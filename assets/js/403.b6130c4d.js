/*! For license information please see 403.b6130c4d.js.LICENSE.txt */
(self.webpackChunk_react_mol_docs=self.webpackChunk_react_mol_docs||[]).push([[403],{7053:function(e,t,n){"use strict";n.d(t,{useSpring:function(){return o.q_},useSprings:function(){return o.bY},q:function(){return u}});var i=n(7209),o=n(8308),r=n(6799),a=n(1997),g=n(2955);let s=e=>e(),l=()=>performance.now();function c(e,t){const n=e.findIndex(t);return n<0?e.length:n}const I=["primitive"].concat(Object.keys(g).filter((e=>/^[A-Z]/.test(e))).map((e=>e[0].toLowerCase()+e.slice(1)))),C=new class{constructor(e){let t=!0,n=!1,i=0,o=[],a=[],g=0;const I=new Set,C=new Set,u=new Set,d=e=>o.indexOf(e)<0&&o.splice(c(o,(t=>t.priority>e.priority)),0,e),h=()=>{if(!t){e(h);try{m()}catch(n){console.error(n)}}},A=()=>{t&&(t=!1,0==i&&(i=l(),e(h)))},p=[];this.setTimeout=(e,t)=>{const n=l()+t,i=()=>{const e=p.findIndex((e=>e.cancel==i));e>=0&&p.splice(e,1)},o=c(p,(e=>e.time>n)),r={time:n,handler:e,cancel:i};return p.splice(o,0,r),A(),r};const m=this.advance=()=>{const e=l();if(I.size&&(I.forEach(d),I.clear()),p.length&&s((()=>{const t=c(p,(t=>t.time>e));p.splice(0,t).forEach((e=>e.handler()))})),e>i){const t=Math.min(64,e-i);i=e,s((()=>{if(o.length){const e=a;for(let n=0;n<o.length;n++){const i=o[n];g=i.priority,i.idle||(r.OH.willAdvance(i),i.advance(t),i.idle||e.push(i))}g=0,a=o,a.length=0,o=e}(0,r.bl)(C,e),u.size&&(n=!0,(0,r.bl)(u,e),n=!1)}))}};this.start=e=>{g>e.priority?I.add(e):(d(e),A())},this.onFrame=e=>{C.add(e),A()},this.onWrite=e=>{n?e(i):u.add(e)}}}((()=>(0,i.z6)()));(0,i.gy)((()=>(C.advance(),!0))),o.OH.assign({createStringInterpolator:r.qS,colors:r.O9,frameLoop:C});const u=(0,a.Ld)(I,{applyAnimatedValues:i.nH}).animated},1581:function(e,t,n){"use strict";n.d(t,{animated:function(){return i.q}});var i=n(7053);n.o(i,"useSpring")&&n.d(t,{useSpring:function(){return i.useSpring}}),n.o(i,"useSprings")&&n.d(t,{useSprings:function(){return i.useSprings}})},9157:function(e,t,n){"use strict";n.d(t,{Nm:function(){return h}});var i=n(2784);function o(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var a=function e(t,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),r=2;r<i;r++)o[r-2]=arguments[r];if(o.length>0)return e(t,n)&&e.apply(void 0,[n].concat(o));if(typeof t!=typeof n)return!1;if(e.str(t)||e.num(t))return t===n;for(var a in t)if(!(a in n))return!1;for(var g in n)if(t[g]!==n[g])return!1;return!0};a.arr=Array.isArray,a.fls=function(e){return a.und(e)||a.nul(e)||!1===e||""===e},a.nul=function(e){return null===e},a.und=function(e){return void 0===e},a.num=function(e){return"number"==typeof e},a.str=function(e){return"string"==typeof e},a.bol=function(e){return"boolean"==typeof e},a.fun=function(e){return"function"==typeof e},a.obj=function(e){return"[object Object]"===Object.prototype.toString.call(e)},a.url=function(e){return e instanceof URL},a.set=function(e){return e instanceof Set},a.map=function(e){return e instanceof Map},a.big=function(e){return a.str(e)&&e===e.toUpperCase()},a.len=function(e,t){return(a.arr(t)||a.str(t))&&t.length===e};var g={media:"",matches:!1,onchange:function(){},addListener:function(){},removeListener:function(){},addEventListener:function(){},removeEventListener:function(){},dispatchEvent:function(e){return!0}},s={mediaConfig:{size:{xs:1,sm:576,md:768,lg:992,xl:1200},width:0,widthRef:null,mediaType:null},viewConfig:{once:!1,onView:null,timeout:0,defaultView:!0},prefix:["none","init","onView","mediaConfig","viewConfig"]};function l(e,t){void 0===t&&(t=s);var n=t.widthRef,i=(null==n?void 0:n.current)||n,o=i?i.clientWidth:t.width||0;if(a.num(e)&&Math.pow(e,2)<1)return e<0?o*(Number(e)+1)<<0:o*Number(e)<<0;if(e instanceof Array&&e.every((function(e){return a.num(e)}))){var r=e.filter((function(e){return e>0})).map((function(e){return e<1?o*Number(e):e})),g=o-(r.length?r.reduce((function(e,t){return e+t})):0);return e.map((function(e){return 0===e?0:e<0?e>-1?~~(g*Number(-e)):e:e<1?~~(o*Number(e)):e}))}return e}function c(e,t){return void 0===t&&(t=s),a.str(e)?e:[t.mediaType||""].concat(Object.entries(e).map((function(e){var t=e[0],n=e[1];return[t.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})).toLowerCase(),n]})).map((function(e){var n=e[0],i=e[1];return a.bol(i)?(i?"":"not ")+n:"("+n+": "+(a.num(i)&&/[height|width]$/.test(n)?l(i,t)+"px":i)+")"}))).filter(Boolean).join(" and ")}var I=["prefix","viewConfig","mediaConfig"];function C(e,t){return function(e,t){var n=t.size,i=void 0===n?{xs:1,sm:576,md:768,lg:992,xl:1200}:n,o=Object.keys(i),r=function(e){return o.find((function(t){return t===e}))?i[e]:0},a=function(e,t,n){return"(min-width:"+r(e)+"px)"+(t+1-n.length<0?" and (max-width:"+(r(n[t+1][0])-1)+"px)":"")},g=o.map((function(t){return e.find((function(e){return e[0]===t}))||null})).filter((function(e){return null!==e})),s=g.length?g.find((function(e){return"xs"===e[0]}))?[]:[["xs",g[0][1]]]:[],l=[].concat(s,g).map((function(e,t){return[a(e[0],t,g),e[1]]})),c=g.length?e.filter((function(e){return!o.find((function(t){return t===e[0]}))})):e;return[].concat(c,l)}(e.map((function(e){var n=e[0],i=e[1];return[c(n,t),l(i,t)]})),t)}function u(e){var t=e.map((function(e){return e instanceof Array?e:Object.entries(e)}));return t[0].map((function(e){return e[0]})).map((function(e){return[e,t.map((function(t){return t.find((function(t){return t[0]===e}))[1]}))]}))}var d=function(e){return function(t,n,l){var c;void 0===n&&(n=[]),void 0===l&&(l=s),a.fun(t)&&(t=t()),a.len(0,n)&&(n=[]);var u=t instanceof Array?t:Object.entries(t),d=(0,i.useState)((function(){return function(e,t){var n=t.prefix,i={viewConfig:t.viewConfig,mediaConfig:t.mediaConfig,initConfig:o(t,I)};return Object.assign.apply(Object,[{},Object.fromEntries(e.filter((function(e){return n.some((function(t){return t===e[0]}))})))].concat(Object.entries(i).map((function(t){var n=t[0],i=t[1];return r({},(e.find((function(e){return e[0]===n}))||[null,{}])[1],i)}))))}(u,l)}))[0],h=(0,i.useState)(C(u,d)),A=h[0],p=h[1],m=(0,i.useState)(d.defaultView),b=m[0],f=m[1],y=(0,i.useState)((A.filter((function(e){return"init"===e[0]}))[0]||A[0])[1]),G=y[0],v=y[1],B=(0,i.useRef)(null),Z=(0,i.useRef)(t),w=(0,i.useRef)(Array(null==(c=n)?void 0:c.length).fill(b)),W=(0,i.useCallback)((function(e){a.fun(e)&&(e=e(Z.current)),Z.current=e;var t=Array.isArray(e)?e:Object.entries(e);p(C(t,d))}),[d]);return e((function(){var e=!0,t=d.prefix,n=A.map((function(n){var i=n[0],o=n[1];if("none"===i&&(B.current=o),null!=t&&t.some((function(e){return e===i})))return{media:null,fn:null};var r=a.und(window)?g:window.matchMedia(i),s=function(){e&&r.matches&&v(o)};return r.addListener(s),e&&r.matches&&v(o),{media:r,fn:s}}));return function(){e=!1,n.map((function(e){var t=e.media,n=e.fn;return n&&(null==t?void 0:t.removeListener(n))}))}}),[A,d]),e((function(){var e,t=!0,i=d.timeout,o=void 0===i?0:i,r=d.once,a=void 0!==r&&r,g=d.onView,s=void 0===g?null:g,l=null==(e=n)?void 0:e.map((function(e,n){var i,r=(null==e?void 0:e.current)||e;if(!r)return{observer:null,el:r};var g=new IntersectionObserver((function(e){var i=e[e.length-1];t&&(setTimeout((function(){w.current[n]=i.isIntersecting,s&&s(i.isIntersecting),B.current&&f(w.current.some(Boolean))}),o),i.isIntersecting&&a&&g.unobserve(r))}),{root:(null==d||null==(i=d.root)?void 0:i.current)||null});return g.observe(r),{observer:g,el:r}}));return function(){t=!1,a&&l.map((function(e){var t=e.observer,n=e.el;return n&&(null==t?void 0:t.unobserve(n))}))}}),[d]),[b||!B.current?G:B.current,W]}},h=d(i.useEffect),A=d(i.useLayoutEffect),p=function(e){return function(t,n,i,o){void 0===i&&(i=[]),void 0===o&&(o=s),a.fun(n)&&(n=[].concat(Array(t)).map((function(e,t){return n(t)})));var r=e(u(n),i,o),g=r[0],l=r[1];return[g,function(e){a.fun(e)&&(e=[].concat(Array(t)).map((function(t,n){return e(n)}))),l(u(e))}]}},m=(p(h),p(A),function(e){return function(t,n){void 0===n&&(n=!1);var o=c(t),r=(0,i.useState)(n),s=r[0],l=r[1];return e((function(){var e=!0,t=a.und(window)?g:window.matchMedia(o),n=function(){return e&&l(Boolean(t.matches))};return t.addListener(n),l(t.matches),function(){return e=!1,void t.removeListener(n)}}),[o]),s}}),b=(m(i.useEffect),m(i.useLayoutEffect),["defaultView","once","timeout"]),f=function(e){return function(t,n,g){void 0===g&&(g=s.viewConfig);var l=g,c=l.defaultView,I=l.once,C=l.timeout,u=o(l,b),d=(0,i.useState)(!0===c),h=d[0],A=d[1],p=(0,i.useRef)(u);return e((function(){a(p.current,u)||(p.current=u)}),[u]),e((function(){var e,i,o=!0,a=(null==(e=p.current)||null==(i=e.root)?void 0:i.current)||null,g=t instanceof Element?t:null==t?void 0:t.current;if(!g)return function(){o=!1};var s=new IntersectionObserver((function(e){var t=e[e.length-1];n&&n(t),o&&(setTimeout((function(){return A(t.isIntersecting)}),C),t.isIntersecting&&I&&s.unobserve(g))}),r({},p.current,{root:a}));return s.observe(g),function(){o=!1,I&&s.unobserve(g)}}),[p.current,t]),h}};f(i.useEffect),f(i.useLayoutEffect)},6470:function(e,t,n){"use strict";function i(e,t,n,i,o,r,a){try{var g=e[r](a),s=g.value}catch(l){return void n(l)}g.done?t(s):Promise.resolve(s).then(i,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function g(e){i(a,o,r,g,s,"next",e)}function s(e){i(a,o,r,g,s,"throw",e)}g(void 0)}))}}n.d(t,{Z:function(){return o}})},9539:function(e,t,n){"use strict";function i(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}n.d(t,{Z:function(){return i}})},8879:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=0;function o(e){return"__private_"+i+++"_"+e}},3182:function(e,t,n){"use strict";function i(e,t){return t||(t=e.slice(0)),e.raw=t,e}n.d(t,{Z:function(){return i}})},7162:function(e,t,n){e.exports=n(5047)},1997:function(e,t,n){"use strict";n.d(t,{eC:function(){return I},iG:function(){return c},Ld:function(){return f},ys:function(){return a},sb:function(){return A},He:function(){return s},f3:function(){return g}});var i=n(6799),o=n(2784);const r=Symbol.for("Animated:node"),a=e=>e&&e[r],g=(e,t)=>(0,i.dE)(e,r,t),s=e=>e&&e[r]&&e[r].getPayload();class l{constructor(){g(this,this)}getPayload(){return this.payload||[]}}class c extends l{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,i.is.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new c(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return i.is.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,i.is.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class I extends c{constructor(e){super(0),this._string=null,this._toString=(0,i.mD)({output:[e,e]})}static create(e){return new I(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(i.is.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=(0,i.mD)({output:[this.getValue(),e]})),this._value=0,super.reset()}}const C={dependencies:null};class u extends l{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return(0,i.rU)(this.source,((n,o)=>{var a;(a=n)&&a[r]===a?t[o]=n.getValue(e):(0,i.j$)(n)?t[o]=(0,i.je)(n):e||(t[o]=n)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&(0,i.S6)(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return(0,i.rU)(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){C.dependencies&&(0,i.j$)(e)&&C.dependencies.add(e);const t=s(e);t&&(0,i.S6)(t,(e=>this.add(e)))}}class d extends u{constructor(e){super(e)}static create(e){return new d(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.some(((t,n)=>t.setValue(e[n]))):(super.setValue(e.map(h)),!0)}}function h(e){return((0,i.Df)(e)?I:c).create(e)}function A(e){const t=a(e);return t?t.constructor:i.is.arr(e)?d:(0,i.Df)(e)?I:c}const p=(e,t)=>{const n=!i.is.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,o.forwardRef)(((r,a)=>{const g=(0,o.useRef)(null),s=n&&(0,o.useCallback)((e=>{g.current=function(e,t){e&&(i.is.fun(e)?e(t):e.current=t);return t}(a,e)}),[a]),[l,c]=function(e,t){const n=new Set;C.dependencies=n,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)});return e=new u(e),C.dependencies=null,[e,n]}(r,t),I=(0,i.NW)(),d=()=>{const e=g.current;if(n&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,l.getValue(!0)))&&I()},h=new m(d,c),A=(0,o.useRef)();(0,i.bt)((()=>{const e=A.current;A.current=h,(0,i.S6)(c,(e=>(0,i.UI)(e,h))),e&&((0,i.S6)(e.deps,(t=>(0,i.iL)(t,e))),i.Wn.cancel(e.update))})),(0,o.useEffect)(d,[]),(0,i.tf)((()=>()=>{const e=A.current;(0,i.S6)(e.deps,(t=>(0,i.iL)(t,e)))}));const p=t.getComponentProps(l.getValue());return(0,o.createElement)(e,{...p,ref:s})}))};class m{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&i.Wn.write(this.update)}}const b=Symbol.for("AnimatedComponent"),f=(e,{applyAnimatedValues:t=(()=>!1),createAnimatedStyle:n=(e=>new u(e)),getComponentProps:o=(e=>e)}={})=>{const r={applyAnimatedValues:t,createAnimatedStyle:n,getComponentProps:o},a=e=>{const t=y(e)||"Anonymous";return(e=i.is.str(e)?a[e]||(a[e]=p(e,r)):e[b]||(e[b]=p(e,r))).displayName=`Animated(${t})`,e};return(0,i.rU)(e,((t,n)=>{i.is.arr(e)&&(n=y(t)),a[n]=a(t)})),{animated:a}},y=e=>i.is.str(e)?e:e&&i.is.str(e.displayName)?e.displayName:i.is.fun(e)&&e.name||null},8308:function(e,t,n){"use strict";n.d(t,{OH:function(){return i.OH},q_:function(){return de},bY:function(){return ue}});var i=n(6799),o=n(2784),r=n(1997);function a(e,...t){return i.is.fun(e)?e(...t):e}const g=(e,t)=>!0===e||!!(t&&e&&(i.is.fun(e)?e(t):(0,i.qo)(e).includes(t))),s=(e,t)=>i.is.obj(e)?t&&e[t]:e,l=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,c=e=>e,I=(e,t=c)=>{let n=C;e.default&&!0!==e.default&&(e=e.default,n=Object.keys(e));const o={};for(const r of n){const n=t(e[r],r);i.is.und(n)||(o[r]=n)}return o},C=["config","onProps","onStart","onChange","onPause","onResume","onRest"],u={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function d(e){const t=function(e){const t={};let n=0;if((0,i.rU)(e,((e,i)=>{u[i]||(t[i]=e,n++)})),n)return t}(e);if(t){const n={to:t};return(0,i.rU)(e,((e,i)=>i in t||(n[i]=e))),n}return{...e}}function h(e){return e=(0,i.je)(e),i.is.arr(e)?e.map(h):(0,i.Df)(e)?i.OH.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function A(e){for(const t in e)return!0;return!1}function p(e){return i.is.fun(e)||i.is.arr(e)&&i.is.obj(e[0])}function m(e,t){var n;null==(n=e.ref)||n.delete(e),null==t||t.delete(e)}function b(e,t){var n;t&&e.ref!==t&&(null==(n=e.ref)||n.delete(e),t.add(e),e.ref=t)}const f={tension:170,friction:26,mass:1,damping:1,easing:e=>e,clamp:!1};class y{constructor(){this.velocity=0,Object.assign(this,f)}}function G(e,t){if(i.is.und(t.decay)){const n=!i.is.und(t.tension)||!i.is.und(t.friction);!n&&i.is.und(t.frequency)&&i.is.und(t.damping)&&i.is.und(t.mass)||(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}else e.duration=void 0}const v=[];class B{constructor(){this.changed=!1,this.values=v,this.toValues=null,this.fromValues=v,this.config=new y,this.immediate=!1}}function Z(e,{key:t,props:n,defaultProps:o,state:r,actions:s}){return new Promise(((l,c)=>{var I;let C,u,d=g(null!=(I=n.cancel)?I:null==o?void 0:o.cancel,t);if(d)p();else{i.is.und(n.pause)||(r.paused=g(n.pause,t));let e=null==o?void 0:o.pause;!0!==e&&(e=r.paused||g(e,t)),C=a(n.delay||0,t),e?(r.resumeQueue.add(A),s.pause()):(s.resume(),A())}function h(){r.resumeQueue.add(A),r.timeouts.delete(u),u.cancel(),C=u.time-i.Wn.now()}function A(){C>0?(u=i.Wn.setTimeout(p,C),r.pauseQueue.add(h),r.timeouts.add(u)):p()}function p(){r.pauseQueue.delete(h),r.timeouts.delete(u),e<=(r.cancelId||0)&&(d=!0);try{s.start({...n,callId:e,cancel:d},l)}catch(t){c(t)}}}))}const w=(e,t)=>1==t.length?t[0]:t.some((e=>e.cancelled))?R(e.get()):t.every((e=>e.noop))?W(e.get()):S(e.get(),t.every((e=>e.finished))),W=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),S=(e,t,n=!1)=>({value:e,finished:t,cancelled:n}),R=e=>({value:e,cancelled:!0,finished:!1});function V(e,t,n,o){const{callId:r,parentId:a,onRest:g}=t,{asyncTo:s,promise:l}=n;return a||e!==s||t.reset?n.promise=(async()=>{n.asyncId=r,n.asyncTo=e;const c=I(t,((e,t)=>"onRest"===t?void 0:e));let C,u;const d=new Promise(((e,t)=>(C=e,u=t))),h=e=>{const t=r<=(n.cancelId||0)&&R(o)||r!==n.asyncId&&S(o,!1);if(t)throw e.result=t,u(e),e},A=(e,t)=>{const a=new X,g=new H;return(async()=>{if(i.OH.skipAnimation)throw x(n),g.result=S(o,!1),u(g),g;h(a);const s=i.is.obj(e)?{...e}:{...t,to:e};s.parentId=r,(0,i.rU)(c,((e,t)=>{i.is.und(s[t])&&(s[t]=e)}));const l=await o.start(s);return h(a),n.paused&&await new Promise((e=>{n.resumeQueue.add(e)})),l})()};let p;if(i.OH.skipAnimation)return x(n),S(o,!1);try{let t;t=i.is.arr(e)?(async e=>{for(const t of e)await A(t)})(e):Promise.resolve(e(A,o.stop.bind(o))),await Promise.all([t.then(C),d]),p=S(o.get(),!0,!1)}catch(m){if(m instanceof X)p=m.result;else{if(!(m instanceof H))throw m;p=m.result}}finally{r==n.asyncId&&(n.asyncId=a,n.asyncTo=a?s:void 0,n.promise=a?l:void 0)}return i.is.fun(g)&&i.Wn.batchedUpdates((()=>{g(p,o,o.item)})),p})():l}function x(e,t){(0,i.yl)(e.timeouts,(e=>e.cancel())),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class X extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}}class H extends Error{constructor(){super("SkipAnimationSignal")}}const Y=e=>e instanceof N;let K=1;class N extends i.B0{constructor(){super(...arguments),this.id=K++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=(0,r.ys)(this);return e&&e.getValue()}to(...e){return i.OH.to(this,e)}interpolate(...e){return(0,i.LW)(),i.OH.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){(0,i.k0)(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||i.fT.sort(this),(0,i.k0)(this,{type:"priority",parent:this,priority:e})}}const M=Symbol.for("SpringPhase"),F=e=>(1&e[M])>0,z=e=>(2&e[M])>0,L=e=>(4&e[M])>0,k=(e,t)=>t?e[M]|=3:e[M]&=-3,E=(e,t)=>t?e[M]|=4:e[M]&=-5;class T extends N{constructor(e,t){if(super(),this.animation=new B,this.defaultProps={},this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!i.is.und(e)||!i.is.und(t)){const n=i.is.obj(e)?{...e}:{...t,from:e};i.is.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(z(this)||this._state.asyncTo)||L(this)}get goal(){return(0,i.je)(this.animation.to)}get velocity(){const e=(0,r.ys)(this);return e instanceof r.iG?e.lastVelocity||0:e.getPayload().map((e=>e.lastVelocity||0))}get hasAnimated(){return F(this)}get isAnimating(){return z(this)}get isPaused(){return L(this)}advance(e){let t=!0,n=!1;const o=this.animation;let{config:a,toValues:g}=o;const s=(0,r.He)(o.to);!s&&(0,i.j$)(o.to)&&(g=(0,i.qo)((0,i.je)(o.to))),o.values.forEach(((l,c)=>{if(l.done)return;const I=l.constructor==r.eC?1:s?s[c].lastPosition:g[c];let C=o.immediate,u=I;if(!C){if(u=l.lastPosition,a.tension<=0)return void(l.done=!0);let t=l.elapsedTime+=e;const n=o.fromValues[c],r=null!=l.v0?l.v0:l.v0=i.is.arr(a.velocity)?a.velocity[c]:a.velocity;let g;if(i.is.und(a.duration))if(a.decay){const e=!0===a.decay?.998:a.decay,i=Math.exp(-(1-e)*t);u=n+r/(1-e)*(1-i),C=Math.abs(l.lastPosition-u)<.1,g=r*i}else{g=null==l.lastVelocity?r:l.lastVelocity;const t=a.precision||(n==I?.005:Math.min(1,.001*Math.abs(I-n))),o=a.restVelocity||t/10,s=a.clamp?0:a.bounce,c=!i.is.und(s),d=n==I?l.v0>0:n<I;let h,A=!1;const p=1,m=Math.ceil(e/p);for(let e=0;e<m&&(h=Math.abs(g)>o,h||(C=Math.abs(I-u)<=t,!C));++e){c&&(A=u==I||u>I==d,A&&(g=-g*s,u=I));g+=(1e-6*-a.tension*(u-I)+.001*-a.friction*g)/a.mass*p,u+=g*p}}else{let i=1;a.duration>0&&(this._memoizedDuration!==a.duration&&(this._memoizedDuration=a.duration,l.durationProgress>0&&(l.elapsedTime=a.duration*l.durationProgress,t=l.elapsedTime+=e)),i=(a.progress||0)+t/this._memoizedDuration,i=i>1?1:i<0?0:i,l.durationProgress=i),u=n+a.easing(i)*(I-n),g=(u-l.lastPosition)/e,C=1==i}l.lastVelocity=g,Number.isNaN(u)&&(console.warn("Got NaN while animating:",this),C=!0)}s&&!s[c].done&&(C=!1),C?l.done=!0:t=!1,l.setValue(u,a.round)&&(n=!0)}));const l=(0,r.ys)(this);if(t){const e=(0,i.je)(o.to);(l.setValue(e)||n)&&this._onChange(e),this._stop()}else n&&this._onChange(l.getValue())}set(e){return i.Wn.batchedUpdates((()=>{this._stop(),this._focus(e),this._set(e)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(z(this)){const{to:e,config:t}=this.animation;i.Wn.batchedUpdates((()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()}))}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let n;return i.is.und(e)?(n=this.queue||[],this.queue=[]):n=[i.is.obj(e)?e:{...t,to:e}],Promise.all(n.map((e=>this._update(e)))).then((e=>w(this,e)))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),x(this._state,e&&this._lastCallId),i.Wn.batchedUpdates((()=>this._stop(t,e))),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:n,from:o}=e;n=i.is.obj(n)?n[t]:n,(null==n||p(n))&&(n=void 0),o=i.is.obj(o)?o[t]:o,null==o&&(o=void 0);const a={to:n,from:o};return F(this)||(e.reverse&&([n,o]=[o,n]),o=(0,i.je)(o),i.is.und(o)?(0,r.ys)(this)||this._set(n):this._set(o)),a}_update({...e},t){const{key:n,defaultProps:o}=this;e.default&&Object.assign(o,I(e,((e,t)=>/^on/.test(t)?s(e,n):e))),O(this,e,"onProps"),j(this,"onProps",e,this);const r=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const a=this._state;return Z(++this._lastCallId,{key:n,props:e,defaultProps:o,state:a,actions:{pause:()=>{L(this)||(E(this,!0),(0,i.bl)(a.pauseQueue),j(this,"onPause",S(this,U(this,this.animation.to)),this))},resume:()=>{L(this)&&(E(this,!1),z(this)&&this._resume(),(0,i.bl)(a.resumeQueue),j(this,"onResume",S(this,U(this,this.animation.to)),this))},start:this._merge.bind(this,r)}}).then((n=>{if(e.loop&&n.finished&&(!t||!n.noop)){const t=_(e);if(t)return this._update(t,!0)}return n}))}_merge(e,t,n){if(t.cancel)return this.stop(!0),n(R(this));const o=!i.is.und(e.to),s=!i.is.und(e.from);if(o||s){if(!(t.callId>this._lastToId))return n(R(this));this._lastToId=t.callId}const{key:l,defaultProps:c,animation:I}=this,{to:C,from:u}=I;let{to:d=C,from:A=u}=e;!s||o||t.default&&!i.is.und(d)||(d=A),t.reverse&&([d,A]=[A,d]);const m=!(0,i.Xy)(A,u);m&&(I.from=A),A=(0,i.je)(A);const b=!(0,i.Xy)(d,C);b&&this._focus(d);const y=p(t.to),{config:v}=I,{decay:B,velocity:Z}=v;(o||s)&&(v.velocity=0),t.config&&!y&&function(e,t,n){n&&(G(n={...n},t),t={...n,...t}),G(e,t),Object.assign(e,t);for(const i in f)null==e[i]&&(e[i]=f[i]);let{mass:o,frequency:r,damping:a}=e;i.is.und(r)||(r<.01&&(r=.01),a<0&&(a=0),e.tension=Math.pow(2*Math.PI/r,2)*o,e.friction=4*Math.PI*a*o/r)}(v,a(t.config,l),t.config!==c.config?a(c.config,l):void 0);let w=(0,r.ys)(this);if(!w||i.is.und(d))return n(S(this,!0));const x=i.is.und(t.reset)?s&&!t.default:!i.is.und(A)&&g(t.reset,l),X=x?A:this.get(),H=h(d),Y=i.is.num(H)||i.is.arr(H)||(0,i.Df)(H),K=!y&&(!Y||g(c.immediate||t.immediate,l));if(b){const e=(0,r.sb)(d);if(e!==w.constructor){if(!K)throw Error(`Cannot animate between ${w.constructor.name} and ${e.name}, as the "to" prop suggests`);w=this._set(H)}}const N=w.constructor;let M=(0,i.j$)(d),L=!1;if(!M){const e=x||!F(this)&&m;(b||e)&&(L=(0,i.Xy)(h(X),H),M=!L),(0,i.Xy)(v.decay,B)&&(0,i.Xy)(v.velocity,Z)||(M=!0)}if(L&&z(this)&&(I.changed&&!x?M=!0:M||this._stop(C)),!y&&((M||(0,i.j$)(C))&&(I.values=w.getPayload(),I.toValues=(0,i.j$)(d)?null:N==r.eC?[1]:(0,i.qo)(H)),I.immediate!=K&&(I.immediate=K,K||x||this._set(C)),M)){const{onRest:e}=I;(0,i.S6)(Q,(e=>O(this,t,e)));const o=S(this,U(this,C));(0,i.bl)(this._pendingCalls,o),this._pendingCalls.add(n),I.changed&&i.Wn.batchedUpdates((()=>{var t;I.changed=!x,null==e||e(o,this),x?a(c.onRest,o):null==(t=I.onStart)||t.call(I,o,this)}))}x&&this._set(X),y?n(V(t.to,t,this._state,this)):M?this._start():z(this)&&!b?this._pendingCalls.add(n):n(W(X))}_focus(e){const t=this.animation;e!==t.to&&((0,i.Ll)(this)&&this._detach(),t.to=e,(0,i.Ll)(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;(0,i.j$)(t)&&((0,i.UI)(t,this),Y(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;(0,i.j$)(e)&&(0,i.iL)(e,this)}_set(e,t=!0){const n=(0,i.je)(e);if(!i.is.und(n)){const e=(0,r.ys)(this);if(!e||!(0,i.Xy)(n,e.getValue())){const o=(0,r.sb)(n);e&&e.constructor==o?e.setValue(n):(0,r.f3)(this,o.create(n)),e&&i.Wn.batchedUpdates((()=>{this._onChange(n,t)}))}}return(0,r.ys)(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,j(this,"onStart",S(this,U(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),a(this.animation.onChange,e,this)),a(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;(0,r.ys)(this).reset((0,i.je)(e.to)),e.immediate||(e.fromValues=e.values.map((e=>e.lastPosition))),z(this)||(k(this,!0),L(this)||this._resume())}_resume(){i.OH.skipAnimation?this.finish():i.fT.start(this)}_stop(e,t){if(z(this)){k(this,!1);const n=this.animation;(0,i.S6)(n.values,(e=>{e.done=!0})),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),(0,i.k0)(this,{type:"idle",parent:this});const o=t?R(this.get()):S(this.get(),U(this,null!=e?e:n.to));(0,i.bl)(this._pendingCalls,o),n.changed&&(n.changed=!1,j(this,"onRest",o,this))}}}function U(e,t){const n=h(t),o=h(e.get());return(0,i.Xy)(o,n)}function _(e,t=e.loop,n=e.to){let i=a(t);if(i){const o=!0!==i&&d(i),r=(o||e).reverse,a=!o||o.reset;return J({...e,loop:t,default:!1,pause:void 0,to:!r||p(n)?n:void 0,from:a?e.from:void 0,reset:a,...o})}}function J(e){const{to:t,from:n}=e=d(e),o=new Set;return i.is.obj(t)&&P(t,o),i.is.obj(n)&&P(n,o),e.keys=o.size?Array.from(o):null,e}function D(e){const t=J(e);return i.is.und(t.default)&&(t.default=I(t)),t}function P(e,t){(0,i.rU)(e,((e,n)=>null!=e&&t.add(n)))}const Q=["onStart","onRest","onChange","onPause","onResume"];function O(e,t,n){e.animation[n]=t[n]!==l(t,n)?s(t[n],e.key):void 0}function j(e,t,...n){var i,o,r,a;null==(o=(i=e.animation)[t])||o.call(i,...n),null==(a=(r=e.defaultProps)[t])||a.call(r,...n)}const q=["onStart","onChange","onRest"];let $=1;class ee{constructor(e,t){this.id=$++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((e=>e.idle))}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each(((t,n)=>e[n]=t.get())),e}set(e){for(const t in e){const n=e[t];i.is.und(n)||this.springs[t].set(n)}}update(e){return e&&this.queue.push(J(e)),this}start(e){let{queue:t}=this;return e?t=(0,i.qo)(e).map(J):this.queue=[],this._flush?this._flush(this,t):(ge(this,t),te(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const n=this.springs;(0,i.S6)((0,i.qo)(t),(t=>n[t].stop(!!e)))}else x(this._state,this._lastAsyncId),this.each((t=>t.stop(!!e)));return this}pause(e){if(i.is.und(e))this.start({pause:!0});else{const t=this.springs;(0,i.S6)((0,i.qo)(e),(e=>t[e].pause()))}return this}resume(e){if(i.is.und(e))this.start({pause:!1});else{const t=this.springs;(0,i.S6)((0,i.qo)(e),(e=>t[e].resume()))}return this}each(e){(0,i.rU)(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:n}=this._events,o=this._active.size>0,r=this._changed.size>0;(o&&!this._started||r&&!this._started)&&(this._started=!0,(0,i.yl)(e,(([e,t])=>{t.value=this.get(),e(t,this,this._item)})));const a=!o&&this._started,g=r||a&&n.size?this.get():null;r&&t.size&&(0,i.yl)(t,(([e,t])=>{t.value=g,e(t,this,this._item)})),a&&(this._started=!1,(0,i.yl)(n,(([e,t])=>{t.value=g,e(t,this,this._item)})))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}i.Wn.onFrame(this._onFrame)}}function te(e,t){return Promise.all(t.map((t=>ne(e,t)))).then((t=>w(e,t)))}async function ne(e,t,n){const{keys:o,to:r,from:a,loop:g,onRest:s,onResolve:c}=t,I=i.is.obj(t.default)&&t.default;g&&(t.loop=!1),!1===r&&(t.to=null),!1===a&&(t.from=null);const C=i.is.arr(r)||i.is.fun(r)?r:void 0;C?(t.to=void 0,t.onRest=void 0,I&&(I.onRest=void 0)):(0,i.S6)(q,(n=>{const o=t[n];if(i.is.fun(o)){const i=e._events[n];t[n]=({finished:e,cancelled:t})=>{const n=i.get(o);n?(e||(n.finished=!1),t&&(n.cancelled=!0)):i.set(o,{value:null,finished:e||!1,cancelled:t||!1})},I&&(I[n]=t[n])}}));const u=e._state;t.pause===!u.paused?(u.paused=t.pause,(0,i.bl)(t.pause?u.pauseQueue:u.resumeQueue)):u.paused&&(t.pause=!0);const d=(o||Object.keys(e.springs)).map((n=>e.springs[n].start(t))),h=!0===t.cancel||!0===l(t,"cancel");(C||h&&u.asyncId)&&d.push(Z(++e._lastAsyncId,{props:t,state:u,actions:{pause:i.ZT,resume:i.ZT,start(t,n){h?(x(u,e._lastAsyncId),n(R(e))):(t.onRest=s,n(V(C,t,u,e)))}}})),u.paused&&await new Promise((e=>{u.resumeQueue.add(e)}));const A=w(e,await Promise.all(d));if(g&&A.finished&&(!n||!A.noop)){const n=_(t,g,r);if(n)return ge(e,[n]),ne(e,n,!0)}return c&&i.Wn.batchedUpdates((()=>c(A,e,e.item))),A}function ie(e,t){const n={...e.springs};return t&&(0,i.S6)((0,i.qo)(t),(e=>{i.is.und(e.keys)&&(e=J(e)),i.is.obj(e.to)||(e={...e,to:void 0}),ae(n,e,(e=>re(e)))})),n}function oe(e,t){(0,i.rU)(t,((t,n)=>{e.springs[n]||(e.springs[n]=t,(0,i.UI)(t,e))}))}function re(e,t){const n=new T;return n.key=e,t&&(0,i.UI)(n,t),n}function ae(e,t,n){t.keys&&(0,i.S6)(t.keys,(i=>{(e[i]||(e[i]=n(i)))._prepareNode(t)}))}function ge(e,t){(0,i.S6)(t,(t=>{ae(e.springs,t,(t=>re(t,e)))}))}const se=({children:e,...t})=>{const n=(0,o.useContext)(le),r=t.pause||!!n.pause,a=t.immediate||!!n.immediate;t=(0,i.Pr)((()=>({pause:r,immediate:a})),[r,a]);const{Provider:g}=le;return(0,o.createElement)(g,{value:t},e)},le=(ce=se,Ie={},Object.assign(ce,(0,o.createContext)(Ie)),ce.Provider._context=ce,ce.Consumer._context=ce,ce);var ce,Ie;se.Provider=le.Provider,se.Consumer=le.Consumer;class Ce extends Function{constructor(){super("return arguments.callee._call.apply(arguments.callee, arguments)"),this.current=[]}_call(e){(0,i.ZR)(),this.start(e)}set(e){(0,i.S6)(this.current,(t=>t.set(e)))}start(e){const t=[];return(0,i.S6)(this.current,((n,o)=>{if(i.is.und(e))t.push(n.start());else{const i=this._getProps(e,n,o);i&&t.push(n.start(i))}})),t}update(e){return(0,i.S6)(this.current,((t,n)=>t.update(this._getProps(e,t,n)))),this}add(e){this.current.includes(e)||this.current.push(e)}delete(e){const t=this.current.indexOf(e);~t&&this.current.splice(t,1)}_getProps(e,t,n){return i.is.fun(e)?e(n,t):e}}function ue(e,t,n){const r=i.is.fun(t)&&t;r&&!n&&(n=[]);const a=(0,o.useMemo)((()=>r||3==arguments.length?new Ce:void 0),[]),g=(0,o.useRef)(0),s=(0,i.NW)(),l=(0,o.useMemo)((()=>({ctrls:[],queue:[],flush(e,t){const n=ie(e,t);return g.current>0&&!l.queue.length&&!Object.keys(n).some((t=>!e.springs[t]))?te(e,t):new Promise((i=>{oe(e,n),l.queue.push((()=>{i(te(e,t))})),s()}))}})),[]),c=[...l.ctrls],I=[],C=(0,i.zH)(e)||0,u=c.slice(e,C);function d(e,n){for(let i=e;i<n;i++){const e=c[i]||(c[i]=new ee(null,l.flush)),n=r?r(i,e):t[i];n&&(I[i]=D(n))}}(0,o.useMemo)((()=>{c.length=e,d(C,e)}),[e]),(0,o.useMemo)((()=>{d(0,Math.min(C,e))}),n);const h=c.map(((e,t)=>ie(e,I[t]))),p=(0,o.useContext)(se),f=(0,i.zH)(p),y=p!==f&&A(p);(0,i.bt)((()=>{g.current++,l.ctrls=c;const{queue:e}=l;e.length&&(l.queue=[],(0,i.S6)(e,(e=>e()))),(0,i.S6)(u,(e=>{m(e,a),e.stop(!0)})),(0,i.S6)(c,((e,t)=>{oe(e,h[t]),null==a||a.add(e),y&&e.start({default:p});const n=I[t];n&&(b(e,n.ref),e.ref?e.queue.push(n):e.start(n))}))})),(0,i.tf)((()=>()=>{(0,i.S6)(l.ctrls,(e=>e.stop(!0)))}));const G=h.map((e=>({...e})));return a?[G,a]:G}function de(e,t){const n=i.is.fun(e),[[o],r]=ue(1,n?e:[e],n?t||[]:t);return n||2==arguments.length?[o,r]:o}(0,i.S6)(["stop","pause","resume"],(e=>{Ce.prototype[e]=function(){return(0,i.S6)(this.current,(t=>t[e](...arguments))),this}}));class he extends N{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=(0,i.mD)(...t);const n=this._get(),o=(0,r.sb)(n);(0,r.f3)(this,o.create(n))}advance(e){const t=this._get(),n=this.get();(0,i.Xy)(t,n)||((0,r.ys)(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&pe(this._active)&&me(this)}_get(){const e=i.is.arr(this.source)?this.source.map(i.je):(0,i.qo)((0,i.je)(this.source));return this.calc(...e)}_start(){this.idle&&!pe(this._active)&&(this.idle=!1,(0,i.S6)((0,r.He)(this),(e=>{e.done=!1})),i.OH.skipAnimation?(i.Wn.batchedUpdates((()=>this.advance())),me(this)):i.fT.start(this))}_attach(){let e=1;(0,i.S6)((0,i.qo)(this.source),(t=>{(0,i.j$)(t)&&(0,i.UI)(t,this),Y(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){(0,i.S6)((0,i.qo)(this.source),(e=>{(0,i.j$)(e)&&(0,i.iL)(e,this)})),this._active.clear(),me(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=(0,i.qo)(this.source).reduce(((e,t)=>Math.max(e,(Y(t)?t.priority:0)+1)),0))}}function Ae(e){return!1!==e.idle}function pe(e){return!e.size||Array.from(e).every(Ae)}function me(e){e.idle||(e.idle=!0,(0,i.S6)((0,r.He)(e),(e=>{e.done=!0})),(0,i.k0)(e,{type:"idle",parent:e}))}i.OH.assign({createStringInterpolator:i.qS,to:(e,t)=>new he(e,t)});i.fT.advance},6799:function(e,t,n){"use strict";n.d(t,{B0:function(){return me},OH:function(){return N},UI:function(){return fe},k0:function(){return pe},O9:function(){return J},mD:function(){return Ie},qS:function(){return Se},dE:function(){return v},ZR:function(){return Ye},LW:function(){return Xe},S6:function(){return w},rU:function(){return W},yl:function(){return R},bl:function(){return V},fT:function(){return k},Ll:function(){return Ae},je:function(){return he},j$:function(){return de},is:function(){return B},Df:function(){return Ke},Xy:function(){return Z},ZT:function(){return G},Wn:function(){return o},iL:function(){return ye},qo:function(){return S},NW:function(){return Fe},bt:function(){return Ee},Pr:function(){return Le},tf:function(){return Ne},zH:function(){return ke}});let i=m();const o=e=>d(e,i);let r=m();o.write=e=>d(e,r);let a=m();o.onStart=e=>d(e,a);let g=m();o.onFrame=e=>d(e,g);let s=m();o.onFinish=e=>d(e,s);let l=[];o.setTimeout=(e,t)=>{let n=o.now()+t,i=()=>{let e=l.findIndex((e=>e.cancel==i));~e&&l.splice(e,1),f.count-=~e?1:0},r={time:n,handler:e,cancel:i};return l.splice(c(n),0,r),f.count+=1,h(),r};let c=e=>~(~l.findIndex((t=>t.time>e))||~l.length);o.cancel=e=>{i.delete(e),r.delete(e)},o.sync=e=>{u=!0,o.batchedUpdates(e),u=!1},o.throttle=e=>{let t;function n(){try{e(...t)}finally{t=null}}function i(...e){t=e,o.onStart(n)}return i.handler=e,i.cancel=()=>{a.delete(n),t=null},i};let I="undefined"!=typeof window?window.requestAnimationFrame:()=>{};o.use=e=>I=e,o.now="undefined"!=typeof performance?()=>performance.now():Date.now,o.batchedUpdates=e=>e(),o.catch=console.error;let C=-1,u=!1;function d(e,t){u?(t.delete(e),e(0)):(t.add(e),h())}function h(){C<0&&(C=0,I(A))}function A(){~C&&(I(A),o.batchedUpdates(p))}function p(){let e=C;C=o.now();let t=c(C);t&&(b(l.splice(0,t),(e=>e.handler())),f.count-=t),a.flush(),i.flush(e?Math.min(64,C-e):16.667),g.flush(),r.flush(),s.flush()}function m(){let e=new Set,t=e;return{add(n){f.count+=t!=e||e.has(n)?0:1,e.add(n)},delete:n=>(f.count-=t==e&&e.has(n)?1:0,e.delete(n)),flush(n){t.size&&(e=new Set,f.count-=t.size,b(t,(t=>t(n)&&e.add(t))),f.count+=e.size,t=e)}}}function b(e,t){e.forEach((e=>{try{t(e)}catch(n){o.catch(n)}}))}const f={count:0,clear(){C=-1,l=[],a=m(),i=m(),g=m(),r=m(),s=m(),f.count=0}};var y=n(2784);function G(){}const v=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),B={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function Z(e,t){if(B.arr(e)){if(!B.arr(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}const w=(e,t)=>e.forEach(t);function W(e,t,n){for(const i in e)t.call(n,e[i],i)}const S=e=>B.und(e)?[]:B.arr(e)?e:[e];function R(e,t){if(e.size){const n=Array.from(e);e.clear(),w(n,t)}}const V=(e,...t)=>R(e,(e=>e(...t)));let x,X,H=null,Y=!1,K=G;var N=Object.freeze({__proto__:null,get createStringInterpolator(){return x},get to(){return X},get colors(){return H},get skipAnimation(){return Y},get willAdvance(){return K},assign:e=>{e.to&&(X=e.to),e.now&&(o.now=e.now),void 0!==e.colors&&(H=e.colors),null!=e.skipAnimation&&(Y=e.skipAnimation),e.createStringInterpolator&&(x=e.createStringInterpolator),e.requestAnimationFrame&&o.use(e.requestAnimationFrame),e.batchedUpdates&&(o.batchedUpdates=e.batchedUpdates),e.willAdvance&&(K=e.willAdvance)}});const M=new Set;let F=[],z=[],L=0;const k={get idle(){return!M.size&&!F.length},start(e){L>e.priority?(M.add(e),o.onStart(E)):(T(e),o(_))},advance:_,sort(e){if(L)o.onFrame((()=>k.sort(e)));else{const t=F.indexOf(e);~t&&(F.splice(t,1),U(e))}},clear(){F=[],M.clear()}};function E(){M.forEach(T),M.clear(),o(_)}function T(e){F.includes(e)||U(e)}function U(e){F.splice(function(e,t){const n=e.findIndex(t);return n<0?e.length:n}(F,(t=>t.priority>e.priority)),0,e)}function _(e){const t=z;for(let n=0;n<F.length;n++){const i=F[n];L=i.priority,i.idle||(K(i),i.advance(e),i.idle||t.push(i))}return L=0,z=F,z.length=0,F=t,F.length>0}const J={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},D="[-+]?\\d*\\.?\\d+",P=D+"%";function Q(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const O=new RegExp("rgb"+Q(D,D,D)),j=new RegExp("rgba"+Q(D,D,D,D)),q=new RegExp("hsl"+Q(D,P,P)),$=new RegExp("hsla"+Q(D,P,P,D)),ee=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,te=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,ne=/^#([0-9a-fA-F]{6})$/,ie=/^#([0-9a-fA-F]{8})$/;function oe(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function re(e,t,n){const i=n<.5?n*(1+t):n+t-n*t,o=2*n-i,r=oe(o,i,e+1/3),a=oe(o,i,e),g=oe(o,i,e-1/3);return Math.round(255*r)<<24|Math.round(255*a)<<16|Math.round(255*g)<<8}function ae(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function ge(e){return(parseFloat(e)%360+360)%360/360}function se(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function le(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function ce(e){let t=function(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=ne.exec(e))?parseInt(t[1]+"ff",16)>>>0:H&&void 0!==H[e]?H[e]:(t=O.exec(e))?(ae(t[1])<<24|ae(t[2])<<16|ae(t[3])<<8|255)>>>0:(t=j.exec(e))?(ae(t[1])<<24|ae(t[2])<<16|ae(t[3])<<8|se(t[4]))>>>0:(t=ee.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=ie.exec(e))?parseInt(t[1],16)>>>0:(t=te.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=q.exec(e))?(255|re(ge(t[1]),le(t[2]),le(t[3])))>>>0:(t=$.exec(e))?(re(ge(t[1]),le(t[2]),le(t[3]))|se(t[4]))>>>0:null}(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const Ie=(e,t,n)=>{if(B.fun(e))return e;if(B.arr(e))return Ie({range:e,output:t,extrapolate:n});if(B.str(e.output[0]))return x(e);const i=e,o=i.output,r=i.range||[0,1],a=i.extrapolateLeft||i.extrapolate||"extend",g=i.extrapolateRight||i.extrapolate||"extend",s=i.easing||(e=>e);return e=>{const t=function(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}(e,r);return function(e,t,n,i,o,r,a,g,s){let l=s?s(e):e;if(l<t){if("identity"===a)return l;"clamp"===a&&(l=t)}if(l>n){if("identity"===g)return l;"clamp"===g&&(l=n)}if(i===o)return i;if(t===n)return e<=t?i:o;t===-1/0?l=-l:n===1/0?l-=t:l=(l-t)/(n-t);l=r(l),i===-1/0?l=-l:o===1/0?l+=i:l=l*(o-i)+i;return l}(e,r[t],r[t+1],o[t],o[t+1],s,a,g,i.map)}};const Ce=Symbol.for("FluidValue.get"),ue=Symbol.for("FluidValue.observers"),de=e=>Boolean(e&&e[Ce]),he=e=>e&&e[Ce]?e[Ce]():e,Ae=e=>e[ue]||null;function pe(e,t){let n=e[ue];n&&n.forEach((e=>{!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)}))}class me{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");be(this,e)}}const be=(e,t)=>Ge(e,Ce,t);function fe(e,t){if(e[Ce]){let n=e[ue];n||Ge(e,ue,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function ye(e,t){let n=e[ue];if(n&&n.has(t)){const i=n.size-1;i?n.delete(t):e[ue]=null,e.observerRemoved&&e.observerRemoved(i,t)}}const Ge=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),ve=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Be=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi;let Ze;const we=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,We=(e,t,n,i,o)=>`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(i)}, ${o})`,Se=e=>{Ze||(Ze=H?new RegExp(`(${Object.keys(H).join("|")})`,"g"):/^\b$/);const t=e.output.map((e=>he(e).replace(Be,ce).replace(Ze,ce))),n=t.map((e=>e.match(ve).map(Number))),i=n[0].map(((e,t)=>n.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))).map((t=>Ie({...e,output:t})));return e=>{let n=0;return t[0].replace(ve,(()=>String(i[n++](e)))).replace(we,We)}},Re="react-spring: ",Ve=e=>{const t=e;let n=!1;if("function"!=typeof t)throw new TypeError(`${Re}once requires a function parameter`);return(...e)=>{n||(t(...e),n=!0)}},xe=Ve(console.warn);function Xe(){xe(`${Re}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const He=Ve(console.warn);function Ye(){He(`${Re}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead)`)}function Ke(e){return B.str(e)&&("#"==e[0]||/\d/.test(e)||e in(H||{}))}const Ne=e=>(0,y.useEffect)(e,Me),Me=[];function Fe(){const e=(0,y.useState)()[1],t=(0,y.useState)(ze)[0];return Ne(t.unmount),()=>{t.current&&e({})}}function ze(){const e={current:!0,unmount:()=>()=>{e.current=!1}};return e}function Le(e,t){const[n]=(0,y.useState)((()=>({inputs:t,result:e()}))),i=(0,y.useRef)(),o=i.current;let r=o;if(r){Boolean(t&&r.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,r.inputs))||(r={inputs:t,result:e()})}else r=n;return(0,y.useEffect)((()=>{i.current=r,o==n&&(n.inputs=n.result=void 0)}),[r]),r.result}function ke(e){const t=(0,y.useRef)();return(0,y.useEffect)((()=>{t.current=e})),t.current}const Ee="undefined"!=typeof window&&window.document&&window.document.createElement?y.useLayoutEffect:y.useEffect},248:function(e,t,n){"use strict";n.d(t,{wI:function(){return zt},EJ:function(){return Ft},xK:function(){return Mt}});var i=n(2784),o=n(7209),r=n(2955);const a=(0,i.createContext)({});function g(e,t,n){var i=void 0===t?null:t,o=function(e,t){var n=atob(e);if(t){for(var i=new Uint8Array(n.length),o=0,r=n.length;o<r;++o)i[o]=n.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}(e,void 0!==n&&n),r=o.indexOf("\n",10)+1,a=o.substring(r)+(i?"//# sourceMappingURL="+i:""),g=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(g)}var s,l,c,I,C=(s="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KICAvKioKICAgKiBBIDN4MyBtYXRyaXguCiAgICogQXV0aG9yZWQgYnkge0BsaW5rIGh0dHA6Ly9naXRodWIuY29tL3NjaHRlcHBlLyBzY2h0ZXBwZX0KICAgKi8KCgogIGNsYXNzIE1hdDMgewogICAgLyoqCiAgICAgKiBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZWxlbWVudHMgQSB2ZWN0b3Igb2YgbGVuZ3RoIDksIGNvbnRhaW5pbmcgYWxsIG1hdHJpeCBlbGVtZW50cy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZWxlbWVudHMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0pIHsKICAgICAgdGhpcy5lbGVtZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy5lbGVtZW50cyA9IGVsZW1lbnRzOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggdG8gaWRlbnRpdHkKICAgICAqIEB0b2RvIFNob3VsZCBwZXJoYXBzIGJlIHJlbmFtZWQgdG8gYHNldElkZW50aXR5KClgIHRvIGJlIG1vcmUgY2xlYXIuCiAgICAgKiBAdG9kbyBDcmVhdGUgYW5vdGhlciBmdW5jdGlvbiB0aGF0IGltbWVkaWF0ZWx5IGNyZWF0ZXMgYW4gaWRlbnRpdHkgbWF0cml4IGVnLiBgZXllKClgCiAgICAgKi8KCgogICAgaWRlbnRpdHkoKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMTsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDE7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAxOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYWxsIGVsZW1lbnRzIHRvIHplcm8KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVswXSA9IDA7CiAgICAgIGVbMV0gPSAwOwogICAgICBlWzJdID0gMDsKICAgICAgZVszXSA9IDA7CiAgICAgIGVbNF0gPSAwOwogICAgICBlWzVdID0gMDsKICAgICAgZVs2XSA9IDA7CiAgICAgIGVbN10gPSAwOwogICAgICBlWzhdID0gMDsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF0cml4IGRpYWdvbmFsIGVsZW1lbnRzIGZyb20gYSBWZWMzCiAgICAgKi8KCgogICAgc2V0VHJhY2UodmVjdG9yKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gdmVjdG9yLng7CiAgICAgIGVbNF0gPSB2ZWN0b3IueTsKICAgICAgZVs4XSA9IHZlY3Rvci56OwogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMKICAgICAqLwoKCiAgICBnZXRUcmFjZSh0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICB0YXJnZXQueCA9IGVbMF07CiAgICAgIHRhcmdldC55ID0gZVs0XTsKICAgICAgdGFyZ2V0LnogPSBlWzhdOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNYXRyaXgtVmVjdG9yIG11bHRpcGxpY2F0aW9uCiAgICAgKiBAcGFyYW0gdiBUaGUgdmVjdG9yIHRvIG11bHRpcGx5IHdpdGgKICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwsIHRhcmdldCB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bHQodiwgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCA9IG5ldyBNYXQzKCkpIHsKICAgICAgY29uc3QgQSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IEIgPSBtYXRyaXguZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGNvbnN0IGExMSA9IEFbMF0sCiAgICAgICAgICAgIGExMiA9IEFbMV0sCiAgICAgICAgICAgIGExMyA9IEFbMl0sCiAgICAgICAgICAgIGEyMSA9IEFbM10sCiAgICAgICAgICAgIGEyMiA9IEFbNF0sCiAgICAgICAgICAgIGEyMyA9IEFbNV0sCiAgICAgICAgICAgIGEzMSA9IEFbNl0sCiAgICAgICAgICAgIGEzMiA9IEFbN10sCiAgICAgICAgICAgIGEzMyA9IEFbOF07CiAgICAgIGNvbnN0IGIxMSA9IEJbMF0sCiAgICAgICAgICAgIGIxMiA9IEJbMV0sCiAgICAgICAgICAgIGIxMyA9IEJbMl0sCiAgICAgICAgICAgIGIyMSA9IEJbM10sCiAgICAgICAgICAgIGIyMiA9IEJbNF0sCiAgICAgICAgICAgIGIyMyA9IEJbNV0sCiAgICAgICAgICAgIGIzMSA9IEJbNl0sCiAgICAgICAgICAgIGIzMiA9IEJbN10sCiAgICAgICAgICAgIGIzMyA9IEJbOF07CiAgICAgIFRbMF0gPSBhMTEgKiBiMTEgKyBhMTIgKiBiMjEgKyBhMTMgKiBiMzE7CiAgICAgIFRbMV0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzI7CiAgICAgIFRbMl0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzM7CiAgICAgIFRbM10gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzE7CiAgICAgIFRbNF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzI7CiAgICAgIFRbNV0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzM7CiAgICAgIFRbNl0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CiAgICAgIFRbN10gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CiAgICAgIFRbOF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNjYWxlIGVhY2ggY29sdW1uIG9mIHRoZSBtYXRyaXgKICAgICAqLwoKCiAgICBzY2FsZSh2ZWN0b3IsIHRhcmdldCA9IG5ldyBNYXQzKCkpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IHQgPSB0YXJnZXQuZWxlbWVudHM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gMzsgaSsrKSB7CiAgICAgICAgdFszICogaSArIDBdID0gdmVjdG9yLnggKiBlWzMgKiBpICsgMF07CiAgICAgICAgdFszICogaSArIDFdID0gdmVjdG9yLnkgKiBlWzMgKiBpICsgMV07CiAgICAgICAgdFszICogaSArIDJdID0gdmVjdG9yLnogKiBlWzMgKiBpICsgMl07CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIEF4PWIKICAgICAqIEBwYXJhbSBiIFRoZSByaWdodCBoYW5kIHNpZGUKICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwuIFRhcmdldCB2ZWN0b3IgdG8gc2F2ZSBpbi4KICAgICAqIEByZXR1cm4gVGhlIHNvbHV0aW9uIHgKICAgICAqIEB0b2RvIHNob3VsZCByZXVzZSBhcnJheXMKICAgICAqLwoKCiAgICBzb2x2ZShiLCB0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgIkNvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyIgKyB0YXJnZXQudG9TdHJpbmcoKSArICJdLCBiPVsiICsgYi50b1N0cmluZygpICsgIl0sIEE9WyIgKyB0aGlzLnRvU3RyaW5nKCkgKyAiXSI7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0ID0gbmV3IE1hdDMoKSkgewogICAgICAvLyBDb25zdHJ1Y3QgZXF1YXRpb25zCiAgICAgIGNvbnN0IG5yID0gMzsgLy8gbnVtIHJvd3MKCiAgICAgIGNvbnN0IG5jID0gNjsgLy8gbnVtIGNvbHMKCiAgICAgIGNvbnN0IGVxbnMgPSByZXZlcnNlX2VxbnM7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICBlcW5zW2kgKyBuYyAqIGpdID0gdGhpcy5lbGVtZW50c1tpICsgMyAqIGpdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZXFuc1szICsgNiAqIDBdID0gMTsKICAgICAgZXFuc1szICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1szICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDFdID0gMTsKICAgICAgZXFuc1s0ICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDJdID0gMTsgLy8gQ29tcHV0ZSByaWdodCB1cHBlciB0cmlhbmd1bGFyIHZlcnNpb24gb2YgdGhlIG1hdHJpeCAtIEdhdXNzIGVsaW1pbmF0aW9uCgogICAgICBsZXQgbiA9IDM7CiAgICAgIGNvbnN0IGsgPSBuOwogICAgICBsZXQgbnA7CiAgICAgIGNvbnN0IGtwID0gbmM7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBpICkgPSBsaW5lKCBpICkgKyBsaW5lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBrICkgPSBsaW5lKCBrICkgLSBtdWx0aXBsaWVyICogbGluZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gZWxpbWluYXRlIHRoZSB1cHBlciBsZWZ0IHRyaWFuZ2xlIG9mIHRoZSBtYXRyaXgKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gaSAtIDE7CgogICAgICAgIGRvIHsKICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgIG5wID0gbmM7CgogICAgICAgICAgZG8gewogICAgICAgICAgICBwID0gbmMgLSBucDsKICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgIH0gd2hpbGUgKGotLSk7CiAgICAgIH0gd2hpbGUgKC0taSk7IC8vIG9wZXJhdGlvbnMgb24gdGhlIGRpYWdvbmFsCgoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IDEgLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgIG5wID0gbmM7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgZXFuc1twICsgbmMgKiBpXSA9IGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgaiA9IDI7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBlcW5zW25yICsgaiArIG5jICogaV07CgogICAgICAgICAgaWYgKGlzTmFOKHApIHx8IHAgPT09IEluZmluaXR5KSB7CiAgICAgICAgICAgIHRocm93ICJDb3VsZCBub3QgcmV2ZXJzZSEgQT1bIiArIHRoaXMudG9TdHJpbmcoKSArICJdIjsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQgPSBuZXcgTWF0MygpKSB7CiAgICAgIGNvbnN0IE0gPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCBUID0gdGFyZ2V0LmVsZW1lbnRzOwogICAgICBsZXQgdG1wOyAvL1NldCBkaWFnb25hbHMKCiAgICAgIFRbMF0gPSBNWzBdOwogICAgICBUWzRdID0gTVs0XTsKICAgICAgVFs4XSA9IE1bOF07CiAgICAgIHRtcCA9IE1bMV07CiAgICAgIFRbMV0gPSBNWzNdOwogICAgICBUWzNdID0gdG1wOwogICAgICB0bXAgPSBNWzJdOwogICAgICBUWzJdID0gTVs2XTsKICAgICAgVFs2XSA9IHRtcDsKICAgICAgdG1wID0gTVs1XTsKICAgICAgVFs1XSA9IE1bN107CiAgICAgIFRbN10gPSB0bXA7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KCiAgY29uc3QgcmV2ZXJzZV9lcW5zID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogIC8qKgogICAqIDMtZGltZW5zaW9uYWwgdmVjdG9yCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgdiA9IG5ldyBWZWMzKDEsIDIsIDMpCiAgICogICAgIGNvbnNvbGUubG9nKCd4PScgKyB2LngpIC8vIHg9MQogICAqLwoKICBjbGFzcyBWZWMzIHsKICAgIGNvbnN0cnVjdG9yKHggPSAwLjAsIHkgPSAwLjAsIHogPSAwLjApIHsKICAgICAgdGhpcy54ID0gdm9pZCAwOwogICAgICB0aGlzLnkgPSB2b2lkIDA7CiAgICAgIHRoaXMueiA9IHZvaWQgMDsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIGNyb3NzIHByb2R1Y3QKICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwgdGFyZ2V0IHRvIHNhdmUgaW4uCiAgICAgKi8KCgogICAgY3Jvc3ModmVjdG9yLCB0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIGNvbnN0IHZ4ID0gdmVjdG9yLng7CiAgICAgIGNvbnN0IHZ5ID0gdmVjdG9yLnk7CiAgICAgIGNvbnN0IHZ6ID0gdmVjdG9yLno7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geSAqIHZ6IC0geiAqIHZ5OwogICAgICB0YXJnZXQueSA9IHogKiB2eCAtIHggKiB2ejsKICAgICAgdGFyZ2V0LnogPSB4ICogdnkgLSB5ICogdng7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmVjdG9ycycgMyBlbGVtZW50cwogICAgICovCgoKICAgIHNldCh4LCB5LCB6KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYWxsIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB0byB6ZXJvLgogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIHRoaXMueCA9IHRoaXMueSA9IHRoaXMueiA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIFZlY3RvciBhZGRpdGlvbgogICAgICovCgoKICAgIHZhZGQodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdmVjdG9yLnggKyB0aGlzLng7CiAgICAgICAgdGFyZ2V0LnkgPSB2ZWN0b3IueSArIHRoaXMueTsKICAgICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICsgdGhpcy56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggKyB2ZWN0b3IueCwgdGhpcy55ICsgdmVjdG9yLnksIHRoaXMueiArIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3Igc3VidHJhY3Rpb24KICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwgdGFyZ2V0IHRvIHNhdmUgaW4uCiAgICAgKi8KCgogICAgdnN1Yih2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgdGFyZ2V0LnggPSB0aGlzLnggLSB2ZWN0b3IueDsKICAgICAgICB0YXJnZXQueSA9IHRoaXMueSAtIHZlY3Rvci55OwogICAgICAgIHRhcmdldC56ID0gdGhpcy56IC0gdmVjdG9yLno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG5ldyBWZWMzKHRoaXMueCAtIHZlY3Rvci54LCB0aGlzLnkgLSB2ZWN0b3IueSwgdGhpcy56IC0gdmVjdG9yLnopOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY3Jvc3MgcHJvZHVjdCBtYXRyaXggYV9jcm9zcyBmcm9tIGEgdmVjdG9yLCBzdWNoIHRoYXQgYSB4IGIgPSBhX2Nyb3NzICogYiA9IGMKICAgICAqCiAgICAgKiBTZWUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyL1REQkQyNC9WVDA2L2xlY3R1cmVzL0xlY3R1cmU2LnBkZiBVbWXDpSBVbml2ZXJzaXR5IExlY3R1cmV9CiAgICAgKi8KCgogICAgY3Jvc3NtYXQoKSB7CiAgICAgIHJldHVybiBuZXcgTWF0MyhbMCwgLXRoaXMueiwgdGhpcy55LCB0aGlzLnosIDAsIC10aGlzLngsIC10aGlzLnksIHRoaXMueCwgMF0pOwogICAgfQogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgdGhlIHZlY3Rvci4gTm90ZSB0aGF0IHRoaXMgY2hhbmdlcyB0aGUgdmFsdWVzIGluIHRoZSB2ZWN0b3IuCiAgICAgICogQHJldHVybiBSZXR1cm5zIHRoZSBub3JtIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBub3JtYWxpemUoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IG4gPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuID4gMC4wKSB7CiAgICAgICAgY29uc3QgaW52TiA9IDEgLyBuOwogICAgICAgIHRoaXMueCAqPSBpbnZOOwogICAgICAgIHRoaXMueSAqPSBpbnZOOwogICAgICAgIHRoaXMueiAqPSBpbnZOOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIE1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdGhpcy54ID0gMDsKICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgIHRoaXMueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZlcnNpb24gb2YgdGhpcyB2ZWN0b3IgdGhhdCBpcyBvZiBsZW5ndGggMS4KICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwgdGFyZ2V0IHRvIHNhdmUgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgdW5pdCB2ZWN0b3IKICAgICAqLwoKCiAgICB1bml0KHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgdGFyZ2V0LnggPSBzY2FsYXIgKiB4OwogICAgICB0YXJnZXQueSA9IHNjYWxhciAqIHk7CiAgICAgIHRhcmdldC56ID0gc2NhbGFyICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHZlY3RvciB3aXRoIGFuIG90aGVyIHZlY3RvciwgY29tcG9uZW50LXdpc2UuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB2ZWN0b3IgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWwodmVjdG9yLCB0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRhcmdldC54ID0gdmVjdG9yLnggKiB0aGlzLng7CiAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKiB0aGlzLnk7CiAgICAgIHRhcmdldC56ID0gdmVjdG9yLnogKiB0aGlzLno7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNjYWxlIGEgdmVjdG9yIGFuZCBhZGQgaXQgdG8gdGhpcyB2ZWN0b3IuIFNhdmUgdGhlIHJlc3VsdCBpbiAidGFyZ2V0Ii4gKHRhcmdldCA9IHRoaXMgKyB2ZWN0b3IgKiBzY2FsYXIpCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB2ZWN0b3IgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIGFkZFNjYWxlZFZlY3RvcihzY2FsYXIsIHZlY3RvciwgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRhcmdldC54ID0gLXRoaXMueDsKICAgICAgdGFyZ2V0LnkgPSAtdGhpcy55OwogICAgICB0YXJnZXQueiA9IC10aGlzLno7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdHdvIGFydGlmaWNpYWwgdGFuZ2VudHMgdG8gdGhlIHZlY3RvcgogICAgICogQHBhcmFtIHQxIFZlY3RvciBvYmplY3QgdG8gc2F2ZSB0aGUgZmlyc3QgdGFuZ2VudCBpbgogICAgICogQHBhcmFtIHQyIFZlY3RvciBvYmplY3QgdG8gc2F2ZSB0aGUgc2Vjb25kIHRhbmdlbnQgaW4KICAgICAqLwoKCiAgICB0YW5nZW50cyh0MSwgdDIpIHsKICAgICAgY29uc3Qgbm9ybSA9IHRoaXMubGVuZ3RoKCk7CgogICAgICBpZiAobm9ybSA+IDAuMCkgewogICAgICAgIGNvbnN0IG4gPSBWZWMzX3RhbmdlbnRzX247CiAgICAgICAgY29uc3QgaW5vcm0gPSAxIC8gbm9ybTsKICAgICAgICBuLnNldCh0aGlzLnggKiBpbm9ybSwgdGhpcy55ICogaW5vcm0sIHRoaXMueiAqIGlub3JtKTsKICAgICAgICBjb25zdCByYW5kVmVjID0gVmVjM190YW5nZW50c19yYW5kVmVjOwoKICAgICAgICBpZiAoTWF0aC5hYnMobi54KSA8IDAuOSkgewogICAgICAgICAgcmFuZFZlYy5zZXQoMSwgMCwgMCk7CiAgICAgICAgICBuLmNyb3NzKHJhbmRWZWMsIHQxKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmFuZFZlYy5zZXQoMCwgMSwgMCk7CiAgICAgICAgICBuLmNyb3NzKHJhbmRWZWMsIHQxKTsKICAgICAgICB9CgogICAgICAgIG4uY3Jvc3ModDEsIHQyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUaGUgbm9ybWFsIGxlbmd0aCBpcyB6ZXJvLCBtYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHQxLnNldCgxLCAwLCAwKTsKICAgICAgICB0Mi5zZXQoMCwgMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29udmVydHMgdG8gYSBtb3JlIHJlYWRhYmxlIGZvcm1hdAogICAgICovCgoKICAgIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gdGhpcy54ICsgIiwiICsgdGhpcy55ICsgIiwiICsgdGhpcy56OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uID0gMWUtNikgewogICAgICBpZiAoTWF0aC5hYnModGhpcy54IC0gdmVjdG9yLngpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueSAtIHZlY3Rvci55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnogLSB2ZWN0b3IueikgPiBwcmVjaXNpb24pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZlY3RvciBpcyBhbG1vc3QgemVybwogICAgICovCgoKICAgIGFsbW9zdFplcm8ocHJlY2lzaW9uID0gMWUtNikgewogICAgICBpZiAoTWF0aC5hYnModGhpcy54KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueikgPiBwcmVjaXNpb24pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgdmVjdG9yIGlzIGFudGktcGFyYWxsZWwgdG8gYW5vdGhlciB2ZWN0b3IuCiAgICAgKiBAcGFyYW0gcHJlY2lzaW9uIFNldCB0byB6ZXJvIGZvciBleGFjdCBjb21wYXJpc29ucwogICAgICovCgoKICAgIGlzQW50aXBhcmFsbGVsVG8odmVjdG9yLCBwcmVjaXNpb24pIHsKICAgICAgdGhpcy5uZWdhdGUoYW50aXBfbmVnKTsKICAgICAgcmV0dXJuIGFudGlwX25lZy5hbG1vc3RFcXVhbHModmVjdG9yLCBwcmVjaXNpb24pOwogICAgfQogICAgLyoqCiAgICAgKiBDbG9uZSB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLngsIHRoaXMueSwgdGhpcy56KTsKICAgIH0KCiAgfQoKICBWZWMzLlpFUk8gPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ggPSB2b2lkIDA7CiAgVmVjMy5VTklUX1kgPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ogPSB2b2lkIDA7CiAgVmVjMy5aRVJPID0gbmV3IFZlYzMoMCwgMCwgMCk7CiAgVmVjMy5VTklUX1ggPSBuZXcgVmVjMygxLCAwLCAwKTsKICBWZWMzLlVOSVRfWSA9IG5ldyBWZWMzKDAsIDEsIDApOwogIFZlYzMuVU5JVF9aID0gbmV3IFZlYzMoMCwgMCwgMSk7CiAgY29uc3QgVmVjM190YW5nZW50c19uID0gbmV3IFZlYzMoKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX3JhbmRWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFudGlwX25lZyA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KCiAgY2xhc3MgQUFCQiB7CiAgICAvKioKICAgICAqIFRoZSBsb3dlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB1cHBlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkgewogICAgICB0aGlzLmxvd2VyQm91bmQgPSB2b2lkIDA7CiAgICAgIHRoaXMudXBwZXJCb3VuZCA9IHZvaWQgMDsKICAgICAgdGhpcy5sb3dlckJvdW5kID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cHBlckJvdW5kID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvd2VyQm91bmQpIHsKICAgICAgICB0aGlzLmxvd2VyQm91bmQuY29weShvcHRpb25zLmxvd2VyQm91bmQpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy51cHBlckJvdW5kKSB7CiAgICAgICAgdGhpcy51cHBlckJvdW5kLmNvcHkob3B0aW9ucy51cHBlckJvdW5kKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIEFBQkIgYm91bmRzIGZyb20gYSBzZXQgb2YgcG9pbnRzLgogICAgICogQHBhcmFtIHBvaW50cyBBbiBhcnJheSBvZiBWZWMzJ3MuCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdAogICAgICovCgoKICAgIHNldEZyb21Qb2ludHMocG9pbnRzLCBwb3NpdGlvbiwgcXVhdGVybmlvbiwgc2tpblNpemUpIHsKICAgICAgY29uc3QgbCA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgY29uc3QgcSA9IHF1YXRlcm5pb247IC8vIFNldCB0byB0aGUgZmlyc3QgcG9pbnQKCiAgICAgIGwuY29weShwb2ludHNbMF0pOwoKICAgICAgaWYgKHEpIHsKICAgICAgICBxLnZtdWx0KGwsIGwpOwogICAgICB9CgogICAgICB1LmNvcHkobCk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBvaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBwID0gcG9pbnRzW2ldOwoKICAgICAgICBpZiAocSkgewogICAgICAgICAgcS52bXVsdChwLCB0bXAkMSk7CiAgICAgICAgICBwID0gdG1wJDE7CiAgICAgICAgfQoKICAgICAgICBpZiAocC54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSBwLng7CiAgICAgICAgfQoKICAgICAgICBpZiAocC54IDwgbC54KSB7CiAgICAgICAgICBsLnggPSBwLng7CiAgICAgICAgfQoKICAgICAgICBpZiAocC55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSBwLnk7CiAgICAgICAgfQoKICAgICAgICBpZiAocC55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSBwLnk7CiAgICAgICAgfQoKICAgICAgICBpZiAocC56ID4gdS56KSB7CiAgICAgICAgICB1LnogPSBwLno7CiAgICAgICAgfQoKICAgICAgICBpZiAocC56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSBwLno7CiAgICAgICAgfQogICAgICB9IC8vIEFkZCBvZmZzZXQKCgogICAgICBpZiAocG9zaXRpb24pIHsKICAgICAgICBwb3NpdGlvbi52YWRkKGwsIGwpOwogICAgICAgIHBvc2l0aW9uLnZhZGQodSwgdSk7CiAgICAgIH0KCiAgICAgIGlmIChza2luU2l6ZSkgewogICAgICAgIGwueCAtPSBza2luU2l6ZTsKICAgICAgICBsLnkgLT0gc2tpblNpemU7CiAgICAgICAgbC56IC09IHNraW5TaXplOwogICAgICAgIHUueCArPSBza2luU2l6ZTsKICAgICAgICB1LnkgKz0gc2tpblNpemU7CiAgICAgICAgdS56ICs9IHNraW5TaXplOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29weSBib3VuZHMgZnJvbSBhbiBBQUJCIHRvIHRoaXMgQUFCQgogICAgICogQHBhcmFtIGFhYmIgU291cmNlIHRvIGNvcHkgZnJvbQogICAgICogQHJldHVybiBUaGUgdGhpcyBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkKICAgICAqLwoKCiAgICBjb3B5KGFhYmIpIHsKICAgICAgdGhpcy5sb3dlckJvdW5kLmNvcHkoYWFiYi5sb3dlckJvdW5kKTsKICAgICAgdGhpcy51cHBlckJvdW5kLmNvcHkoYWFiYi51cHBlckJvdW5kKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENsb25lIGFuIEFBQkIKICAgICAqLwoKCiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyBBQUJCKCkuY29weSh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogRXh0ZW5kIHRoaXMgQUFCQiBzbyB0aGF0IGl0IGNvdmVycyB0aGUgZ2l2ZW4gQUFCQiB0b28uCiAgICAgKi8KCgogICAgZXh0ZW5kKGFhYmIpIHsKICAgICAgdGhpcy5sb3dlckJvdW5kLnggPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueCwgYWFiYi5sb3dlckJvdW5kLngpOwogICAgICB0aGlzLnVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC54LCBhYWJiLnVwcGVyQm91bmQueCk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC55ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnksIGFhYmIubG93ZXJCb3VuZC55KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnkgPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueSwgYWFiYi51cHBlckJvdW5kLnkpOwogICAgICB0aGlzLmxvd2VyQm91bmQueiA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC56LCBhYWJiLmxvd2VyQm91bmQueik7CiAgICAgIHRoaXMudXBwZXJCb3VuZC56ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLnosIGFhYmIudXBwZXJCb3VuZC56KTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBBQUJCIG92ZXJsYXBzIHRoaXMgQUFCQi4KICAgICAqLwoKCiAgICBvdmVybGFwcyhhYWJiKSB7CiAgICAgIGNvbnN0IGwxID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbDIgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUyID0gYWFiYi51cHBlckJvdW5kOyAvLyAgICAgIGwyICAgICAgICB1MgogICAgICAvLyAgICAgIHwtLS0tLS0tLS18CiAgICAgIC8vIHwtLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgdTEKCiAgICAgIGNvbnN0IG92ZXJsYXBzWCA9IGwyLnggPD0gdTEueCAmJiB1MS54IDw9IHUyLnggfHwgbDEueCA8PSB1Mi54ICYmIHUyLnggPD0gdTEueDsKICAgICAgY29uc3Qgb3ZlcmxhcHNZID0gbDIueSA8PSB1MS55ICYmIHUxLnkgPD0gdTIueSB8fCBsMS55IDw9IHUyLnkgJiYgdTIueSA8PSB1MS55OwogICAgICBjb25zdCBvdmVybGFwc1ogPSBsMi56IDw9IHUxLnogJiYgdTEueiA8PSB1Mi56IHx8IGwxLnogPD0gdTIueiAmJiB1Mi56IDw9IHUxLno7CiAgICAgIHJldHVybiBvdmVybGFwc1ggJiYgb3ZlcmxhcHNZICYmIG92ZXJsYXBzWjsKICAgIH0gLy8gTW9zdGx5IGZvciBkZWJ1Z2dpbmcKCgogICAgdm9sdW1lKCkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICByZXR1cm4gKHUueCAtIGwueCkgKiAodS55IC0gbC55KSAqICh1LnogLSBsLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgaXMgZnVsbHkgY29udGFpbmVkIGluIHRoaXMgQUFCQi4KICAgICAqLwoKCiAgICBjb250YWlucyhhYWJiKSB7CiAgICAgIGNvbnN0IGwxID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbDIgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUyID0gYWFiYi51cHBlckJvdW5kOyAvLyAgICAgIGwyICAgICAgICB1MgogICAgICAvLyAgICAgIHwtLS0tLS0tLS18CiAgICAgIC8vIHwtLS0tLS0tLS0tLS0tLS18CiAgICAgIC8vIGwxICAgICAgICAgICAgICB1MQoKICAgICAgcmV0dXJuIGwxLnggPD0gbDIueCAmJiB1MS54ID49IHUyLnggJiYgbDEueSA8PSBsMi55ICYmIHUxLnkgPj0gdTIueSAmJiBsMS56IDw9IGwyLnogJiYgdTEueiA+PSB1Mi56OwogICAgfQoKICAgIGdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBhLmNvcHkobCk7CiAgICAgIGIuc2V0KHUueCwgbC55LCBsLnopOwogICAgICBjLnNldCh1LngsIHUueSwgbC56KTsKICAgICAgZC5zZXQobC54LCB1LnksIHUueik7CiAgICAgIGUuc2V0KHUueCwgbC55LCB1LnopOwogICAgICBmLnNldChsLngsIHUueSwgbC56KTsKICAgICAgZy5zZXQobC54LCBsLnksIHUueik7CiAgICAgIGguY29weSh1KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSByZXByZXNlbnRhdGlvbiBvZiBhbiBBQUJCIGluIGFub3RoZXIgZnJhbWUuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiBBQUJCIG9iamVjdC4KICAgICAqLwoKCiAgICB0b0xvY2FsRnJhbWUoZnJhbWUsIHRhcmdldCkgewogICAgICBjb25zdCBjb3JuZXJzID0gdHJhbnNmb3JtSW50b0ZyYW1lX2Nvcm5lcnM7CiAgICAgIGNvbnN0IGEgPSBjb3JuZXJzWzBdOwogICAgICBjb25zdCBiID0gY29ybmVyc1sxXTsKICAgICAgY29uc3QgYyA9IGNvcm5lcnNbMl07CiAgICAgIGNvbnN0IGQgPSBjb3JuZXJzWzNdOwogICAgICBjb25zdCBlID0gY29ybmVyc1s0XTsKICAgICAgY29uc3QgZiA9IGNvcm5lcnNbNV07CiAgICAgIGNvbnN0IGcgPSBjb3JuZXJzWzZdOwogICAgICBjb25zdCBoID0gY29ybmVyc1s3XTsgLy8gR2V0IGNvcm5lcnMgaW4gY3VycmVudCBmcmFtZQoKICAgICAgdGhpcy5nZXRDb3JuZXJzKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpOyAvLyBUcmFuc2Zvcm0gdGhlbSB0byBuZXcgbG9jYWwgZnJhbWUKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICBjb25zdCBjb3JuZXIgPSBjb3JuZXJzW2ldOwogICAgICAgIGZyYW1lLnBvaW50VG9Mb2NhbChjb3JuZXIsIGNvcm5lcik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQuc2V0RnJvbVBvaW50cyhjb3JuZXJzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSByZXByZXNlbnRhdGlvbiBvZiBhbiBBQUJCIGluIHRoZSBnbG9iYWwgZnJhbWUuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiBBQUJCIG9iamVjdC4KICAgICAqLwoKCiAgICB0b1dvcmxkRnJhbWUoZnJhbWUsIHRhcmdldCkgewogICAgICBjb25zdCBjb3JuZXJzID0gdHJhbnNmb3JtSW50b0ZyYW1lX2Nvcm5lcnM7CiAgICAgIGNvbnN0IGEgPSBjb3JuZXJzWzBdOwogICAgICBjb25zdCBiID0gY29ybmVyc1sxXTsKICAgICAgY29uc3QgYyA9IGNvcm5lcnNbMl07CiAgICAgIGNvbnN0IGQgPSBjb3JuZXJzWzNdOwogICAgICBjb25zdCBlID0gY29ybmVyc1s0XTsKICAgICAgY29uc3QgZiA9IGNvcm5lcnNbNV07CiAgICAgIGNvbnN0IGcgPSBjb3JuZXJzWzZdOwogICAgICBjb25zdCBoID0gY29ybmVyc1s3XTsgLy8gR2V0IGNvcm5lcnMgaW4gY3VycmVudCBmcmFtZQoKICAgICAgdGhpcy5nZXRDb3JuZXJzKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpOyAvLyBUcmFuc2Zvcm0gdGhlbSB0byBuZXcgbG9jYWwgZnJhbWUKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICBjb25zdCBjb3JuZXIgPSBjb3JuZXJzW2ldOwogICAgICAgIGZyYW1lLnBvaW50VG9Xb3JsZChjb3JuZXIsIGNvcm5lcik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQuc2V0RnJvbVBvaW50cyhjb3JuZXJzKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIEFBQkIgaXMgaGl0IGJ5IGEgcmF5LgogICAgICovCgoKICAgIG92ZXJsYXBzUmF5KHJheSkgewogICAgICBjb25zdCB7CiAgICAgICAgZGlyZWN0aW9uLAogICAgICAgIGZyb20KICAgICAgfSA9IHJheTsgLy8gY29uc3QgdCA9IDAKICAgICAgLy8gcmF5LmRpcmVjdGlvbiBpcyB1bml0IGRpcmVjdGlvbiB2ZWN0b3Igb2YgcmF5CgogICAgICBjb25zdCBkaXJGcmFjWCA9IDEgLyBkaXJlY3Rpb24ueDsKICAgICAgY29uc3QgZGlyRnJhY1kgPSAxIC8gZGlyZWN0aW9uLnk7CiAgICAgIGNvbnN0IGRpckZyYWNaID0gMSAvIGRpcmVjdGlvbi56OyAvLyB0aGlzLmxvd2VyQm91bmQgaXMgdGhlIGNvcm5lciBvZiBBQUJCIHdpdGggbWluaW1hbCBjb29yZGluYXRlcyAtIGxlZnQgYm90dG9tLCBydCBpcyBtYXhpbWFsIGNvcm5lcgoKICAgICAgY29uc3QgdDEgPSAodGhpcy5sb3dlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQyID0gKHRoaXMudXBwZXJCb3VuZC54IC0gZnJvbS54KSAqIGRpckZyYWNYOwogICAgICBjb25zdCB0MyA9ICh0aGlzLmxvd2VyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDQgPSAodGhpcy51cHBlckJvdW5kLnkgLSBmcm9tLnkpICogZGlyRnJhY1k7CiAgICAgIGNvbnN0IHQ1ID0gKHRoaXMubG93ZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOwogICAgICBjb25zdCB0NiA9ICh0aGlzLnVwcGVyQm91bmQueiAtIGZyb20ueikgKiBkaXJGcmFjWjsgLy8gY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpKTsKICAgICAgLy8gY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpKTsKCiAgICAgIGNvbnN0IHRtaW4gPSBNYXRoLm1heChNYXRoLm1heChNYXRoLm1pbih0MSwgdDIpLCBNYXRoLm1pbih0MywgdDQpKSwgTWF0aC5taW4odDUsIHQ2KSk7CiAgICAgIGNvbnN0IHRtYXggPSBNYXRoLm1pbihNYXRoLm1pbihNYXRoLm1heCh0MSwgdDIpLCBNYXRoLm1heCh0MywgdDQpKSwgTWF0aC5tYXgodDUsIHQ2KSk7IC8vIGlmIHRtYXggPCAwLCByYXkgKGxpbmUpIGlzIGludGVyc2VjdGluZyBBQUJCLCBidXQgd2hvbGUgQUFCQiBpcyBiZWhpbmcgdXMKCiAgICAgIGlmICh0bWF4IDwgMCkgewogICAgICAgIC8vdCA9IHRtYXg7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIGlmIHRtaW4gPiB0bWF4LCByYXkgZG9lc24ndCBpbnRlcnNlY3QgQUFCQgoKCiAgICAgIGlmICh0bWluID4gdG1heCkgewogICAgICAgIC8vdCA9IHRtYXg7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgfQoKICBjb25zdCB0bXAkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdHJhbnNmb3JtSW50b0ZyYW1lX2Nvcm5lcnMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgLyoqCiAgICogQ29sbGlzaW9uICJtYXRyaXgiLgogICAqIEl0J3MgYWN0dWFsbHkgYSB0cmlhbmd1bGFyLXNoYXBlZCBhcnJheSBvZiB3aGV0aGVyIHR3byBib2RpZXMgYXJlIHRvdWNoaW5nIHRoaXMgc3RlcCwgZm9yIHJlZmVyZW5jZSBuZXh0IHN0ZXAKICAgKi8KCiAgY2xhc3MgQXJyYXlDb2xsaXNpb25NYXRyaXggewogICAgLyoqCiAgICAgKiBUaGUgbWF0cml4IHN0b3JhZ2UuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm1hdHJpeCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBvYmplY3RzIHRoYXQgZGlzcGF0Y2hlcyBldmVudHMuCiAgICovCgoKICBjbGFzcyBFdmVudFRhcmdldCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5fbGlzdGVuZXJzID0gdm9pZCAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXZlbnQgbGlzdGVuZXIKICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5fbGlzdGVuZXJzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXSA9IFtdOwogICAgICB9CgogICAgICBpZiAoIWxpc3RlbmVyc1t0eXBlXS5pbmNsdWRlcyhsaXN0ZW5lcikpIHsKICAgICAgICBsaXN0ZW5lcnNbdHlwZV0ucHVzaChsaXN0ZW5lcik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBldmVudCBsaXN0ZW5lciBpcyBhZGRlZAogICAgICovCgoKICAgIGhhc0V2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQgJiYgbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFueSBldmVudCBsaXN0ZW5lciBvZiB0aGUgZ2l2ZW4gdHlwZSBpcyBhZGRlZAogICAgICovCgoKICAgIGhhc0FueUV2ZW50TGlzdGVuZXIodHlwZSkgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgcmV0dXJuIGxpc3RlbmVyc1t0eXBlXSAhPT0gdW5kZWZpbmVkOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXZlbnQgbGlzdGVuZXIKICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBjb25zdCBpbmRleCA9IGxpc3RlbmVyc1t0eXBlXS5pbmRleE9mKGxpc3RlbmVyKTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICBsaXN0ZW5lcnNbdHlwZV0uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEVtaXQgYW4gZXZlbnQuCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICBkaXNwYXRjaEV2ZW50KGV2ZW50KSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIGNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbZXZlbnQudHlwZV07CgogICAgICBpZiAobGlzdGVuZXJBcnJheSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZXZlbnQudGFyZ2V0ID0gdGhpczsKCiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBsaXN0ZW5lckFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgbGlzdGVuZXJBcnJheVtpXS5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgoKICBjbGFzcyBRdWF0ZXJuaW9uIHsKICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxKSB7CiAgICAgIHRoaXMueCA9IHZvaWQgMDsKICAgICAgdGhpcy55ID0gdm9pZCAwOwogICAgICB0aGlzLnogPSB2b2lkIDA7CiAgICAgIHRoaXMudyA9IHZvaWQgMDsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZSBvZiB0aGUgcXVhdGVybmlvbi4KICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeiwgdykgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICB0aGlzLncgPSB3OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhIHJlYWRhYmxlIGZvcm1hdAogICAgICogQHJldHVybiAieCx5LHosdyIKICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuIHRoaXMueCArICIsIiArIHRoaXMueSArICIsIiArIHRoaXMueiArICIsIiArIHRoaXMudzsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCkpIHsKICAgICAgdGhpcy5ub3JtYWxpemUoKTsgLy8gaWYgdz4xIGFjb3MgYW5kIHNxcnQgd2lsbCBwcm9kdWNlIGVycm9ycywgdGhpcyBjYW50IGhhcHBlbiBpZiBxdWF0ZXJuaW9uIGlzIG5vcm1hbGlzZWQKCiAgICAgIGNvbnN0IGFuZ2xlID0gMiAqIE1hdGguYWNvcyh0aGlzLncpOwogICAgICBjb25zdCBzID0gTWF0aC5zcXJ0KDEgLSB0aGlzLncgKiB0aGlzLncpOyAvLyBhc3N1bWluZyBxdWF0ZXJuaW9uIG5vcm1hbGlzZWQgdGhlbiB3IGlzIGxlc3MgdGhhbiAxLCBzbyB0ZXJtIGFsd2F5cyBwb3NpdGl2ZS4KCiAgICAgIGlmIChzIDwgMC4wMDEpIHsKICAgICAgICAvLyB0ZXN0IHRvIGF2b2lkIGRpdmlkZSBieSB6ZXJvLCBzIGlzIGFsd2F5cyBwb3NpdGl2ZSBkdWUgdG8gc3FydAogICAgICAgIC8vIGlmIHMgY2xvc2UgdG8gemVybyB0aGVuIGRpcmVjdGlvbiBvZiBheGlzIG5vdCBpbXBvcnRhbnQKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLng7IC8vIGlmIGl0IGlzIGltcG9ydGFudCB0aGF0IGF4aXMgaXMgbm9ybWFsaXNlZCB0aGVuIHJlcGxhY2Ugd2l0aCB4PTE7IHk9ej0wOwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnk7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56OwogICAgICB9IGVsc2UgewogICAgICAgIHRhcmdldEF4aXMueCA9IHRoaXMueCAvIHM7IC8vIG5vcm1hbGlzZSBheGlzCgogICAgICAgIHRhcmdldEF4aXMueSA9IHRoaXMueSAvIHM7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56IC8gczsKICAgICAgfQoKICAgICAgcmV0dXJuIFt0YXJnZXRBeGlzLCBhbmdsZV07CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiB2YWx1ZSBnaXZlbiB0d28gdmVjdG9ycy4gVGhlIHJlc3VsdGluZyByb3RhdGlvbiB3aWxsIGJlIHRoZSBuZWVkZWQgcm90YXRpb24gdG8gcm90YXRlIHUgdG8gdi4KICAgICAqLwoKCiAgICBzZXRGcm9tVmVjdG9ycyh1LCB2KSB7CiAgICAgIGlmICh1LmlzQW50aXBhcmFsbGVsVG8odikpIHsKICAgICAgICBjb25zdCB0MSA9IHNmdl90MTsKICAgICAgICBjb25zdCB0MiA9IHNmdl90MjsKICAgICAgICB1LnRhbmdlbnRzKHQxLCB0Mik7CiAgICAgICAgdGhpcy5zZXRGcm9tQXhpc0FuZ2xlKHQxLCBNYXRoLlBJKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBhID0gdS5jcm9zcyh2KTsKICAgICAgICB0aGlzLnggPSBhLng7CiAgICAgICAgdGhpcy55ID0gYS55OwogICAgICAgIHRoaXMueiA9IGEuejsKICAgICAgICB0aGlzLncgPSBNYXRoLnNxcnQodS5sZW5ndGgoKSAqKiAyICogdi5sZW5ndGgoKSAqKiAyKSArIHUuZG90KHYpOwogICAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiB3aXRoIGFuIG90aGVyIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbXVsdChxdWF0LCB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpKSB7CiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCkpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKICAgICAgdGhpcy5jb25qdWdhdGUodGFyZ2V0KTsKICAgICAgY29uc3QgaW5vcm0yID0gMSAvICh4ICogeCArIHkgKiB5ICsgeiAqIHogKyB3ICogdyk7CiAgICAgIHRhcmdldC54ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LnkgKj0gaW5vcm0yOwogICAgICB0YXJnZXQueiAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC53ICo9IGlub3JtMjsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBxdWF0ZXJuaW9uIGNvbmp1Z2F0ZQogICAgICovCgoKICAgIGNvbmp1Z2F0ZSh0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpKSB7CiAgICAgIHRhcmdldC54ID0gLXRoaXMueDsKICAgICAgdGFyZ2V0LnkgPSAtdGhpcy55OwogICAgICB0YXJnZXQueiA9IC10aGlzLno7CiAgICAgIHRhcmdldC53ID0gdGhpcy53OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgdGhlIHF1YXRlcm5pb24uIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBvZiB0aGUgcXVhdGVybmlvbi4KICAgICAqLwoKCiAgICBub3JtYWxpemUoKSB7CiAgICAgIGxldCBsID0gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyk7CgogICAgICBpZiAobCA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbCA9IDEgLyBsOwogICAgICAgIHRoaXMueCAqPSBsOwogICAgICAgIHRoaXMueSAqPSBsOwogICAgICAgIHRoaXMueiAqPSBsOwogICAgICAgIHRoaXMudyAqPSBsOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQXBwcm94aW1hdGlvbiBvZiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24uIFdvcmtzIGJlc3Qgd2hlbiBxdWF0IGlzIGFscmVhZHkgYWxtb3N0LW5vcm1hbGl6ZWQuCiAgICAgKiBAYXV0aG9yIHVucGhhc2VkLCBodHRwczovL2dpdGh1Yi5jb20vdW5waGFzZWQKICAgICAqLwoKCiAgICBub3JtYWxpemVGYXN0KCkgewogICAgICBjb25zdCBmID0gKDMuMCAtICh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpKSAvIDIuMDsKCiAgICAgIGlmIChmID09PSAwKSB7CiAgICAgICAgdGhpcy54ID0gMDsKICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgIHRoaXMueiA9IDA7CiAgICAgICAgdGhpcy53ID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnggKj0gZjsKICAgICAgICB0aGlzLnkgKj0gZjsKICAgICAgICB0aGlzLnogKj0gZjsKICAgICAgICB0aGlzLncgKj0gZjsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHRoZSBxdWF0ZXJuaW9uIGJ5IGEgdmVjdG9yCiAgICAgKi8KCgogICAgdm11bHQodiwgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIgPSAnWVpYJykgewogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFdWxlciBvcmRlciAiICsgb3JkZXIgKyAiIG5vdCBzdXBwb3J0ZWQgeWV0LiIpOwogICAgICB9CgogICAgICB0YXJnZXQueSA9IGhlYWRpbmc7CiAgICAgIHRhcmdldC56ID0gYXR0aXR1ZGU7CiAgICAgIHRhcmdldC54ID0gYmFuazsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIG9yZGVyIFRoZSBvcmRlciB0byBhcHBseSBhbmdsZXM6ICdYWVonIG9yICdZWFonIG9yIGFueSBvdGhlciBjb21iaW5hdGlvbi4KICAgICAqCiAgICAgKiBTZWUge0BsaW5rIGh0dHBzOi8vd3d3Lm1hdGh3b3Jrcy5jb20vbWF0bGFiY2VudHJhbC9maWxlZXhjaGFuZ2UvMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMgTWF0aFdvcmtzfSByZWZlcmVuY2UKICAgICAqLwoKCiAgICBzZXRGcm9tRXVsZXIoeCwgeSwgeiwgb3JkZXIgPSAnWFlaJykgewogICAgICBjb25zdCBjMSA9IE1hdGguY29zKHggLyAyKTsKICAgICAgY29uc3QgYzIgPSBNYXRoLmNvcyh5IC8gMik7CiAgICAgIGNvbnN0IGMzID0gTWF0aC5jb3MoeiAvIDIpOwogICAgICBjb25zdCBzMSA9IE1hdGguc2luKHggLyAyKTsKICAgICAgY29uc3QgczIgPSBNYXRoLnNpbih5IC8gMik7CiAgICAgIGNvbnN0IHMzID0gTWF0aC5zaW4oeiAvIDIpOwoKICAgICAgaWYgKG9yZGVyID09PSAnWFlaJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1lYWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdaWFknKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWllYJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1laWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdYWlknKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyBRdWF0ZXJuaW9uKHRoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMudyk7CiAgICB9CiAgICAvKioKICAgICAqIFBlcmZvcm1zIGEgc3BoZXJpY2FsIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdHdvIHF1YXQKICAgICAqCiAgICAgKiBAcGFyYW0gdG9RdWF0IHNlY29uZCBvcGVyYW5kCiAgICAgKiBAcGFyYW0gdCBpbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSBzZWxmIHF1YXRlcm5pb24gYW5kIHRvUXVhdAogICAgICogQHBhcmFtIHRhcmdldCBBIHF1YXRlcm5pb24gdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4gSWYgbm90IHByb3ZpZGVkLCBhIG5ldyBvbmUgd2lsbCBiZSBjcmVhdGVkLgogICAgICogQHJldHVybnMge1F1YXRlcm5pb259IFRoZSAidGFyZ2V0IiBvYmplY3QKICAgICAqLwoKCiAgICBzbGVycCh0b1F1YXQsIHQsIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCkpIHsKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKSkgewogICAgICBjb25zdCBheCA9IGFuZ3VsYXJWZWxvY2l0eS54ICogYW5ndWxhckZhY3Rvci54LAogICAgICAgICAgICBheSA9IGFuZ3VsYXJWZWxvY2l0eS55ICogYW5ndWxhckZhY3Rvci55LAogICAgICAgICAgICBheiA9IGFuZ3VsYXJWZWxvY2l0eS56ICogYW5ndWxhckZhY3Rvci56LAogICAgICAgICAgICBieCA9IHRoaXMueCwKICAgICAgICAgICAgYnkgPSB0aGlzLnksCiAgICAgICAgICAgIGJ6ID0gdGhpcy56LAogICAgICAgICAgICBidyA9IHRoaXMudzsKICAgICAgY29uc3QgaGFsZl9kdCA9IGR0ICogMC41OwogICAgICB0YXJnZXQueCArPSBoYWxmX2R0ICogKGF4ICogYncgKyBheSAqIGJ6IC0gYXogKiBieSk7CiAgICAgIHRhcmdldC55ICs9IGhhbGZfZHQgKiAoYXkgKiBidyArIGF6ICogYnggLSBheCAqIGJ6KTsKICAgICAgdGFyZ2V0LnogKz0gaGFsZl9kdCAqIChheiAqIGJ3ICsgYXggKiBieSAtIGF5ICogYngpOwogICAgICB0YXJnZXQudyArPSBoYWxmX2R0ICogKC1heCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYnopOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICB9CgogIGNvbnN0IHNmdl90MSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc2Z2X3QyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBUaGUgYXZhaWxhYmxlIHNoYXBlIHR5cGVzLgogICAqLwoKICBjb25zdCBTSEFQRV9UWVBFUyA9IHsKICAgIC8qKiBTUEhFUkUgKi8KICAgIFNQSEVSRTogMSwKCiAgICAvKiogUExBTkUgKi8KICAgIFBMQU5FOiAyLAoKICAgIC8qKiBCT1ggKi8KICAgIEJPWDogNCwKCiAgICAvKiogQ09NUE9VTkQgKi8KICAgIENPTVBPVU5EOiA4LAoKICAgIC8qKiBDT05WRVhQT0xZSEVEUk9OICovCiAgICBDT05WRVhQT0xZSEVEUk9OOiAxNiwKCiAgICAvKiogSEVJR0hURklFTEQgKi8KICAgIEhFSUdIVEZJRUxEOiAzMiwKCiAgICAvKiogUEFSVElDTEUgKi8KICAgIFBBUlRJQ0xFOiA2NCwKCiAgICAvKiogQ1lMSU5ERVIgKi8KICAgIENZTElOREVSOiAxMjgsCgogICAgLyoqIFRSSU1FU0ggKi8KICAgIFRSSU1FU0g6IDI1NgogIH07CiAgLyoqCiAgICogU2hhcGVUeXBlCiAgICovCgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIHNoYXBlcwogICAqLwoKICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkgewogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLnR5cGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5ID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gU2hhcGUuaWRDb3VudGVyKys7CiAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZSB8fCAwOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IG9wdGlvbnMuY29sbGlzaW9uUmVzcG9uc2UgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgOiAxOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLm1hdGVyaWFsID0gb3B0aW9ucy5tYXRlcmlhbCA/IG9wdGlvbnMubWF0ZXJpYWwgOiBudWxsOwogICAgICB0aGlzLmJvZHkgPSBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIHJhZGl1cy4KICAgICAqIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoZSBwcm9wZXJ0eSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYAogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aHJvdyAiY29tcHV0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdm9sdW1lIG9mIHRoaXMgc2hhcGUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHRocm93ICJ2b2x1bWUoKSBub3QgaW1wbGVtZW50ZWQgZm9yIHNoYXBlIHR5cGUgIiArIHRoaXMudHlwZTsKICAgIH0KICAgIC8qKgogICAgICogQ2FsY3VsYXRlcyB0aGUgaW5lcnRpYSBpbiB0aGUgbG9jYWwgZnJhbWUgZm9yIHRoaXMgc2hhcGUuCiAgICAgKiBAc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9tb21lbnRzX29mX2luZXJ0aWEKICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIHRocm93ICJjYWxjdWxhdGVMb2NhbEluZXJ0aWEoKSBub3QgaW1wbGVtZW50ZWQgZm9yIHNoYXBlIHR5cGUgIiArIHRoaXMudHlwZTsKICAgIH0KICAgIC8qKgogICAgICogQHRvZG8gdXNlIGFic3RyYWN0IGZvciB0aGVzZSBraW5kIG9mIG1ldGhvZHMKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICB0aHJvdyAiY2FsY3VsYXRlV29ybGRBQUJCKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CgogIH0KCiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwogIC8qKgogICAqIFRyYW5zZm9ybWF0aW9uIHV0aWxpdGllcy4KICAgKi8KCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgICAgdGhpcy5wb3NpdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnBvc2l0aW9uKSB7CiAgICAgICAgdGhpcy5wb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5xdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSBnbG9iYWwgcG9pbnQgaW4gbG9jYWwgdHJhbnNmb3JtIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgcmV0dXJuIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHdvcmxkUG9pbnQsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGxvY2FsIHBvaW50IGluIGdsb2JhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkKGxvY2FsUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogdmVjdG9yVG9Xb3JsZEZyYW1lCiAgICAgKi8KCgogICAgdmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsVmVjdG9yLCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogcG9pbnRUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXRlcm5pb24sIHdvcmxkUG9pbnQsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0ID0gbmV3IFZlYzMoKSkgewogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsUG9pbnQsIHJlc3VsdCk7CiAgICAgIHJlc3VsdC52YWRkKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Xb3JsZEZyYW1lKHF1YXRlcm5pb24sIGxvY2FsVmVjdG9yLCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvTG9jYWxGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXRlcm5pb24sIHdvcmxkVmVjdG9yLCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNvbnN0IHRtcFF1YXQkMSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwoKICBjbGFzcyBDb252ZXhQb2x5aGVkcm9uIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHZlcnRpY2VzICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIGZhY2UgY29uc2lzdHMgb2YKICAgICAqLwoKICAgIC8qKiBmYWNlTm9ybWFscyAqLwoKICAgIC8qKiB3b3JsZFZlcnRpY2VzICovCgogICAgLyoqIHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKiB3b3JsZEZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKgogICAgICogSWYgZ2l2ZW4sIHRoZXNlIGxvY2FsbHkgZGVmaW5lZCwgbm9ybWFsaXplZCBheGVzIGFyZSB0aGUgb25seSBvbmVzIGJlaW5nIGNoZWNrZWQgd2hlbiBkb2luZyBzZXBhcmF0aW5nIGF4aXMgY2hlY2suCiAgICAgKi8KCiAgICAvKiogdW5pcXVlRWRnZXMgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSB2ZXJ0aWNlcyBBbiBhcnJheSBvZiBWZWMzJ3MKICAgICAqIEBwYXJhbSBmYWNlcyBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgZGVzY3JpYmluZyB3aGljaCB2ZXJ0aWNlcyB0aGF0IGlzIGluY2x1ZGVkIGluIGVhY2ggZmFjZS4KICAgICAqLwogICAgY29uc3RydWN0b3IocHJvcHMgPSB7fSkgewogICAgICBjb25zdCB7CiAgICAgICAgdmVydGljZXMgPSBbXSwKICAgICAgICBmYWNlcyA9IFtdLAogICAgICAgIG5vcm1hbHMgPSBbXSwKICAgICAgICBheGVzLAogICAgICAgIGJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgIH0gPSBwcm9wczsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04KICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRWZXJ0aWNlcyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMudW5pcXVlQXhlcyA9IHZvaWQgMDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IHZvaWQgMDsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlZlcnRleCAiICsgdGhpcy5mYWNlc1tpXVtqXSArICIgbm90IGZvdW5kISIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY29uc3QgbiA9IHRoaXMuZmFjZU5vcm1hbHNbaV0gfHwgbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmdldEZhY2VOb3JtYWwoaSwgbik7CiAgICAgICAgbi5uZWdhdGUobik7CiAgICAgICAgdGhpcy5mYWNlTm9ybWFsc1tpXSA9IG47CiAgICAgICAgY29uc3QgdmVydGV4ID0gdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldWzBdXTsKCiAgICAgICAgaWYgKG4uZG90KHZlcnRleCkgPCAwKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCIuZmFjZU5vcm1hbHNbIiArIGkgKyAiXSA9IFZlYzMoIiArIG4udG9TdHJpbmcoKSArICIpIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuIik7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiLnZlcnRpY2VzWyIgKyB0aGlzLmZhY2VzW2ldW2pdICsgIl0gPSBWZWMzKCIgKyB0aGlzLnZlcnRpY2VzW3RoaXMuZmFjZXNbaV1bal1dLnRvU3RyaW5nKCkgKyAiKSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWwgb2YgYSBmYWNlIGZyb20gaXRzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgZ2V0RmFjZU5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgZiA9IHRoaXMuZmFjZXNbaV07CiAgICAgIGNvbnN0IHZhID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgdmIgPSB0aGlzLnZlcnRpY2VzW2ZbMV1dOwogICAgICBjb25zdCB2YyA9IHRoaXMudmVydGljZXNbZlsyXV07CiAgICAgIENvbnZleFBvbHloZWRyb24uY29tcHV0ZU5vcm1hbCh2YSwgdmIsIHZjLCB0YXJnZXQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICBjb25zdCBjYiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICAgICAgdmIudnN1Yih2YSwgYWIpOwogICAgICB2Yy52c3ViKHZiLCBjYik7CiAgICAgIGNiLmNyb3NzKGFiLCB0YXJnZXQpOwoKICAgICAgaWYgKCF0YXJnZXQuaXNaZXJvKCkpIHsKICAgICAgICB0YXJnZXQubm9ybWFsaXplKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIG1pbkRpc3QgQ2xhbXAgZGlzdGFuY2UKICAgICAqIEBwYXJhbSByZXN1bHQgVGhlIGFuIGFycmF5IG9mIGNvbnRhY3QgcG9pbnQgb2JqZWN0cywgc2VlIGNsaXBGYWNlQWdhaW5zdEh1bGwKICAgICAqLwoKCiAgICBjbGlwQWdhaW5zdEh1bGwocG9zQSwgcXVhdEEsIGh1bGxCLCBwb3NCLCBxdWF0Qiwgc2VwYXJhdGluZ05vcm1hbCwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IFdvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQiA9IC0xOwogICAgICBsZXQgZG1heCA9IC1OdW1iZXIuTUFYX1ZBTFVFOwoKICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCBodWxsQi5mYWNlcy5sZW5ndGg7IGZhY2UrKykgewogICAgICAgIFdvcmxkTm9ybWFsLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkTm9ybWFsLCBXb3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3QgZCA9IFdvcmxkTm9ybWFsLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPiBkbWF4KSB7CiAgICAgICAgICBkbWF4ID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQiA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCB3b3JsZFZlcnRzQjEgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaHVsbEIuZmFjZXNbY2xvc2VzdEZhY2VCXS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBodWxsQi52ZXJ0aWNlc1todWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdW2ldXTsKICAgICAgICBjb25zdCB3b3JsZGIgPSBuZXcgVmVjMygpOwogICAgICAgIHdvcmxkYi5jb3B5KGIpOwogICAgICAgIHF1YXRCLnZtdWx0KHdvcmxkYiwgd29ybGRiKTsKICAgICAgICBwb3NCLnZhZGQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHdvcmxkVmVydHNCMS5wdXNoKHdvcmxkYik7CiAgICAgIH0KCiAgICAgIGlmIChjbG9zZXN0RmFjZUIgPj0gMCkgewogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZpbmQgdGhlIHNlcGFyYXRpbmcgYXhpcyBiZXR3ZWVuIHRoaXMgaHVsbCBhbmQgYW5vdGhlcgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHZlY3RvciB0byBzYXZlIHRoZSBheGlzIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgZmFsc2UgaWYgYSBzZXBhcmF0aW9uIGlzIGZvdW5kLCBlbHNlIHRydWUKICAgICAqLwoKCiAgICBmaW5kU2VwYXJhdGluZ0F4aXMoaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QiwgdGFyZ2V0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBmYWNlQU5vcm1hbFdTMyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRlbHRhQyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZEVkZ2UxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgQ3Jvc3MgPSBuZXcgVmVjMygpOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKCiAgICAgIGlmICghaHVsbEEudW5pcXVlQXhlcykgewogICAgICAgIGNvbnN0IG51bUZhY2VzQSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QS5sZW5ndGggOiBodWxsQS5mYWNlcy5sZW5ndGg7IC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEEKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0E7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEEgPyBmYWNlTGlzdEFbaV0gOiBpOyAvLyBHZXQgd29ybGQgZmFjZSBub3JtYWwKCiAgICAgICAgICBmYWNlQU5vcm1hbFdTMy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZpXSk7CiAgICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTMywgZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKGZhY2VBTm9ybWFsV1MzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICBpZiAoZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgICAgdGFyZ2V0LmNvcHkoZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGh1bGxBLnVuaXF1ZUF4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBheGlzCiAgICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVBeGVzW2ldLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWh1bGxCLnVuaXF1ZUF4ZXMpIHsKICAgICAgICAvLyBUZXN0IGZhY2Ugbm9ybWFscyBmcm9tIGh1bGxCCiAgICAgICAgY29uc3QgbnVtRmFjZXNCID0gZmFjZUxpc3RCID8gZmFjZUxpc3RCLmxlbmd0aCA6IGh1bGxCLmZhY2VzLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0I7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEJbaV0gOiBpOwogICAgICAgICAgV29ybGRub3JtYWwxLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkbm9ybWFsMSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzIGluIEIKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEIudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlQXhlc1tpXSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBUZXN0IGVkZ2VzCgoKICAgICAgZm9yIChsZXQgZTAgPSAwOyBlMCAhPT0gaHVsbEEudW5pcXVlRWRnZXMubGVuZ3RoOyBlMCsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UKICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVFZGdlc1tlMF0sIHdvcmxkRWRnZTApOwoKICAgICAgICBmb3IgKGxldCBlMSA9IDA7IGUxICE9PSBodWxsQi51bmlxdWVFZGdlcy5sZW5ndGg7IGUxKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBlZGdlIDIKICAgICAgICAgIHF1YXRCLnZtdWx0KGh1bGxCLnVuaXF1ZUVkZ2VzW2UxXSwgd29ybGRFZGdlMSk7CiAgICAgICAgICB3b3JsZEVkZ2UwLmNyb3NzKHdvcmxkRWRnZTEsIENyb3NzKTsKCiAgICAgICAgICBpZiAoIUNyb3NzLmFsbW9zdFplcm8oKSkgewogICAgICAgICAgICBDcm9zcy5ub3JtYWxpemUoKTsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IGh1bGxBLnRlc3RTZXBBeGlzKENyb3NzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICAgIGlmIChkaXN0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRpc3QgPCBkbWluKSB7CiAgICAgICAgICAgICAgZG1pbiA9IGRpc3Q7CiAgICAgICAgICAgICAgdGFyZ2V0LmNvcHkoQ3Jvc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBwb3NCLnZzdWIocG9zQSwgZGVsdGFDKTsKCiAgICAgIGlmIChkZWx0YUMuZG90KHRhcmdldCkgPiAwLjApIHsKICAgICAgICB0YXJnZXQubmVnYXRlKHRhcmdldCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBUZXN0IHNlcGFyYXRpbmcgYXhpcyBhZ2FpbnN0IHR3byBodWxscy4gQm90aCBodWxscyBhcmUgcHJvamVjdGVkIG9udG8gdGhlIGF4aXMgYW5kIHRoZSBvdmVybGFwIHNpemUgaXMgcmV0dXJuZWQgaWYgdGhlcmUgaXMgb25lLgogICAgICogQHJldHVybiBUaGUgb3ZlcmxhcCBkZXB0aCwgb3IgRkFMU0UgaWYgbm8gcGVuZXRyYXRpb24uCiAgICAgKi8KCgogICAgdGVzdFNlcEF4aXMoYXhpcywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QikgewogICAgICBjb25zdCBodWxsQSA9IHRoaXM7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQSwgYXhpcywgcG9zQSwgcXVhdEEsIG1heG1pbkEpOwogICAgICBDb252ZXhQb2x5aGVkcm9uLnByb2plY3QoaHVsbEIsIGF4aXMsIHBvc0IsIHF1YXRCLCBtYXhtaW5CKTsKICAgICAgY29uc3QgbWF4QSA9IG1heG1pbkFbMF07CiAgICAgIGNvbnN0IG1pbkEgPSBtYXhtaW5BWzFdOwogICAgICBjb25zdCBtYXhCID0gbWF4bWluQlswXTsKICAgICAgY29uc3QgbWluQiA9IG1heG1pbkJbMV07CgogICAgICBpZiAobWF4QSA8IG1pbkIgfHwgbWF4QiA8IG1pbkEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFNlcGFyYXRlZAogICAgICB9CgogICAgICBjb25zdCBkMCA9IG1heEEgLSBtaW5COwogICAgICBjb25zdCBkMSA9IG1heEIgLSBtaW5BOwogICAgICBjb25zdCBkZXB0aCA9IGQwIDwgZDEgPyBkMCA6IGQxOwogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgY29uc3QgYWFiYm1heCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFhYmJtaW4gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoYWFiYm1pbiwgYWFiYm1heCk7CiAgICAgIGNvbnN0IHggPSBhYWJibWF4LnggLSBhYWJibWluLng7CiAgICAgIGNvbnN0IHkgPSBhYWJibWF4LnkgLSBhYWJibWluLnk7CiAgICAgIGNvbnN0IHogPSBhYWJibWF4LnogLSBhYWJibWluLno7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueSA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHggKiAyICogeCk7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBmYWNlX2kgSW5kZXggb2YgdGhlIGZhY2UKICAgICAqLwoKCiAgICBnZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGZhY2VfaSkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tmYWNlX2ldOwogICAgICBjb25zdCBuID0gdGhpcy5mYWNlTm9ybWFsc1tmYWNlX2ldOwogICAgICBjb25zdCB2ID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgYyA9IC1uLmRvdCh2KTsKICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICAvKioKICAgICAqIENsaXAgYSBmYWNlIGFnYWluc3QgYSBodWxsLgogICAgICogQHBhcmFtIHdvcmxkVmVydHNCMSBBbiBhcnJheSBvZiBWZWMzIHdpdGggdmVydGljZXMgaW4gdGhlIHdvcmxkIGZyYW1lLgogICAgICogQHBhcmFtIG1pbkRpc3QgRGlzdGFuY2UgY2xhbXBpbmcKICAgICAqIEBwYXJhbSBBcnJheSByZXN1bHQgQXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGNvbnRhY3QgcG9pbnRzIGluLiBXaWxsIGJlIG9iamVjdHMgd2l0aCBwcm9wZXJ0aWVzOiBwb2ludCwgZGVwdGgsIG5vcm1hbC4gVGhlc2UgYXJlIHJlcHJlc2VudGVkIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIGNsaXBGYWNlQWdhaW5zdEh1bGwoc2VwYXJhdGluZ05vcm1hbCwgcG9zQSwgcXVhdEEsIHdvcmxkVmVydHNCMSwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBlZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZFBsYW5lQW5vcm1hbDEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkQTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBsb2NhbFBsYW5lTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGxhbmVOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgY29uc3Qgd29ybGRWZXJ0c0IyID0gW107CiAgICAgIGNvbnN0IHBWdHhJbiA9IHdvcmxkVmVydHNCMTsKICAgICAgY29uc3QgcFZ0eE91dCA9IHdvcmxkVmVydHNCMjsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQSA9IC0xOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7IC8vIEZpbmQgdGhlIGZhY2Ugd2l0aCBub3JtYWwgY2xvc2VzdCB0byB0aGUgc2VwYXJhdGluZyBheGlzCgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgZmFjZUFOb3JtYWxXUy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZhY2VdKTsKICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTLCBmYWNlQU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBkID0gZmFjZUFOb3JtYWxXUy5kb3Qoc2VwYXJhdGluZ05vcm1hbCk7CgogICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICBjbG9zZXN0RmFjZUEgPSBmYWNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQSA8IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gR2V0IHRoZSBmYWNlIGFuZCBjb25zdHJ1Y3QgY29ubmVjdGVkIGZhY2VzCgoKICAgICAgY29uc3QgcG9seUEgPSBodWxsQS5mYWNlc1tjbG9zZXN0RmFjZUFdOwogICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcyA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQS5mYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaHVsbEEuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICgKICAgICAgICAgIC8qIFNoYXJpbmcgYSB2ZXJ0ZXgqLwogICAgICAgICAgcG9seUEuaW5kZXhPZihodWxsQS5mYWNlc1tpXVtqXSkgIT09IC0xICYmCiAgICAgICAgICAvKiBOb3QgdGhlIG9uZSB3ZSBhcmUgbG9va2luZyBmb3IgY29ubmVjdGlvbnMgZnJvbSAqLwogICAgICAgICAgaSAhPT0gY2xvc2VzdEZhY2VBICYmCiAgICAgICAgICAvKiBOb3QgYWxyZWFkeSBhZGRlZCAqLwogICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMuaW5kZXhPZihpKSA9PT0gLTEpIHsKICAgICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2xpcCB0aGUgcG9seWdvbiB0byB0aGUgYmFjayBvZiB0aGUgcGxhbmVzIG9mIGFsbCBmYWNlcyBvZiBodWxsIEEsCiAgICAgIC8vIHRoYXQgYXJlIGFkamFjZW50IHRvIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBjb25zdCBudW1WZXJ0aWNlc0EgPSBwb2x5QS5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVZlcnRpY2VzQTsgaSsrKSB7CiAgICAgICAgY29uc3QgYSA9IGh1bGxBLnZlcnRpY2VzW3BvbHlBW2ldXTsKICAgICAgICBjb25zdCBiID0gaHVsbEEudmVydGljZXNbcG9seUFbKGkgKyAxKSAlIG51bVZlcnRpY2VzQV1dOwogICAgICAgIGEudnN1YihiLCBlZGdlMCk7CiAgICAgICAgV29ybGRFZGdlMC5jb3B5KGVkZ2UwKTsKICAgICAgICBxdWF0QS52bXVsdChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICBwb3NBLnZhZGQoV29ybGRFZGdlMCwgV29ybGRFZGdlMCk7CiAgICAgICAgd29ybGRQbGFuZUFub3JtYWwxLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgICBxdWF0QS52bXVsdCh3b3JsZFBsYW5lQW5vcm1hbDEsIHdvcmxkUGxhbmVBbm9ybWFsMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBXb3JsZEVkZ2UwLmNyb3NzKHdvcmxkUGxhbmVBbm9ybWFsMSwgcGxhbmVOb3JtYWxXUzEpOwogICAgICAgIHBsYW5lTm9ybWFsV1MxLm5lZ2F0ZShwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgd29ybGRBMS5jb3B5KGEpOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIHBvc0EudmFkZCh3b3JsZEExLCB3b3JsZEExKTsKICAgICAgICBjb25zdCBvdGhlckZhY2UgPSBwb2x5QS5jb25uZWN0ZWRGYWNlc1tpXTsKICAgICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tvdGhlckZhY2VdKTsKICAgICAgICBjb25zdCBsb2NhbFBsYW5lRXEgPSB0aGlzLmdldFBsYW5lQ29uc3RhbnRPZkZhY2Uob3RoZXJGYWNlKTsKICAgICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgICAgY29uc3QgcGxhbmVFcVdTID0gbG9jYWxQbGFuZUVxIC0gcGxhbmVOb3JtYWxXUy5kb3QocG9zQSk7IC8vIENsaXAgZmFjZSBhZ2FpbnN0IG91ciBjb25zdHJ1Y3RlZCBwbGFuZQoKICAgICAgICB0aGlzLmNsaXBGYWNlQWdhaW5zdFBsYW5lKHBWdHhJbiwgcFZ0eE91dCwgcGxhbmVOb3JtYWxXUywgcGxhbmVFcVdTKTsgLy8gVGhyb3cgYXdheSBhbGwgY2xpcHBlZCBwb2ludHMsIGJ1dCBzYXZlIHRoZSByZW1haW5pbmcgdW50aWwgbmV4dCBjbGlwCgogICAgICAgIHdoaWxlIChwVnR4SW4ubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4uc2hpZnQoKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChwVnR4T3V0Lmxlbmd0aCkgewogICAgICAgICAgcFZ0eEluLnB1c2gocFZ0eE91dC5zaGlmdCgpKTsKICAgICAgICB9CiAgICAgIH0gLy8gb25seSBrZWVwIGNvbnRhY3QgcG9pbnRzIHRoYXQgYXJlIGJlaGluZCB0aGUgd2l0bmVzcyBmYWNlCgoKICAgICAgbG9jYWxQbGFuZU5vcm1hbC5jb3B5KHRoaXMuZmFjZU5vcm1hbHNbY2xvc2VzdEZhY2VBXSk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShjbG9zZXN0RmFjZUEpOwogICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgIHF1YXRBLnZtdWx0KHBsYW5lTm9ybWFsV1MsIHBsYW5lTm9ybWFsV1MpOwogICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcFZ0eEluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGRlcHRoID0gcGxhbmVOb3JtYWxXUy5kb3QocFZ0eEluW2ldKSArIHBsYW5lRXFXUzsgLy8gPz8/CgogICAgICAgIGlmIChkZXB0aCA8PSBtaW5EaXN0KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiY2xhbXBlZDogZGVwdGg9IiArIGRlcHRoICsgIiB0byBtaW5EaXN0PSIgKyBtaW5EaXN0KTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGFyZ2V0LnZhZGQodmVydHNbaV0sIHRhcmdldCk7CiAgICAgIH0KCiAgICAgIHRhcmdldC5zY2FsZSgxIC8gdmVydHMubGVuZ3RoLCB0YXJnZXQpOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm0gYWxsIGxvY2FsIHBvaW50cy4gV2lsbCBjaGFuZ2UgdGhlIC52ZXJ0aWNlcwogICAgICovCgoKICAgIHRyYW5zZm9ybUFsbFBvaW50cyhvZmZzZXQsIHF1YXQpIHsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7IC8vIEFwcGx5IHJvdGF0aW9uCgogICAgICBpZiAocXVhdCkgewogICAgICAgIC8vIFJvdGF0ZSB2ZXJ0aWNlcwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgIH0gLy8gUm90YXRlIGZhY2Ugbm9ybWFscwoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdGhpcy5mYWNlTm9ybWFsc1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfQogICAgICAgIC8qCiAgICAgICAgICAgICAgLy8gUm90YXRlIGVkZ2VzCiAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy51bmlxdWVFZGdlcy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLnVuaXF1ZUVkZ2VzW2ldOwogICAgICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsdik7CiAgICAgICAgICAgICAgfSovCgogICAgICB9IC8vIEFwcGx5IG9mZnNldAoKCiAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOwogICAgICAgICAgdi52YWRkKG9mZnNldCwgdik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrcyB3aGV0aGVyIHAgaXMgaW5zaWRlIHRoZSBwb2x5aGVkcmEuIE11c3QgYmUgaW4gbG9jYWwgY29vcmRzLgogICAgICogVGhlIHBvaW50IGxpZXMgb3V0c2lkZSBvZiB0aGUgY29udmV4IGh1bGwgb2YgdGhlIG90aGVyIHBvaW50cyBpZiBhbmQgb25seSBpZiB0aGUgZGlyZWN0aW9uCiAgICAgKiBvZiBhbGwgdGhlIHZlY3RvcnMgZnJvbSBpdCB0byB0aG9zZSBvdGhlciBwb2ludHMgYXJlIG9uIGxlc3MgdGhhbiBvbmUgaGFsZiBvZiBhIHNwaGVyZSBhcm91bmQgaXQuCiAgICAgKiBAcGFyYW0gcCBBIHBvaW50IGdpdmVuIGluIGxvY2FsIGNvb3JkaW5hdGVzCiAgICAgKi8KCgogICAgcG9pbnRJc0luc2lkZShwKSB7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgcG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldEF2ZXJhZ2VQb2ludExvY2FsKHBvaW50SW5zaWRlKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5mYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBuID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCB2ID0gdmVydHNbZmFjZXNbaV1bMF1dOyAvLyBXZSBvbmx5IG5lZWQgb25lIHBvaW50IGluIHRoZSBmYWNlCiAgICAgICAgLy8gVGhpcyBkb3QgcHJvZHVjdCBkZXRlcm1pbmVzIHdoaWNoIHNpZGUgb2YgdGhlIGVkZ2UgdGhlIHBvaW50IGlzCgogICAgICAgIGNvbnN0IHZUb1AgPSBuZXcgVmVjMygpOwogICAgICAgIHAudnN1Yih2LCB2VG9QKTsKICAgICAgICBjb25zdCByMSA9IG4uZG90KHZUb1ApOwogICAgICAgIGNvbnN0IHZUb1BvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgICBwb2ludEluc2lkZS52c3ViKHYsIHZUb1BvaW50SW5zaWRlKTsKICAgICAgICBjb25zdCByMiA9IG4uZG90KHZUb1BvaW50SW5zaWRlKTsKCiAgICAgICAgaWYgKHIxIDwgMCAmJiByMiA+IDAgfHwgcjEgPiAwICYmIHIyIDwgMCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFbmNvdW50ZXJlZCBzb21lIG90aGVyIHNpZ24uIEV4aXQuCiAgICAgICAgfQogICAgICB9IC8vIElmIHdlIGdvdCBoZXJlLCBhbGwgZG90IHByb2R1Y3RzIHdlcmUgb2YgdGhlIHNhbWUgc2lnbi4KCgogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXggYW5kIG1pbiBkb3QgcHJvZHVjdCBvZiBhIGNvbnZleCBodWxsIGF0IHBvc2l0aW9uIChwb3MscXVhdCkgcHJvamVjdGVkIG9udG8gYW4gYXhpcy4KICAgICAqIFJlc3VsdHMgYXJlIHNhdmVkIGluIHRoZSBhcnJheSBtYXhtaW4uCiAgICAgKiBAcGFyYW0gcmVzdWx0IHJlc3VsdFswXSBhbmQgcmVzdWx0WzFdIHdpbGwgYmUgc2V0IHRvIG1heGltdW0gYW5kIG1pbmltdW0sIHJlc3BlY3RpdmVseS4KICAgICAqLwoKCiAgICBzdGF0aWMgcHJvamVjdChzaGFwZSwgYXhpcywgcG9zLCBxdWF0LCByZXN1bHQpIHsKICAgICAgY29uc3QgbiA9IHNoYXBlLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgY29uc3QgbG9jYWxBeGlzID0gcHJvamVjdF9sb2NhbEF4aXM7CiAgICAgIGxldCBtYXggPSAwOwogICAgICBsZXQgbWluID0gMDsKICAgICAgY29uc3QgbG9jYWxPcmlnaW4gPSBwcm9qZWN0X2xvY2FsT3JpZ2luOwogICAgICBjb25zdCB2cyA9IHNoYXBlLnZlcnRpY2VzOwogICAgICBsb2NhbE9yaWdpbi5zZXRaZXJvKCk7IC8vIFRyYW5zZm9ybSB0aGUgYXhpcyB0byBsb2NhbAoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3MsIHF1YXQsIGF4aXMsIGxvY2FsQXhpcyk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3MsIHF1YXQsIGxvY2FsT3JpZ2luLCBsb2NhbE9yaWdpbik7CiAgICAgIGNvbnN0IGFkZCA9IGxvY2FsT3JpZ2luLmRvdChsb2NhbEF4aXMpOwogICAgICBtaW4gPSBtYXggPSB2c1swXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgY29uc3QgdmFsID0gdnNbaV0uZG90KGxvY2FsQXhpcyk7CgogICAgICAgIGlmICh2YWwgPiBtYXgpIHsKICAgICAgICAgIG1heCA9IHZhbDsKICAgICAgICB9CgogICAgICAgIGlmICh2YWwgPCBtaW4pIHsKICAgICAgICAgIG1pbiA9IHZhbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbiAtPSBhZGQ7CiAgICAgIG1heCAtPSBhZGQ7CgogICAgICBpZiAobWluID4gbWF4KSB7CiAgICAgICAgLy8gSW5jb25zaXN0ZW50IC0gc3dhcAogICAgICAgIGNvbnN0IHRlbXAgPSBtaW47CiAgICAgICAgbWluID0gbWF4OwogICAgICAgIG1heCA9IHRlbXA7CiAgICAgIH0gLy8gT3V0cHV0CgoKICAgICAgcmVzdWx0WzBdID0gbWF4OwogICAgICByZXN1bHRbMV0gPSBtaW47CiAgICB9CgogIH0KCiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBjb25zdCBwcm9qZWN0X2xvY2FsQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcHJvamVjdF9sb2NhbE9yaWdpbiA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCgogIGNsYXNzIEJveCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogVGhlIGhhbGYgZXh0ZW50cyBvZiB0aGUgYm94LgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIGJ5IHRoZSBjb250YWN0IGdlbmVyYXRvciB0byBtYWtlIGNvbnRhY3RzIHdpdGggb3RoZXIgY29udmV4IHBvbHloZWRyYSBmb3IgZXhhbXBsZS4KICAgICAqLwogICAgY29uc3RydWN0b3IoaGFsZkV4dGVudHMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkJPWAogICAgICB9KTsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaGFsZkV4dGVudHMgPSBoYWxmRXh0ZW50czsKICAgICAgdGhpcy5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24gPSBudWxsOwogICAgICB0aGlzLnVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIGxvY2FsIGNvbnZleCBwb2x5aGVkcm9uIHJlcHJlc2VudGF0aW9uIHVzZWQgZm9yIHNvbWUgY29sbGlzaW9ucy4KICAgICAqLwoKCiAgICB1cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKSB7CiAgICAgIGNvbnN0IHN4ID0gdGhpcy5oYWxmRXh0ZW50cy54OwogICAgICBjb25zdCBzeSA9IHRoaXMuaGFsZkV4dGVudHMueTsKICAgICAgY29uc3Qgc3ogPSB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICAgIGNvbnN0IFYgPSBWZWMzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtuZXcgVigtc3gsIC1zeSwgLXN6KSwgbmV3IFYoc3gsIC1zeSwgLXN6KSwgbmV3IFYoc3gsIHN5LCAtc3opLCBuZXcgVigtc3gsIHN5LCAtc3opLCBuZXcgVigtc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgLXN5LCBzeiksIG5ldyBWKHN4LCBzeSwgc3opLCBuZXcgVigtc3gsIHN5LCBzeildOwogICAgICBjb25zdCBmYWNlcyA9IFtbMywgMiwgMSwgMF0sIC8vIC16CiAgICAgIFs0LCA1LCA2LCA3XSwgLy8gK3oKICAgICAgWzUsIDQsIDAsIDFdLCAvLyAteQogICAgICBbMiwgMywgNywgNl0sIC8vICt5CiAgICAgIFswLCA0LCA3LCAzXSwgLy8gLXgKICAgICAgWzEsIDIsIDYsIDVdIC8vICt4CiAgICAgIF07CiAgICAgIGNvbnN0IGF4ZXMgPSBbbmV3IFYoMCwgMCwgMSksIG5ldyBWKDAsIDEsIDApLCBuZXcgVigxLCAwLCAwKV07CiAgICAgIGNvbnN0IGggPSBuZXcgQ29udmV4UG9seWhlZHJvbih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24gPSBoOwogICAgICBoLm1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKICAgIH0KICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHRoZSBpbmVydGlhIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CgogIGNvbnN0IHdvcmxkQ29ybmVyVGVtcFBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgd29ybGRDb3JuZXJzVGVtcCA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCgogIGNvbnN0IEJPRFlfVFlQRVMgPSB7CiAgICAvKiogRFlOQU1JQyAqLwogICAgRFlOQU1JQzogMSwKCiAgICAvKiogU1RBVElDICovCiAgICBTVEFUSUM6IDIsCgogICAgLyoqIEtJTkVNQVRJQyAqLwogICAgS0lORU1BVElDOiA0CiAgfTsKICAvKioKICAgKiBCb2R5VHlwZQogICAqLwoKICAvKioKICAgKiBCT0RZX1NMRUVQX1NUQVRFUwogICAqLwoKICBjb25zdCBCT0RZX1NMRUVQX1NUQVRFUyA9IHsKICAgIC8qKiBBV0FLRSAqLwogICAgQVdBS0U6IDAsCgogICAgLyoqIFNMRUVQWSAqLwogICAgU0xFRVBZOiAxLAoKICAgIC8qKiBTTEVFUElORyAqLwogICAgU0xFRVBJTkc6IDIKICB9OwogIC8qKgogICAqIEJvZHlTbGVlcFN0YXRlCiAgICovCgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGFsbCBib2R5IHR5cGVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUoMSkKICAgKiAgICAgY29uc3QgYm9keSA9IG5ldyBDQU5OT04uQm9keSh7CiAgICogICAgICAgbWFzczogMSwKICAgKiAgICAgICBzaGFwZSwKICAgKiAgICAgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShib2R5KQogICAqLwoKICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvc2l0aW9uIG9mIGJvZHkgaW4gV29ybGQuYm9kaWVzLiBVcGRhdGVkIGJ5IFdvcmxkIGFuZCB1c2VkIGluIEFycmF5Q29sbGlzaW9uTWF0cml4LgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2UgdG8gdGhlIHdvcmxkIHRoZSBib2R5IGlzIGxpdmluZyBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIEJFRk9SRSBzdGVwcGluZyB0aGUgc3lzdGVtLiBVc2UgaXQgdG8gYXBwbHkgZm9yY2VzLCBmb3IgZXhhbXBsZS4gSW5zaWRlIHRoZSBmdW5jdGlvbiwgInRoaXMiIHdpbGwgcmVmZXIgdG8gdGhpcyBCb2R5IG9iamVjdC4gRGVwcmVjYXRlZCAtIHVzZSBXb3JsZCBldmVudHMgaW5zdGVhZC4KICAgICAqIEBkZXByZWNhdGVkIFVzZSBXb3JsZCBldmVudHMgaW5zdGVhZAogICAgICovCgogICAgLyoqCiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIHVzZWQgQUZURVIgc3RlcHBpbmcgdGhlIHN5c3RlbS4gSW5zaWRlIHRoZSBmdW5jdGlvbiwgInRoaXMiIHdpbGwgcmVmZXIgdG8gdGhpcyBCb2R5IG9iamVjdC4gRGVwcmVjYXRlZCAtIHVzZSBXb3JsZCBldmVudHMgaW5zdGVhZC4KICAgICAqIEBkZXByZWNhdGVkIFVzZSBXb3JsZCBldmVudHMgaW5zdGVhZAogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgY29sbGlzaW9uIGdyb3VwIHRoZSBib2R5IGJlbG9uZ3MgdG8uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBjb2xsaXNpb24gZ3JvdXAgdGhlIGJvZHkgY2FuIGNvbGxpZGUgd2l0aC4KICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZCAtIGkuZS4gImNvbGxpZGUiIGV2ZW50cyB3aWxsIGJlIHJhaXNlZCwgYnV0IGZvcmNlcyB3aWxsIG5vdCBiZSBhbHRlcmVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW50ZXJwb2xhdGVkIHBvc2l0aW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBJbml0aWFsIHBvc2l0aW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSB2ZWxvY2l0eSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5pdGlhbCB2ZWxvY2l0eSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogTGluZWFyIGZvcmNlIG9uIHRoZSBib2R5IGluIHdvcmxkIHNwYWNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbWFzcyBvZiB0aGUgYm9keS4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHBoeXNpY3MgbWF0ZXJpYWwgb2YgdGhlIGJvZHkuIEl0IGRlZmluZXMgdGhlIGJvZHkgaW50ZXJhY3Rpb24gd2l0aCBvdGhlciBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEhvdyBtdWNoIHRvIGRhbXAgdGhlIGJvZHkgdmVsb2NpdHkgZWFjaCBzdGVwLiBJdCBjYW4gZ28gZnJvbSAwIHRvIDEuCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIE9uZSBvZjogYEJvZHkuRFlOQU1JQ2AsIGBCb2R5LlNUQVRJQ2AgYW5kIGBCb2R5LktJTkVNQVRJQ2AuCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRydWUsIHRoZSBib2R5IHdpbGwgYXV0b21hdGljYWxseSBmYWxsIHRvIHNsZWVwLgogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBDdXJyZW50IHNsZWVwIHN0YXRlLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgc3BlZWQgKHRoZSBub3JtIG9mIHRoZSB2ZWxvY2l0eSkgaXMgc21hbGxlciB0aGFuIHRoaXMgdmFsdWUsIHRoZSBib2R5IGlzIGNvbnNpZGVyZWQgc2xlZXB5LgogICAgICogQGRlZmF1bHQgMC4xCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSBib2R5IGhhcyBiZWVuIHNsZWVweSBmb3IgdGhpcyBzbGVlcFRpbWVMaW1pdCBzZWNvbmRzLCBpdCBpcyBjb25zaWRlcmVkIHNsZWVwaW5nLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSByb3RhdGlvbmFsIGZvcmNlIG9uIHRoZSBib2R5LCBhcm91bmQgY2VudGVyIG9mIG1hc3MuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIHNwYWNlIG9yaWVudGF0aW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBJbml0aWFsIHF1YXRlcm5pb24gb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEludGVycG9sYXRlZCBvcmllbnRhdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5ndWxhciB2ZWxvY2l0eSBvZiB0aGUgYm9keSwgaW4gd29ybGQgc3BhY2UuIFRoaW5rIG9mIHRoZSBhbmd1bGFyIHZlbG9jaXR5IGFzIGEgdmVjdG9yLCB3aGljaCB0aGUgYm9keSByb3RhdGVzIGFyb3VuZC4gVGhlIGxlbmd0aCBvZiB0aGlzIHZlY3RvciBkZXRlcm1pbmVzIGhvdyBmYXN0IChpbiByYWRpYW5zIHBlciBzZWNvbmQpIHRoZSBib2R5IHJvdGF0ZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEluaXRpYWwgYW5ndWxhciB2ZWxvY2l0eSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogTGlzdCBvZiBTaGFwZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvc2l0aW9uIG9mIGVhY2ggU2hhcGUgaW4gdGhlIGJvZHksIGdpdmVuIGluIGxvY2FsIEJvZHkgc3BhY2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE9yaWVudGF0aW9uIG9mIGVhY2ggU2hhcGUsIGdpdmVuIGluIGxvY2FsIEJvZHkgc3BhY2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmVydGlhIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gdHJ1ZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9keSB0byByb3RhdGUuIE1ha2Ugc3VyZSB0byBydW4gLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCkgaWYgeW91IGNoYW5nZSB0aGlzIGFmdGVyIHRoZSBib2R5IGNyZWF0aW9uLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG11Y2ggdG8gZGFtcCB0aGUgYm9keSBhbmd1bGFyIHZlbG9jaXR5IGVhY2ggc3RlcC4gSXQgY2FuIGdvIGZyb20gMCB0byAxLgogICAgICogQGRlZmF1bHQgMC4wMQogICAgICovCgogICAgLyoqCiAgICAgKiBVc2UgdGhpcyBwcm9wZXJ0eSB0byBsaW1pdCB0aGUgbW90aW9uIGFsb25nIGFueSB3b3JsZCBheGlzLiAoMSwxLDEpIHdpbGwgYWxsb3cgbW90aW9uIGFsb25nIGFsbCBheGVzIHdoaWxlICgwLDAsMCkgYWxsb3dzIG5vbmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZSB0aGlzIHByb3BlcnR5IHRvIGxpbWl0IHRoZSByb3RhdGlvbmFsIG1vdGlvbiBhbG9uZyBhbnkgd29ybGQgYXhpcy4gKDEsMSwxKSB3aWxsIGFsbG93IHJvdGF0aW9uIGFsb25nIGFsbCBheGVzIHdoaWxlICgwLDAsMCkgYWxsb3dzIG5vbmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIHNwYWNlIGJvdW5kaW5nIGJveCBvZiB0aGUgYm9keSBhbmQgaXRzIHNoYXBlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5kaWNhdGVzIGlmIHRoZSBBQUJCIG5lZWRzIHRvIGJlIHVwZGF0ZWQgYmVmb3JlIHVzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVG90YWwgYm91bmRpbmcgcmFkaXVzIG9mIHRoZSBCb2R5IGluY2x1ZGluZyBpdHMgc2hhcGVzLCByZWxhdGl2ZSB0byBib2R5LnBvc2l0aW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRydWUgdGhlIGJvZHkgYmVoYXZlcyBsaWtlIGEgdHJpZ2dlci4gSXQgZG9lcyBub3QgY29sbGlkZQogICAgICogd2l0aCBvdGhlciBib2RpZXMgYnV0IGNvbGxpc2lvbiBldmVudHMgYXJlIHN0aWxsIHRyaWdnZXJlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLmluZGV4ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLnByZVN0ZXAgPSB2b2lkIDA7CiAgICAgIHRoaXMucG9zdFN0ZXAgPSB2b2lkIDA7CiAgICAgIHRoaXMudmxhbWJkYSA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvblJlc3BvbnNlID0gdm9pZCAwOwogICAgICB0aGlzLnBvc2l0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5pdFBvc2l0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLmluaXRWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5mb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXNzID0gdm9pZCAwOwogICAgICB0aGlzLmludk1hc3MgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMubGluZWFyRGFtcGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy50eXBlID0gdm9pZCAwOwogICAgICB0aGlzLmFsbG93U2xlZXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGVlcFNwZWVkTGltaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xlZXBUaW1lTGltaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB2b2lkIDA7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHZvaWQgMDsKICAgICAgdGhpcy50b3JxdWUgPSB2b2lkIDA7CiAgICAgIHRoaXMucXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5pdEFuZ3VsYXJWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5zaGFwZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzID0gdm9pZCAwOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLmluZXJ0aWEgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdm9pZCAwOwogICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ3VsYXJEYW1waW5nID0gdm9pZCAwOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmd1bGFyRmFjdG9yID0gdm9pZCAwOwogICAgICB0aGlzLmFhYmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdm9pZCAwOwogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gdm9pZCAwOwogICAgICB0aGlzLndsYW1iZGEgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gQm9keS5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5pbmRleCA9IC0xOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5wcmVTdGVwID0gbnVsbDsKICAgICAgdGhpcy5wb3N0U3RlcCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgd29ybGRQb2ludC52c3ViKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCB2ZWN0b3IgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb0xvY2FsRnJhbWUod29ybGRWZWN0b3IsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHdvcmxkVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGRGcmFtZShsb2NhbFBvaW50LCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBzaGFwZSB0byB0aGUgYm9keSB3aXRoIGEgbG9jYWwgb2Zmc2V0IGFuZCBvcmllbnRhdGlvbi4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZFNoYXBlKHNoYXBlLCBfb2Zmc2V0LCBfb3JpZW50YXRpb24pIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKF9vZmZzZXQpIHsKICAgICAgICBvZmZzZXQuY29weShfb2Zmc2V0KTsKICAgICAgfQoKICAgICAgaWYgKF9vcmllbnRhdGlvbikgewogICAgICAgIG9yaWVudGF0aW9uLmNvcHkoX29yaWVudGF0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMucHVzaChzaGFwZSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5wdXNoKG9yaWVudGF0aW9uKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBib2R5LgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlU2hhcGUoc2hhcGUpIHsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNoYXBlcy5pbmRleE9mKHNoYXBlKTsKCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1NoYXBlIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgYm9keScpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSBudWxsOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBib3VuZGluZyByYWRpdXMgb2YgdGhlIGJvZHkuIFNob3VsZCBiZSBkb25lIGlmIGFueSBvZiB0aGUgc2hhcGVzIGFyZSBjaGFuZ2VkLgogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nUmFkaXVzKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBsZXQgcmFkaXVzID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsKICAgICAgICBzaGFwZS51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICAgIGNvbnN0IG9mZnNldCA9IHNoYXBlT2Zmc2V0c1tpXS5sZW5ndGgoKTsKICAgICAgICBjb25zdCByID0gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CgogICAgICAgIGlmIChvZmZzZXQgKyByID4gcmFkaXVzKSB7CiAgICAgICAgICByYWRpdXMgPSBvZmZzZXQgKyByOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IHJhZGl1czsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgLmFhYmIKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IHNoYXBlT3JpZW50YXRpb25zID0gdGhpcy5zaGFwZU9yaWVudGF0aW9uczsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGNvbnN0IG9mZnNldCA9IHRtcFZlYzsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSB0bXBRdWF0OwogICAgICBjb25zdCBib2R5UXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3Qgc2hhcGVBQUJCID0gdXBkYXRlQUFCQl9zaGFwZUFBQkI7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07IC8vIEdldCBzaGFwZSB3b3JsZCBwb3NpdGlvbgoKICAgICAgICBib2R5UXVhdC52bXVsdChzaGFwZU9mZnNldHNbaV0sIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0LnZhZGQodGhpcy5wb3NpdGlvbiwgb2Zmc2V0KTsgLy8gR2V0IHNoYXBlIHdvcmxkIHF1YXRlcm5pb24KCiAgICAgICAgYm9keVF1YXQubXVsdChzaGFwZU9yaWVudGF0aW9uc1tpXSwgb3JpZW50YXRpb24pOyAvLyBHZXQgc2hhcGUgQUFCQgoKICAgICAgICBzaGFwZS5jYWxjdWxhdGVXb3JsZEFBQkIob2Zmc2V0LCBvcmllbnRhdGlvbiwgc2hhcGVBQUJCLmxvd2VyQm91bmQsIHNoYXBlQUFCQi51cHBlckJvdW5kKTsKCiAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgIGFhYmIuY29weShzaGFwZUFBQkIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhYWJiLmV4dGVuZChzaGFwZUFBQkIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIGAuaW5lcnRpYVdvcmxkYCBhbmQgYC5pbnZJbmVydGlhV29ybGRgCiAgICAgKi8KCgogICAgdXBkYXRlSW5lcnRpYVdvcmxkKGZvcmNlKSB7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmludkluZXJ0aWE7CiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDtlbHNlIHsKICAgICAgICBjb25zdCBtMSA9IHVpd19tMTsKICAgICAgICBjb25zdCBtMiA9IHVpd19tMjsKICAgICAgICBtMS5zZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHRoaXMucXVhdGVybmlvbik7CiAgICAgICAgbTEudHJhbnNwb3NlKG0yKTsKICAgICAgICBtMS5zY2FsZShJLCBtMSk7CiAgICAgICAgbTEubW11bHQobTIsIHRoaXMuaW52SW5lcnRpYVdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFwcGx5aW5nIGZvcmNlIHRoaXMgd2F5IHdpbGwgYWRkIHRvIEJvZHkuZm9yY2UgYW5kIEJvZHkudG9ycXVlLgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBhbW91bnQgb2YgZm9yY2UgdG8gYWRkLgogICAgICogQHBhcmFtIHJlbGF0aXZlUG9pbnQgQSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3MgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoZm9yY2UsIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpKSB7CiAgICAgIC8vIE5lZWRlZD8KICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgZm9yY2UKCgogICAgICBjb25zdCByb3RGb3JjZSA9IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZTsKICAgICAgcmVsYXRpdmVQb2ludC5jcm9zcyhmb3JjZSwgcm90Rm9yY2UpOyAvLyBBZGQgbGluZWFyIGZvcmNlCgogICAgICB0aGlzLmZvcmNlLnZhZGQoZm9yY2UsIHRoaXMuZm9yY2UpOyAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKICAgICAgdGhpcy50b3JxdWUudmFkZChyb3RGb3JjZSwgdGhpcy50b3JxdWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxGb3JjZShsb2NhbEZvcmNlLCBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpKSB7CiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIHRoaXMud2FrZVVwKCk7CiAgICAgIH0gLy8gQ29tcHV0ZSBwb2ludCBwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgYm9keSBjZW50ZXIKCgogICAgICBjb25zdCByID0gcmVsYXRpdmVQb2ludDsgLy8gQ29tcHV0ZSBwcm9kdWNlZCBjZW50cmFsIGltcHVsc2UgdmVsb2NpdHkKCiAgICAgIGNvbnN0IHZlbG8gPSBCb2R5X2FwcGx5SW1wdWxzZV92ZWxvOwogICAgICB2ZWxvLmNvcHkoaW1wdWxzZSk7CiAgICAgIHZlbG8uc2NhbGUodGhpcy5pbnZNYXNzLCB2ZWxvKTsgLy8gQWRkIGxpbmVhciBpbXB1bHNlCgogICAgICB0aGlzLnZlbG9jaXR5LnZhZGQodmVsbywgdGhpcy52ZWxvY2l0eSk7IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCByb3RWZWxvID0gQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbzsKICAgICAgci5jcm9zcyhpbXB1bHNlLCByb3RWZWxvKTsKICAgICAgLyoKICAgICAgIHJvdFZlbG8ueCAqPSB0aGlzLmludkluZXJ0aWEueDsKICAgICAgIHJvdFZlbG8ueSAqPSB0aGlzLmludkluZXJ0aWEueTsKICAgICAgIHJvdFZlbG8ueiAqPSB0aGlzLmludkluZXJ0aWEuejsKICAgICAgICovCgogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZC52bXVsdChyb3RWZWxvLCByb3RWZWxvKTsgLy8gQWRkIHJvdGF0aW9uYWwgSW1wdWxzZQoKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkudmFkZChyb3RWZWxvLCB0aGlzLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGxvY2FsbHktZGVmaW5lZCBpbXB1bHNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEltcHVsc2UobG9jYWxJbXB1bHNlLCBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkSW1wdWxzZSA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEltcHVsc2UsIHdvcmxkSW1wdWxzZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlJbXB1bHNlKHdvcmxkSW1wdWxzZSwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogU2hvdWxkIGJlIGNhbGxlZCB3aGVuZXZlciB5b3UgY2hhbmdlIHRoZSBib2R5IHNoYXBlIG9yIG1hc3MuCiAgICAgKi8KCgogICAgdXBkYXRlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50czsKICAgICAgdGhpcy5pbnZNYXNzID0gdGhpcy5tYXNzID4gMCA/IDEuMCAvIHRoaXMubWFzcyA6IDA7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmluZXJ0aWE7CiAgICAgIGNvbnN0IGZpeGVkID0gdGhpcy5maXhlZFJvdGF0aW9uOyAvLyBBcHByb3hpbWF0ZSB3aXRoIEFBQkIgYm94CgogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgaGFsZkV4dGVudHMuc2V0KCh0aGlzLmFhYmIudXBwZXJCb3VuZC54IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueCkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueSAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnkpIC8gMiwgKHRoaXMuYWFiYi51cHBlckJvdW5kLnogLSB0aGlzLmFhYmIubG93ZXJCb3VuZC56KSAvIDIpOwogICAgICBCb3guY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgdGhpcy5tYXNzLCBJKTsKICAgICAgdGhpcy5pbnZJbmVydGlhLnNldChJLnggPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueCA6IDAsIEkueSA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS55IDogMCwgSS56ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnogOiAwKTsKICAgICAgdGhpcy51cGRhdGVJbmVydGlhV29ybGQodHJ1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB3b3JsZCB2ZWxvY2l0eSBvZiBhIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIHdvcmxkUG9pbnQKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCB2ZWN0b3IuCiAgICAgKi8KCgogICAgZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IHIgPSBuZXcgVmVjMygpOwogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcik7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHIsIHJlc3VsdCk7CiAgICAgIHRoaXMudmVsb2NpdHkudmFkZChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIE1vdmUgdGhlIGJvZHkgZm9yd2FyZCBpbiB0aW1lLgogICAgICogQHBhcmFtIGR0IFRpbWUgc3RlcAogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemUgU2V0IHRvIHRydWUgdG8gbm9ybWFsaXplIHRoZSBib2R5IHF1YXRlcm5pb24KICAgICAqIEBwYXJhbSBxdWF0Tm9ybWFsaXplRmFzdCBJZiB0aGUgcXVhdGVybmlvbiBzaG91bGQgYmUgbm9ybWFsaXplZCB1c2luZyAiZmFzdCIgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAvLyBTYXZlIHByZXZpb3VzIHBvc2l0aW9uCiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KHRoaXMucXVhdGVybmlvbik7CgogICAgICBpZiAoISh0aGlzLnR5cGUgPT09IEJvZHkuRFlOQU1JQyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB8fCB0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2ZWxvID0gdGhpcy52ZWxvY2l0eTsKICAgICAgY29uc3QgYW5ndWxhclZlbG8gPSB0aGlzLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgY29uc3QgcG9zID0gdGhpcy5wb3NpdGlvbjsKICAgICAgY29uc3QgZm9yY2UgPSB0aGlzLmZvcmNlOwogICAgICBjb25zdCB0b3JxdWUgPSB0aGlzLnRvcnF1ZTsKICAgICAgY29uc3QgcXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgaW52TWFzcyA9IHRoaXMuaW52TWFzczsKICAgICAgY29uc3QgaW52SW5lcnRpYSA9IHRoaXMuaW52SW5lcnRpYVdvcmxkOwogICAgICBjb25zdCBsaW5lYXJGYWN0b3IgPSB0aGlzLmxpbmVhckZhY3RvcjsKICAgICAgY29uc3QgaU1kdCA9IGludk1hc3MgKiBkdDsKICAgICAgdmVsby54ICs9IGZvcmNlLnggKiBpTWR0ICogbGluZWFyRmFjdG9yLng7CiAgICAgIHZlbG8ueSArPSBmb3JjZS55ICogaU1kdCAqIGxpbmVhckZhY3Rvci55OwogICAgICB2ZWxvLnogKz0gZm9yY2UueiAqIGlNZHQgKiBsaW5lYXJGYWN0b3IuejsKICAgICAgY29uc3QgZSA9IGludkluZXJ0aWEuZWxlbWVudHM7CiAgICAgIGNvbnN0IGFuZ3VsYXJGYWN0b3IgPSB0aGlzLmFuZ3VsYXJGYWN0b3I7CiAgICAgIGNvbnN0IHR4ID0gdG9ycXVlLnggKiBhbmd1bGFyRmFjdG9yLng7CiAgICAgIGNvbnN0IHR5ID0gdG9ycXVlLnkgKiBhbmd1bGFyRmFjdG9yLnk7CiAgICAgIGNvbnN0IHR6ID0gdG9ycXVlLnogKiBhbmd1bGFyRmFjdG9yLno7CiAgICAgIGFuZ3VsYXJWZWxvLnggKz0gZHQgKiAoZVswXSAqIHR4ICsgZVsxXSAqIHR5ICsgZVsyXSAqIHR6KTsKICAgICAgYW5ndWxhclZlbG8ueSArPSBkdCAqIChlWzNdICogdHggKyBlWzRdICogdHkgKyBlWzVdICogdHopOwogICAgICBhbmd1bGFyVmVsby56ICs9IGR0ICogKGVbNl0gKiB0eCArIGVbN10gKiB0eSArIGVbOF0gKiB0eik7IC8vIFVzZSBuZXcgdmVsb2NpdHkgIC0gbGVhcCBmcm9nCgogICAgICBwb3MueCArPSB2ZWxvLnggKiBkdDsKICAgICAgcG9zLnkgKz0gdmVsby55ICogZHQ7CiAgICAgIHBvcy56ICs9IHZlbG8ueiAqIGR0OwogICAgICBxdWF0LmludGVncmF0ZSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSwgZHQsIHRoaXMuYW5ndWxhckZhY3RvciwgcXVhdCk7CgogICAgICBpZiAocXVhdE5vcm1hbGl6ZSkgewogICAgICAgIGlmIChxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAgICAgcXVhdC5ub3JtYWxpemVGYXN0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1YXQubm9ybWFsaXplKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7IC8vIFVwZGF0ZSB3b3JsZCBpbmVydGlhCgogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCgpOwogICAgfQoKICB9CgogIEJvZHkuaWRDb3VudGVyID0gMDsKICBCb2R5LkNPTExJREVfRVZFTlRfTkFNRSA9ICdjb2xsaWRlJzsKICBCb2R5LkRZTkFNSUMgPSBCT0RZX1RZUEVTLkRZTkFNSUM7CiAgQm9keS5TVEFUSUMgPSBCT0RZX1RZUEVTLlNUQVRJQzsKICBCb2R5LktJTkVNQVRJQyA9IEJPRFlfVFlQRVMuS0lORU1BVElDOwogIEJvZHkuQVdBS0UgPSBCT0RZX1NMRUVQX1NUQVRFUy5BV0FLRTsKICBCb2R5LlNMRUVQWSA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQWTsKICBCb2R5LlNMRUVQSU5HID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBJTkc7CiAgQm9keS53YWtldXBFdmVudCA9IHsKICAgIHR5cGU6ICd3YWtldXAnCiAgfTsKICBCb2R5LnNsZWVweUV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVweScKICB9OwogIEJvZHkuc2xlZXBFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcCcKICB9OwogIGNvbnN0IHRtcFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgdXBkYXRlQUFCQl9zaGFwZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHVpd19tMSA9IG5ldyBNYXQzKCk7CiAgY29uc3QgdWl3X20yID0gbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3IgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbnMKICAgKiBAYXV0aG9yIHNjaHRlcHBlCiAgICovCgogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy51c2VCb3VuZGluZ0JveGVzID0gdm9pZCAwOwogICAgICB0aGlzLmRpcnR5ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy51c2VCb3VuZGluZ0JveGVzID0gZmFsc2U7CiAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNvbGxpc2lvbiBwYWlycyBmcm9tIHRoZSB3b3JsZAogICAgICogQHBhcmFtIHdvcmxkIFRoZSB3b3JsZCB0byBzZWFyY2ggaW4KICAgICAqIEBwYXJhbSBwMSBFbXB0eSBhcnJheSB0byBiZSBmaWxsZWQgd2l0aCBib2R5IG9iamVjdHMKICAgICAqIEBwYXJhbSBwMiBFbXB0eSBhcnJheSB0byBiZSBmaWxsZWQgd2l0aCBib2R5IG9iamVjdHMKICAgICAqLwoKCiAgICBjb2xsaXNpb25QYWlycyh3b3JsZCwgcDEsIHAyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY29sbGlzaW9uUGFpcnMgbm90IGltcGxlbWVudGVkIGZvciB0aGlzIEJyb2FkUGhhc2UgY2xhc3MhJyk7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgYm9keSBwYWlyIG5lZWRzIHRvIGJlIGludGVyc2VjdGlvbiB0ZXN0ZWQgYXQgYWxsLgogICAgICovCgoKICAgIG5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJvZHlBLCBib2R5QikgewogICAgICAvLyBDaGVjayBjb2xsaXNpb24gZmlsdGVyIG1hc2tzCiAgICAgIGlmICgoYm9keUEuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5Qi5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCB8fCAoYm9keUIuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5QS5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyBDaGVjayB0eXBlcwoKCiAgICAgIGlmICgoKGJvZHlBLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUEuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgJiYgKChib2R5Qi50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlCLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpKSB7CiAgICAgICAgLy8gQm90aCBib2RpZXMgYXJlIHN0YXRpYyBvciBzbGVlcGluZy4gU2tpcC4KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgdm9sdW1lcyBvZiB0d28gYm9kaWVzIGludGVyc2VjdC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3Rpb25UZXN0KGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKHRoaXMudXNlQm91bmRpbmdCb3hlcykgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ0JveEJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgc3BoZXJlcyBvZiB0d28gYm9kaWVzIGFyZSBpbnRlcnNlY3RpbmcuCiAgICAgKiBAcGFyYW0gcGFpcnMxIGJvZHlBIGlzIGFwcGVuZGVkIHRvIHRoaXMgYXJyYXkgaWYgaW50ZXJzZWN0aW9uCiAgICAgKiBAcGFyYW0gcGFpcnMyIGJvZHlCIGlzIGFwcGVuZGVkIHRvIHRoaXMgYXJyYXkgaWYgaW50ZXJzZWN0aW9uCiAgICAgKi8KCgogICAgZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCByID0gQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yOwogICAgICBib2R5Qi5wb3NpdGlvbi52c3ViKGJvZHlBLnBvc2l0aW9uLCByKTsKICAgICAgY29uc3QgYm91bmRpbmdSYWRpdXNTdW0yID0gKGJvZHlBLmJvdW5kaW5nUmFkaXVzICsgYm9keUIuYm91bmRpbmdSYWRpdXMpICoqIDI7CiAgICAgIGNvbnN0IG5vcm0yID0gci5sZW5ndGhTcXVhcmVkKCk7CgogICAgICBpZiAobm9ybTIgPCBib3VuZGluZ1JhZGl1c1N1bTIpIHsKICAgICAgICBwYWlyczEucHVzaChib2R5QSk7CiAgICAgICAgcGFpcnMyLnB1c2goYm9keUIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBib3hlcyBvZiB0d28gYm9kaWVzIGFyZSBpbnRlcnNlY3RpbmcuCiAgICAgKi8KCgogICAgZG9Cb3VuZGluZ0JveEJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAoYm9keUEuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgYm9keUEudXBkYXRlQUFCQigpOwogICAgICB9CgogICAgICBpZiAoYm9keUIuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgYm9keUIudXBkYXRlQUFCQigpOwogICAgICB9IC8vIENoZWNrIEFBQkIgLyBBQUJCCgoKICAgICAgaWYgKGJvZHlBLmFhYmIub3ZlcmxhcHMoYm9keUIuYWFiYikpIHsKICAgICAgICBwYWlyczEucHVzaChib2R5QSk7CiAgICAgICAgcGFpcnMyLnB1c2goYm9keUIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgZHVwbGljYXRlIHBhaXJzIGZyb20gdGhlIHBhaXIgYXJyYXlzLgogICAgICovCgoKICAgIG1ha2VQYWlyc1VuaXF1ZShwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCB0ID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfdGVtcDsKICAgICAgY29uc3QgcDEgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMTsKICAgICAgY29uc3QgcDIgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMjsKICAgICAgY29uc3QgTiA9IHBhaXJzMS5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgcDFbaV0gPSBwYWlyczFbaV07CiAgICAgICAgcDJbaV0gPSBwYWlyczJbaV07CiAgICAgIH0KCiAgICAgIHBhaXJzMS5sZW5ndGggPSAwOwogICAgICBwYWlyczIubGVuZ3RoID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBpZDEgPSBwMVtpXS5pZDsKICAgICAgICBjb25zdCBpZDIgPSBwMltpXS5pZDsKICAgICAgICBjb25zdCBrZXkgPSBpZDEgPCBpZDIgPyBpZDEgKyAiLCIgKyBpZDIgOiBpZDIgKyAiLCIgKyBpZDE7CiAgICAgICAgdFtrZXldID0gaTsKICAgICAgICB0LmtleXMucHVzaChrZXkpOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdC5rZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qga2V5ID0gdC5rZXlzLnBvcCgpOwogICAgICAgIGNvbnN0IHBhaXJJbmRleCA9IHRba2V5XTsKICAgICAgICBwYWlyczEucHVzaChwMVtwYWlySW5kZXhdKTsKICAgICAgICBwYWlyczIucHVzaChwMltwYWlySW5kZXhdKTsKICAgICAgICBkZWxldGUgdFtrZXldOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFRvIGJlIGltcGxlbWVudGVkIGJ5IHN1YmNhc3NlcwogICAgICovCgoKICAgIHNldFdvcmxkKHdvcmxkKSB7fQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgc3BoZXJlcyBvZiB0d28gYm9kaWVzIG92ZXJsYXAuCiAgICAgKi8KCgogICAgc3RhdGljIGJvdW5kaW5nU3BoZXJlQ2hlY2soYm9keUEsIGJvZHlCKSB7CiAgICAgIGNvbnN0IGRpc3QgPSBuZXcgVmVjMygpOyAvLyBic2NfZGlzdDsKCiAgICAgIGJvZHlBLnBvc2l0aW9uLnZzdWIoYm9keUIucG9zaXRpb24sIGRpc3QpOwogICAgICBjb25zdCBzYSA9IGJvZHlBLnNoYXBlc1swXTsKICAgICAgY29uc3Qgc2IgPSBib2R5Qi5zaGFwZXNbMF07CiAgICAgIHJldHVybiBNYXRoLnBvdyhzYS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNiLmJvdW5kaW5nU3BoZXJlUmFkaXVzLCAyKSA+IGRpc3QubGVuZ3RoU3F1YXJlZCgpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiB0aGUgQUFCQi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBjb25zb2xlLndhcm4oJy5hYWJiUXVlcnkgaXMgbm90IGltcGxlbWVudGVkIGluIHRoaXMgQnJvYWRwaGFzZSBzdWJjbGFzcy4nKTsKICAgICAgcmV0dXJuIFtdOwogICAgfQoKICB9IC8vIFRlbXAgb2JqZWN0cwoKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICAvKioKICAgKiBOYWl2ZSBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9uLCB1c2VkIGluIGxhY2sgb2YgYmV0dGVyIG9uZXMuCiAgICoKICAgKiBUaGUgbmFpdmUgYnJvYWRwaGFzZSBsb29rcyBhdCBhbGwgcG9zc2libGUgcGFpcnMgd2l0aG91dCByZXN0cmljdGlvbiwgdGhlcmVmb3JlIGl0IGhhcyBjb21wbGV4aXR5IE5eMiBfKHdoaWNoIGlzIGJhZClfCiAgICovCgogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0ID0gW10pIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gd29ybGQuYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0gLy8gVWdseSBoYWNrIHVudGlsIEJvZHkgZ2V0cyBhYWJiCgoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCgoKICBjbGFzcyBSYXljYXN0UmVzdWx0IHsKICAgIC8qKgogICAgICogcmF5RnJvbVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJheVRvV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGl0Tm9ybWFsV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGl0UG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoYXNIaXQKICAgICAqLwoKICAgIC8qKgogICAgICogc2hhcGUKICAgICAqLwoKICAgIC8qKgogICAgICogYm9keQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggb2YgdGhlIGhpdCB0cmlhbmdsZSwgaWYgdGhlIGhpdCBzaGFwZSB3YXMgYSB0cmltZXNoCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3RhbmNlIHRvIHRoZSBoaXQuIFdpbGwgYmUgc2V0IHRvIC0xIGlmIHRoZXJlIHdhcyBubyBoaXQKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIHJheSBzaG91bGQgc3RvcCB0cmF2ZXJzaW5nIHRoZSBib2RpZXMKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLnJheVRvV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5oYXNIaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hhcGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keSA9IHZvaWQgMDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJheVRvV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFJlc2V0IGFsbCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLnJheVRvV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIGFib3J0CiAgICAgKi8KCgogICAgYWJvcnQoKSB7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICBzZXQocmF5RnJvbVdvcmxkLCByYXlUb1dvcmxkLCBoaXROb3JtYWxXb3JsZCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLmNvcHkocmF5RnJvbVdvcmxkKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLmNvcHkocmF5VG9Xb3JsZCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuY29weShoaXROb3JtYWxXb3JsZCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5jb3B5KGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnNoYXBlID0gc2hhcGU7CiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgIH0KCiAgfQoKICBsZXQgX1NoYXBlJHR5cGVzJFNQSEVSRSwgX1NoYXBlJHR5cGVzJFBMQU5FLCBfU2hhcGUkdHlwZXMkQk9YLCBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIsIF9TaGFwZSR0eXBlcyRDT05WRVhQTywgX1NoYXBlJHR5cGVzJEhFSUdIVEZJLCBfU2hhcGUkdHlwZXMkVFJJTUVTSDsKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KCgogIGNvbnN0IFJBWV9NT0RFUyA9IHsKICAgIC8qKiBDTE9TRVNUICovCiAgICBDTE9TRVNUOiAxLAoKICAgIC8qKiBBTlkgKi8KICAgIEFOWTogMiwKCiAgICAvKiogQUxMICovCiAgICBBTEw6IDQKICB9OwogIC8qKgogICAqIFJheU1vZGUKICAgKi8KCiAgX1NoYXBlJHR5cGVzJFNQSEVSRSA9IFNoYXBlLnR5cGVzLlNQSEVSRTsKICBfU2hhcGUkdHlwZXMkUExBTkUgPSBTaGFwZS50eXBlcy5QTEFORTsKICBfU2hhcGUkdHlwZXMkQk9YID0gU2hhcGUudHlwZXMuQk9YOwogIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiA9IFNoYXBlLnR5cGVzLkNZTElOREVSOwogIF9TaGFwZSR0eXBlcyRDT05WRVhQTyA9IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST047CiAgX1NoYXBlJHR5cGVzJEhFSUdIVEZJID0gU2hhcGUudHlwZXMuSEVJR0hURklFTEQ7CiAgX1NoYXBlJHR5cGVzJFRSSU1FU0ggPSBTaGFwZS50eXBlcy5UUklNRVNIOwogIC8qKgogICAqIEEgbGluZSBpbiAzRCBzcGFjZSB0aGF0IGludGVyc2VjdHMgYm9kaWVzIGFuZCByZXR1cm4gcG9pbnRzLgogICAqLwoKICBjbGFzcyBSYXkgewogICAgLyoqCiAgICAgKiBmcm9tCiAgICAgKi8KCiAgICAvKioKICAgICAqIHRvCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRpcmVjdGlvbgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgcHJlY2lzaW9uIG9mIHRoZSByYXkuIFVzZWQgd2hlbiBjaGVja2luZyBwYXJhbGxlbGl0eSBldGMuCiAgICAgKiBAZGVmYXVsdCAwLjAwMDEKICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGBmYWxzZWAgaWYgeW91IGRvbid0IHdhbnQgdGhlIFJheSB0byB0YWtlIGBjb2xsaXNpb25SZXNwb25zZWAgZmxhZ3MgaW50byBhY2NvdW50IG9uIGJvZGllcyBhbmQgc2hhcGVzLgogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgcmF5IHNraXBzIGFueSBoaXRzIHdpdGggbm9ybWFsLmRvdChyYXlEaXJlY3Rpb24pIDwgMC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbkZpbHRlckdyb3VwCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW50ZXJzZWN0aW9uIG1vZGUuIFNob3VsZCBiZSBSYXkuQU5ZLCBSYXkuQUxMIG9yIFJheS5DTE9TRVNULgogICAgICogQGRlZmF1bHQgUkFZLkFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBDdXJyZW50IHJlc3VsdCBvYmplY3QuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdpbGwgYmUgc2V0IHRvIGB0cnVlYCBkdXJpbmcgaW50ZXJzZWN0V29ybGQoKSBpZiB0aGUgcmF5IGhpdCBhbnl0aGluZy4KICAgICAqLwoKICAgIC8qKgogICAgICogVXNlci1wcm92aWRlZCByZXN1bHQgY2FsbGJhY2suIFdpbGwgYmUgdXNlZCBpZiBtb2RlIGlzIFJheS5BTEwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENMT1NFU1QKICAgICAqLwoKICAgIC8qKgogICAgICogQU5ZCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFMTAogICAgICovCiAgICBnZXQgW19TaGFwZSR0eXBlcyRTUEhFUkVdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0U3BoZXJlOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJFBMQU5FXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFBsYW5lOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJEJPWF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RCb3g7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQ1lMSU5ERVJdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENPTlZFWFBPXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRIRUlHSFRGSV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRUUklNRVNIXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFRyaW1lc2g7CiAgICB9CgogICAgY29uc3RydWN0b3IoZnJvbSA9IG5ldyBWZWMzKCksIHRvID0gbmV3IFZlYzMoKSkgewogICAgICB0aGlzLmZyb20gPSB2b2lkIDA7CiAgICAgIHRoaXMudG8gPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnByZWNpc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdm9pZCAwOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHZvaWQgMDsKICAgICAgdGhpcy5tb2RlID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3VsdCA9IHZvaWQgMDsKICAgICAgdGhpcy5oYXNIaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuY2FsbGJhY2sgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CgogIFJheS5DTE9TRVNUID0gUkFZX01PREVTLkNMT1NFU1Q7CiAgUmF5LkFOWSA9IFJBWV9NT0RFUy5BTlk7CiAgUmF5LkFMTCA9IFJBWV9NT0RFUy5BTEw7CiAgY29uc3QgdG1wQUFCQiQxID0gbmV3IEFBQkIoKTsKICBjb25zdCB0bXBBcnJheSA9IFtdOwogIGNvbnN0IHYxID0gbmV3IFZlYzMoKTsKICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV9xaSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgaW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X3ZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxEaXJlY3Rpb24gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxGcm9tID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsVG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfd29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IEFBQkIoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlcyA9IFtdOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCB2MCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0ID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gZGlzdGFuY2VGcm9tSW50ZXJzZWN0aW9uKGZyb20sIGRpcmVjdGlvbiwgcG9zaXRpb24pIHsKICAgIC8vIHYwIGlzIHZlY3RvciBmcm9tIGZyb20gdG8gcG9zaXRpb24KICAgIHBvc2l0aW9uLnZzdWIoZnJvbSwgdjApOwogICAgY29uc3QgZG90ID0gdjAuZG90KGRpcmVjdGlvbik7IC8vIGludGVyc2VjdCA9IGRpcmVjdGlvbipkb3QgKyBmcm9tCgogICAgZGlyZWN0aW9uLnNjYWxlKGRvdCwgaW50ZXJzZWN0KTsKICAgIGludGVyc2VjdC52YWRkKGZyb20sIGludGVyc2VjdCk7CiAgICBjb25zdCBkaXN0YW5jZSA9IHBvc2l0aW9uLmRpc3RhbmNlVG8oaW50ZXJzZWN0KTsKICAgIHJldHVybiBkaXN0YW5jZTsKICB9CiAgLyoqCiAgICogU3dlZXAgYW5kIHBydW5lIGJyb2FkcGhhc2UgYWxvbmcgb25lIGF4aXMuCiAgICovCgoKICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gdm9pZCAwOwogICAgICB0aGlzLl9hZGRCb2R5SGFuZGxlciA9IHZvaWQgMDsKICAgICAgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0ID0gW10pIHsKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGF4aXMgPSAneCc7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYXhpcyA9ICd5JzsKICAgICAgfQoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGF4aXMgPSAneic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgYWFiYi5sb3dlckJvdW5kW2F4aXNdOwogICAgICBhYWJiLnVwcGVyQm91bmRbYXhpc107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4aXNMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNsYXNzIFV0aWxzIHsKICAgIC8qKgogICAgICogRXh0ZW5kIGFuIG9wdGlvbnMgb2JqZWN0IHdpdGggZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuIE1heSBiZSBmYWxzeTogaW4gdGhpcyBjYXNlLCBhIG5ldyBvYmplY3QgaXMgY3JlYXRlZCBhbmQgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gZGVmYXVsdHMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcmV0dXJuIFRoZSBtb2RpZmllZCBvcHRpb25zIG9iamVjdC4KICAgICAqLwogICAgc3RhdGljIGRlZmF1bHRzKG9wdGlvbnMgPSB7fSwgZGVmYXVsdHMpIHsKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KICAvKioKICAgKiBDb25zdHJhaW50IGJhc2UgY2xhc3MKICAgKi8KCgogIGNsYXNzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBFcXVhdGlvbnMgdG8gYmUgc29sdmVkIGluIHRoaXMgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9kaWVzIHRvIGNvbGxpZGUgd2hlbiB0aGV5IGFyZSBjb25uZWN0ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyA9IHt9KSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlBID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlCID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSB2b2lkIDA7CiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KCiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbCA9IHZvaWQgMDsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCgoKICBjbGFzcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIE1pbmltdW0gKHJlYWQ6IG5lZ2F0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogTWF4aW11bSAocmVhZDogcG9zaXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBBIG51bWJlciwgcHJvcG9ydGlvbmFsIHRvIHRoZSBmb3JjZSBhZGRlZCB0byB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihiaSwgYmosIG1pbkZvcmNlID0gLTFlNiwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5taW5Gb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhGb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaSA9IHZvaWQgMDsKICAgICAgdGhpcy5zaiA9IHZvaWQgMDsKICAgICAgdGhpcy5hID0gdm9pZCAwOwogICAgICB0aGlzLmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXBzID0gdm9pZCAwOwogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSB2b2lkIDA7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IHZvaWQgMDsKICAgICAgdGhpcy5lbmFibGVkID0gdm9pZCAwOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQoKICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlID0gMWU2KSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnJpID0gdm9pZCAwOwogICAgICB0aGlzLnJqID0gdm9pZCAwOwogICAgICB0aGlzLm5pID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMSA9IG5ldyBWZWMzKCk7IC8vIFRlbXAgdmVjdG9ycwoKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwoKICBjbGFzcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBwaXZvdEEgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QSB3aGljaCBib2R5QSBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBib2R5QiBCb2R5IHRoYXQgd2lsbCBiZSBjb25zdHJhaW5lZCBpbiBhIHNpbWlsYXIgd2F5IHRvIHRoZSBzYW1lIHBvaW50IGFzIGJvZHlBLiBXZSB3aWxsIHRoZXJlZm9yZSBnZXQgYSBsaW5rIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLiBJZiBub3Qgc3BlY2lmaWVkLCBib2R5QSB3aWxsIGJlIGNvbnN0cmFpbmVkIHRvIGEgc3RhdGljIHBvaW50LgogICAgICogQHBhcmFtIHBpdm90QiBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlCIHdoaWNoIGJvZHlCIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBwaXZvdEEgPSBuZXcgVmVjMygpLCBib2R5QiwgcGl2b3RCID0gbmV3IFZlYzMoKSwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5waXZvdEEgPSB2b2lkIDA7CiAgICAgIHRoaXMucGl2b3RCID0gdm9pZCAwOwogICAgICB0aGlzLmVxdWF0aW9uWCA9IHZvaWQgMDsKICAgICAgdGhpcy5lcXVhdGlvblkgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXF1YXRpb25aID0gdm9pZCAwOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQogIC8qKgogICAqIENvbmUgZXF1YXRpb24uIFdvcmtzIHRvIGtlZXAgdGhlIGdpdmVuIGJvZHkgd29ybGQgdmVjdG9ycyBhbGlnbmVkLCBvciB0aWx0ZWQgd2l0aGluIGEgZ2l2ZW4gYW5nbGUgZnJvbSBlYWNoIG90aGVyLgogICAqLwoKCiAgY2xhc3MgQ29uZUVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEEKICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBCCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSAiY29uZSBhbmdsZSIgdG8ga2VlcAogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMgPSB7fSkgewogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0IgPSB2b2lkIDA7CiAgICAgIHRoaXMuYW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CgogIGNvbnN0IHRtcFZlYzEkMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwoKICBjbGFzcyBSb3RhdGlvbmFsRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhBbmdsZQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMgPSB7fSkgewogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0IgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF4QW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCgogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zID0ge30pIHsKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ2xlID0gdm9pZCAwOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29uZUVxdWF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnR3aXN0RXF1YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5heGlzQiA9IG9wdGlvbnMuYXhpc0IgPyBvcHRpb25zLmF4aXNCLmNsb25lKCkgOiBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgdGhpcy5hbmdsZSA9IHR5cGVvZiBvcHRpb25zLmFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5nbGUgOiAwOwogICAgICBjb25zdCBjID0gdGhpcy5jb25lRXF1YXRpb24gPSBuZXcgQ29uZUVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHQgPSB0aGlzLnR3aXN0RXF1YXRpb24gPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIHRoaXMudHdpc3RBbmdsZSA9IHR5cGVvZiBvcHRpb25zLnR3aXN0QW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy50d2lzdEFuZ2xlIDogMDsgLy8gTWFrZSB0aGUgY29uZSBlcXVhdGlvbiBwdXNoIHRoZSBib2RpZXMgdG93YXJkIHRoZSBjb25lIGF4aXMsIG5vdCBvdXR3YXJkCgogICAgICBjLm1heEZvcmNlID0gMDsKICAgICAgYy5taW5Gb3JjZSA9IC1tYXhGb3JjZTsgLy8gTWFrZSB0aGUgdHdpc3QgZXF1YXRpb24gYWRkIHRvcnF1ZSB0b3dhcmQgdGhlIGluaXRpYWwgcG9zaXRpb24KCiAgICAgIHQubWF4Rm9yY2UgPSAwOwogICAgICB0Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGMsIHQpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IGNvbmUgPSB0aGlzLmNvbmVFcXVhdGlvbjsKICAgICAgY29uc3QgdHdpc3QgPSB0aGlzLnR3aXN0RXF1YXRpb247CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBVcGRhdGUgdGhlIGF4ZXMgdG8gdGhlIGNvbmUgY29uc3RyYWludAoKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0EsIGNvbmUuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy5heGlzQiwgY29uZS5heGlzQik7IC8vIFVwZGF0ZSB0aGUgd29ybGQgYXhlcyBpbiB0aGUgdHdpc3QgY29uc3RyYWludAoKICAgICAgdGhpcy5heGlzQS50YW5nZW50cyh0d2lzdC5heGlzQSwgdHdpc3QuYXhpc0EpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgdGhpcy5heGlzQi50YW5nZW50cyh0d2lzdC5heGlzQiwgdHdpc3QuYXhpc0IpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgY29uZS5hbmdsZSA9IHRoaXMuYW5nbGU7CiAgICAgIHR3aXN0Lm1heEFuZ2xlID0gdGhpcy50d2lzdEFuZ2xlOwogICAgfQoKICB9CiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KCgogIGNsYXNzIERpc3RhbmNlQ29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgZGlzdGFuY2UgdG8ga2VlcC4gSWYgdW5kZWZpbmVkLCBpdCB3aWxsIGJlIHNldCB0byB0aGUgY3VycmVudCBkaXN0YW5jZSBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5QgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZGlzdGFuY2UgVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIuCiAgICAgKiBAcGFyYW0gbWF4Rm9yY2UgVGhlIG1heGltdW0gZm9yY2UgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBjb25zdHJhaW4gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBkaXN0YW5jZSwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gdm9pZCAwOwoKICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBkaXN0YW5jZSA9IGJvZHlBLnBvc2l0aW9uLmRpc3RhbmNlVG8oYm9keUIucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsgLy8gTWFrZSBpdCBiaWRpcmVjdGlvbmFsCgogICAgICBlcS5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgZXEubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb247CiAgICAgIGNvbnN0IGhhbGZEaXN0ID0gdGhpcy5kaXN0YW5jZSAqIDAuNTsKICAgICAgY29uc3Qgbm9ybWFsID0gZXEubmk7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIG5vcm1hbCk7CiAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgbm9ybWFsLnNjYWxlKGhhbGZEaXN0LCBlcS5yaSk7CiAgICAgIG5vcm1hbC5zY2FsZSgtaGFsZkRpc3QsIGVxLnJqKTsKICAgIH0KCiAgfQogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCgoKICBjbGFzcyBMb2NrQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zID0ge30pIHsKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGFsZldheSA9IG5ldyBWZWMzKCk7CiAgICAgIGJvZHlBLnBvc2l0aW9uLnZhZGQoYm9keUIucG9zaXRpb24sIGhhbGZXYXkpOwogICAgICBoYWxmV2F5LnNjYWxlKDAuNSwgaGFsZldheSk7CiAgICAgIGJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90Qik7CiAgICAgIGJvZHlBLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90QSk7IC8vIFRoZSBwb2ludC10by1wb2ludCBjb25zdHJhaW50IHdpbGwga2VlcCBhIHBvaW50IHNoYXJlZCBiZXR3ZWVuIHRoZSBib2RpZXMKCiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsgLy8gU3RvcmUgaW5pdGlhbCByb3RhdGlvbiBvZiB0aGUgYm9kaWVzIGFzIHVuaXQgdmVjdG9ycyBpbiB0aGUgbG9jYWwgYm9keSBzcGFjZXMKCiAgICAgIHRoaXMueEEgPSB2b2lkIDA7CiAgICAgIHRoaXMueEIgPSB2b2lkIDA7CiAgICAgIHRoaXMueUEgPSB2b2lkIDA7CiAgICAgIHRoaXMueUIgPSB2b2lkIDA7CiAgICAgIHRoaXMuekEgPSB2b2lkIDA7CiAgICAgIHRoaXMuekIgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IHZvaWQgMDsKICAgICAgdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjMgPSB2b2lkIDA7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgLyoqCiAgICogUm90YXRpb25hbCBtb3RvciBjb25zdHJhaW50LiBUcmllcyB0byBrZWVwIHRoZSByZWxhdGl2ZSBhbmd1bGFyIHZlbG9jaXR5IG9mIHRoZSBib2RpZXMgdG8gYSBnaXZlbiB2YWx1ZS4KICAgKi8KCgogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQiA9IHZvaWQgMDsKICAgICAgdGhpcy50YXJnZXRWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICAvKioKICAgKiBIaW5nZSBjb25zdHJhaW50LiBUaGluayBvZiBpdCBhcyBhIGRvb3IgaGluZ2UuIEl0IHRyaWVzIHRvIGtlZXAgdGhlIGRvb3IgaW4gdGhlIGNvcnJlY3QgcGxhY2UgYW5kIHdpdGggdGhlIGNvcnJlY3Qgb3JpZW50YXRpb24uCiAgICovCgoKICBjbGFzcyBIaW5nZUNvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUm90YXRpb24gYXhpcywgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyA9IHt9KSB7CiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IHZvaWQgMDsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uID0gdm9pZCAwOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KCiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSB2b2lkIDA7CiAgICAgIHRoaXMucmogPSB2b2lkIDA7CiAgICAgIHRoaXMudCA9IHZvaWQgMDsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CgogIENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwoKICBjbGFzcyBNYXRlcmlhbCB7CiAgICAvKioKICAgICAqIE1hdGVyaWFsIG5hbWUuCiAgICAgKiBJZiBvcHRpb25zIGlzIGEgc3RyaW5nLCBuYW1lIHdpbGwgYmUgc2V0IHRvIHRoYXQgc3RyaW5nLgogICAgICogQHRvZG8gRGVwcmVjYXRlIHRoaXMKICAgICAqLwoKICAgIC8qKiBNYXRlcmlhbCBpZC4gKi8KCiAgICAvKioKICAgICAqIEZyaWN0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgZnJpY3Rpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIHJlc3RpdHV0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7CiAgICAgIHRoaXMubmFtZSA9IHZvaWQgMDsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHZvaWQgMDsKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQoKICBNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwoKICBjbGFzcyBTcHJpbmcgewogICAgLyoqCiAgICAgKiBSZXN0IGxlbmd0aCBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERhbXBpbmcgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogRmlyc3QgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNlY29uZCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QSBpbiBsb2NhbCBib2R5QSBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEEsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUIgaW4gbG9jYWwgYm9keUIgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBCLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMgPSB7fSkgewogICAgICB0aGlzLnJlc3RMZW5ndGggPSB2b2lkIDA7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmRhbXBpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keUEgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keUIgPSB2b2lkIDA7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gdm9pZCAwOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IHZvaWQgMDsKICAgICAgdGhpcy5yZXN0TGVuZ3RoID0gdHlwZW9mIG9wdGlvbnMucmVzdExlbmd0aCA9PT0gJ251bWJlcicgPyBvcHRpb25zLnJlc3RMZW5ndGggOiAxOwogICAgICB0aGlzLnN0aWZmbmVzcyA9IG9wdGlvbnMuc3RpZmZuZXNzIHx8IDEwMDsKICAgICAgdGhpcy5kYW1waW5nID0gb3B0aW9ucy5kYW1waW5nIHx8IDE7CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQSkgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JBLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5sb2NhbEFuY2hvckIpIHsKICAgICAgICB0aGlzLmxvY2FsQW5jaG9yQi5jb3B5KG9wdGlvbnMubG9jYWxBbmNob3JCKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMud29ybGRBbmNob3JBKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZEFuY2hvckEob3B0aW9ucy53b3JsZEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckIpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQihvcHRpb25zLndvcmxkQW5jaG9yQik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBBLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JBLCB0aGlzLmxvY2FsQW5jaG9yQSk7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgdXNpbmcgd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgc2V0V29ybGRBbmNob3JCKHdvcmxkQW5jaG9yQikgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkQW5jaG9yQiwgdGhpcy5sb2NhbEFuY2hvckIpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JBKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlBLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JBLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEIsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JCKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0aGUgc3ByaW5nIGZvcmNlIHRvIHRoZSBjb25uZWN0ZWQgYm9kaWVzLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoKSB7CiAgICAgIGNvbnN0IGsgPSB0aGlzLnN0aWZmbmVzczsKICAgICAgY29uc3QgZCA9IHRoaXMuZGFtcGluZzsKICAgICAgY29uc3QgbCA9IHRoaXMucmVzdExlbmd0aDsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHIgPSBhcHBseUZvcmNlX3I7CiAgICAgIGNvbnN0IHJfdW5pdCA9IGFwcGx5Rm9yY2Vfcl91bml0OwogICAgICBjb25zdCB1ID0gYXBwbHlGb3JjZV91OwogICAgICBjb25zdCBmID0gYXBwbHlGb3JjZV9mOwogICAgICBjb25zdCB0bXAgPSBhcHBseUZvcmNlX3RtcDsKICAgICAgY29uc3Qgd29ybGRBbmNob3JBID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckE7CiAgICAgIGNvbnN0IHdvcmxkQW5jaG9yQiA9IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCOwogICAgICBjb25zdCByaSA9IGFwcGx5Rm9yY2Vfcmk7CiAgICAgIGNvbnN0IHJqID0gYXBwbHlGb3JjZV9yajsKICAgICAgY29uc3QgcmlfeF9mID0gYXBwbHlGb3JjZV9yaV94X2Y7CiAgICAgIGNvbnN0IHJqX3hfZiA9IGFwcGx5Rm9yY2VfcmpfeF9mOyAvLyBHZXQgd29ybGQgYW5jaG9ycwoKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKTsKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKTsgLy8gR2V0IG9mZnNldCBwb2ludHMKCiAgICAgIHdvcmxkQW5jaG9yQS52c3ViKGJvZHlBLnBvc2l0aW9uLCByaSk7CiAgICAgIHdvcmxkQW5jaG9yQi52c3ViKGJvZHlCLnBvc2l0aW9uLCByaik7IC8vIENvbXB1dGUgZGlzdGFuY2UgdmVjdG9yIGJldHdlZW4gd29ybGQgYW5jaG9yIHBvaW50cwoKICAgICAgd29ybGRBbmNob3JCLnZzdWIod29ybGRBbmNob3JBLCByKTsKICAgICAgY29uc3QgcmxlbiA9IHIubGVuZ3RoKCk7CiAgICAgIHJfdW5pdC5jb3B5KHIpOwogICAgICByX3VuaXQubm9ybWFsaXplKCk7IC8vIENvbXB1dGUgcmVsYXRpdmUgdmVsb2NpdHkgb2YgdGhlIGFuY2hvciBwb2ludHMsIHUKCiAgICAgIGJvZHlCLnZlbG9jaXR5LnZzdWIoYm9keUEudmVsb2NpdHksIHUpOyAvLyBBZGQgcm90YXRpb25hbCB2ZWxvY2l0eQoKICAgICAgYm9keUIuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJqLCB0bXApOwogICAgICB1LnZhZGQodG1wLCB1KTsKICAgICAgYm9keUEuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJpLCB0bXApOwogICAgICB1LnZzdWIodG1wLCB1KTsgLy8gRiA9IC0gayAqICggeCAtIEwgKSAtIEQgKiAoIHUgKQoKICAgICAgcl91bml0LnNjYWxlKC1rICogKHJsZW4gLSBsKSAtIGQgKiB1LmRvdChyX3VuaXQpLCBmKTsgLy8gQWRkIGZvcmNlcyB0byBib2RpZXMKCiAgICAgIGJvZHlBLmZvcmNlLnZzdWIoZiwgYm9keUEuZm9yY2UpOwogICAgICBib2R5Qi5mb3JjZS52YWRkKGYsIGJvZHlCLmZvcmNlKTsgLy8gQW5ndWxhciBmb3JjZQoKICAgICAgcmkuY3Jvc3MoZiwgcmlfeF9mKTsKICAgICAgcmouY3Jvc3MoZiwgcmpfeF9mKTsKICAgICAgYm9keUEudG9ycXVlLnZzdWIocmlfeF9mLCBib2R5QS50b3JxdWUpOwogICAgICBib2R5Qi50b3JxdWUudmFkZChyal94X2YsIGJvZHlCLnRvcnF1ZSk7CiAgICB9CgogIH0KCiAgY29uc3QgYXBwbHlGb3JjZV9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JfdW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV91ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yaSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yaiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yaV94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmpfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3RtcCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogV2hlZWxJbmZvCiAgICovCgogIGNsYXNzIFdoZWVsSW5mbyB7CiAgICAvKioKICAgICAqIE1heCB0cmF2ZWwgZGlzdGFuY2Ugb2YgdGhlIHN1c3BlbnNpb24sIGluIG1ldGVycy4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3BlZWQgdG8gYXBwbHkgdG8gdGhlIHdoZWVsIHJvdGF0aW9uIHdoZW4gdGhlIHdoZWVsIGlzIHNsaWRpbmcuCiAgICAgKiBAZGVmYXVsdCAtMC4xCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkIHNob3VsZCBiZSB1c2VkLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogc2xpZGluZwogICAgICovCgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHBvaW50LCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIGNoYXNzaXMgYm9keSBmcmFtZS4KICAgICAqLwoKICAgIC8qKgogICAgICogY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRpcmVjdGlvbkxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRpcmVjdGlvbldvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVMb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlc3RMZW5ndGgKICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbk1heExlbmd0aAogICAgICogQGRlZmF1bHQgMgogICAgICovCgogICAgLyoqCiAgICAgKiByYWRpdXMKICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblN0aWZmbmVzcwogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdDb21wcmVzc2lvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ1JlbGF4YXRpb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZyaWN0aW9uU2xpcAogICAgICogQGRlZmF1bHQgMTAuNQogICAgICovCgogICAgLyoqIGZvcndhcmRBY2NlbGVyYXRpb24gKi8KCiAgICAvKiogc2lkZUFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKgogICAgICogc3RlZXJpbmcKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogUm90YXRpb24gdmFsdWUsIGluIHJhZGlhbnMuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRlbHRhUm90YXRpb24KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogcm9sbEluZmx1ZW5jZQogICAgICogQGRlZmF1bHQgMC4wMQogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhTdXNwZW5zaW9uRm9yY2UKICAgICAqLwoKICAgIC8qKgogICAgICogZW5naW5lRm9yY2UKICAgICAqLwoKICAgIC8qKgogICAgICogYnJha2UKICAgICAqLwoKICAgIC8qKgogICAgICogaXNGcm9udFdoZWVsCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uRm9yY2UKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2xpcEluZm8KICAgICAqLwoKICAgIC8qKgogICAgICogc2tpZEluZm8KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkxlbmd0aAogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzaWRlSW1wdWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBmb3J3YXJkSW1wdWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgcmVzdWx0IGZyb20gcmF5Y2FzdGluZy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlZWwgd29ybGQgdHJhbnNmb3JtLgogICAgICovCgogICAgLyoqCiAgICAgKiBpc0luQ29udGFjdAogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gdm9pZCAwOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSB2b2lkIDA7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGlkaW5nID0gdm9pZCAwOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gdm9pZCAwOwogICAgICB0aGlzLmF4bGVXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gdm9pZCAwOwogICAgICB0aGlzLnJhZGl1cyA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5kYW1waW5nUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuZm9yd2FyZEFjY2VsZXJhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlQWNjZWxlcmF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnN0ZWVyaW5nID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucm9sbEluZmx1ZW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuYnJha2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gdm9pZCAwOwogICAgICB0aGlzLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xpcEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkVHJhbnNmb3JtID0gdm9pZCAwOwogICAgICB0aGlzLmlzSW5Db250YWN0ID0gdm9pZCAwOwogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQoKICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCgogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgdGhpcy5jaGFzc2lzQm9keSA9IHZvaWQgMDsKICAgICAgdGhpcy53aGVlbEluZm9zID0gdm9pZCAwOwogICAgICB0aGlzLnNsaWRpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5kZXhSaWdodEF4aXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHZvaWQgMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHZvaWQgMDsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSB2b2lkIDA7CiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGFzc2lzQm9keSA9IG9wdGlvbnMuY2hhc3Npc0JvZHk7CiAgICAgIHRoaXMud2hlZWxJbmZvcyA9IFtdOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuaW5kZXhSaWdodEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4UmlnaHRBeGlzIDogMjsKICAgICAgdGhpcy5pbmRleEZvcndhcmRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgOiAwOwogICAgICB0aGlzLmluZGV4VXBBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhVcEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFVwQXhpcyA6IDE7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKCiAgICAgIHRoaXMucHJlU3RlcENhbGxiYWNrID0gKCkgPT4ge307CgogICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucyA9IHt9KSB7CiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSAwOwoKICAgICAgICBpZiAoIWZvcndhcmRXU1tpXSkgewogICAgICAgICAgZm9yd2FyZFdTW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CgogICAgICAgIGlmICghYXhsZVtpXSkgewogICAgICAgICAgYXhsZVtpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgYXhsZWkgPSBheGxlW2ldOwogICAgICAgICAgY29uc3Qgd2hlZWxUcmFucyA9IHRoaXMuZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZChpKTsgLy8gR2V0IHdvcmxkIGF4bGUKCiAgICAgICAgICB3aGVlbFRyYW5zLnZlY3RvclRvV29ybGRGcmFtZShkaXJlY3Rpb25zW3RoaXMuaW5kZXhSaWdodEF4aXNdLCBheGxlaSk7CiAgICAgICAgICBjb25zdCBzdXJmTm9ybWFsV1MgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkOwogICAgICAgICAgY29uc3QgcHJvaiA9IGF4bGVpLmRvdChzdXJmTm9ybWFsV1MpOwogICAgICAgICAgc3VyZk5vcm1hbFdTLnNjYWxlKHByb2osIHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaik7CiAgICAgICAgICBheGxlaS52c3ViKHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiwgYXhsZWkpOwogICAgICAgICAgYXhsZWkubm9ybWFsaXplKCk7CiAgICAgICAgICBzdXJmTm9ybWFsV1MuY3Jvc3MoYXhsZWksIGZvcndhcmRXU1tpXSk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0ubm9ybWFsaXplKCk7CiAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoY2hhc3Npc0JvZHksIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGF4bGVpKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHNpZGVGcmljdGlvblN0aWZmbmVzczI7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBzaWRlRmFjdG9yID0gMTsKICAgICAgY29uc3QgZndkRmFjdG9yID0gMC41OwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwogICAgICAgIGxldCByb2xsaW5nRnJpY3Rpb24gPSAwOwogICAgICAgIHdoZWVsLnNsaXBJbmZvID0gMTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGxpbmdGcmljdGlvbkltcHVsc2UgPSAwOwogICAgICAgICAgY29uc3QgbWF4SW1wdWxzZSA9IHdoZWVsLmJyYWtlID8gd2hlZWwuYnJha2UgOiBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZTsgLy8gYnRXaGVlbENvbnRhY3RQb2ludCBjb250YWN0UHQoY2hhc3Npc0JvZHksZ3JvdW5kT2JqZWN0LHdoZWVsSW5mcmF5Y2FzdEluZm8uaGl0UG9pbnRXb3JsZCxmb3J3YXJkV1Nbd2hlZWxdLG1heEltcHVsc2UpOwogICAgICAgICAgLy8gcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjb250YWN0UHQpOwoKICAgICAgICAgIHJvbGxpbmdGcmljdGlvbiA9IGNhbGNSb2xsaW5nRnJpY3Rpb24oY2hhc3Npc0JvZHksIGdyb3VuZE9iamVjdCwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBmb3J3YXJkV1NbaV0sIG1heEltcHVsc2UpOwogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uICs9IHdoZWVsLmVuZ2luZUZvcmNlICogdGltZVN0ZXA7IC8vIHJvbGxpbmdGcmljdGlvbiA9IDA7CgogICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4SW1wdWxzZSAvIHJvbGxpbmdGcmljdGlvbjsKICAgICAgICAgIHdoZWVsLnNsaXBJbmZvICo9IGZhY3RvcjsKICAgICAgICB9IC8vc3dpdGNoIGJldHdlZW4gYWN0aXZlIHJvbGxpbmcgKHRocm90dGxlKSwgYnJha2luZyBhbmQgbm9uLWFjdGl2ZSByb2xsaW5nIGZyaWN0aW9uIChudGhyb3R0bGUvYnJlYWspCgoKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuc2tpZEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CiAgICAgICAgICBjb25zdCBtYXhpbXAgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgKiB0aW1lU3RlcCAqIHdoZWVsLmZyaWN0aW9uU2xpcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNpZGUgPSBtYXhpbXA7CiAgICAgICAgICBjb25zdCBtYXhpbXBTcXVhcmVkID0gbWF4aW1wICogbWF4aW1wU2lkZTsKICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gcm9sbGluZ0ZyaWN0aW9uOyAvL3doZWVsSW5mby5lbmdpbmVGb3JjZSogdGltZVN0ZXA7CgogICAgICAgICAgY29uc3QgeCA9IHdoZWVsLmZvcndhcmRJbXB1bHNlICogZndkRmFjdG9yIC8gd2hlZWwuZm9yd2FyZEFjY2VsZXJhdGlvbjsKICAgICAgICAgIGNvbnN0IHkgPSB3aGVlbC5zaWRlSW1wdWxzZSAqIHNpZGVGYWN0b3IgLyB3aGVlbC5zaWRlQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgaW1wdWxzZVNxdWFyZWQgPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgd2hlZWwuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChpbXB1bHNlU3F1YXJlZCA+IG1heGltcFNxdWFyZWQpIHsKICAgICAgICAgICAgdGhpcy5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgd2hlZWwuc2xpZGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1heGltcCAvIE1hdGguc3FydChpbXB1bHNlU3F1YXJlZCk7CiAgICAgICAgICAgIHdoZWVsLnNraWRJbmZvICo9IGZhY3RvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsaWRpbmcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CgogICAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICAgIGlmICh3aGVlbC5za2lkSW5mbyA8IDEpIHsKICAgICAgICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBhcHBseSB0aGUgaW1wdWxzZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IHJlbF9wb3MgPSBuZXcgVmVjMygpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxfcG9zKTsgLy8gY2Fubm9ucyBhcHBseWltcHVsc2UgaXMgdXNpbmcgd29ybGQgY29vcmQgZm9yIHRoZSBwb3NpdGlvbgogICAgICAgIC8vcmVsX3Bvcy5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgIGlmICh3aGVlbC5mb3J3YXJkSW1wdWxzZSAhPT0gMCkgewogICAgICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0uc2NhbGUod2hlZWwuZm9yd2FyZEltcHVsc2UsIGltcHVsc2UpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbF9wb3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgICBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1Yihncm91bmRPYmplY3QucG9zaXRpb24sIHJlbF9wb3MyKTsgLy9yZWxfcG9zMi5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgICAgY29uc3Qgc2lkZUltcCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBheGxlW2ldLnNjYWxlKHdoZWVsLnNpZGVJbXB1bHNlLCBzaWRlSW1wKTsgLy8gU2NhbGUgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSB1cCBkaXJlY3Rpb24gd2l0aCByb2xsSW5mbHVlbmNlLgogICAgICAgICAgLy8gSWYgcm9sbEluZmx1ZW5jZSBpcyAxLCB0aGUgaW1wdWxzZSB3aWxsIGJlIGFwcGxpZWQgb24gdGhlIGhpdFBvaW50IChlYXN5IHRvIHJvbGwgb3ZlciksIGlmIGl0IGlzIHplcm8gaXQgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBzYW1lIHBsYW5lIGFzIHRoZSBjZW50ZXIgb2YgbWFzcyAobm90IGVhc3kgdG8gcm9sbCBvdmVyKS4KCiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb0xvY2FsRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICByZWxfcG9zWyd4eXonW3RoaXMuaW5kZXhVcEF4aXNdXSAqPSB3aGVlbC5yb2xsSW5mbHVlbmNlOwogICAgICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHJlbF9wb3MsIHJlbF9wb3MpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MpOyAvL2FwcGx5IGZyaWN0aW9uIGltcHVsc2Ugb24gdGhlIGdyb3VuZAoKICAgICAgICAgIHNpZGVJbXAuc2NhbGUoLTEsIHNpZGVJbXApOwogICAgICAgICAgZ3JvdW5kT2JqZWN0LmFwcGx5SW1wdWxzZShzaWRlSW1wLCByZWxfcG9zMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KCiAgY29uc3QgdG1wVmVjNCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjNSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjNiA9IG5ldyBWZWMzKCk7CiAgbmV3IFJheSgpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQogIC8qKgogICAqIFNwaGVyaWNhbCBzaGFwZQogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1cyA9IDEKICAgKiAgICAgY29uc3Qgc3BoZXJlU2hhcGUgPSBuZXcgQ0FOTk9OLlNwaGVyZShyYWRpdXMpCiAgICogICAgIGNvbnN0IHNwaGVyZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogc3BoZXJlU2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShzcGhlcmVCb2R5KQogICAqLwoKCiAgY2xhc3MgU3BoZXJlIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSwgYSBub24tbmVnYXRpdmUgbnVtYmVyLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihyYWRpdXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlNQSEVSRQogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMucmFkaXVzID0gcmFkaXVzICE9PSB1bmRlZmluZWQgPyByYWRpdXMgOiAxLjA7CgogICAgICBpZiAodGhpcy5yYWRpdXMgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc3BoZXJlIHJhZGl1cyBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKiBjYWxjdWxhdGVMb2NhbEluZXJ0aWEgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIEN5bGluZGVyIGNsYXNzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1c1RvcCA9IDAuNQogICAqICAgICBjb25zdCByYWRpdXNCb3R0b20gPSAwLjUKICAgKiAgICAgY29uc3QgaGVpZ2h0ID0gMgogICAqICAgICBjb25zdCBudW1TZWdtZW50cyA9IDEyCiAgICogICAgIGNvbnN0IGN5bGluZGVyU2hhcGUgPSBuZXcgQ0FOTk9OLkN5bGluZGVyKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKQogICAqICAgICBjb25zdCBjeWxpbmRlckJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY3lsaW5kZXJTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGN5bGluZGVyQm9keSkKICAgKi8KCiAgY2xhc3MgQ3lsaW5kZXIgZXh0ZW5kcyBDb252ZXhQb2x5aGVkcm9uIHsKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4gKi8KCiAgICAvKiogVGhlIG51bWJlciBvZiBzZWdtZW50cyB0byBidWlsZCB0aGUgY3lsaW5kZXIgb3V0IG9mLiAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHJhZGl1c1RvcCBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIHJhZGl1c0JvdHRvbSBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4KICAgICAqIEBwYXJhbSBudW1TZWdtZW50cyBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1c1RvcCA9IDEsIHJhZGl1c0JvdHRvbSA9IDEsIGhlaWdodCA9IDEsIG51bVNlZ21lbnRzID0gOCkgewogICAgICBpZiAocmFkaXVzVG9wIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGN5bGluZGVyIHJhZGl1c1RvcCBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzQm90dG9tIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgY29uc3QgTiA9IG51bVNlZ21lbnRzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBheGVzID0gW107CiAgICAgIGNvbnN0IGZhY2VzID0gW107CiAgICAgIGNvbnN0IGJvdHRvbWZhY2UgPSBbXTsKICAgICAgY29uc3QgdG9wZmFjZSA9IFtdOwogICAgICBjb25zdCBjb3MgPSBNYXRoLmNvczsKICAgICAgY29uc3Qgc2luID0gTWF0aC5zaW47IC8vIEZpcnN0IGJvdHRvbSBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKDApLCAtaGVpZ2h0ICogMC41LCByYWRpdXNCb3R0b20gKiBjb3MoMCkpKTsKICAgICAgYm90dG9tZmFjZS5wdXNoKDApOyAvLyBGaXJzdCB0b3AgcG9pbnQKCiAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbigwKSwgaGVpZ2h0ICogMC41LCByYWRpdXNUb3AgKiBjb3MoMCkpKTsKICAgICAgdG9wZmFjZS5wdXNoKDEpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCB0aGV0YSA9IDIgKiBNYXRoLlBJIC8gTiAqIChpICsgMSk7CiAgICAgICAgY29uc3QgdGhldGFOID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAwLjUpOwoKICAgICAgICBpZiAoaSA8IE4gLSAxKSB7CiAgICAgICAgICAvLyBCb3R0b20KICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c0JvdHRvbSAqIHNpbih0aGV0YSksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIGJvdHRvbWZhY2UucHVzaCgyICogaSArIDIpOyAvLyBUb3AKCiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNUb3AgKiBzaW4odGhldGEpLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIHRvcGZhY2UucHVzaCgyICogaSArIDMpOyAvLyBGYWNlCgogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMiAqIGkgKyAzLCAyICogaSArIDJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMSwgMF0pOyAvLyBDb25uZWN0CiAgICAgICAgfSAvLyBBeGlzOiB3ZSBjYW4gY3V0IG9mZiBoYWxmIG9mIHRoZW0gaWYgd2UgaGF2ZSBldmVuIG51bWJlciBvZiBzZWdtZW50cwoKCiAgICAgICAgaWYgKE4gJSAyID09PSAxIHx8IGkgPCBOIC8gMikgewogICAgICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKC1zaW4odGhldGFOKSwgMCwgY29zKHRoZXRhTikpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZhY2VzLnB1c2goYm90dG9tZmFjZSk7CiAgICAgIGF4ZXMucHVzaChuZXcgVmVjMygwLCAxLCAwKSk7IC8vIFJlb3JkZXIgdG9wIGZhY2UKCiAgICAgIGNvbnN0IHRlbXAgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wZmFjZS5sZW5ndGg7IGkrKykgewogICAgICAgIHRlbXAucHVzaCh0b3BmYWNlW3RvcGZhY2UubGVuZ3RoIC0gaSAtIDFdKTsKICAgICAgfQoKICAgICAgZmFjZXMucHVzaCh0ZW1wKTsKICAgICAgc3VwZXIoewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gdm9pZCAwOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHZvaWQgMDsKICAgICAgdGhpcy5oZWlnaHQgPSB2b2lkIDA7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSB2b2lkIDA7CiAgICAgIHRoaXMudHlwZSA9IFNoYXBlLnR5cGVzLkNZTElOREVSOwogICAgICB0aGlzLnJhZGl1c1RvcCA9IHJhZGl1c1RvcDsKICAgICAgdGhpcy5yYWRpdXNCb3R0b20gPSByYWRpdXNCb3R0b207CiAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICB0aGlzLm51bVNlZ21lbnRzID0gbnVtU2VnbWVudHM7CiAgICB9CgogIH0KICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwoKCiAgY2xhc3MgUGFydGljbGUgZXh0ZW5kcyBTaGFwZSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFCiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVMb2NhbEluZXJ0aWEKICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KICAvKioKICAgKiBBIHBsYW5lLCBmYWNpbmcgaW4gdGhlIFogZGlyZWN0aW9uLiBUaGUgcGxhbmUgaGFzIGl0cyBzdXJmYWNlIGF0IHo9MCBhbmQgZXZlcnl0aGluZyBiZWxvdyB6PTAgaXMgYXNzdW1lZCB0byBiZSBzb2xpZCBwbGFuZS4gVG8gbWFrZSB0aGUgcGxhbmUgZmFjZSBpbiBzb21lIG90aGVyIGRpcmVjdGlvbiB0aGFuIHosIHlvdSBtdXN0IHB1dCBpdCBpbnNpZGUgYSBCb2R5IGFuZCByb3RhdGUgdGhhdCBib2R5LiBTZWUgdGhlIGRlbW9zLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHBsYW5lU2hhcGUgPSBuZXcgQ0FOTk9OLlBsYW5lKCkKICAgKiAgICAgY29uc3QgcGxhbmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMCwgc2hhcGU6ICBwbGFuZVNoYXBlIH0pCiAgICogICAgIHBsYW5lQm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcigtTWF0aC5QSSAvIDIsIDAsIDApIC8vIG1ha2UgaXQgZmFjZSB1cAogICAqICAgICB3b3JsZC5hZGRCb2R5KHBsYW5lQm9keSkKICAgKi8KCgogIGNsYXNzIFBsYW5lIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHdvcmxkTm9ybWFsICovCgogICAgLyoqIHdvcmxkTm9ybWFsTmVlZHNVcGRhdGUgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUExBTkUKICAgICAgfSk7IC8vIFdvcmxkIG9yaWVudGVkIG5vcm1hbAoKICAgICAgdGhpcy53b3JsZE5vcm1hbCA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdm9pZCAwOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHBsYW5lIGlzIGluZmluaXRlLi4uCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIFRoZSBwbGFuZSBBQUJCIGlzIGluZmluaXRlLCBleGNlcHQgaWYgdGhlIG5vcm1hbCBpcyBwb2ludGluZyBhbG9uZyBhbnkgYXhpcwogICAgICB0ZW1wTm9ybWFsLnNldCgwLCAwLCAxKTsgLy8gRGVmYXVsdCBwbGFuZSBub3JtYWwgaXMgegoKICAgICAgcXVhdC52bXVsdCh0ZW1wTm9ybWFsLCB0ZW1wTm9ybWFsKTsKICAgICAgY29uc3QgbWF4VmFsID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgbWluLnNldCgtbWF4VmFsLCAtbWF4VmFsLCAtbWF4VmFsKTsKICAgICAgbWF4LnNldChtYXhWYWwsIG1heFZhbCwgbWF4VmFsKTsKCiAgICAgIGlmICh0ZW1wTm9ybWFsLnggPT09IDEpIHsKICAgICAgICBtYXgueCA9IHBvcy54OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueCA9PT0gLTEpIHsKICAgICAgICBtaW4ueCA9IHBvcy54OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC55ID09PSAxKSB7CiAgICAgICAgbWF4LnkgPSBwb3MueTsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnkgPT09IC0xKSB7CiAgICAgICAgbWluLnkgPSBwb3MueTsKICAgICAgfQoKICAgICAgaWYgKHRlbXBOb3JtYWwueiA9PT0gMSkgewogICAgICAgIG1heC56ID0gcG9zLno7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC56ID09PSAtMSkgewogICAgICAgIG1pbi56ID0gcG9zLno7CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CgogIH0KCiAgY29uc3QgdGVtcE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogSGVpZ2h0ZmllbGQgc2hhcGUgY2xhc3MuIEhlaWdodCBkYXRhIGlzIGdpdmVuIGFzIGFuIGFycmF5LiBUaGVzZSBkYXRhIHBvaW50cyBhcmUgc3ByZWFkIG91dCBldmVubHkgd2l0aCBhIGdpdmVuIGRpc3RhbmNlLgogICAqIEB0b2RvIFNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgYWxvbmcgYWxsIGF4ZXMsIG5vdCBqdXN0IHkKICAgKiBAdG9kbyBzaG91bGQgYmUgcG9zc2libGUgdG8gc2NhbGUgYWxvbmcgYWxsIGF4ZXMKICAgKiBAdG9kbyBSZWZhY3RvciBlbGVtZW50U2l6ZSB0byBlbGVtZW50U2l6ZVggYW5kIGVsZW1lbnRTaXplWQogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgLy8gR2VuZXJhdGUgc29tZSBoZWlnaHQgZGF0YSAoeS12YWx1ZXMpLgogICAqICAgICBjb25zdCBkYXRhID0gW10KICAgKiAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgKiAgICAgICAgIGNvbnN0IHkgPSAwLjUgKiBNYXRoLmNvcygwLjIgKiBpKQogICAqICAgICAgICAgZGF0YS5wdXNoKHkpCiAgICogICAgIH0KICAgKgogICAqICAgICAvLyBDcmVhdGUgdGhlIGhlaWdodGZpZWxkIHNoYXBlCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkU2hhcGUgPSBuZXcgQ0FOTk9OLkhlaWdodGZpZWxkKGRhdGEsIHsKICAgKiAgICAgICAgIGVsZW1lbnRTaXplOiAxIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9ucwogICAqICAgICB9KQogICAqICAgICBjb25zdCBoZWlnaHRmaWVsZEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBzaGFwZTogaGVpZ2h0ZmllbGRTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGhlaWdodGZpZWxkQm9keSkKICAgKi8KCiAgY2xhc3MgSGVpZ2h0ZmllbGQgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTWF4IHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogTWluaW11bSB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIHNwYWNpbmcgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb24uCiAgICAgKiBAdG9kbyBlbGVtZW50U2l6ZVggYW5kIFkKICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZGF0YSBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGRhdGEsIG9wdGlvbnMgPSB7fSkgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIG1heFZhbHVlOiBudWxsLAogICAgICAgIG1pblZhbHVlOiBudWxsLAogICAgICAgIGVsZW1lbnRTaXplOiAxCiAgICAgIH0pOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuSEVJR0hURklFTEQKICAgICAgfSk7CiAgICAgIHRoaXMuZGF0YSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5taW5WYWx1ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB2b2lkIDA7CiAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gdm9pZCAwOwogICAgICB0aGlzLnBpbGxhck9mZnNldCA9IHZvaWQgMDsKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHZvaWQgMDsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCA9IFtdKSB7CiAgICAgIC8vIEdldCBtYXggYW5kIG1pbiBvZiB0aGUgZGF0YQogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOyAvLyBTZXQgZmlyc3QgdmFsdWUKCiAgICAgIGxldCBtYXggPSB0aGlzLm1pblZhbHVlOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDw9IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPD0gaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IGhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlc3VsdFswXSA9IHRoaXMubWluVmFsdWU7CiAgICAgIHJlc3VsdFsxXSA9IG1heDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBpbmRleCBvZiBhIGxvY2FsIHBvc2l0aW9uIG9uIHRoZSBoZWlnaHRmaWVsZC4gVGhlIGluZGV4ZXMgaW5kaWNhdGUgdGhlIHJlY3RhbmdsZXMsIHNvIGlmIHlvdXIgdGVycmFpbiBpcyBtYWRlIG9mIE4geCBOIGhlaWdodCBkYXRhIHBvaW50cywgeW91IHdpbGwgaGF2ZSByZWN0YW5nbGUgaW5kZXhlcyByYW5naW5nIGZyb20gMCB0byBOLTEuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFR3by1lbGVtZW50IGFycmF5CiAgICAgKiBAcGFyYW0gY2xhbXAgSWYgdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBjbGFtcGVkIHRvIHRoZSBoZWlnaHRmaWVsZCBlZGdlLgogICAgICovCgoKICAgIGdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCByZXN1bHQsIGNsYW1wKSB7CiAgICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAogICAgICBjb25zdCB3ID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IHhpID0gTWF0aC5mbG9vcih4IC8gdyk7CiAgICAgIGxldCB5aSA9IE1hdGguZmxvb3IoeSAvIHcpOwogICAgICByZXN1bHRbMF0gPSB4aTsKICAgICAgcmVzdWx0WzFdID0geWk7CgogICAgICBpZiAoY2xhbXApIHsKICAgICAgICAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwogICAgICAgIGlmICh4aSA8IDApIHsKICAgICAgICAgIHhpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5aSA8IDApIHsKICAgICAgICAgIHlpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh4aSA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHhpID0gZGF0YS5sZW5ndGggLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpID49IGRhdGFbMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgeWkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICB9IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCgogICAgICBpZiAoeGkgPCAwIHx8IHlpIDwgMCB8fCB4aSA+PSBkYXRhLmxlbmd0aCAtIDEgfHwgeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBnZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYykgewogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgbG93ZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSB4aSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSB5aSkgKiogMjsKICAgICAgY29uc3QgdXBwZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSAoeGkgKyAxKSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSAoeWkgKyAxKSkgKiogMjsKICAgICAgY29uc3QgdXBwZXIgPSBsb3dlckRpc3QyID4gdXBwZXJEaXN0MjsKICAgICAgdGhpcy5nZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKTsKICAgICAgcmV0dXJuIHVwcGVyOwogICAgfQoKICAgIGdldE5vcm1hbEF0KHgsIHksIGVkZ2VDbGFtcCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGEgPSBnZXROb3JtYWxBdF9hOwogICAgICBjb25zdCBiID0gZ2V0Tm9ybWFsQXRfYjsKICAgICAgY29uc3QgYyA9IGdldE5vcm1hbEF0X2M7CiAgICAgIGNvbnN0IGUwID0gZ2V0Tm9ybWFsQXRfZTA7CiAgICAgIGNvbnN0IGUxID0gZ2V0Tm9ybWFsQXRfZTE7CiAgICAgIHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiLnZzdWIoYSwgZTApOwogICAgICBjLnZzdWIoYSwgZTEpOwogICAgICBlMC5jcm9zcyhlMSwgcmVzdWx0KTsKICAgICAgcmVzdWx0Lm5vcm1hbGl6ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gQUFCQiBvZiBhIHNxdWFyZSBpbiB0aGUgaGVpZ2h0ZmllbGQKICAgICAqIEBwYXJhbSB4aQogICAgICogQHBhcmFtIHlpCiAgICAgKiBAcGFyYW0gcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0QWFiYkF0SW5kZXgoeGksIHlpLCB7CiAgICAgIGxvd2VyQm91bmQsCiAgICAgIHVwcGVyQm91bmQKICAgIH0pIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBsb3dlckJvdW5kLnNldCh4aSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0pOwogICAgICB1cHBlckJvdW5kLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgaGVpZ2h0IGluIHRoZSBoZWlnaHRmaWVsZCBhdCBhIGdpdmVuIHBvc2l0aW9uCiAgICAgKi8KCgogICAgZ2V0SGVpZ2h0QXQoeCwgeSwgZWRnZUNsYW1wKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGEgPSBnZXRIZWlnaHRBdF9hOwogICAgICBjb25zdCBiID0gZ2V0SGVpZ2h0QXRfYjsKICAgICAgY29uc3QgYyA9IGdldEhlaWdodEF0X2M7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgdXBwZXIgPSB0aGlzLmdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKTsKICAgICAgYmFyeWNlbnRyaWNXZWlnaHRzKHgsIHksIGEueCwgYS55LCBiLngsIGIueSwgYy54LCBjLnksIGdldEhlaWdodEF0X3dlaWdodHMpOwogICAgICBjb25zdCB3ID0gZ2V0SGVpZ2h0QXRfd2VpZ2h0czsKCiAgICAgIGlmICh1cHBlcikgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIHJldHVybiBkYXRhW3hpICsgMV1beWkgKyAxXSAqIHcueCArIGRhdGFbeGldW3lpICsgMV0gKiB3LnkgKyBkYXRhW3hpICsgMV1beWldICogdy56OwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIHJldHVybiBkYXRhW3hpXVt5aV0gKiB3LnggKyBkYXRhW3hpICsgMV1beWldICogdy55ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcuejsKICAgICAgfQogICAgfQoKICAgIGdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB4aSArICJfIiArIHlpICsgIl8iICsgKGdldFVwcGVyVHJpYW5nbGUgPyAxIDogMCk7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHRlcnJhaW4gaXMgaW5maW5pdGUKICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoqIEBUT0RPIGRvIGl0IHByb3Blcmx5ICovCiAgICAgIG1pbi5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CiAgICAgIG1heC5zZXQoTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSk7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIFVzZSB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBtaW4vbWF4IHZhbHVlcwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBzID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IG5ldyBWZWMzKGRhdGEubGVuZ3RoICogcywgZGF0YVswXS5sZW5ndGggKiBzLCBNYXRoLm1heChNYXRoLmFicyh0aGlzLm1heFZhbHVlKSwgTWF0aC5hYnModGhpcy5taW5WYWx1ZSkpKS5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgaGVpZ2h0IHZhbHVlcyBmcm9tIGFuIGltYWdlLiBDdXJyZW50bHkgb25seSBzdXBwb3J0ZWQgaW4gYnJvd3Nlci4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRzRnJvbUltYWdlKGltYWdlLCBzY2FsZSkgewogICAgICBjb25zdCB7CiAgICAgICAgeCwKICAgICAgICB6LAogICAgICAgIHkKICAgICAgfSA9IHNjYWxlOwogICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTsKICAgICAgY29uc3QgbWF0cml4ID0gdGhpcy5kYXRhOwogICAgICBtYXRyaXgubGVuZ3RoID0gMDsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IE1hdGguYWJzKHgpIC8gaW1hZ2VEYXRhLndpZHRoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZURhdGEuaGVpZ2h0OyBpKyspIHsKICAgICAgICBjb25zdCByb3cgPSBbXTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbWFnZURhdGEud2lkdGg7IGorKykgewogICAgICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNF07CiAgICAgICAgICBjb25zdCBiID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMV07CiAgICAgICAgICBjb25zdCBjID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMl07CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSAoYSArIGIgKyBjKSAvIDQgLyAyNTUgKiB6OwoKICAgICAgICAgIGlmICh4IDwgMCkgewogICAgICAgICAgICByb3cucHVzaChoZWlnaHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93LnVuc2hpZnQoaGVpZ2h0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh5IDwgMCkgewogICAgICAgICAgbWF0cml4LnVuc2hpZnQocm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0cml4LnB1c2gocm93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZSgpOwogICAgfQoKICB9CgogIGNvbnN0IGdldEhlaWdodEF0X2lkeCA9IFtdOwogIGNvbnN0IGdldEhlaWdodEF0X3dlaWdodHMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEhlaWdodEF0X2EgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEhlaWdodEF0X2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEhlaWdodEF0X2MgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2EgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2MgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2UwID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMSA9IG5ldyBWZWMzKCk7IC8vIGZyb20gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQmFyeWNlbnRyaWNfY29vcmRpbmF0ZV9zeXN0ZW0KCiAgZnVuY3Rpb24gYmFyeWNlbnRyaWNXZWlnaHRzKHgsIHksIGF4LCBheSwgYngsIGJ5LCBjeCwgY3ksIHJlc3VsdCkgewogICAgcmVzdWx0LnggPSAoKGJ5IC0gY3kpICogKHggLSBjeCkgKyAoY3ggLSBieCkgKiAoeSAtIGN5KSkgLyAoKGJ5IC0gY3kpICogKGF4IC0gY3gpICsgKGN4IC0gYngpICogKGF5IC0gY3kpKTsKICAgIHJlc3VsdC55ID0gKChjeSAtIGF5KSAqICh4IC0gY3gpICsgKGF4IC0gY3gpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueiA9IDEgLSByZXN1bHQueCAtIHJlc3VsdC55OwogIH0KICAvKioKICAgKiBPY3RyZWVOb2RlCiAgICovCgoKICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7CiAgICAgIHRoaXMucm9vdCA9IHZvaWQgMDsKICAgICAgdGhpcy5hYWJiID0gdm9pZCAwOwogICAgICB0aGlzLmRhdGEgPSB2b2lkIDA7CiAgICAgIHRoaXMuY2hpbGRyZW4gPSB2b2lkIDA7CiAgICAgIHRoaXMucm9vdCA9IG9wdGlvbnMucm9vdCB8fCBudWxsOwogICAgICB0aGlzLmFhYmIgPSBvcHRpb25zLmFhYmIgPyBvcHRpb25zLmFhYmIuY2xvbmUoKSA6IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZGF0YSA9IFtdOwogICAgICB0aGlzLmNoaWxkcmVuID0gW107CiAgICB9CiAgICAvKioKICAgICAqIHJlc2V0CiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIHRoaXMuY2hpbGRyZW4ubGVuZ3RoID0gdGhpcy5kYXRhLmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEluc2VydCBkYXRhIGludG8gdGhpcyBub2RlCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgc3VjY2Vzc2Z1bCwgb3RoZXJ3aXNlIGZhbHNlCiAgICAgKi8KCgogICAgaW5zZXJ0KGFhYmIsIGVsZW1lbnREYXRhLCBsZXZlbCA9IDApIHsKICAgICAgY29uc3Qgbm9kZURhdGEgPSB0aGlzLmRhdGE7IC8vIElnbm9yZSBvYmplY3RzIHRoYXQgZG8gbm90IGJlbG9uZyBpbiB0aGlzIG5vZGUKCiAgICAgIGlmICghdGhpcy5hYWJiLmNvbnRhaW5zKGFhYmIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBvYmplY3QgY2Fubm90IGJlIGFkZGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY29uc3QgbWF4RGVwdGggPSB0aGlzLm1heERlcHRoIHx8IHRoaXMucm9vdC5tYXhEZXB0aDsKCiAgICAgIGlmIChsZXZlbCA8IG1heERlcHRoKSB7CiAgICAgICAgLy8gU3ViZGl2aWRlIGlmIHRoZXJlIGFyZSBubyBjaGlsZHJlbiB5ZXQKICAgICAgICBsZXQgc3ViZGl2aWRlZCA9IGZhbHNlOwoKICAgICAgICBpZiAoIWNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5zdWJkaXZpZGUoKTsKICAgICAgICAgIHN1YmRpdmlkZWQgPSB0cnVlOwogICAgICAgIH0gLy8gYWRkIHRvIHdoaWNoZXZlciBub2RlIHdpbGwgYWNjZXB0IGl0CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgICBpZiAoY2hpbGRyZW5baV0uaW5zZXJ0KGFhYmIsIGVsZW1lbnREYXRhLCBsZXZlbCArIDEpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHN1YmRpdmlkZWQpIHsKICAgICAgICAgIC8vIE5vIGNoaWxkcmVuIGFjY2VwdGVkISBNaWdodCBhcyB3ZWxsIGp1c3QgcmVtb3ZlIGVtIHNpbmNlIHRoZXkgY29udGFpbiBub25lCiAgICAgICAgICBjaGlsZHJlbi5sZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgfSAvLyBUb28gZGVlcCwgb3IgY2hpbGRyZW4gZGlkbnQgd2FudCBpdC4gYWRkIGl0IGluIGN1cnJlbnQgbm9kZQoKCiAgICAgIG5vZGVEYXRhLnB1c2goZWxlbWVudERhdGEpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIDggZXF1YWxseSBzaXplZCBjaGlsZHJlbiBub2RlcyBhbmQgcHV0IHRoZW0gaW4gdGhlIGBjaGlsZHJlbmAgYXJyYXkuCiAgICAgKi8KCgogICAgc3ViZGl2aWRlKCkgewogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBsID0gYWFiYi5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gYWFiYi51cHBlckJvdW5kOwogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNoaWxkcmVuLnB1c2gobmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pKTsKICAgICAgdS52c3ViKGwsIGhhbGZEaWFnb25hbCk7CiAgICAgIGhhbGZEaWFnb25hbC5zY2FsZSgwLjUsIGhhbGZEaWFnb25hbCk7CiAgICAgIGNvbnN0IHJvb3QgPSB0aGlzLnJvb3QgfHwgdGhpczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuW2ldOyAvLyBTZXQgY3VycmVudCBub2RlIGFzIHJvb3QKCiAgICAgICAgY2hpbGQucm9vdCA9IHJvb3Q7IC8vIENvbXB1dGUgYm91bmRzCgogICAgICAgIGNvbnN0IGxvd2VyQm91bmQgPSBjaGlsZC5hYWJiLmxvd2VyQm91bmQ7CiAgICAgICAgbG93ZXJCb3VuZC54ICo9IGhhbGZEaWFnb25hbC54OwogICAgICAgIGxvd2VyQm91bmQueSAqPSBoYWxmRGlhZ29uYWwueTsKICAgICAgICBsb3dlckJvdW5kLnogKj0gaGFsZkRpYWdvbmFsLno7CiAgICAgICAgbG93ZXJCb3VuZC52YWRkKGwsIGxvd2VyQm91bmQpOyAvLyBVcHBlciBib3VuZCBpcyBhbHdheXMgbG93ZXIgYm91bmQgKyBoYWxmRGlhZ29uYWwKCiAgICAgICAgbG93ZXJCb3VuZC52YWRkKGhhbGZEaWFnb25hbCwgY2hpbGQuYWFiYi51cHBlckJvdW5kKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYWxsIGRhdGEsIHBvdGVudGlhbGx5IHdpdGhpbiBhbiBBQUJCCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICBhYWJiUXVlcnkoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHRoaXMuZGF0YTsgLy8gYWJvcnQgaWYgdGhlIHJhbmdlIGRvZXMgbm90IGludGVyc2VjdCB0aGlzIG5vZGUKICAgICAgLy8gaWYgKCF0aGlzLmFhYmIub3ZlcmxhcHMoYWFiYikpewogICAgICAvLyAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgLy8gfQogICAgICAvLyBBZGQgb2JqZWN0cyBhdCB0aGlzIGxldmVsCiAgICAgIC8vIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZURhdGEpOwogICAgICAvLyBBZGQgY2hpbGQgZGF0YQogICAgICAvLyBAdG9kbyB1bndyYXAgcmVjdXJzaW9uIGludG8gYSBxdWV1ZSAvIGxvb3AsIHRoYXQncyBmYXN0ZXIgaW4gSlMKCiAgICAgIHRoaXMuY2hpbGRyZW47IC8vIGZvciAobGV0IGkgPSAwLCBOID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAvLyAgICAgY2hpbGRyZW5baV0uYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCk7CiAgICAgIC8vIH0KCiAgICAgIGNvbnN0IHF1ZXVlID0gW3RoaXNdOwoKICAgICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIGNvbnN0IG5vZGUgPSBxdWV1ZS5wb3AoKTsKCiAgICAgICAgaWYgKG5vZGUuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlLmRhdGEpOwogICAgICAgIH0KCiAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocXVldWUsIG5vZGUuY2hpbGRyZW4pOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYWxsIGRhdGEsIHBvdGVudGlhbGx5IGludGVyc2VjdGVkIGJ5IGEgcmF5LgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgcmF5UXVlcnkocmF5LCB0cmVlVHJhbnNmb3JtLCByZXN1bHQpIHsKICAgICAgLy8gVXNlIGFhYmIgcXVlcnkgZm9yIG5vdy4KCiAgICAgIC8qKiBAdG9kbyBpbXBsZW1lbnQgcmVhbCByYXkgcXVlcnkgd2hpY2ggbmVlZHMgbGVzcyBsb29rdXBzICovCiAgICAgIHJheS5nZXRBQUJCKHRtcEFBQkIpOwogICAgICB0bXBBQUJCLnRvTG9jYWxGcmFtZSh0cmVlVHJhbnNmb3JtLCB0bXBBQUJCKTsKICAgICAgdGhpcy5hYWJiUXVlcnkodG1wQUFCQiwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogcmVtb3ZlRW1wdHlOb2RlcwogICAgICovCgoKICAgIHJlbW92ZUVtcHR5Tm9kZXMoKSB7CiAgICAgIGZvciAobGV0IGkgPSB0aGlzLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgdGhpcy5jaGlsZHJlbltpXS5yZW1vdmVFbXB0eU5vZGVzKCk7CgogICAgICAgIGlmICghdGhpcy5jaGlsZHJlbltpXS5jaGlsZHJlbi5sZW5ndGggJiYgIXRoaXMuY2hpbGRyZW5baV0uZGF0YS5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CiAgLyoqCiAgICogT2N0cmVlCiAgICovCgoKICBjbGFzcyBPY3RyZWUgZXh0ZW5kcyBPY3RyZWVOb2RlIHsKICAgIC8qKgogICAgICogTWF4aW11bSBzdWJkaXZpc2lvbiBkZXB0aAogICAgICogQGRlZmF1bHQgOAogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gYWFiYiBUaGUgdG90YWwgQUFCQiBvZiB0aGUgdHJlZQogICAgICovCiAgICBjb25zdHJ1Y3RvcihhYWJiLCBvcHRpb25zID0ge30pIHsKICAgICAgc3VwZXIoewogICAgICAgIHJvb3Q6IG51bGwsCiAgICAgICAgYWFiYgogICAgICB9KTsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHR5cGVvZiBvcHRpb25zLm1heERlcHRoICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4RGVwdGggOiA4OwogICAgfQoKICB9CgogIGNvbnN0IGhhbGZEaWFnb25hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wQUFCQiA9IG5ldyBBQUJCKCk7CiAgLyoqCiAgICogVHJpbWVzaC4KICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBIb3cgdG8gbWFrZSBhIG1lc2ggd2l0aCBhIHNpbmdsZSB0cmlhbmdsZQogICAqICAgICBjb25zdCB2ZXJ0aWNlcyA9IFsKICAgKiAgICAgICAgIDAsIDAsIDAsIC8vIHZlcnRleCAwCiAgICogICAgICAgICAxLCAwLCAwLCAvLyB2ZXJ0ZXggMQogICAqICAgICAgICAgMCwgMSwgMCAgLy8gdmVydGV4IDIKICAgKiAgICAgXQogICAqICAgICBjb25zdCBpbmRpY2VzID0gWwogICAqICAgICAgICAgMCwgMSwgMiAgLy8gdHJpYW5nbGUgMAogICAqICAgICBdCiAgICogICAgIGNvbnN0IHRyaW1lc2hTaGFwZSA9IG5ldyBDQU5OT04uVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcykKICAgKi8KCiAgY2xhc3MgVHJpbWVzaCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogdmVydGljZXMKICAgICAqLwoKICAgIC8qKgogICAgICogQXJyYXkgb2YgaW50ZWdlcnMsIGluZGljYXRpbmcgd2hpY2ggdmVydGljZXMgZWFjaCB0cmlhbmdsZSBjb25zaXN0cyBvZi4gVGhlIGxlbmd0aCBvZiB0aGlzIGFycmF5IGlzIHRodXMgMyB0aW1lcyB0aGUgbnVtYmVyIG9mIHRyaWFuZ2xlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIG5vcm1hbHMgZGF0YS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGxvY2FsIEFBQkIgb2YgdGhlIG1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlZmVyZW5jZXMgdG8gdmVydGV4IHBhaXJzLCBtYWtpbmcgdXAgYWxsIHVuaXF1ZSBlZGdlcyBpbiB0aGUgdHJpbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgc2NhbGluZyBvZiB0aGUgbWVzaC4gVXNlIC5zZXRTY2FsZSgpIHRvIHNldCBpdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4ZWQgdHJpYW5nbGVzLiBVc2UgLnVwZGF0ZVRyZWUoKSB0byB1cGRhdGUgaXQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHZlcnRpY2VzLCBpbmRpY2VzKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5UUklNRVNICiAgICAgIH0pOwogICAgICB0aGlzLnZlcnRpY2VzID0gdm9pZCAwOwogICAgICB0aGlzLmluZGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMubm9ybWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy5hYWJiID0gdm9pZCAwOwogICAgICB0aGlzLmVkZ2VzID0gdm9pZCAwOwogICAgICB0aGlzLnNjYWxlID0gdm9pZCAwOwogICAgICB0aGlzLnRyZWUgPSB2b2lkIDA7CiAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKTsKICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IEludDE2QXJyYXkoaW5kaWNlcyk7CiAgICAgIHRoaXMubm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoaW5kaWNlcy5sZW5ndGgpOwogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmVkZ2VzID0gbnVsbDsKICAgICAgdGhpcy5zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpOwogICAgICB0aGlzLnRyZWUgPSBuZXcgT2N0cmVlKCk7CiAgICAgIHRoaXMudXBkYXRlRWRnZXMoKTsKICAgICAgdGhpcy51cGRhdGVOb3JtYWxzKCk7CiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMudXBkYXRlVHJlZSgpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVUcmVlCiAgICAgKi8KCgogICAgdXBkYXRlVHJlZSgpIHsKICAgICAgY29uc3QgdHJlZSA9IHRoaXMudHJlZTsKICAgICAgdHJlZS5yZXNldCgpOwogICAgICB0cmVlLmFhYmIuY29weSh0aGlzLmFhYmIpOwogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7IC8vIFRoZSBsb2NhbCBtZXNoIEFBQkIgaXMgc2NhbGVkLCBidXQgdGhlIG9jdHJlZSBBQUJCIHNob3VsZCBiZSB1bnNjYWxlZAoKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueiAqPSAxIC8gc2NhbGUuejsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueiAqPSAxIC8gc2NhbGUuejsgLy8gSW5zZXJ0IGFsbCB0cmlhbmdsZXMKCiAgICAgIGNvbnN0IHRyaWFuZ2xlQUFCQiA9IG5ldyBBQUJCKCk7CiAgICAgIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBvaW50cyA9IFthLCBiLCBjXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vdGhpcy5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIGEsIGIsIGMpOwogICAgICAgIC8vIEdldCB1bnNjYWxlZCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwoKICAgICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKCiAgICAgICAgdHJpYW5nbGVBQUJCLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgICB0cmVlLmluc2VydCh0cmlhbmdsZUFBQkIsIGkpOwogICAgICB9CgogICAgICB0cmVlLnJlbW92ZUVtcHR5Tm9kZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRyaWFuZ2xlcyBpbiBhIGxvY2FsIEFBQkIgZnJvbSB0aGUgdHJpbWVzaC4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlZmVyZW5jaW5nIHRoZSBxdWVyaWVkIHRyaWFuZ2xlcy4KICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZXNJbkFBQkIoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHVuc2NhbGVkQUFCQi5jb3B5KGFhYmIpOyAvLyBTY2FsZSBpdCB0byBsb2NhbAoKICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBjb25zdCBpc3ggPSBzY2FsZS54OwogICAgICBjb25zdCBpc3kgPSBzY2FsZS55OwogICAgICBjb25zdCBpc3ogPSBzY2FsZS56OwogICAgICBjb25zdCBsID0gdW5zY2FsZWRBQUJCLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB1bnNjYWxlZEFBQkIudXBwZXJCb3VuZDsKICAgICAgbC54IC89IGlzeDsKICAgICAgbC55IC89IGlzeTsKICAgICAgbC56IC89IGlzejsKICAgICAgdS54IC89IGlzeDsKICAgICAgdS55IC89IGlzeTsKICAgICAgdS56IC89IGlzejsKICAgICAgcmV0dXJuIHRoaXMudHJlZS5hYWJiUXVlcnkodW5zY2FsZWRBQUJCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRTY2FsZQogICAgICovCgoKICAgIHNldFNjYWxlKHNjYWxlKSB7CiAgICAgIGNvbnN0IHdhc1VuaWZvcm0gPSB0aGlzLnNjYWxlLnggPT09IHRoaXMuc2NhbGUueSAmJiB0aGlzLnNjYWxlLnkgPT09IHRoaXMuc2NhbGUuejsKICAgICAgY29uc3QgaXNVbmlmb3JtID0gc2NhbGUueCA9PT0gc2NhbGUueSAmJiBzY2FsZS55ID09PSBzY2FsZS56OwoKICAgICAgaWYgKCEod2FzVW5pZm9ybSAmJiBpc1VuaWZvcm0pKSB7CiAgICAgICAgLy8gTm9uLXVuaWZvcm0gc2NhbGluZy4gTmVlZCB0byB1cGRhdGUgbm9ybWFscy4KICAgICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNjYWxlKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuIFdpbGwgc2F2ZSBpbiB0aGUgYC5ub3JtYWxzYCBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGVOb3JtYWxzKCkgewogICAgICBjb25zdCBuID0gY29tcHV0ZU5vcm1hbHNfbjsgLy8gR2VuZXJhdGUgbm9ybWFscwoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMubm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICB0aGlzLmdldFZlcnRleChhLCB2YSk7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYiwgdmIpOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGMsIHZjKTsKICAgICAgICBUcmltZXNoLmNvbXB1dGVOb3JtYWwodmIsIHZhLCB2Yywgbik7CiAgICAgICAgbm9ybWFsc1tpM10gPSBuLng7CiAgICAgICAgbm9ybWFsc1tpMyArIDFdID0gbi55OwogICAgICAgIG5vcm1hbHNbaTMgKyAyXSA9IG4uejsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuZWRnZXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlRWRnZXMoKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0ge307CgogICAgICBjb25zdCBhZGQgPSAoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGtleSA9IGEgPCBiID8gYSArICJfIiArIGIgOiBiICsgIl8iICsgYTsKICAgICAgICBlZGdlc1trZXldID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICBhZGQoYSwgYik7CiAgICAgICAgYWRkKGIsIGMpOwogICAgICAgIGFkZChjLCBhKTsKICAgICAgfQoKICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVkZ2VzKTsKICAgICAgdGhpcy5lZGdlcyA9IG5ldyBJbnQxNkFycmF5KGtleXMubGVuZ3RoICogMik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpbmRpY2VzID0ga2V5c1tpXS5zcGxpdCgnXycpOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGldID0gcGFyc2VJbnQoaW5kaWNlc1swXSwgMTApOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGkgKyAxXSA9IHBhcnNlSW50KGluZGljZXNbMV0sIDEwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWRnZSB2ZXJ0ZXgKICAgICAqIEBwYXJhbSBmaXJzdE9yU2Vjb25kIDAgb3IgMSwgZGVwZW5kaW5nIG9uIHdoaWNoIG9uZSBvZiB0aGUgdmVydGljZXMgeW91IG5lZWQuCiAgICAgKiBAcGFyYW0gdmVydGV4U3RvcmUgV2hlcmUgdG8gc3RvcmUgdGhlIHJlc3VsdAogICAgICovCgoKICAgIGdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCBmaXJzdE9yU2Vjb25kLCB2ZXJ0ZXhTdG9yZSkgewogICAgICBjb25zdCB2ZXJ0ZXhJbmRleCA9IHRoaXMuZWRnZXNbZWRnZUluZGV4ICogMiArIChmaXJzdE9yU2Vjb25kID8gMSA6IDApXTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodmVydGV4SW5kZXgsIHZlcnRleFN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdmVjdG9yIGFsb25nIGFuIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0RWRnZVZlY3RvcihlZGdlSW5kZXgsIHZlY3RvclN0b3JlKSB7CiAgICAgIGNvbnN0IHZhID0gZ2V0RWRnZVZlY3Rvcl92YTsKICAgICAgY29uc3QgdmIgPSBnZXRFZGdlVmVjdG9yX3ZiOwogICAgICB0aGlzLmdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCAwLCB2YSk7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDEsIHZiKTsKICAgICAgdmIudnN1Yih2YSwgdmVjdG9yU3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdmVydGV4IGkuCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0VmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpOwoKICAgICAgb3V0LnggKj0gc2NhbGUueDsKICAgICAgb3V0LnkgKj0gc2NhbGUueTsKICAgICAgb3V0LnogKj0gc2NhbGUuejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHJhdyB2ZXJ0ZXggaQogICAgICogQHJldHVybiBUaGUgIm91dCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIF9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICByZXR1cm4gb3V0LnNldCh2ZXJ0aWNlc1tpM10sIHZlcnRpY2VzW2kzICsgMV0sIHZlcnRpY2VzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZXJ0ZXggZnJvbSB0aGUgdHJpbWVzaCx0cmFuc2Zvcm1lZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0V29ybGRWZXJ0ZXgoaSwgcG9zLCBxdWF0LCBvdXQpIHsKICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgb3V0KTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvcywgcXVhdCwgb3V0LCBvdXQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRocmVlIHZlcnRpY2VzIGZvciB0cmlhbmdsZSBpLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYykgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTNdLCBhKTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMV0sIGIpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAyXSwgYyk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiB0cmlhbmdsZSBpLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGdldE5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQodGhpcy5ub3JtYWxzW2kzXSwgdGhpcy5ub3JtYWxzW2kzICsgMV0sIHRoaXMubm9ybWFsc1tpMyArIDJdKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKGNsaV9hYWJiKTsKICAgICAgY29uc3QgeCA9IGNsaV9hYWJiLnVwcGVyQm91bmQueCAtIGNsaV9hYWJiLmxvd2VyQm91bmQueDsKICAgICAgY29uc3QgeSA9IGNsaV9hYWJiLnVwcGVyQm91bmQueSAtIGNsaV9hYWJiLmxvd2VyQm91bmQueTsKICAgICAgY29uc3QgeiA9IGNsaV9hYWJiLnVwcGVyQm91bmQueiAtIGNsaV9hYWJiLmxvd2VyQm91bmQuejsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopLCAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeCAqIDIgKiB4ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGxvY2FsIEFBQkIgZm9yIHRoZSB0cmltZXNoCiAgICAgKi8KCgogICAgY29tcHV0ZUxvY2FsQUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgdiA9IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0OwogICAgICB0aGlzLmdldFZlcnRleCgwLCB2KTsKICAgICAgbC5jb3B5KHYpOwogICAgICB1LmNvcHkodik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CgogICAgICAgIGlmICh2LnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IHUueCkgewogICAgICAgICAgdS54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGwueSkgewogICAgICAgICAgbC55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgLmFhYmJgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKHRoaXMuYWFiYik7CiAgICB9CiAgICAvKioKICAgICAqIFdpbGwgdXBkYXRlIHRoZSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBBc3N1bWUgcG9pbnRzIGFyZSBkaXN0cmlidXRlZCB3aXRoIGxvY2FsICgwLDAsMCkgYXMgY2VudGVyCiAgICAgIGxldCBtYXgyID0gMDsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdmVydGljZXMubGVuZ3RoIC8gMzsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgY29uc3Qgbm9ybTIgPSB2Lmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoKICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAvIDMsCiAgICAgICAgICAgICAgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICAgICAgY29uc3QgbWlueCxtaW55LG1pbnosbWF4eCxtYXh5LG1heHo7CiAgICAgICAgICAgY29uc3QgdiA9IHRlbXBXb3JsZFZlcnRleDsKICAgICAgICAgIGZvcihsZXQgaT0wOyBpPG47IGkrKyl7CiAgICAgICAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICAgICAgICBwb3MudmFkZCh2LCB2KTsKICAgICAgICAgICAgICBpZiAodi54IDwgbWlueCB8fCBtaW54PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi54ID4gbWF4eCB8fCBtYXh4PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGlmICh2LnkgPCBtaW55IHx8IG1pbnk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW55ID0gdi55OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnkgPiBtYXh5IHx8IG1heHk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh5ID0gdi55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueiA8IG1pbnogfHwgbWluej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnogPSB2Lno7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueiA+IG1heHogfHwgbWF4ej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHogPSB2Lno7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbWluLnNldChtaW54LG1pbnksbWlueik7CiAgICAgICAgICBtYXguc2V0KG1heHgsbWF4eSxtYXh6KTsKICAgICAgICAgICovCiAgICAgIC8vIEZhc3RlciBhcHByb3hpbWF0aW9uIHVzaW5nIGxvY2FsIEFBQkIKICAgICAgY29uc3QgZnJhbWUgPSBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWU7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiOwogICAgICBmcmFtZS5wb3NpdGlvbiA9IHBvczsKICAgICAgZnJhbWUucXVhdGVybmlvbiA9IHF1YXQ7CiAgICAgIHRoaXMuYWFiYi50b1dvcmxkRnJhbWUoZnJhbWUsIHJlc3VsdCk7CiAgICAgIG1pbi5jb3B5KHJlc3VsdC5sb3dlckJvdW5kKTsKICAgICAgbWF4LmNvcHkocmVzdWx0LnVwcGVyQm91bmQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYXBwcm94aW1hdGUgdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSBhIFRyaW1lc2ggaW5zdGFuY2UsIHNoYXBlZCBhcyBhIHRvcnVzLgogICAgICovCgoKICAgIHN0YXRpYyBjcmVhdGVUb3J1cyhyYWRpdXMgPSAxLCB0dWJlID0gMC41LCByYWRpYWxTZWdtZW50cyA9IDgsIHR1YnVsYXJTZWdtZW50cyA9IDYsIGFyYyA9IE1hdGguUEkgKiAyKSB7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQoKICBjb25zdCBjb21wdXRlTm9ybWFsc19uID0gbmV3IFZlYzMoKTsKICBjb25zdCB1bnNjYWxlZEFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICBjb25zdCBhYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2xpX2FhYmIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWUgPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgY2FsY3VsYXRlV29ybGRBQUJCX2FhYmIgPSBuZXcgQUFCQigpOwogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCgogIGNsYXNzIFNvbHZlciB7CiAgICAvKioKICAgICAqIEFsbCBlcXVhdGlvbnMgdG8gYmUgc29sdmVkCiAgICAgKi8KCiAgICAvKioKICAgICAqIEB0b2RvIHJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmVxdWF0aW9ucyA9IHZvaWQgMDsKICAgICAgdGhpcy5lcXVhdGlvbnMgPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogU2hvdWxkIGJlIGltcGxlbWVudGVkIGluIHN1YmNsYXNzZXMhCiAgICAgKiBAdG9kbyB1c2UgYWJzdHJhY3QKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIHJldHVybiAoLy8gU2hvdWxkIHJldHVybiB0aGUgbnVtYmVyIG9mIGl0ZXJhdGlvbnMgZG9uZSEKICAgICAgICAwCiAgICAgICk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbiBlcXVhdGlvbgogICAgICovCgoKICAgIGFkZEVxdWF0aW9uKGVxKSB7CiAgICAgIGlmIChlcS5lbmFibGVkICYmICFlcS5iaS5pc1RyaWdnZXIgJiYgIWVxLmJqLmlzVHJpZ2dlcikgewogICAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBlcXVhdGlvbgogICAgICovCgoKICAgIHJlbW92ZUVxdWF0aW9uKGVxKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBpID0gZXFzLmluZGV4T2YoZXEpOwoKICAgICAgaWYgKGkgIT09IC0xKSB7CiAgICAgICAgZXFzLnNwbGljZShpLCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYWxsIGVxdWF0aW9ucwogICAgICovCgoKICAgIHJlbW92ZUFsbEVxdWF0aW9ucygpIHsKICAgICAgdGhpcy5lcXVhdGlvbnMubGVuZ3RoID0gMDsKICAgIH0KCiAgfQogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gR2F1c3MtU2VpZGVsIHNvbHZlci4KICAgKiBAdG9kbyBUaGUgc3Bvb2sgcGFyYW1ldGVycyBzaG91bGQgYmUgc3BlY2lmaWVkIGZvciBlYWNoIGNvbnN0cmFpbnQsIG5vdCBnbG9iYWxseS4KICAgKiBAc2VlIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDA5L2xlY3R1cmVzL3Nwb29rbm90ZXMucGRmCiAgICovCgoKICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgoKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9sYW1iZGEgPSBbXTsKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9pbnZDcyA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX0JzID0gW107CiAgLyoqCiAgICogRm9yIHBvb2xpbmcgb2JqZWN0cyB0aGF0IGNhbiBiZSByZXVzZWQuCiAgICovCgoKICBjbGFzcyBQb29sIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm9iamVjdHMgPSBbXTsKICAgICAgdGhpcy50eXBlID0gT2JqZWN0OwogICAgfQogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwoKCiAgICByZWxlYXNlKC4uLmFyZ3MpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmdzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYXJnczsgaSsrKSB7CiAgICAgICAgdGhpcy5vYmplY3RzLnB1c2goYXJnc1tpXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0KCkgewogICAgICBpZiAodGhpcy5vYmplY3RzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdE9iamVjdCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLm9iamVjdHMucG9wKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29uc3RydWN0IGFuIG9iamVjdC4gU2hvdWxkIGJlIGltcGxlbWVudGVkIGluIGVhY2ggc3ViY2xhc3MuCiAgICAgKi8KCgogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbnN0cnVjdE9iamVjdCgpIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIFBvb2wgc3ViY2xhc3MgeWV0IScpOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFNlbGYsIGZvciBjaGFpbmluZwogICAgICovCgoKICAgIHJlc2l6ZShzaXplKSB7CiAgICAgIGNvbnN0IG9iamVjdHMgPSB0aGlzLm9iamVjdHM7CgogICAgICB3aGlsZSAob2JqZWN0cy5sZW5ndGggPiBzaXplKSB7CiAgICAgICAgb2JqZWN0cy5wb3AoKTsKICAgICAgfQoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoIDwgc2l6ZSkgewogICAgICAgIG9iamVjdHMucHVzaCh0aGlzLmNvbnN0cnVjdE9iamVjdCgpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KICAvKioKICAgKiBWZWMzUG9vbAogICAqLwoKCiAgY2xhc3MgVmVjM1Bvb2wgZXh0ZW5kcyBQb29sIHsKICAgIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgICAgc3VwZXIoLi4uYXJncyk7CiAgICAgIHRoaXMudHlwZSA9IFZlYzM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgcmV0dXJuIG5ldyBWZWMzKCk7CiAgICB9CgogIH0KCiAgbGV0IF9DT0xMSVNJT05fVFlQRVMkc3BoZSwgX0NPTExJU0lPTl9UWVBFUyRzcGhlMiwgX0NPTExJU0lPTl9UWVBFUyRib3hCLCBfQ09MTElTSU9OX1RZUEVTJHNwaGUzLCBfQ09MTElTSU9OX1RZUEVTJHBsYW4sIF9DT0xMSVNJT05fVFlQRVMkY29udiwgX0NPTExJU0lPTl9UWVBFUyRzcGhlNCwgX0NPTExJU0lPTl9UWVBFUyRwbGFuMiwgX0NPTExJU0lPTl9UWVBFUyRib3hDLCBfQ09MTElTSU9OX1RZUEVTJHNwaGU1LCBfQ09MTElTSU9OX1RZUEVTJGJveEgsIF9DT0xMSVNJT05fVFlQRVMkY29udjIsIF9DT0xMSVNJT05fVFlQRVMkc3BoZTYsIF9DT0xMSVNJT05fVFlQRVMkcGxhbjMsIF9DT0xMSVNJT05fVFlQRVMkYm94UCwgX0NPTExJU0lPTl9UWVBFUyRjb252MywgX0NPTExJU0lPTl9UWVBFUyRjeWxpLCBfQ09MTElTSU9OX1RZUEVTJHNwaGU3LCBfQ09MTElTSU9OX1RZUEVTJHBsYW40LCBfQ09MTElTSU9OX1RZUEVTJGJveEMyLCBfQ09MTElTSU9OX1RZUEVTJGNvbnY0LCBfQ09MTElTSU9OX1RZUEVTJGhlaWcsIF9DT0xMSVNJT05fVFlQRVMkcGFydCwgX0NPTExJU0lPTl9UWVBFUyRzcGhlOCwgX0NPTExJU0lPTl9UWVBFUyRwbGFuNTsgLy8gTmFtaW5nIHJ1bGU6IGJhc2VkIG9mIHRoZSBvcmRlciBpbiBTSEFQRV9UWVBFUywKICAvLyB0aGUgZmlyc3QgcGFydCBvZiB0aGUgbWV0aG9kIGlzIGZvcm1lZCBieSB0aGUKICAvLyBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYmVmb3JlLCBpbiB0aGUgc2Vjb25kIHBhcnQKICAvLyB0aGVyZSBpcyB0aGUgc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGFmdGVyIGluIHRoZSBTSEFQRV9UWVBFUyBsaXN0CgoKICBjb25zdCBDT0xMSVNJT05fVFlQRVMgPSB7CiAgICBzcGhlcmVTcGhlcmU6IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHNwaGVyZVBsYW5lOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5QTEFORSwKICAgIGJveEJveDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQk9YLAogICAgc3BoZXJlQm94OiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBwbGFuZUJveDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBjb252ZXhDb252ZXg6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVDb252ZXg6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBwbGFuZUNvbnZleDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgYm94Q29udmV4OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgc3BoZXJlSGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgYm94SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgY29udmV4SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRCwKICAgIHNwaGVyZVBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHBsYW5lUGFydGljbGU6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBib3hQYXJ0aWNsZTogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBjb252ZXhQYXJ0aWNsZTogU2hhcGUudHlwZXMuUEFSVElDTEUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgY3lsaW5kZXJDeWxpbmRlcjogU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVDeWxpbmRlcjogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwbGFuZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgYm94Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgY29udmV4Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwYXJ0aWNsZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgc3BoZXJlVHJpbWVzaDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuVFJJTUVTSCwKICAgIHBsYW5lVHJpbWVzaDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5UUklNRVNICiAgfTsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGUgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlU3BoZXJlOwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTIgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGxhbmU7CiAgX0NPTExJU0lPTl9UWVBFUyRib3hCID0gQ09MTElTSU9OX1RZUEVTLmJveEJveDsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGUzID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZUJveDsKICBfQ09MTElTSU9OX1RZUEVTJHBsYW4gPSBDT0xMSVNJT05fVFlQRVMucGxhbmVCb3g7CiAgX0NPTExJU0lPTl9UWVBFUyRjb252ID0gQ09MTElTSU9OX1RZUEVTLmNvbnZleENvbnZleDsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU0ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZUNvbnZleDsKICBfQ09MTElTSU9OX1RZUEVTJHBsYW4yID0gQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4OwogIF9DT0xMSVNJT05fVFlQRVMkYm94QyA9IENPTExJU0lPTl9UWVBFUy5ib3hDb252ZXg7CiAgX0NPTExJU0lPTl9UWVBFUyRzcGhlNSA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVIZWlnaHRmaWVsZDsKICBfQ09MTElTSU9OX1RZUEVTJGJveEggPSBDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGQ7CiAgX0NPTExJU0lPTl9UWVBFUyRjb252MiA9IENPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZDsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU2ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlOwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbjMgPSBDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZTsKICBfQ09MTElTSU9OX1RZUEVTJGJveFAgPSBDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGU7CiAgX0NPTExJU0lPTl9UWVBFUyRjb252MyA9IENPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZTsKICBfQ09MTElTSU9OX1RZUEVTJGN5bGkgPSBDT0xMSVNJT05fVFlQRVMuY3lsaW5kZXJDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU3ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZUN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbjQgPSBDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJGJveEMyID0gQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkY29udjQgPSBDT0xMSVNJT05fVFlQRVMuY29udmV4Q3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRoZWlnID0gQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRwYXJ0ID0gQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRzcGhlOCA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVUcmltZXNoOwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbjUgPSBDT0xMSVNJT05fVFlQRVMucGxhbmVUcmltZXNoOwogIC8qKgogICAqIEhlbHBlciBjbGFzcyBmb3IgdGhlIFdvcmxkLiBHZW5lcmF0ZXMgQ29udGFjdEVxdWF0aW9ucy4KICAgKiBAdG9kbyBTcGhlcmUtQ29udmV4UG9seWhlZHJvbiBjb250YWN0cwogICAqIEB0b2RvIENvbnRhY3QgcmVkdWN0aW9uCiAgICogQHRvZG8gc2hvdWxkIG1vdmUgbWV0aG9kcyB0byBwcm90b3R5cGUKICAgKi8KCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlU3BoZXJlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlMl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRib3hCXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Qm94OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlM10oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUJveDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQm94OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjb252XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlNF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbjJdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94Q10oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkc3BoZTVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94SF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjb252Ml0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlNl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRwbGFuM10oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGJveFBdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkY29udjNdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkY3lsaV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkc3BoZTddKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHBsYW40XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGJveEMyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjb252NF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkaGVpZ10oKSB7CiAgICAgIHJldHVybiB0aGlzLmhlaWdodGZpZWxkQ3lsaW5kZXI7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHBhcnRdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlOF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVRyaW1lc2g7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHBsYW41XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVUcmltZXNoOwogICAgfSAvLyBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhUcmltZXNoXSgpIHsKICAgIC8vICAgcmV0dXJuIHRoaXMuY29udmV4VHJpbWVzaAogICAgLy8gfQoKCiAgICBjb25zdHJ1Y3Rvcih3b3JsZCkgewogICAgICB0aGlzLmNvbnRhY3RQb2ludFBvb2wgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLnYzcG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsID0gdm9pZCAwOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RQb2ludFBvb2wgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IFtdOwogICAgICB0aGlzLnJlc3VsdCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gW107CiAgICAgIHRoaXMudjNwb29sID0gbmV3IFZlYzNQb29sKCk7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgICAgdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsKICAgICAgdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBNYWtlIGEgY29udGFjdCBvYmplY3QsIGJ5IHVzaW5nIHRoZSBpbnRlcm5hbCBwb29sIG9yIGNyZWF0aW5nIGEgbmV3IG9uZS4KICAgICAqLwoKCiAgICBjcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIG92ZXJyaWRlU2hhcGVBLCBvdmVycmlkZVNoYXBlQikgewogICAgICBsZXQgYzsKCiAgICAgIGlmICh0aGlzLmNvbnRhY3RQb2ludFBvb2wubGVuZ3RoKSB7CiAgICAgICAgYyA9IHRoaXMuY29udGFjdFBvaW50UG9vbC5wb3AoKTsKICAgICAgICBjLmJpID0gYmk7CiAgICAgICAgYy5iaiA9IGJqOwogICAgICB9IGVsc2UgewogICAgICAgIGMgPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJpLCBiaik7CiAgICAgIH0KCiAgICAgIGMuZW5hYmxlZCA9IGJpLmNvbGxpc2lvblJlc3BvbnNlICYmIGJqLmNvbGxpc2lvblJlc3BvbnNlICYmIHNpLmNvbGxpc2lvblJlc3BvbnNlICYmIHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsKICAgICAgYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICBjLnNldFNwb29rUGFyYW1zKGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwgdGhpcy53b3JsZC5kdCk7CiAgICAgIGNvbnN0IG1hdEEgPSBzaS5tYXRlcmlhbCB8fCBiaS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNqLm1hdGVyaWFsIHx8IGJqLm1hdGVyaWFsOwoKICAgICAgaWYgKG1hdEEgJiYgbWF0QiAmJiBtYXRBLnJlc3RpdHV0aW9uID49IDAgJiYgbWF0Qi5yZXN0aXR1dGlvbiA+PSAwKSB7CiAgICAgICAgYy5yZXN0aXR1dGlvbiA9IG1hdEEucmVzdGl0dXRpb24gKiBtYXRCLnJlc3RpdHV0aW9uOwogICAgICB9CgogICAgICBjLnNpID0gb3ZlcnJpZGVTaGFwZUEgfHwgc2k7CiAgICAgIGMuc2ogPSBvdmVycmlkZVNoYXBlQiB8fCBzajsKICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXF1YXRpb24sIG91dEFycmF5KSB7CiAgICAgIGNvbnN0IGJvZHlBID0gY29udGFjdEVxdWF0aW9uLmJpOwogICAgICBjb25zdCBib2R5QiA9IGNvbnRhY3RFcXVhdGlvbi5iajsKICAgICAgY29uc3Qgc2hhcGVBID0gY29udGFjdEVxdWF0aW9uLnNpOwogICAgICBjb25zdCBzaGFwZUIgPSBjb250YWN0RXF1YXRpb24uc2o7CiAgICAgIGNvbnN0IHdvcmxkID0gdGhpcy53b3JsZDsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7IC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgIGxldCBmcmljdGlvbiA9IGNtLmZyaWN0aW9uOwogICAgICBjb25zdCBtYXRBID0gc2hhcGVBLm1hdGVyaWFsIHx8IGJvZHlBLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2hhcGVCLm1hdGVyaWFsIHx8IGJvZHlCLm1hdGVyaWFsOwoKICAgICAgaWYgKG1hdEEgJiYgbWF0QiAmJiBtYXRBLmZyaWN0aW9uID49IDAgJiYgbWF0Qi5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgZnJpY3Rpb24gPSBtYXRBLmZyaWN0aW9uICogbWF0Qi5mcmljdGlvbjsKICAgICAgfQoKICAgICAgaWYgKGZyaWN0aW9uID4gMCkgewogICAgICAgIC8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiB3b3JsZC5ncmF2aXR5Lmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gU3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIHBlbmV0cmF0aW9uIGluZm8KCiAgICAgIGNvbnN0IHNpZGVfbnMgPSBzcGhlcmVCb3hfc2lkZV9uczsKICAgICAgY29uc3Qgc2lkZV9uczEgPSBzcGhlcmVCb3hfc2lkZV9uczE7CiAgICAgIGNvbnN0IHNpZGVfbnMyID0gc3BoZXJlQm94X3NpZGVfbnMyOwogICAgICBsZXQgc2lkZV9oID0gbnVsbDsKICAgICAgbGV0IHNpZGVfcGVuZXRyYXRpb25zID0gMDsKICAgICAgbGV0IHNpZGVfZG90MSA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDIgPSAwOwogICAgICBsZXQgc2lkZV9kaXN0YW5jZSA9IG51bGw7CgogICAgICBmb3IgKGxldCBpZHggPSAwLCBuc2lkZXMgPSBzaWRlcy5sZW5ndGg7IGlkeCAhPT0gbnNpZGVzICYmIGZvdW5kID09PSBmYWxzZTsgaWR4KyspIHsKICAgICAgICAvLyBHZXQgdGhlIHBsYW5lIHNpZGUgbm9ybWFsIChucykKICAgICAgICBjb25zdCBucyA9IHNwaGVyZUJveF9uczsKICAgICAgICBucy5jb3B5KHNpZGVzW2lkeF0pOwogICAgICAgIGNvbnN0IGggPSBucy5sZW5ndGgoKTsKICAgICAgICBucy5ub3JtYWxpemUoKTsgLy8gVGhlIG5vcm1hbC9kaXN0YW5jZSBkb3QgcHJvZHVjdCB0ZWxscyB3aGljaCBzaWRlIG9mIHRoZSBwbGFuZSB3ZSBhcmUKCiAgICAgICAgY29uc3QgZG90ID0gYm94X3RvX3NwaGVyZS5kb3QobnMpOwoKICAgICAgICBpZiAoZG90IDwgaCArIFIgJiYgZG90ID4gMCkgewogICAgICAgICAgLy8gSW50ZXJzZWN0cyBwbGFuZS4gTm93IGNoZWNrIHRoZSBvdGhlciB0d28gZGltZW5zaW9ucwogICAgICAgICAgY29uc3QgbnMxID0gc3BoZXJlQm94X25zMTsKICAgICAgICAgIGNvbnN0IG5zMiA9IHNwaGVyZUJveF9uczI7CiAgICAgICAgICBuczEuY29weShzaWRlc1soaWR4ICsgMSkgJSAzXSk7CiAgICAgICAgICBuczIuY29weShzaWRlc1soaWR4ICsgMikgJSAzXSk7CiAgICAgICAgICBjb25zdCBoMSA9IG5zMS5sZW5ndGgoKTsKICAgICAgICAgIGNvbnN0IGgyID0gbnMyLmxlbmd0aCgpOwogICAgICAgICAgbnMxLm5vcm1hbGl6ZSgpOwogICAgICAgICAgbnMyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgY29uc3QgZG90MSA9IGJveF90b19zcGhlcmUuZG90KG5zMSk7CiAgICAgICAgICBjb25zdCBkb3QyID0gYm94X3RvX3NwaGVyZS5kb3QobnMyKTsKCiAgICAgICAgICBpZiAoZG90MSA8IGgxICYmIGRvdDEgPiAtaDEgJiYgZG90MiA8IGgyICYmIGRvdDIgPiAtaDIpIHsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguYWJzKGRvdCAtIGggLSBSKTsKCiAgICAgICAgICAgIGlmIChzaWRlX2Rpc3RhbmNlID09PSBudWxsIHx8IGRpc3QgPCBzaWRlX2Rpc3RhbmNlKSB7CiAgICAgICAgICAgICAgc2lkZV9kaXN0YW5jZSA9IGRpc3Q7CiAgICAgICAgICAgICAgc2lkZV9kb3QxID0gZG90MTsKICAgICAgICAgICAgICBzaWRlX2RvdDIgPSBkb3QyOwogICAgICAgICAgICAgIHNpZGVfaCA9IGg7CiAgICAgICAgICAgICAgc2lkZV9ucy5jb3B5KG5zKTsKICAgICAgICAgICAgICBzaWRlX25zMS5jb3B5KG5zMSk7CiAgICAgICAgICAgICAgc2lkZV9uczIuY29weShuczIpOwogICAgICAgICAgICAgIHNpZGVfcGVuZXRyYXRpb25zKys7CgogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc2lkZV9wZW5ldHJhdGlvbnMpIHsKICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgc2lkZV9ucy5zY2FsZSgtUiwgci5yaSk7IC8vIFNwaGVyZSByCgogICAgICAgIHIubmkuY29weShzaWRlX25zKTsKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHNob3VsZCBiZSBvdXQgb2Ygc3BoZXJlCgogICAgICAgIHNpZGVfbnMuc2NhbGUoc2lkZV9oLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMS5zY2FsZShzaWRlX2RvdDEsIHNpZGVfbnMxKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczEsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMyLnNjYWxlKHNpZGVfZG90Miwgc2lkZV9uczIpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMiwgci5yaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0gLy8gQ2hlY2sgY29ybmVycwoKCiAgICAgIGxldCByaiA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3Qgc3BoZXJlX3RvX2Nvcm5lciA9IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IDIgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gMiAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgZm9yIChsZXQgbCA9IDA7IGwgIT09IDIgJiYgIWZvdW5kOyBsKyspIHsKICAgICAgICAgICAgcmouc2V0KDAsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGopIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaykgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCgogICAgICAgICAgICB4ai52YWRkKHJqLCBzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgc3BoZXJlX3RvX2Nvcm5lci52c3ViKHhpLCBzcGhlcmVfdG9fY29ybmVyKTsKCiAgICAgICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByLm5pLmNvcHkoci5yaSk7CiAgICAgICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLmNvcHkocmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShyaik7CiAgICAgIHJqID0gbnVsbDsgLy8gQ2hlY2sgZWRnZXMKCiAgICAgIGNvbnN0IGVkZ2VUYW5nZW50ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBlZGdlQ2VudGVyID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCByID0gdjNwb29sLmdldCgpOyAvLyByID0gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlcgoKICAgICAgY29uc3Qgb3J0aG9nb25hbCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZGlzdCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgTnNpZGVzID0gc2lkZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5zaWRlcyAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGlmIChqICUgMyAhPT0gayAlIDMpIHsKICAgICAgICAgICAgLy8gR2V0IGVkZ2UgdGFuZ2VudAogICAgICAgICAgICBzaWRlc1trXS5jcm9zcyhzaWRlc1tqXSwgZWRnZVRhbmdlbnQpOwogICAgICAgICAgICBlZGdlVGFuZ2VudC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgc2lkZXNbal0udmFkZChzaWRlc1trXSwgZWRnZUNlbnRlcik7CiAgICAgICAgICAgIHIuY29weSh4aSk7CiAgICAgICAgICAgIHIudnN1YihlZGdlQ2VudGVyLCByKTsKICAgICAgICAgICAgci52c3ViKHhqLCByKTsKICAgICAgICAgICAgY29uc3Qgb3J0aG9ub3JtID0gci5kb3QoZWRnZVRhbmdlbnQpOyAvLyBkaXN0YW5jZSBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCgogICAgICAgICAgICBlZGdlVGFuZ2VudC5zY2FsZShvcnRob25vcm0sIG9ydGhvZ29uYWwpOyAvLyBWZWN0b3IgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgogICAgICAgICAgICAvLyBGaW5kIHRoZSB0aGlyZCBzaWRlIG9ydGhvZ29uYWwgdG8gdGhpcyBvbmUKCiAgICAgICAgICAgIGxldCBsID0gMDsKCiAgICAgICAgICAgIHdoaWxlIChsID09PSBqICUgMyB8fCBsID09PSBrICUgMykgewogICAgICAgICAgICAgIGwrKzsKICAgICAgICAgICAgfSAvLyB2ZWMgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgcHJvamVjdGVkIHRvIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIHRoZSBlZGdlIHRhbmdlbnQKCgogICAgICAgICAgICBkaXN0LmNvcHkoeGkpOwogICAgICAgICAgICBkaXN0LnZzdWIob3J0aG9nb25hbCwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1YihlZGdlQ2VudGVyLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKHhqLCBkaXN0KTsgLy8gRGlzdGFuY2VzIGluIHRhbmdlbnQgZGlyZWN0aW9uIGFuZCBkaXN0YW5jZSBpbiB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byBpdAoKICAgICAgICAgICAgY29uc3QgdGRpc3QgPSBNYXRoLmFicyhvcnRob25vcm0pOwogICAgICAgICAgICBjb25zdCBuZGlzdCA9IGRpc3QubGVuZ3RoKCk7CgogICAgICAgICAgICBpZiAodGRpc3QgPCBzaWRlc1tsXS5sZW5ndGgoKSAmJiBuZGlzdCA8IFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgZWRnZUNlbnRlci52YWRkKG9ydGhvZ29uYWwsIHJlcy5yaik7IC8vIGJveCByagoKICAgICAgICAgICAgICByZXMucmouY29weShyZXMucmopOwogICAgICAgICAgICAgIGRpc3QubmVnYXRlKHJlcy5uaSk7CiAgICAgICAgICAgICAgcmVzLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHJlcy5yaS5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGosIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHJlcy5yaS5zY2FsZShSLCByZXMucmkpOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1YihiaS5wb3NpdGlvbiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmoudmFkZCh4aiwgcmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmoudnN1Yihiai5wb3NpdGlvbiwgcmVzLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHJlcyk7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHJlcywgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKGVkZ2VUYW5nZW50LCBlZGdlQ2VudGVyLCByLCBvcnRob2dvbmFsLCBkaXN0KTsKICAgIH0KCiAgICBwbGFuZUJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzai5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5pZCA9IHNqLmlkOwogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleChzaSwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IHNlcEF4aXMgPSBjb252ZXhDb252ZXhfc2VwQXhpczsKCiAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChzaS5maW5kU2VwYXJhdGluZ0F4aXMoc2osIHhpLCBxaSwgeGosIHFqLCBzZXBBeGlzLCBmYWNlTGlzdEEsIGZhY2VMaXN0QikpIHsKICAgICAgICBjb25zdCByZXMgPSBbXTsKICAgICAgICBjb25zdCBxID0gY29udmV4Q29udmV4X3E7CiAgICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLCBxaSwgc2osIHhqLCBxaiwgc2VwQXhpcywgLTEwMCwgMTAwLCByZXMpOwogICAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIGNvbnN0IHJpID0gci5yaTsKICAgICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICAgIHNlcEF4aXMubmVnYXRlKHIubmkpOwogICAgICAgICAgcmVzW2pdLm5vcm1hbC5uZWdhdGUocSk7CiAgICAgICAgICBxLnNjYWxlKHJlc1tqXS5kZXB0aCwgcSk7CiAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAgICAgICByai5jb3B5KHJlc1tqXS5wb2ludCk7IC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKCiAgICAgICAgICByaS52c3ViKHhpLCByaSk7CiAgICAgICAgICByai52c3ViKHhqLCByaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZUNvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCB2M3Bvb2wgPSB0aGlzLnYzcG9vbDsKICAgICAgeGkudnN1Yih4aiwgY29udmV4X3RvX3NwaGVyZSk7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBzai5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgZmFjZXMgPSBzai5mYWNlczsKICAgICAgY29uc3QgdmVydHMgPSBzai52ZXJ0aWNlczsKICAgICAgY29uc3QgUiA9IHNpLnJhZGl1czsgLy8gICAgIHJldHVybjsKICAgICAgLy8gfQoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIENoZWNrIGNvcm5lcnMKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB2ZXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgogICAgICAgIGNvbnN0IHdvcmxkQ29ybmVyID0gc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyOwogICAgICAgIHFqLnZtdWx0KHYsIHdvcmxkQ29ybmVyKTsKICAgICAgICB4ai52YWRkKHdvcmxkQ29ybmVyLCB3b3JsZENvcm5lcik7CiAgICAgICAgY29uc3Qgc3BoZXJlX3RvX2Nvcm5lciA9IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lcjsKICAgICAgICB3b3JsZENvcm5lci52c3ViKHhpLCBzcGhlcmVfdG9fY29ybmVyKTsKCiAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICByLm5pLmNvcHkoci5yaSk7CiAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gLy8gQ2hlY2sgc2lkZSAocGxhbmUpIGludGVyc2VjdGlvbnMKCgogICAgICBmb3IgKGxldCBpID0gMCwgbmZhY2VzID0gZmFjZXMubGVuZ3RoOyBpICE9PSBuZmFjZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtYWwgPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IGZhY2UgPSBmYWNlc1tpXTsgLy8gR2V0IHdvcmxkLXRyYW5zZm9ybWVkIG5vcm1hbCBvZiB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbDsKICAgICAgICBxai52bXVsdChub3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gR2V0IGEgd29ybGQgdmVydGV4IGZyb20gdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGRQb2ludCA9IHNwaGVyZUNvbnZleF93b3JsZFBvaW50OwogICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbMF1dLCB3b3JsZFBvaW50KTsKICAgICAgICB3b3JsZFBvaW50LnZhZGQoeGosIHdvcmxkUG9pbnQpOyAvLyBHZXQgYSBwb2ludCBvbiB0aGUgc3BoZXJlLCBjbG9zZXN0IHRvIHRoZSBmYWNlIG5vcm1hbAoKICAgICAgICBjb25zdCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lOwogICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUpOwogICAgICAgIHhpLnZhZGQod29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUpOyAvLyBWZWN0b3IgZnJvbSBhIGZhY2UgcG9pbnQgdG8gdGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHNwaGVyZQoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYyA9IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYzsKICAgICAgICB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUudnN1Yih3b3JsZFBvaW50LCBwZW5ldHJhdGlvblZlYyk7IC8vIFRoZSBwZW5ldHJhdGlvbi4gTmVnYXRpdmUgdmFsdWUgbWVhbnMgb3ZlcmxhcC4KCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb24gPSBwZW5ldHJhdGlvblZlYy5kb3Qod29ybGROb3JtYWwpOwogICAgICAgIGNvbnN0IHdvcmxkUG9pbnRUb1NwaGVyZSA9IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQ7CiAgICAgICAgeGkudnN1Yih3b3JsZFBvaW50LCB3b3JsZFBvaW50VG9TcGhlcmUpOwoKICAgICAgICBpZiAocGVuZXRyYXRpb24gPCAwICYmIHdvcmxkUG9pbnRUb1NwaGVyZS5kb3Qod29ybGROb3JtYWwpID4gMCkgewogICAgICAgICAgLy8gSW50ZXJzZWN0cyBwbGFuZS4gTm93IGNoZWNrIGlmIHRoZSBzcGhlcmUgaXMgaW5zaWRlIHRoZSBmYWNlIHBvbHlnb24KICAgICAgICAgIGNvbnN0IGZhY2VWZXJ0cyA9IFtdOyAvLyBGYWNlIHZlcnRpY2VzLCBpbiB3b3JsZCBjb29yZHMKCiAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTnZlcnRzID0gZmFjZS5sZW5ndGg7IGogIT09IE52ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IHdvcmxkVmVydGV4ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlW2pdXSwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICB4ai52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIGZhY2VWZXJ0cy5wdXNoKHdvcmxkVmVydGV4KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocG9pbnRJblBvbHlnb24oZmFjZVZlcnRzLCB3b3JsZE5vcm1hbCwgeGkpKSB7CiAgICAgICAgICAgIC8vIElzIHRoZSBzcGhlcmUgY2VudGVyIGluIHRoZSBmYWNlIHBvbHlnb24/CiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgci5yaSk7IC8vIENvbnRhY3Qgb2Zmc2V0LCBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gY29udGFjdAoKICAgICAgICAgICAgd29ybGROb3JtYWwubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgcG9pbnRpbmcgb3V0IG9mIHNwaGVyZQoKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtcGVuZXRyYXRpb24sIHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCBwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsgLy94aS52c3ViKHhqKS52YWRkKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpLnZhZGQocGVuZXRyYXRpb25WZWMyICwgci5yaik7CgogICAgICAgICAgICB4aS52c3ViKHhqLCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQsIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25WZWMyLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocGVuZXRyYXRpb25TcGhlcmVQb2ludCk7CiAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47IC8vIFdlIG9ubHkgZXhwZWN0ICpvbmUqIGZhY2UgY29udGFjdAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gRWRnZT8KICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IGZhY2UubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAvLyBHZXQgdHdvIHdvcmxkIHRyYW5zZm9ybWVkIHZlcnRpY2VzCiAgICAgICAgICAgICAgY29uc3QgdjEgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgY29uc3QgdjIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDEpICUgZmFjZS5sZW5ndGhdXSwgdjEpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAyKSAlIGZhY2UubGVuZ3RoXV0sIHYyKTsKICAgICAgICAgICAgICB4ai52YWRkKHYxLCB2MSk7CiAgICAgICAgICAgICAgeGoudmFkZCh2MiwgdjIpOyAvLyBDb25zdHJ1Y3QgZWRnZSB2ZWN0b3IKCiAgICAgICAgICAgICAgY29uc3QgZWRnZSA9IHNwaGVyZUNvbnZleF9lZGdlOwogICAgICAgICAgICAgIHYyLnZzdWIodjEsIGVkZ2UpOyAvLyBDb25zdHJ1Y3QgdGhlIHNhbWUgdmVjdG9yLCBidXQgbm9ybWFsaXplZAoKICAgICAgICAgICAgICBjb25zdCBlZGdlVW5pdCA9IHNwaGVyZUNvbnZleF9lZGdlVW5pdDsKICAgICAgICAgICAgICBlZGdlLnVuaXQoZWRnZVVuaXQpOyAvLyBwIGlzIHhpIHByb2plY3RlZCBvbnRvIHRoZSBlZGdlCgogICAgICAgICAgICAgIGNvbnN0IHAgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgY29uc3QgdjFfdG9feGkgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgeGkudnN1Yih2MSwgdjFfdG9feGkpOwogICAgICAgICAgICAgIGNvbnN0IGRvdCA9IHYxX3RvX3hpLmRvdChlZGdlVW5pdCk7CiAgICAgICAgICAgICAgZWRnZVVuaXQuc2NhbGUoZG90LCBwKTsKICAgICAgICAgICAgICBwLnZhZGQodjEsIHApOyAvLyBDb21wdXRlIGEgdmVjdG9yIGZyb20gcCB0byB0aGUgY2VudGVyIG9mIHRoZSBzcGhlcmUKCiAgICAgICAgICAgICAgY29uc3QgeGlfdG9fcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBwLnZzdWIoeGksIHhpX3RvX3ApOyAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgLy8gQU5EIGlmIHAgaXMgaW4gYmV0d2VlbiB2MSBhbmQgdjIKCiAgICAgICAgICAgICAgaWYgKGRvdCA+IDAgJiYgZG90ICogZG90IDwgZWRnZS5sZW5ndGhTcXVhcmVkKCkgJiYgeGlfdG9fcC5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgICAgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgICAgLy8gRWRnZSBjb250YWN0IQogICAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgICAgcC52c3ViKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aSwgci5uaSk7CiAgICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgci5uaS5zY2FsZShSLCByLnJpKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKCiAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHBsYW5lQ29udmV4KHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBwbGFuZVBvc2l0aW9uLCBjb252ZXhQb3NpdGlvbiwgcGxhbmVRdWF0LCBjb252ZXhRdWF0LCBwbGFuZUJvZHksIGNvbnZleEJvZHksIHNpLCBzaiwganVzdFRlc3QpIHsKICAgICAgLy8gU2ltcGx5IHJldHVybiB0aGUgcG9pbnRzIGJlaGluZCB0aGUgcGxhbmUuCiAgICAgIGNvbnN0IHdvcmxkVmVydGV4ID0gcGxhbmVDb252ZXhfdjsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBwbGFuZUNvbnZleF9ub3JtYWw7CiAgICAgIHdvcmxkTm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgcGxhbmVRdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKICAgICAgY29uc3QgcmVscG9zID0gcGxhbmVDb252ZXhfcmVscG9zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGNvbnZleFNoYXBlLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIGNvbnZleCB2ZXJ0ZXgKICAgICAgICB3b3JsZFZlcnRleC5jb3B5KGNvbnZleFNoYXBlLnZlcnRpY2VzW2ldKTsKICAgICAgICBjb252ZXhRdWF0LnZtdWx0KHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgY29udmV4UG9zaXRpb24udmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIHdvcmxkVmVydGV4LnZzdWIocGxhbmVQb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjb25zdCBkb3QgPSB3b3JsZE5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCBjb252ZXhCb2R5LCBwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgc2ksIHNqKTsgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZUNvbnZleF9wcm9qZWN0ZWQ7CiAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSh3b3JsZE5vcm1hbC5kb3QocmVscG9zKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOwogICAgICAgICAgcHJvamVjdGVkLnZzdWIocGxhbmVQb3NpdGlvbiwgci5yaSk7IC8vIEZyb20gcGxhbmUgdG8gdmVydGV4IHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIHIubmkuY29weSh3b3JsZE5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwgb3V0IGZyb20gcGxhbmUKICAgICAgICAgIC8vIHJqIGlzIG5vdyBqdXN0IHRoZSB2ZWN0b3IgZnJvbSB0aGUgY29udmV4IGNlbnRlciB0byB0aGUgdmVydGV4CgogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihjb252ZXhQb3NpdGlvbiwgci5yaik7IC8vIE1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIGJvZHkKCiAgICAgICAgICByLnJpLnZhZGQocGxhbmVQb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIocGxhbmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmoudmFkZChjb252ZXhQb3NpdGlvbiwgci5yaik7CiAgICAgICAgICByLnJqLnZzdWIoY29udmV4Qm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpOwogICAgICB9CiAgICB9CgogICAgYm94Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZUhlaWdodGZpZWxkKHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBzcGhlcmVQb3MsIGhmUG9zLCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGRhdGEgPSBoZlNoYXBlLmRhdGE7CiAgICAgIGNvbnN0IHJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMjsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIHNwaGVyZVBvcywgbG9jYWxTcGhlcmVQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSBjYW4ndCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsU3BoZXJlUG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxTcGhlcmVQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHNCZWZvcmUgPSByZXN1bHQubGVuZ3RoOwogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKHNwaGVyZVBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc3BoZXJlU2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5zcGhlcmVDb252ZXgoc3BoZXJlU2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBzcGhlcmVQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgc3BoZXJlU2hhcGUsIGhmU2hhcGUsIGp1c3RUZXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKHNwaGVyZVBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc3BoZXJlU2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5zcGhlcmVDb252ZXgoc3BoZXJlU2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBzcGhlcmVQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgc3BoZXJlU2hhcGUsIGhmU2hhcGUsIGp1c3RUZXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzID0gcmVzdWx0Lmxlbmd0aCAtIG51bUNvbnRhY3RzQmVmb3JlOwoKICAgICAgICAgIGlmIChudW1Db250YWN0cyA+IDIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgLyoKICAgICAgICAgICAgLy8gU2tpcCBhbGwgYnV0IDEKICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBudW1Db250YWN0cyAtIDE7IGsrKykgewogICAgICAgICAgICAgICAgcmVzdWx0LnBvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAqLwoKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBib3hIZWlnaHRmaWVsZChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkKHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleEhlaWdodGZpZWxkKGNvbnZleFNoYXBlLCBoZlNoYXBlLCBjb252ZXhQb3MsIGhmUG9zLCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGRhdGEgPSBoZlNoYXBlLmRhdGE7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCByYWRpdXMgPSBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBjb252ZXhIZWlnaHRmaWVsZF90bXAyOwogICAgICBjb25zdCBmYWNlTGlzdCA9IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0OyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxDb252ZXhQb3MgPSBjb252ZXhIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgY29udmV4UG9zLCBsb2NhbENvbnZleFBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlJ3JlIGNhbnQgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbENvbnZleFBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsQ29udmV4UG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoY29udmV4UG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLmNvbnZleENvbnZleChjb252ZXhTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIGNvbnZleFBvcywgd29ybGRQaWxsYXJPZmZzZXQsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCBudWxsLCBudWxsLCBqdXN0VGVzdCwgZmFjZUxpc3QsIG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoY29udmV4UG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLmNvbnZleENvbnZleChjb252ZXhTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIGNvbnZleFBvcywgd29ybGRQaWxsYXJPZmZzZXQsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCBudWxsLCBudWxsLCBqdXN0VGVzdCwgZmFjZUxpc3QsIG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gVGhlIG5vcm1hbCBpcyB0aGUgdW5pdCB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHBhcnRpY2xlIGNlbnRlcgogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVNwaGVyZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHhpLnZzdWIoeGosIG5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbmd0aFNxdWFyZWQgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKGxlbmd0aFNxdWFyZWQgPD0gc2oucmFkaXVzICogc2oucmFkaXVzKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICByLnJqLmNvcHkobm9ybWFsKTsKICAgICAgICByLnJqLnNjYWxlKHNqLnJhZGl1cywgci5yaik7CiAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlUGxhbmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBiai5xdWF0ZXJuaW9uLnZtdWx0KG5vcm1hbCwgbm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBjb25zdCByZWxwb3MgPSBwYXJ0aWNsZVBsYW5lX3JlbHBvczsKICAgICAgeGkudnN1Yihiai5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgY29uc3QgZG90ID0gbm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQogICAgICAgIC8vIEdldCBwYXJ0aWNsZSBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGFydGljbGVQbGFuZV9wcm9qZWN0ZWQ7CiAgICAgICAgbm9ybWFsLnNjYWxlKG5vcm1hbC5kb3QoeGkpLCBwcm9qZWN0ZWQpOwogICAgICAgIHhpLnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOyAvL3Byb2plY3RlZC52YWRkKGJqLnBvc2l0aW9uLHByb2plY3RlZCk7CiAgICAgICAgLy8gcmogaXMgbm93IHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgci5yai5jb3B5KHByb2plY3RlZCk7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hQYXJ0aWNsZShzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlKHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleFBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGxldCBwZW5ldHJhdGVkRmFjZUluZGV4ID0gLTE7CiAgICAgIGNvbnN0IHBlbmV0cmF0ZWRGYWNlTm9ybWFsID0gY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWw7CiAgICAgIGNvbnN0IHdvcmxkUGVuZXRyYXRpb25WZWMgPSBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjOwogICAgICBsZXQgbWluUGVuZXRyYXRpb24gPSBudWxsOwogICAgICBjb25zdCBsb2NhbCA9IGNvbnZleFBhcnRpY2xlX2xvY2FsOwogICAgICBsb2NhbC5jb3B5KHhpKTsKICAgICAgbG9jYWwudnN1Yih4aiwgbG9jYWwpOyAvLyBDb252ZXJ0IHBvc2l0aW9uIHRvIHJlbGF0aXZlIHRoZSBjb252ZXggb3JpZ2luCgogICAgICBxai5jb25qdWdhdGUoY3FqKTsKICAgICAgY3FqLnZtdWx0KGxvY2FsLCBsb2NhbCk7CgogICAgICBpZiAoc2oucG9pbnRJc0luc2lkZShsb2NhbCkpIHsKICAgICAgICBpZiAoc2oud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRWZXJ0aWNlcyh4aiwgcWopOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNqLndvcmxkRmFjZU5vcm1hbHNOZWVkc1VwZGF0ZSkgewogICAgICAgICAgc2ouY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocWopOwogICAgICAgIH0gLy8gRm9yIGVhY2ggd29ybGQgcG9seWdvbiBpbiB0aGUgcG9seWhlZHJhCgoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbmZhY2VzID0gc2ouZmFjZXMubGVuZ3RoOyBpICE9PSBuZmFjZXM7IGkrKykgewogICAgICAgICAgLy8gQ29uc3RydWN0IHdvcmxkIGZhY2UgdmVydGljZXMKICAgICAgICAgIGNvbnN0IHZlcnRzID0gW3NqLndvcmxkVmVydGljZXNbc2ouZmFjZXNbaV1bMF1dXTsKICAgICAgICAgIGNvbnN0IG5vcm1hbCA9IHNqLndvcmxkRmFjZU5vcm1hbHNbaV07IC8vIENoZWNrIGhvdyBtdWNoIHRoZSBwYXJ0aWNsZSBwZW5ldHJhdGVzIHRoZSBwb2x5Z29uIHBsYW5lLgoKICAgICAgICAgIHhpLnZzdWIodmVydHNbMF0sIGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwogICAgICAgICAgY29uc3QgcGVuZXRyYXRpb24gPSAtbm9ybWFsLmRvdChjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlKTsKCiAgICAgICAgICBpZiAobWluUGVuZXRyYXRpb24gPT09IG51bGwgfHwgTWF0aC5hYnMocGVuZXRyYXRpb24pIDwgTWF0aC5hYnMobWluUGVuZXRyYXRpb24pKSB7CiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtaW5QZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZUluZGV4ID0gaTsKICAgICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuY29weShub3JtYWwpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHBlbmV0cmF0ZWRGYWNlSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAvLyBTZXR1cCBjb250YWN0CiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLnNjYWxlKG1pblBlbmV0cmF0aW9uLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsgLy8gcmogaXMgdGhlIHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgZmFjZQoKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudmFkZCh4aSwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICB3b3JsZFBlbmV0cmF0aW9uVmVjLnZzdWIoeGosIHdvcmxkUGVuZXRyYXRpb25WZWMpOwogICAgICAgICAgci5yai5jb3B5KHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvL2NvbnN0IHByb2plY3RlZFRvRmFjZSA9IHhpLnZzdWIoeGopLnZhZGQod29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICAvL3Byb2plY3RlZFRvRmFjZS5jb3B5KHIucmopOwogICAgICAgICAgLy9xai52bXVsdChyLnJqLHIucmopOwoKICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2FybignUG9pbnQgZm91bmQgaW5zaWRlIGNvbnZleCwgYnV0IGRpZCBub3QgZmluZCBwZW5ldHJhdGluZyBmYWNlIScpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXIoaGZTaGFwZSwgY29udmV4U2hhcGUsIGhmUG9zLCBjb252ZXhQb3MsIGhmUXVhdCwgY29udmV4UXVhdCwgaGZCb2R5LCBjb252ZXhCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHBhcnRpY2xlQ3lsaW5kZXIoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZVRyaW1lc2goc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgc3BoZXJlUG9zLCB0cmltZXNoUG9zLCBzcGhlcmVRdWF0LCB0cmltZXNoUXVhdCwgc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBlZGdlVmVydGV4QSA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEE7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhCID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QjsKICAgICAgY29uc3QgZWRnZVZlY3RvciA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvcjsKICAgICAgY29uc3QgZWRnZVZlY3RvclVuaXQgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0OwogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVQb3M7CiAgICAgIGNvbnN0IHRtcCA9IHNwaGVyZVRyaW1lc2hfdG1wOwogICAgICBjb25zdCBsb2NhbFNwaGVyZUFBQkIgPSBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlQUFCQjsKICAgICAgY29uc3QgdjIgPSBzcGhlcmVUcmltZXNoX3YyOwogICAgICBjb25zdCByZWxwb3MgPSBzcGhlcmVUcmltZXNoX3JlbHBvczsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gc3BoZXJlVHJpbWVzaF90cmlhbmdsZXM7IC8vIENvbnZlcnQgc3BoZXJlIHBvc2l0aW9uIHRvIGxvY2FsIGluIHRoZSB0cmltZXNoCgogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHNwaGVyZVBvcywgbG9jYWxTcGhlcmVQb3MpOyAvLyBHZXQgdGhlIGFhYmIgb2YgdGhlIHNwaGVyZSBsb2NhbGx5IGluIHRoZSB0cmltZXNoCgogICAgICBjb25zdCBzcGhlcmVSYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGxvY2FsU3BoZXJlQUFCQi5sb3dlckJvdW5kLnNldChsb2NhbFNwaGVyZVBvcy54IC0gc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy55IC0gc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy56IC0gc3BoZXJlUmFkaXVzKTsKICAgICAgbG9jYWxTcGhlcmVBQUJCLnVwcGVyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggKyBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgKyBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogKyBzcGhlcmVSYWRpdXMpOwogICAgICB0cmltZXNoU2hhcGUuZ2V0VHJpYW5nbGVzSW5BQUJCKGxvY2FsU3BoZXJlQUFCQiwgdHJpYW5nbGVzKTsgLy9mb3IgKGxldCBpID0gMDsgaSA8IHRyaW1lc2hTaGFwZS5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgdHJpYW5nbGVzLnB1c2goaSk7IC8vIEFsbAogICAgICAvLyBWZXJ0aWNlcwoKICAgICAgY29uc3QgdiA9IHNwaGVyZVRyaW1lc2hfdjsKICAgICAgY29uc3QgcmFkaXVzU3F1YXJlZCA9IHNwaGVyZVNoYXBlLnJhZGl1cyAqIHNwaGVyZVNoYXBlLnJhZGl1czsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCB2KTsgLy8gQ2hlY2sgdmVydGV4IG92ZXJsYXAgaW4gc3BoZXJlCgogICAgICAgICAgdi52c3ViKGxvY2FsU3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgIGlmIChyZWxwb3MubGVuZ3RoU3F1YXJlZCgpIDw9IHJhZGl1c1NxdWFyZWQpIHsKICAgICAgICAgICAgLy8gU2FmZSB1cAogICAgICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHYyLCB2KTsKICAgICAgICAgICAgdi52c3ViKHNwaGVyZVBvcywgcmVscG9zKTsKCiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCBzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICAgIHIubmkuY29weShyZWxwb3MpOwogICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOyAvLyByaSBpcyB0aGUgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byB0aGUgc3BoZXJlIHN1cmZhY2UKCiAgICAgICAgICAgIHIucmkuY29weShyLm5pKTsKICAgICAgICAgICAgci5yaS5zY2FsZShzcGhlcmVTaGFwZS5yYWRpdXMsIHIucmkpOwogICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICByLnJqLmNvcHkodik7CiAgICAgICAgICAgIHIucmoudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7IC8vIFN0b3JlIHJlc3VsdAoKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBhbGwgZWRnZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaWFuZ2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyBqXSwgZWRnZVZlcnRleEEpOwogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgKGogKyAxKSAlIDNdLCBlZGdlVmVydGV4Qik7CiAgICAgICAgICBlZGdlVmVydGV4Qi52c3ViKGVkZ2VWZXJ0ZXhBLCBlZGdlVmVjdG9yKTsgLy8gUHJvamVjdCBzcGhlcmUgcG9zaXRpb24gdG8gdGhlIGVkZ2UKCiAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhCLCB0bXApOwogICAgICAgICAgY29uc3QgcG9zaXRpb25BbG9uZ0VkZ2VCID0gdG1wLmRvdChlZGdlVmVjdG9yKTsKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICBsZXQgcG9zaXRpb25BbG9uZ0VkZ2VBID0gdG1wLmRvdChlZGdlVmVjdG9yKTsKCiAgICAgICAgICBpZiAocG9zaXRpb25BbG9uZ0VkZ2VBID4gMCAmJiBwb3NpdGlvbkFsb25nRWRnZUIgPCAwKSB7CiAgICAgICAgICAgIC8vIE5vdyBjaGVjayB0aGUgb3J0aG9nb25hbCBkaXN0YW5jZSBmcm9tIGVkZ2UgdG8gc3BoZXJlIGNlbnRlcgogICAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhBLCB0bXApOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5jb3B5KGVkZ2VWZWN0b3IpOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgcG9zaXRpb25BbG9uZ0VkZ2VBID0gdG1wLmRvdChlZGdlVmVjdG9yVW5pdCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LnNjYWxlKHBvc2l0aW9uQWxvbmdFZGdlQSwgdG1wKTsKICAgICAgICAgICAgdG1wLnZhZGQoZWRnZVZlcnRleEEsIHRtcCk7IC8vIHRtcCBpcyBub3cgdGhlIHNwaGVyZSBjZW50ZXIgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBlZGdlLCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2ggZnJhbWUKCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0bXAuZGlzdGFuY2VUbyhsb2NhbFNwaGVyZVBvcyk7CgogICAgICAgICAgICBpZiAoZGlzdCA8IHNwaGVyZVNoYXBlLnJhZGl1cykgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgICB0bXAudnN1Yihsb2NhbFNwaGVyZVBvcywgci5uaSk7CiAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByLm5pLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52YWRkKHNwaGVyZVBvcywgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdG1wLCB0bXApOwogICAgICAgICAgICAgIHRtcC52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLnJpLCByLnJpKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBUcmlhbmdsZSBmYWNlcwoKCiAgICAgIGNvbnN0IHZhID0gc3BoZXJlVHJpbWVzaF92YTsKICAgICAgY29uc3QgdmIgPSBzcGhlcmVUcmltZXNoX3ZiOwogICAgICBjb25zdCB2YyA9IHNwaGVyZVRyaW1lc2hfdmM7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHNwaGVyZVRyaW1lc2hfbm9ybWFsOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VHJpYW5nbGVWZXJ0aWNlcyh0cmlhbmdsZXNbaV0sIHZhLCB2YiwgdmMpOwogICAgICAgIHRyaW1lc2hTaGFwZS5nZXROb3JtYWwodHJpYW5nbGVzW2ldLCBub3JtYWwpOwogICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIodmEsIHRtcCk7CiAgICAgICAgbGV0IGRpc3QgPSB0bXAuZG90KG5vcm1hbCk7CiAgICAgICAgbm9ybWFsLnNjYWxlKGRpc3QsIHRtcCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih0bXAsIHRtcCk7IC8vIHRtcCBpcyBub3cgdGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIHRyaWFuZ2xlIHBsYW5lCgogICAgICAgIGRpc3QgPSB0bXAuZGlzdGFuY2VUbyhsb2NhbFNwaGVyZVBvcyk7CgogICAgICAgIGlmIChSYXkucG9pbnRJblRyaWFuZ2xlKHRtcCwgdmEsIHZiLCB2YykgJiYgZGlzdCA8IHNwaGVyZVNoYXBlLnJhZGl1cykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICByLm5pLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihzcGhlcmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdG1wLCB0bXApOwogICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5uaSwgci5uaSk7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLnJpLCByLnJpKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KCiAgICBwbGFuZVRyaW1lc2gocGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBwbGFuZVBvcywgdHJpbWVzaFBvcywgcGxhbmVRdWF0LCB0cmltZXNoUXVhdCwgcGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIE1ha2UgY29udGFjdHMhCiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBub3JtYWwgPSBwbGFuZVRyaW1lc2hfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLnZlcnRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCB2ZXJ0ZXggZnJvbSB0cmltZXNoCiAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleChpLCB2KTsgLy8gU2FmZSB1cAoKICAgICAgICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgICAgICAgdjIuY29weSh2KTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHYyLCB2KTsgLy8gQ2hlY2sgcGxhbmUgc2lkZQoKICAgICAgICBjb25zdCByZWxwb3MgPSBwbGFuZVRyaW1lc2hfcmVscG9zOwogICAgICAgIHYudnN1YihwbGFuZVBvcywgcmVscG9zKTsKICAgICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgdHJpbWVzaEJvZHksIHBsYW5lU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwKICAgICAgICAgIC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVUcmltZXNoX3Byb2plY3RlZDsKICAgICAgICAgIG5vcm1hbC5zY2FsZShyZWxwb3MuZG90KG5vcm1hbCksIHByb2plY3RlZCk7CiAgICAgICAgICB2LnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOyAvLyByaSBpcyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgICAgci5yaS5jb3B5KHByb2plY3RlZCk7CiAgICAgICAgICByLnJpLnZzdWIocGxhbmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgIHIucmoudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7IC8vIFN0b3JlIHJlc3VsdAoKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IC8vIGNvbnZleFRyaW1lc2goCiAgICAvLyAgIHNpOiBDb252ZXhQb2x5aGVkcm9uLCBzajogVHJpbWVzaCwgeGk6IFZlYzMsIHhqOiBWZWMzLCBxaTogUXVhdGVybmlvbiwgcWo6IFF1YXRlcm5pb24sCiAgICAvLyAgIGJpOiBCb2R5LCBiajogQm9keSwgcnNpPzogU2hhcGUgfCBudWxsLCByc2o/OiBTaGFwZSB8IG51bGwsCiAgICAvLyAgIGZhY2VMaXN0QT86IG51bWJlcltdIHwgbnVsbCwgZmFjZUxpc3RCPzogbnVtYmVyW10gfCBudWxsLAogICAgLy8gKSB7CiAgICAvLyAgIGNvbnN0IHNlcEF4aXMgPSBjb252ZXhDb252ZXhfc2VwQXhpczsKICAgIC8vICAgaWYoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKXsKICAgIC8vICAgICAgIHJldHVybjsKICAgIC8vICAgfQogICAgLy8gICAvLyBDb25zdHJ1Y3QgYSB0ZW1wIGh1bGwgZm9yIGVhY2ggdHJpYW5nbGUKICAgIC8vICAgY29uc3QgaHVsbEIgPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgLy8gICBodWxsQi5mYWNlcyA9IFtbMCwxLDJdXTsKICAgIC8vICAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogICAgLy8gICBjb25zdCB2YiA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICAgIC8vICAgaHVsbEIudmVydGljZXMgPSBbCiAgICAvLyAgICAgICB2YSwKICAgIC8vICAgICAgIHZiLAogICAgLy8gICAgICAgdmMKICAgIC8vICAgXTsKICAgIC8vICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzai5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgLy8gICAgICAgY29uc3QgdHJpYW5nbGVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgLy8gICAgICAgc2ouZ2V0Tm9ybWFsKGksIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgIGh1bGxCLmZhY2VOb3JtYWxzID0gW3RyaWFuZ2xlTm9ybWFsXTsKICAgIC8vICAgICAgIHNqLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgdmEsIHZiLCB2Yyk7CiAgICAvLyAgICAgICBsZXQgZCA9IHNpLnRlc3RTZXBBeGlzKHRyaWFuZ2xlTm9ybWFsLCBodWxsQiwgeGksIHFpLCB4aiwgcWopOwogICAgLy8gICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgIHRyaWFuZ2xlTm9ybWFsLnNjYWxlKC0xLCB0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICAgICAgZCA9IHNpLnRlc3RTZXBBeGlzKHRyaWFuZ2xlTm9ybWFsLCBodWxsQiwgeGksIHFpLCB4aiwgcWopOwogICAgLy8gICAgICAgICAgIGlmKCFkKXsKICAgIC8vICAgICAgICAgICAgICAgY29udGludWU7CiAgICAvLyAgICAgICAgICAgfQogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgY29uc3QgcmVzOiBDb252ZXhQb2x5aGVkcm9uQ29udGFjdFBvaW50W10gPSBbXTsKICAgIC8vICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgIC8vICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSxxaSxodWxsQix4aixxaix0cmlhbmdsZU5vcm1hbCwtMTAwLDEwMCxyZXMpOwogICAgLy8gICAgICAgZm9yKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKXsKICAgIC8vICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksYmosc2ksc2oscnNpLHJzaiksCiAgICAvLyAgICAgICAgICAgICAgIHJpID0gci5yaSwKICAgIC8vICAgICAgICAgICAgICAgcmogPSByLnJqOwogICAgLy8gICAgICAgICAgIHIubmkuY29weSh0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAvLyAgICAgICAgICAgcmVzW2pdLm5vcm1hbC5uZWdhdGUocSk7CiAgICAvLyAgICAgICAgICAgcS5tdWx0KHJlc1tqXS5kZXB0aCwgcSk7CiAgICAvLyAgICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgLy8gICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsKICAgIC8vICAgICAgICAgICAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCiAgICAvLyAgICAgICAgICAgcmkudnN1Yih4aSxyaSk7CiAgICAvLyAgICAgICAgICAgcmoudnN1Yih4aixyaik7CiAgICAvLyAgICAgICAgICAgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKICAgIC8vICAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAvLyAgICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgLy8gICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgIC8vICAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAvLyAgICAgICAgICAgcmVzdWx0LnB1c2gocik7CiAgICAvLyAgICAgICB9CiAgICAvLyAgIH0KICAgIC8vIH0KCgogIH0KCiAgY29uc3QgYXZlcmFnZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRCID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0MSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgdG1wUXVhdDIgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHBsYW5lVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lVHJpbWVzaF9yZWxwb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lVHJpbWVzaF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhBID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVQb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZhID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZiID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lX3RvX3NwaGVyZV9vcnRobyA9IG5ldyBWZWMzKCk7IC8vIFNlZSBodHRwOi8vYnVsbGV0cGh5c2ljcy5jb20vQnVsbGV0L0J1bGxldEZ1bGwvU3BoZXJlVHJpYW5nbGVEZXRlY3Rvcl84Y3BwX3NvdXJjZS5odG1sCgogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX3Z0cCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIHBvaW50SW5Qb2x5Z29uKHZlcnRzLCBub3JtYWwsIHApIHsKICAgIGxldCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICBjb25zdCBOID0gdmVydHMubGVuZ3RoOwoKICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBHZXQgZWRnZSB0byB0aGUgbmV4dCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IGVkZ2UgPSBwb2ludEluUG9seWdvbl9lZGdlOwogICAgICB2ZXJ0c1soaSArIDEpICUgTl0udnN1Yih2LCBlZGdlKTsgLy8gR2V0IGNyb3NzIHByb2R1Y3QgYmV0d2VlbiBwb2x5Z29uIG5vcm1hbCBhbmQgdGhlIGVkZ2UKCiAgICAgIGNvbnN0IGVkZ2VfeF9ub3JtYWwgPSBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsOyAvL2NvbnN0IGVkZ2VfeF9ub3JtYWwgPSBuZXcgVmVjMygpOwoKICAgICAgZWRnZS5jcm9zcyhub3JtYWwsIGVkZ2VfeF9ub3JtYWwpOyAvLyBHZXQgdmVjdG9yIGJldHdlZW4gcG9pbnQgYW5kIGN1cnJlbnQgdmVydGV4CgogICAgICBjb25zdCB2ZXJ0ZXhfdG9fcCA9IHBvaW50SW5Qb2x5Z29uX3Z0cDsKICAgICAgcC52c3ViKHYsIHZlcnRleF90b19wKTsgLy8gVGhpcyBkb3QgcHJvZHVjdCBkZXRlcm1pbmVzIHdoaWNoIHNpZGUgb2YgdGhlIGVkZ2UgdGhlIHBvaW50IGlzCgogICAgICBjb25zdCByID0gZWRnZV94X25vcm1hbC5kb3QodmVydGV4X3RvX3ApOyAvLyBJZiBhbGwgc3VjaCBkb3QgcHJvZHVjdHMgaGF2ZSBzYW1lIHNpZ24sIHdlIGFyZSBpbnNpZGUgdGhlIHBvbHlnb24uCgogICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwgfHwgciA+IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IHRydWUgfHwgciA8PSAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCkgewogICAgICAgICAgcG9zaXRpdmVSZXN1bHQgPSByID4gMDsKICAgICAgICB9CgogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICB9CiAgICB9IC8vIElmIHdlIGdvdCBoZXJlLCBhbGwgZG90IHByb2R1Y3RzIHdlcmUgb2YgdGhlIHNhbWUgc2lnbi4KCgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBjb25zdCBib3hfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlcyA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKICBjb25zdCBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2VVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZENvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF92ID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcHJvamVjdGVkID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfc2VwQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4Q29udmV4X3EgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlU3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7IC8vIFdJUAoKICBjb25zdCBjcWogPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX2xvY2FsID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfdG1wMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfdG1wMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3QgPSBbMF07CiAgY29uc3Qgc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMiA9IG5ldyBWZWMzKCk7CgogIGNsYXNzIE92ZXJsYXBLZWVwZXIgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5jdXJyZW50ID0gdm9pZCAwOwogICAgICB0aGlzLnByZXZpb3VzID0gdm9pZCAwOwogICAgICB0aGlzLmN1cnJlbnQgPSBbXTsKICAgICAgdGhpcy5wcmV2aW91cyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBnZXRLZXkKICAgICAqLwoKCiAgICBnZXRLZXkoaSwgaikgewogICAgICBpZiAoaiA8IGkpIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIGkgPDwgMTYgfCBqOwogICAgfQogICAgLyoqCiAgICAgKiBzZXQKICAgICAqLwoKCiAgICBzZXQoaSwgaikgewogICAgICAvLyBJbnNlcnRpb24gc29ydC4gVGhpcyB3YXkgdGhlIGRpZmYgd2lsbCBoYXZlIGxpbmVhciBjb21wbGV4aXR5LgogICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleShpLCBqKTsKICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgICAgbGV0IGluZGV4ID0gMDsKCiAgICAgIHdoaWxlIChrZXkgPiBjdXJyZW50W2luZGV4XSkgewogICAgICAgIGluZGV4Kys7CiAgICAgIH0KCiAgICAgIGlmIChrZXkgPT09IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgcmV0dXJuOyAvLyBQYWlyIHdhcyBhbHJlYWR5IGFkZGVkCiAgICAgIH0KCiAgICAgIGZvciAobGV0IGogPSBjdXJyZW50Lmxlbmd0aCAtIDE7IGogPj0gaW5kZXg7IGotLSkgewogICAgICAgIGN1cnJlbnRbaiArIDFdID0gY3VycmVudFtqXTsKICAgICAgfQoKICAgICAgY3VycmVudFtpbmRleF0gPSBrZXk7CiAgICB9CiAgICAvKioKICAgICAqIHRpY2sKICAgICAqLwoKCiAgICB0aWNrKCkgewogICAgICBjb25zdCB0bXAgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMucHJldmlvdXM7CiAgICAgIHRoaXMucHJldmlvdXMgPSB0bXA7CiAgICAgIHRoaXMuY3VycmVudC5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBnZXREaWZmCiAgICAgKi8KCgogICAgZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIGNvbnN0IGIgPSB0aGlzLnByZXZpb3VzOwogICAgICBjb25zdCBhbCA9IGEubGVuZ3RoOwogICAgICBjb25zdCBibCA9IGIubGVuZ3RoOwogICAgICBsZXQgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlBID0gYVtpXTsKCiAgICAgICAgd2hpbGUgKGtleUEgPiBiW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGtleUEgPT09IGJbal07CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2goYWRkaXRpb25zLCBrZXlBKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGogPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibDsgaSsrKSB7CiAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgY29uc3Qga2V5QiA9IGJbaV07CgogICAgICAgIHdoaWxlIChrZXlCID4gYVtqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KCiAgICAgICAgZm91bmQgPSBhW2pdID09PSBrZXlCOwoKICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICB1bnBhY2tBbmRQdXNoKHJlbW92YWxzLCBrZXlCKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQoKICBmdW5jdGlvbiB1bnBhY2tBbmRQdXNoKGFycmF5LCBrZXkpIHsKICAgIGFycmF5LnB1c2goKGtleSAmIDB4ZmZmZjAwMDApID4+IDE2LCBrZXkgJiAweDAwMDBmZmZmKTsKICB9CiAgLyoqCiAgICogVHVwbGVEaWN0aW9uYXJ5CiAgICovCgoKICBjbGFzcyBUdXBsZURpY3Rpb25hcnkgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZGF0YSA9IHsKICAgICAgICBrZXlzOiBbXQogICAgICB9OwogICAgfQogICAgLyoqIGdldCAqLwoKCiAgICBnZXQoaSwgaikgewogICAgICBpZiAoaSA+IGopIHsKICAgICAgICAvLyBzd2FwCiAgICAgICAgY29uc3QgdGVtcCA9IGo7CiAgICAgICAgaiA9IGk7CiAgICAgICAgaSA9IHRlbXA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmRhdGFbaSArICItIiArIGpdOwogICAgfQogICAgLyoqIHNldCAqLwoKCiAgICBzZXQoaSwgaiwgdmFsdWUpIHsKICAgICAgaWYgKGkgPiBqKSB7CiAgICAgICAgY29uc3QgdGVtcCA9IGo7CiAgICAgICAgaiA9IGk7CiAgICAgICAgaSA9IHRlbXA7CiAgICAgIH0KCiAgICAgIGNvbnN0IGtleSA9IGkgKyAiLSIgKyBqOyAvLyBDaGVjayBpZiBrZXkgYWxyZWFkeSBleGlzdHMKCiAgICAgIGlmICghdGhpcy5nZXQoaSwgaikpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZGF0YVtrZXldID0gdmFsdWU7CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBUaGUgcGh5c2ljcyB3b3JsZAogICAqLwoKCiAgY2xhc3MgV29ybGQgZXh0ZW5kcyBFdmVudFRhcmdldCB7CiAgICAvKioKICAgICAqIEN1cnJlbnRseSAvIGxhc3QgdXNlZCB0aW1lc3RlcC4gSXMgc2V0IHRvIC0xIGlmIG5vdCBhdmFpbGFibGUuIFRoaXMgdmFsdWUgaXMgdXBkYXRlZCBiZWZvcmUgZWFjaCBpbnRlcm5hbCBzdGVwLCB3aGljaCBtZWFucyB0aGF0IGl0IGlzICJmcmVzaCIgaW5zaWRlIGV2ZW50IGNhbGxiYWNrcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTWFrZXMgYm9kaWVzIGdvIHRvIHNsZWVwIHdoZW4gdGhleSd2ZSBiZWVuIGluYWN0aXZlLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIHRoZSBjdXJyZW50IGNvbnRhY3RzIChpbnN0YW5jZXMgb2YgQ29udGFjdEVxdWF0aW9uKSBpbiB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEhvdyBvZnRlbiB0byBub3JtYWxpemUgcXVhdGVybmlvbnMuIFNldCB0byAwIGZvciBldmVyeSBzdGVwLCAxIGZvciBldmVyeSBzZWNvbmQgZXRjLi4gQSBsYXJnZXIgdmFsdWUgaW5jcmVhc2VzIHBlcmZvcm1hbmNlLiBJZiBib2RpZXMgdGVuZCB0byBleHBsb2RlLCBzZXQgdG8gYSBzbWFsbGVyIHZhbHVlICh6ZXJvIHRvIGJlIHN1cmUgbm90aGluZyBjYW4gZ28gd3JvbmcpLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gdHJ1ZSB0byB1c2UgZmFzdCBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24uIEl0IGlzIG9mdGVuIGVub3VnaCBhY2N1cmF0ZSB0byB1c2UuCiAgICAgKiBJZiBib2RpZXMgdGVuZCB0byBleHBsb2RlLCBzZXQgdG8gZmFsc2UuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgd2FsbC1jbG9jayB0aW1lIHNpbmNlIHNpbXVsYXRpb24gc3RhcnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE51bWJlciBvZiB0aW1lc3RlcHMgdGFrZW4gc2luY2Ugc3RhcnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIERlZmF1bHQgYW5kIGxhc3QgdGltZXN0ZXAgc2l6ZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBncmF2aXR5IG9mIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIG1hdGVyaWFscy4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKiBAdG9kbyBSZW1vdmUKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuZHQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb250YWN0cyA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucyA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IHZvaWQgMDsKICAgICAgdGhpcy50aW1lID0gdm9pZCAwOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IHZvaWQgMDsKICAgICAgdGhpcy5uZXh0SWQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZ3Jhdml0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5icm9hZHBoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLmJvZGllcyA9IHZvaWQgMDsKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc29sdmVyID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gdm9pZCAwOwogICAgICB0aGlzLm5hcnJvd3BoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlciA9IHZvaWQgMDsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGVmYXVsdE1hdGVyaWFsID0gdm9pZCAwOwogICAgICB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJvZmlsZSA9IHZvaWQgMDsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IHZvaWQgMDsKICAgICAgdGhpcy5zdWJzeXN0ZW1zID0gdm9pZCAwOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHZvaWQgMDsKICAgICAgdGhpcy5yZW1vdmVCb2R5RXZlbnQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWRUb0JvZHlNYXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuZHQgPSAtMTsKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gISFvcHRpb25zLmFsbG93U2xlZXA7CiAgICAgIHRoaXMuY29udGFjdHMgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucyA9IFtdOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVTa2lwID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplU2tpcCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplU2tpcCA6IDA7CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZUZhc3QgPSBvcHRpb25zLnF1YXROb3JtYWxpemVGYXN0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVGYXN0IDogZmFsc2U7CiAgICAgIHRoaXMudGltZSA9IDAuMDsKICAgICAgdGhpcy5zdGVwbnVtYmVyID0gMDsKICAgICAgdGhpcy5kZWZhdWx0X2R0ID0gMSAvIDYwOwogICAgICB0aGlzLm5leHRJZCA9IDA7CiAgICAgIHRoaXMuZ3Jhdml0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5ncmF2aXR5KSB7CiAgICAgICAgdGhpcy5ncmF2aXR5LmNvcHkob3B0aW9ucy5ncmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLm1hdGVyaWFscyA9IFtdOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG51bWJlciBvZiBvYmplY3RzIGluIHRoZSB3b3JsZC4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KCgogICAgbnVtT2JqZWN0cygpIHsKICAgICAgcmV0dXJuIHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zID0ge30sIGNhbGxiYWNrKSB7CiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5BTEw7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHN0b3AgYXQgdGhlIGZpcnN0IHJlc3VsdC4gTm90ZSB0aGF0IHRoZSBvcmRlciBpcyByYW5kb20gLSBidXQgdGhlIG1ldGhvZCBpcyBmYXN0LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdEFueShmcm9tLCB0bywgb3B0aW9ucyA9IHt9LCByZXN1bHQpIHsKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkFOWTsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCByZXR1cm4gaW5mb3JtYXRpb24gb2YgdGhlIGNsb3Nlc3QgaGl0LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdENsb3Nlc3QoZnJvbSwgdG8sIG9wdGlvbnMgPSB7fSwgcmVzdWx0KSB7CiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBtYXRlcmlhbCB0byB0aGUgV29ybGQuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICogQHRvZG8gUmVtb3ZlCiAgICAgKi8KCgogICAgYWRkTWF0ZXJpYWwobSkgewogICAgICB0aGlzLm1hdGVyaWFscy5wdXNoKG0pOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIGEgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgV29ybGQKICAgICAqLwoKCiAgICBhZGRDb250YWN0TWF0ZXJpYWwoY21hdCkgewogICAgICAvLyBBZGQgY29udGFjdCBtYXRlcmlhbAogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMucHVzaChjbWF0KTsgLy8gQWRkIGN1cnJlbnQgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgbWF0ZXJpYWwgdGFibGUKCiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuc2V0KGNtYXQubWF0ZXJpYWxzWzBdLmlkLCBjbWF0Lm1hdGVyaWFsc1sxXS5pZCwgY21hdCk7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwuCiAgICAgKiBAc2VlIGh0dHBzOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDE4MDQyNjE1NDUzMS9odHRwOi8vYnVsbGV0cGh5c2ljcy5vcmcvbWVkaWF3aWtpLTEuNS44L2luZGV4LnBocC9TdGVwcGluZ19UaGVfV29ybGQjV2hhdF9kb190aGVfcGFyYW1ldGVyc190b19idER5bmFtaWNzV29ybGQ6OnN0ZXBTaW11bGF0aW9uX21lYW4uM0YKICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgLy8gZml4ZWQgdGltZXN0ZXBwaW5nIHdpdGhvdXQgaW50ZXJwb2xhdGlvbgogICAgICogICAgIHdvcmxkLnN0ZXAoMSAvIDYwKQogICAgICovCgoKICAgIHN0ZXAoZHQsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzID0gMTApIHsKICAgICAgaWYgKHRpbWVTaW5jZUxhc3RDYWxsZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIEZpeGVkLCBzaW1wbGUgc3RlcHBpbmcKICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7IC8vIEluY3JlbWVudCB0aW1lCgogICAgICAgIHRoaXMudGltZSArPSBkdDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgICAgY29uc3QgdDAgPSBwZXJmb3JtYW5jZSQxLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2UkMS5ub3coKSAtIHQwID4gZHQgKiAxMDAwKSB7CiAgICAgICAgICAgIC8vIFRoZSBmcmFtZXJhdGUgaXMgbm90IGludGVyYWN0aXZlIGFueW1vcmUuCiAgICAgICAgICAgIC8vIFdlIGFyZSBiZWxvdyB0aGUgdGFyZ2V0IGZyYW1lcmF0ZS4KICAgICAgICAgICAgLy8gQmV0dGVyIGJhaWwgb3V0LgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9IC8vIFJlbW92ZSB0aGUgZXhjZXNzIGFjY3VtdWxhdG9yLCBzaW5jZSB3ZSBtYXkgbm90CiAgICAgICAgLy8gaGF2ZSBoYWQgZW5vdWdoIHN1YnN0ZXBzIGF2YWlsYWJsZSB0byBjYXRjaCB1cAoKCiAgICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IHRoaXMuYWNjdW11bGF0b3IgJSBkdDsKICAgICAgICBjb25zdCB0ID0gdGhpcy5hY2N1bXVsYXRvciAvIGR0OwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gdGhpcy5ib2RpZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmJvZGllc1tqXTsKICAgICAgICAgIGIucHJldmlvdXNQb3NpdGlvbi5sZXJwKGIucG9zaXRpb24sIHQsIGIuaW50ZXJwb2xhdGVkUG9zaXRpb24pOwogICAgICAgICAgYi5wcmV2aW91c1F1YXRlcm5pb24uc2xlcnAoYi5xdWF0ZXJuaW9uLCB0LCBiLmludGVycG9sYXRlZFF1YXRlcm5pb24pOwogICAgICAgICAgYi5wcmV2aW91c1F1YXRlcm5pb24ubm9ybWFsaXplKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnRpbWUgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgfQogICAgfQoKICAgIGludGVybmFsU3RlcChkdCkgewogICAgICB0aGlzLmR0ID0gZHQ7CiAgICAgIGNvbnN0IGNvbnRhY3RzID0gdGhpcy5jb250YWN0czsKICAgICAgY29uc3QgcDEgPSBXb3JsZF9zdGVwX3AxOwogICAgICBjb25zdCBwMiA9IFdvcmxkX3N0ZXBfcDI7CiAgICAgIGNvbnN0IE4gPSB0aGlzLm51bU9iamVjdHMoKTsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IHNvbHZlciA9IHRoaXMuc29sdmVyOwogICAgICBjb25zdCBncmF2aXR5ID0gdGhpcy5ncmF2aXR5OwogICAgICBjb25zdCBkb1Byb2ZpbGluZyA9IHRoaXMuZG9Qcm9maWxpbmc7CiAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnByb2ZpbGU7CiAgICAgIGNvbnN0IERZTkFNSUMgPSBCb2R5LkRZTkFNSUM7CiAgICAgIGxldCBwcm9maWxpbmdTdGFydCA9IC1JbmZpbml0eTsKICAgICAgY29uc3QgY29uc3RyYWludHMgPSB0aGlzLmNvbnN0cmFpbnRzOwogICAgICBjb25zdCBmcmljdGlvbkVxdWF0aW9uUG9vbCA9IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgIGdyYXZpdHkubGVuZ3RoKCk7CiAgICAgIGNvbnN0IGd4ID0gZ3Jhdml0eS54OwogICAgICBjb25zdCBneSA9IGdyYXZpdHkueTsKICAgICAgY29uc3QgZ3ogPSBncmF2aXR5Lno7CiAgICAgIGxldCBpID0gMDsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2UkMS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2UkMS5ub3coKTsKICAgICAgfQoKICAgICAgcDEubGVuZ3RoID0gMDsgLy8gQ2xlYW4gdXAgcGFpciBhcnJheXMgZnJvbSBsYXN0IHN0ZXAKCiAgICAgIHAyLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5jb2xsaXNpb25QYWlycyh0aGlzLCBwMSwgcDIpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5icm9hZHBoYXNlID0gcGVyZm9ybWFuY2UkMS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFJlbW92ZSBjb25zdHJhaW5lZCBwYWlycyB3aXRoIGNvbGxpZGVDb25uZWN0ZWQgPT0gZmFsc2UKCgogICAgICBsZXQgTmNvbnN0cmFpbnRzID0gY29uc3RyYWludHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTmNvbnN0cmFpbnRzOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gY29uc3RyYWludHNbaV07CgogICAgICAgIGlmICghYy5jb2xsaWRlQ29ubmVjdGVkKSB7CiAgICAgICAgICBmb3IgKGxldCBqID0gcDEubGVuZ3RoIC0gMTsgaiA+PSAwOyBqIC09IDEpIHsKICAgICAgICAgICAgaWYgKGMuYm9keUEgPT09IHAxW2pdICYmIGMuYm9keUIgPT09IHAyW2pdIHx8IGMuYm9keUIgPT09IHAxW2pdICYmIGMuYm9keUEgPT09IHAyW2pdKSB7CiAgICAgICAgICAgICAgcDEuc3BsaWNlKGosIDEpOwogICAgICAgICAgICAgIHAyLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhUaWNrKCk7IC8vIEdlbmVyYXRlIGNvbnRhY3RzCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlJDEubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2UkMS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIExvb3Agb3ZlciBhbGwgY29sbGlzaW9ucwoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2UkMS5ub3coKTsKICAgICAgfSAvLyBBZGQgYWxsIGZyaWN0aW9uIGVxcwoKCiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICBjb25zdCBuY29udGFjdHMgPSBjb250YWN0cy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gbmNvbnRhY3RzOyBrKyspIHsKICAgICAgICAvLyBDdXJyZW50IGNvbnRhY3QKICAgICAgICBjb25zdCBjID0gY29udGFjdHNba107IC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBpbmRlY2VzCgogICAgICAgIGNvbnN0IGJpID0gYy5iaTsKICAgICAgICBjb25zdCBiaiA9IGMuYmo7CiAgICAgICAgY29uc3Qgc2kgPSBjLnNpOwogICAgICAgIGNvbnN0IHNqID0gYy5zajsgLy8gR2V0IGNvbGxpc2lvbiBwcm9wZXJ0aWVzCgogICAgICAgIGxldCBjbTsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBjbSA9IHRoaXMuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjbSA9IHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsKICAgICAgICB9IC8vIGMuZW5hYmxlZCA9IGJpLmNvbGxpc2lvblJlc3BvbnNlICYmIGJqLmNvbGxpc2lvblJlc3BvbnNlICYmIHNpLmNvbGxpc2lvblJlc3BvbnNlICYmIHNqLmNvbGxpc2lvblJlc3BvbnNlOwoKCiAgICAgICAgY20uZnJpY3Rpb247IC8vIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgICAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICAgIGlmIChiaS5tYXRlcmlhbCAmJiBiai5tYXRlcmlhbCkgewogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLmZyaWN0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCkgewogICAgICAgICAgICBiaS5tYXRlcmlhbC5mcmljdGlvbiAqIGJqLm1hdGVyaWFsLmZyaWN0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChiaS5tYXRlcmlhbC5yZXN0aXR1dGlvbiA+PSAwICYmIGJqLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICAgICAgYy5yZXN0aXR1dGlvbiA9IGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uICogYmoubWF0ZXJpYWwucmVzdGl0dXRpb247CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBjLnNldFNwb29rUGFyYW1zKAogICAgICAgIC8vICAgICAgICAgICBjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sCiAgICAgICAgLy8gICAgICAgICAgIGR0CiAgICAgICAgLy8gICAgICAgKTsKCgogICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihjKTsgLy8gLy8gQWRkIGZyaWN0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgICAgICAvLyBpZihtdSA+IDApewogICAgICAgIC8vIAkvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIAljb25zdCBtdWcgPSBtdSAqIGdub3JtOwogICAgICAgIC8vIAljb25zdCByZWR1Y2VkTWFzcyA9IChiaS5pbnZNYXNzICsgYmouaW52TWFzcyk7CiAgICAgICAgLy8gCWlmKHJlZHVjZWRNYXNzID4gMCl7CiAgICAgICAgLy8gCQlyZWR1Y2VkTWFzcyA9IDEvcmVkdWNlZE1hc3M7CiAgICAgICAgLy8gCX0KICAgICAgICAvLyAJY29uc3QgcG9vbCA9IGZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIC8vIAljb25zdCBjMSA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJpLGJqLG11ZypyZWR1Y2VkTWFzcyk7CiAgICAgICAgLy8gCWNvbnN0IGMyID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5wdXNoKGMxLCBjMik7CiAgICAgICAgLy8gCWMxLmJpID0gYzIuYmkgPSBiaTsKICAgICAgICAvLyAJYzEuYmogPSBjMi5iaiA9IGJqOwogICAgICAgIC8vIAljMS5taW5Gb3JjZSA9IGMyLm1pbkZvcmNlID0gLW11ZypyZWR1Y2VkTWFzczsKICAgICAgICAvLyAJYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZypyZWR1Y2VkTWFzczsKICAgICAgICAvLyAJLy8gQ29weSBvdmVyIHRoZSByZWxhdGl2ZSB2ZWN0b3JzCiAgICAgICAgLy8gCWMxLnJpLmNvcHkoYy5yaSk7CiAgICAgICAgLy8gCWMxLnJqLmNvcHkoYy5yaik7CiAgICAgICAgLy8gCWMyLnJpLmNvcHkoYy5yaSk7CiAgICAgICAgLy8gCWMyLnJqLmNvcHkoYy5yaik7CiAgICAgICAgLy8gCS8vIENvbnN0cnVjdCB0YW5nZW50cwogICAgICAgIC8vIAljLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOwogICAgICAgIC8vICAgICAgICAgICAvLyBTZXQgc3Bvb2sgcGFyYW1zCiAgICAgICAgLy8gICAgICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCBkdCk7CiAgICAgICAgLy8gICAgICAgICAgIGMyLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCBkdCk7CiAgICAgICAgLy8gICAgICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gYy5lbmFibGVkOwogICAgICAgIC8vIAkvLyBBZGQgZXF1YXRpb25zIHRvIHNvbHZlcgogICAgICAgIC8vIAlzb2x2ZXIuYWRkRXF1YXRpb24oYzEpOwogICAgICAgIC8vIAlzb2x2ZXIuYWRkRXF1YXRpb24oYzIpOwogICAgICAgIC8vIH0KCiAgICAgICAgaWYgKGJpLmFsbG93U2xlZXAgJiYgYmkudHlwZSA9PT0gQm9keS5EWU5BTUlDICYmIGJpLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBiai50eXBlICE9PSBCb2R5LlNUQVRJQykgewogICAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkQiA9IGJqLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIGJqLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZEIgPSBiai5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgICBpZiAoc3BlZWRTcXVhcmVkQiA+PSBzcGVlZExpbWl0U3F1YXJlZEIgKiAyKSB7CiAgICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGJqLmFsbG93U2xlZXAgJiYgYmoudHlwZSA9PT0gQm9keS5EWU5BTUlDICYmIGJqLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBiaS50eXBlICE9PSBCb2R5LlNUQVRJQykgewogICAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkQSA9IGJpLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIGJpLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZEEgPSBiaS5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgICBpZiAoc3BlZWRTcXVhcmVkQSA+PSBzcGVlZExpbWl0U3F1YXJlZEEgKiAyKSB7CiAgICAgICAgICAgIGJqLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gLy8gTm93IHdlIGtub3cgdGhhdCBpIGFuZCBqIGFyZSBpbiBjb250YWN0LiBTZXQgY29sbGlzaW9uIG1hdHJpeCBzdGF0ZQoKCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0KGJpLCBiaiwgdHJ1ZSk7CgogICAgICAgIGlmICghdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cy5nZXQoYmksIGJqKSkgewogICAgICAgICAgLy8gRmlyc3QgY29udGFjdCEKICAgICAgICAgIC8vIFdlIHJldXNlIHRoZSBjb2xsaWRlRXZlbnQgb2JqZWN0LCBvdGhlcndpc2Ugd2Ugd2lsbCBlbmQgdXAgY3JlYXRpbmcgbmV3IG9iamVjdHMgZm9yIGVhY2ggbmV3IGNvbnRhY3QsIGV2ZW4gaWYgdGhlcmUncyBubyBldmVudCBsaXN0ZW5lciBhdHRhY2hlZC4KICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiajsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmNvbnRhY3QgPSBjOwogICAgICAgICAgYmkuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCk7CiAgICAgICAgICBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudC5ib2R5ID0gYmk7CiAgICAgICAgICBiai5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1pdENvbnRhY3RFdmVudHMoKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUubWFrZUNvbnRhY3RDb25zdHJhaW50cyA9IHBlcmZvcm1hbmNlJDEubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlJDEubm93KCk7CiAgICAgIH0gLy8gV2FrZSB1cCBib2RpZXMKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UpIHsKICAgICAgICAgIGJpLndha2VVcCgpOwogICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSAvLyBBZGQgdXNlci1hZGRlZCBjb25zdHJhaW50cwoKCiAgICAgIE5jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5jb25zdHJhaW50czsgaSsrKSB7CiAgICAgICAgY29uc3QgYyA9IGNvbnN0cmFpbnRzW2ldOwogICAgICAgIGMudXBkYXRlKCk7CgogICAgICAgIGZvciAobGV0IGogPSAwLCBOZXEgPSBjLmVxdWF0aW9ucy5sZW5ndGg7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICBjb25zdCBlcSA9IGMuZXF1YXRpb25zW2pdOwogICAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGVxKTsKICAgICAgICB9CiAgICAgIH0gLy8gU29sdmUgdGhlIGNvbnN0cmFpbmVkIHN5c3RlbQoKCiAgICAgIHNvbHZlci5zb2x2ZShkdCwgdGhpcyk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLnNvbHZlID0gcGVyZm9ybWFuY2UkMS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFJlbW92ZSBhbGwgY29udGFjdHMgZnJvbSBzb2x2ZXIKCgogICAgICBzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7IC8vIEFwcGx5IGRhbXBpbmcsIHNlZSBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvYnVsbGV0L2lzc3Vlcy9kZXRhaWw/aWQ9NzQgZm9yIGRldGFpbHMKCiAgICAgIGNvbnN0IHBvdyA9IE1hdGgucG93OwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS50eXBlICYgRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGxkID0gcG93KDEuMCAtIGJpLmxpbmVhckRhbXBpbmcsIGR0KTsKICAgICAgICAgIGNvbnN0IHYgPSBiaS52ZWxvY2l0eTsKICAgICAgICAgIHYuc2NhbGUobGQsIHYpOwogICAgICAgICAgY29uc3QgYXYgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CgogICAgICAgICAgaWYgKGF2KSB7CiAgICAgICAgICAgIGNvbnN0IGFkID0gcG93KDEuMCAtIGJpLmFuZ3VsYXJEYW1waW5nLCBkdCk7CiAgICAgICAgICAgIGF2LnNjYWxlKGFkLCBhdik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wcmVTdGVwRXZlbnQpOyAvLyBJbnZva2UgcHJlLXN0ZXAgY2FsbGJhY2tzCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnByZVN0ZXApIHsKICAgICAgICAgIGJpLnByZVN0ZXAuY2FsbChiaSk7CiAgICAgICAgfQogICAgICB9IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZSQxLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZSQxLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gVXBkYXRlIHN0ZXAgbnVtYmVyCgoKICAgICAgdGhpcy5zdGVwbnVtYmVyICs9IDE7CiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3Bvc3RTdGVwRXZlbnQpOyAvLyBJbnZva2UgcG9zdC1zdGVwIGNhbGxiYWNrcwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CiAgICAgICAgY29uc3QgcG9zdFN0ZXAgPSBiaS5wb3N0U3RlcDsKCiAgICAgICAgaWYgKHBvc3RTdGVwKSB7CiAgICAgICAgICBwb3N0U3RlcC5jYWxsKGJpKTsKICAgICAgICB9CiAgICAgIH0gLy8gU2xlZXBpbmcgdXBkYXRlCgoKICAgICAgbGV0IGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CgogICAgICBpZiAodGhpcy5hbGxvd1NsZWVwKSB7CiAgICAgICAgaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CgogICAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CiAgICAgICAgICBiaS5zbGVlcFRpY2sodGhpcy50aW1lKTsKCiAgICAgICAgICBpZiAoYmkuc2xlZXBTdGF0ZSAhPT0gQm9keS5TTEVFUElORykgewogICAgICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSBoYXNBY3RpdmVCb2RpZXM7CiAgICB9CgogICAgZW1pdENvbnRhY3RFdmVudHMoKSB7CiAgICAgIGNvbnN0IGhhc0JlZ2luQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0Jyk7CiAgICAgIGNvbnN0IGhhc0VuZENvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpbkNvbnRhY3QgfHwgaGFzRW5kQ29udGFjdCkgewogICAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIuZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKTsKICAgICAgfQoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYWRkaXRpb25zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUEgPSB0aGlzLmdldEJvZHlCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QiA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5Db250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUEgPSBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChoYXNFbmRDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQocmVtb3ZhbHNbaV0pOwogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpICsgMV0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVuZENvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUEgPSBlbmRDb250YWN0RXZlbnQuYm9keUIgPSBudWxsOwogICAgICB9CgogICAgICBhZGRpdGlvbnMubGVuZ3RoID0gcmVtb3ZhbHMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgaGFzQmVnaW5TaGFwZUNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2JlZ2luU2hhcGVDb250YWN0Jyk7CiAgICAgIGNvbnN0IGhhc0VuZFNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kU2hhcGVDb250YWN0Jyk7CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QgfHwgaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIuZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKTsKICAgICAgfQoKICAgICAgaWYgKGhhc0JlZ2luU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCBzaGFwZUEgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaV0pOwogICAgICAgICAgY29uc3Qgc2hhcGVCID0gdGhpcy5nZXRTaGFwZUJ5SWQoYWRkaXRpb25zW2kgKyAxXSk7CiAgICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IHNoYXBlQTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gc2hhcGVCOwogICAgICAgICAgaWYgKHNoYXBlQSkgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IHNoYXBlQi5ib2R5OwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGJlZ2luU2hhcGVDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZFNoYXBlQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVtb3ZhbHMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCBzaGFwZUEgPSB0aGlzLmdldFNoYXBlQnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChyZW1vdmFsc1tpICsgMV0pOwogICAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gc2hhcGVCOwogICAgICAgICAgaWYgKHNoYXBlQSkgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBzaGFwZUEuYm9keTsKICAgICAgICAgIGlmIChzaGFwZUIpIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kU2hhcGVDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyBhbGwgYm9keSBmb3JjZXMgaW4gdGhlIHdvcmxkIHRvIHplcm8uCiAgICAgKi8KCgogICAgY2xlYXJGb3JjZXMoKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgIGIuZm9yY2U7CiAgICAgICAgYi50b3JxdWU7CiAgICAgICAgYi5mb3JjZS5zZXQoMCwgMCwgMCk7CiAgICAgICAgYi50b3JxdWUuc2V0KDAsIDAsIDApOwogICAgICB9CiAgICB9CgogIH0gLy8gVGVtcCBzdHVmZgoKCiAgbmV3IEFBQkIoKTsKICBjb25zdCB0bXBSYXkgPSBuZXcgUmF5KCk7IC8vIHBlcmZvcm1hbmNlLm5vdygpIGZhbGxiYWNrIG9uIERhdGUubm93KCkKCiAgY29uc3QgcGVyZm9ybWFuY2UkMSA9IGdsb2JhbFRoaXMucGVyZm9ybWFuY2UgfHwge307CgogIGlmICghcGVyZm9ybWFuY2UkMS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZSQxLnRpbWluZyAmJiBwZXJmb3JtYW5jZSQxLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQpIHsKICAgICAgbm93T2Zmc2V0ID0gcGVyZm9ybWFuY2UkMS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlJDEubm93ID0gKCkgPT4gRGF0ZS5ub3coKSAtIG5vd09mZnNldDsKICB9IC8vIFJldXNhYmxlIGV2ZW50IG9iamVjdHMgdG8gc2F2ZSBtZW1vcnkuCgoKICBjb25zdCBXb3JsZF9zdGVwX3Bvc3RTdGVwRXZlbnQgPSB7CiAgICB0eXBlOiAncG9zdFN0ZXAnCiAgfTsgLy8gRGlzcGF0Y2hlZCBiZWZvcmUgdGhlIHdvcmxkIHN0ZXBzIGZvcndhcmQgaW4gdGltZS4KCiAgY29uc3QgV29ybGRfc3RlcF9wcmVTdGVwRXZlbnQgPSB7CiAgICB0eXBlOiAncHJlU3RlcCcKICB9OwogIGNvbnN0IFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50ID0gewogICAgdHlwZTogQm9keS5DT0xMSURFX0VWRU5UX05BTUUsCiAgICBib2R5OiBudWxsLAogICAgY29udGFjdDogbnVsbAogIH07IC8vIFBvb2xzIGZvciB1bnVzZWQgb2JqZWN0cwoKICBjb25zdCBXb3JsZF9zdGVwX29sZENvbnRhY3RzID0gW107CiAgY29uc3QgV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbCA9IFtdOyAvLyBSZXVzYWJsZSBhcnJheXMgZm9yIGNvbGxpc2lvbiBwYWlycwoKICBjb25zdCBXb3JsZF9zdGVwX3AxID0gW107CiAgY29uc3QgV29ybGRfc3RlcF9wMiA9IFtdOyAvLyBTdHVmZiBmb3IgZW1pdENvbnRhY3RFdmVudHMKCiAgY29uc3QgYWRkaXRpb25zID0gW107CiAgY29uc3QgcmVtb3ZhbHMgPSBbXTsKICBjb25zdCBiZWdpbkNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdiZWdpbkNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbAogIH07CiAgY29uc3QgZW5kQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2VuZENvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbAogIH07CiAgY29uc3QgYmVnaW5TaGFwZUNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdiZWdpblNoYXBlQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsLAogICAgc2hhcGVBOiBudWxsLAogICAgc2hhcGVCOiBudWxsCiAgfTsKICBjb25zdCBlbmRTaGFwZUNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRTaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CgogIGZ1bmN0aW9uIGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpIHsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdCb3gnOgogICAgICAgIHJldHVybiBuZXcgQm94KG5ldyBWZWMzKC4uLmFyZ3MubWFwKHYgPT4gdiAvIDIpKSk7CiAgICAgIC8vIGV4dGVudHMgPT4gaGFsZkV4dGVudHMKCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIGNvbnN0IFt2LCBmLCBuXSA9IGFyZ3M7CiAgICAgICAgcmV0dXJuIG5ldyBDb252ZXhQb2x5aGVkcm9uKHsKICAgICAgICAgIHZlcnRpY2VzOiB2Lm1hcCgoW3gsIHksIHpdKSA9PiBuZXcgVmVjMyh4LCB5LCB6KSksCiAgICAgICAgICBub3JtYWxzOiBuID8gbi5tYXAoKFt4LCB5LCB6XSkgPT4gbmV3IFZlYzMoeCwgeSwgeikpIDogbnVsbCwKICAgICAgICAgIGZhY2VzOiBmCiAgICAgICAgfSk7CgogICAgICBjYXNlICdDeWxpbmRlcic6CiAgICAgICAgcmV0dXJuIG5ldyBDeWxpbmRlciguLi5hcmdzKTsKICAgICAgLy8gWyByYWRpdXNUb3AsIHJhZGl1c0JvdHRvbSwgaGVpZ2h0LCBudW1TZWdtZW50cyBdID0gYXJncwoKICAgICAgY2FzZSAnSGVpZ2h0ZmllbGQnOgogICAgICAgIHJldHVybiBuZXcgSGVpZ2h0ZmllbGQoLi4uYXJncyk7CiAgICAgIC8vIFsgQXJyYXkgZGF0YSwgb3B0aW9uczoge21pblZhbHVlLCBtYXhWYWx1ZSwgZWxlbWVudFNpemV9ICBdID0gYXJncwoKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwoKICAgICAgY2FzZSAnUGxhbmUnOgogICAgICAgIHJldHVybiBuZXcgUGxhbmUoKTsKICAgICAgLy8gbm8gYXJncywgaW5maW5pdGUgeCBhbmQgeQoKICAgICAgY2FzZSAnU3BoZXJlJzoKICAgICAgICByZXR1cm4gbmV3IFNwaGVyZSguLi5hcmdzKTsKICAgICAgLy8gW3JhZGl1c10gPSBhcmdzCgogICAgICBjYXNlICdUcmltZXNoJzoKICAgICAgICByZXR1cm4gbmV3IFRyaW1lc2goLi4uYXJncyk7CiAgICAgIC8vIFt2ZXJ0aWNlcywgaW5kaWNlc10gPSBhcmdzCiAgICB9CiAgfQogIC8qKg0KICAgKg0KICAgKiBAcGFyYW0gdXVpZCB7c3RyaW5nfQ0KICAgKiBAcGFyYW0gcHJvcHMge0JvZHlQcm9wc30NCiAgICogQHBhcmFtIHR5cGUge0JvZHlTaGFwZVR5cGV9DQogICAqIEByZXR1cm4ge21vZHVsZTpvYmplY3RzL0JvZHkuQm9keX0NCiAgICovCgoKICBjb25zdCBwcm9wc1RvQm9keSA9ICh1dWlkLCBwcm9wcywgdHlwZSkgPT4gewogICAgY29uc3QgewogICAgICBhcmdzID0gW10sCiAgICAgIHBvc2l0aW9uID0gWzAsIDAsIDBdLAogICAgICByb3RhdGlvbiA9IFswLCAwLCAwXSwKICAgICAgc2NhbGUgPSBbMSwgMSwgMV0sCiAgICAgIHZlbG9jaXR5ID0gWzAsIDAsIDBdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgYW5ndWxhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgdHlwZTogYm9keVR5cGUsCiAgICAgIG1hc3MsCiAgICAgIG1hdGVyaWFsLAogICAgICBzaGFwZXMsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIC4uLmV4dHJhCiAgICB9ID0gcHJvcHM7CiAgICBjb25zdCBib2R5ID0gbmV3IEJvZHkoeyAuLi5leHRyYSwKICAgICAgbWFzczogYm9keVR5cGUgPT09ICdTdGF0aWMnID8gMCA6IG1hc3MsCiAgICAgIHR5cGU6IGJvZHlUeXBlID8gQm9keVtib2R5VHlwZS50b1VwcGVyQ2FzZSgpXSA6IHVuZGVmaW5lZCwKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gbmV3IE1hdGVyaWFsKG1hdGVyaWFsKSA6IHVuZGVmaW5lZAogICAgfSk7CiAgICBib2R5LnV1aWQgPSB1dWlkOwoKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KCiAgICBpZiAodHlwZSA9PT0gJ0NvbXBvdW5kJykgewogICAgICBzaGFwZXMuZm9yRWFjaCgoewogICAgICAgIHR5cGUsCiAgICAgICAgYXJncywKICAgICAgICBwb3NpdGlvbiwKICAgICAgICByb3RhdGlvbiwKICAgICAgICBtYXRlcmlhbCwKICAgICAgICAuLi5leHRyYQogICAgICB9KSA9PiB7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHJvdGF0aW9uID8gbmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pIDogdW5kZWZpbmVkKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IG5ldyBNYXRlcmlhbChtYXRlcmlhbCk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzaGFwZUJvZHksIGV4dHJhKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBib2R5LmFkZFNoYXBlKGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpKTsKICAgIH0KCiAgICBib2R5LnBvc2l0aW9uLnNldChwb3NpdGlvblswXSwgcG9zaXRpb25bMV0sIHBvc2l0aW9uWzJdKTsKICAgIGJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIocm90YXRpb25bMF0sIHJvdGF0aW9uWzFdLCByb3RhdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBzdGF0ZSA9IHsKICAgIGJvZGllczoge30sCiAgICB2ZWhpY2xlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICByYXlzOiB7fSwKICAgIHdvcmxkOiBuZXcgV29ybGQoKSwKICAgIGNvbmZpZzogewogICAgICBzdGVwOiAxIC8gNjAKICAgIH0sCiAgICBzdWJzY3JpcHRpb25zOiB7fSwKICAgIHRlbXBWZWN0b3I6IG5ldyBWZWMzKCksCiAgICBib2RpZXNOZWVkU3luY2luZzogZmFsc2UsCiAgICBsYXN0Q2FsbFRpbWU6IHVuZGVmaW5lZAogIH07CgogIGZ1bmN0aW9uIHN5bmNCb2RpZXMoKSB7CiAgICBzdGF0ZS5ib2RpZXNOZWVkU3luY2luZyA9IHRydWU7CiAgICBzdGF0ZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChhY2MsIGJvZHkpID0+ICh7IC4uLmFjYywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0pLCB7fSk7CiAgfQoKICBzZWxmLm9ubWVzc2FnZSA9IGUgPT4gewogICAgY29uc3QgewogICAgICBvcCwKICAgICAgdXVpZCwKICAgICAgdHlwZSwKICAgICAgcG9zaXRpb25zLAogICAgICBxdWF0ZXJuaW9ucywKICAgICAgcHJvcHMKICAgIH0gPSBlLmRhdGE7CgogICAgc3dpdGNoIChvcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGdyYXZpdHksCiAgICAgICAgICAgIHRvbGVyYW5jZSwKICAgICAgICAgICAgc3RlcCwKICAgICAgICAgICAgaXRlcmF0aW9ucywKICAgICAgICAgICAgYWxsb3dTbGVlcCwKICAgICAgICAgICAgYnJvYWRwaGFzZSwKICAgICAgICAgICAgYXhpc0luZGV4LAogICAgICAgICAgICBkZWZhdWx0Q29udGFjdE1hdGVyaWFsCiAgICAgICAgICB9ID0gcHJvcHM7CiAgICAgICAgICBjb25zdCBicm9hZHBoYXNlcyA9IHsKICAgICAgICAgICAgTmFpdmVCcm9hZHBoYXNlLAogICAgICAgICAgICBTQVBCcm9hZHBoYXNlCiAgICAgICAgICB9OwogICAgICAgICAgc3RhdGUud29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChncmF2aXR5WzBdLCBncmF2aXR5WzFdLCBncmF2aXR5WzJdKTsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSB0b2xlcmFuY2U7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1ticm9hZHBoYXNlICsgJ0Jyb2FkcGhhc2UnXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gYXhpc0luZGV4ID09PSB1bmRlZmluZWQgfHwgYXhpc0luZGV4ID09PSBudWxsID8gMCA6IGF4aXNJbmRleDsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oc3RhdGUud29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbCwgZGVmYXVsdENvbnRhY3RNYXRlcmlhbCk7CiAgICAgICAgICBzdGF0ZS5jb25maWcuc3RlcCA9IHN0ZXA7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzdGVwJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKSAvIDEwMDA7CgogICAgICAgICAgaWYgKCFzdGF0ZS5sYXN0Q2FsbFRpbWUpIHsKICAgICAgICAgICAgc3RhdGUud29ybGQuc3RlcChzdGF0ZS5jb25maWcuc3RlcCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbCA9IG5vdyAtIHN0YXRlLmxhc3RDYWxsVGltZTsKICAgICAgICAgICAgc3RhdGUud29ybGQuc3RlcChzdGF0ZS5jb25maWcuc3RlcCwgdGltZVNpbmNlTGFzdENhbGwpOwogICAgICAgICAgfQoKICAgICAgICAgIHN0YXRlLmxhc3RDYWxsVGltZSA9IG5vdzsKICAgICAgICAgIGNvbnN0IG51bWJlck9mQm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLmxlbmd0aDsKCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mQm9kaWVzOyBpKyspIHsKICAgICAgICAgICAgbGV0IGIgPSBzdGF0ZS53b3JsZC5ib2RpZXNbaV0sCiAgICAgICAgICAgICAgICBwID0gYi5wb3NpdGlvbiwKICAgICAgICAgICAgICAgIHEgPSBiLnF1YXRlcm5pb247CiAgICAgICAgICAgIHBvc2l0aW9uc1szICogaSArIDBdID0gcC54OwogICAgICAgICAgICBwb3NpdGlvbnNbMyAqIGkgKyAxXSA9IHAueTsKICAgICAgICAgICAgcG9zaXRpb25zWzMgKiBpICsgMl0gPSBwLno7CiAgICAgICAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMF0gPSBxLng7CiAgICAgICAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMV0gPSBxLnk7CiAgICAgICAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMl0gPSBxLno7CiAgICAgICAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgM10gPSBxLnc7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CgogICAgICAgICAgZm9yIChjb25zdCBpZCBvZiBPYmplY3Qua2V5cyhzdGF0ZS5zdWJzY3JpcHRpb25zKSkgewogICAgICAgICAgICBsZXQgW3V1aWQsIHR5cGUsIHRhcmdldCA9ICdib2RpZXMnXSA9IHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdOwogICAgICAgICAgICBsZXQgb2JqZWN0ID0gc3RhdGVbdGFyZ2V0XTsKICAgICAgICAgICAgaWYgKCFvYmplY3QgfHwgIW9iamVjdFt1dWlkXSkgY29udGludWU7CiAgICAgICAgICAgIGxldCB2YWx1ZSA9IG9iamVjdFt1dWlkXVt0eXBlXTsKICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgVmVjMykgdmFsdWUgPSB2YWx1ZS50b0FycmF5KCk7ZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBRdWF0ZXJuaW9uKSB7CiAgICAgICAgICAgICAgdmFsdWUudG9FdWxlcihzdGF0ZS50ZW1wVmVjdG9yKTsKICAgICAgICAgICAgICB2YWx1ZSA9IHN0YXRlLnRlbXBWZWN0b3IudG9BcnJheSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtpZCwgdmFsdWVdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBtZXNzYWdlID0gewogICAgICAgICAgICBvcDogJ2ZyYW1lJywKICAgICAgICAgICAgcG9zaXRpb25zLAogICAgICAgICAgICBxdWF0ZXJuaW9ucywKICAgICAgICAgICAgb2JzZXJ2YXRpb25zLAogICAgICAgICAgICBhY3RpdmU6IHN0YXRlLndvcmxkLmhhc0FjdGl2ZUJvZGllcwogICAgICAgICAgfTsKCiAgICAgICAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMubWFwKGJvZHkgPT4gYm9keS51dWlkKTsKICAgICAgICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIFtwb3NpdGlvbnMuYnVmZmVyLCBxdWF0ZXJuaW9ucy5idWZmZXJdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1dWlkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBwcm9wc1RvQm9keSh1dWlkW2ldLCBwcm9wc1tpXSwgdHlwZSk7CiAgICAgICAgICAgIHN0YXRlLndvcmxkLmFkZEJvZHkoYm9keSk7CiAgICAgICAgICAgIGlmIChwcm9wc1tpXS5vbkNvbGxpZGUpIGJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY29sbGlkZScsICh7CiAgICAgICAgICAgICAgdHlwZSwKICAgICAgICAgICAgICBib2R5LAogICAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgICBjb250YWN0CiAgICAgICAgICAgIH0pID0+IHsKICAgICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgICBuaSwKICAgICAgICAgICAgICAgIHJpLAogICAgICAgICAgICAgICAgcmoKICAgICAgICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgICAgICAgICAgdHlwZSwKICAgICAgICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICAgICAgICBjb250YWN0OiB7CiAgICAgICAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgICAgICAgIHJqOiByai50b0FycmF5KCksCiAgICAgICAgICAgICAgICAgIGltcGFjdFZlbG9jaXR5OiBjb250YWN0LmdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVCb2RpZXMnOgogICAgICAgIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXVpZC5sZW5ndGg7IGkrKykgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbdXVpZFtpXV0pOwoKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N1YnNjcmliZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBpZCwKICAgICAgICAgICAgdHlwZSwKICAgICAgICAgICAgdGFyZ2V0CiAgICAgICAgICB9ID0gcHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFt1dWlkLCB0eXBlLCB0YXJnZXRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAndW5zdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5zdWJzY3JpcHRpb25zW3Byb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFBvc2l0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0ucG9zaXRpb24uc2V0KHByb3BzWzBdLCBwcm9wc1sxXSwgcHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKHByb3BzWzBdLCBwcm9wc1sxXSwgcHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS52ZWxvY2l0eS5zZXQocHJvcHNbMF0sIHByb3BzWzFdLCBwcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyVmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KHByb3BzWzBdLCBwcm9wc1sxXSwgcHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TGluZWFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0ubGluZWFyRmFjdG9yLnNldChwcm9wc1swXSwgcHJvcHNbMV0sIHByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hbmd1bGFyRmFjdG9yLnNldChwcm9wc1swXSwgcHJvcHNbMV0sIHByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldE1hc3MnOgogICAgICAgIC8vIGFzc3VtZSB0aGF0IGFuIHVwZGF0ZSBmcm9tIHplcm8tbWFzcyBpbXBsaWVzIGEgbmVlZCBmb3IgZHluYW1pY3Mgb24gc3RhdGljIG9iai4KICAgICAgICBpZiAocHJvcHMgIT09IDAgJiYgc3RhdGUuYm9kaWVzW3V1aWRdLnR5cGUgPT09IDApIHN0YXRlLmJvZGllc1t1dWlkXS50eXBlID0gMTsKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0ubWFzcyA9IHByb3BzOwogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TGluZWFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmxpbmVhckRhbXBpbmcgPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uYW5ndWxhckRhbXBpbmcgPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFsbG93U2xlZXAnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hbGxvd1NsZWVwID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFNwZWVkTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5zbGVlcFNwZWVkTGltaXQgPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFNsZWVwVGltZUxpbWl0JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uc2xlZXBUaW1lTGltaXQgPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlckdyb3VwJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlck1hc2snOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5jb2xsaXNpb25GaWx0ZXJNYXNrID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25GaWx0ZXJNYXNrJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uUmVzcG9uc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Rml4ZWRSb3RhdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmZpeGVkUm90YXRpb24gPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldElzVHJpZ2dlcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmlzVHJpZ2dlciA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0R3Jhdml0eSc6CiAgICAgICAgc3RhdGUud29ybGQuZ3Jhdml0eS5zZXQocHJvcHNbMF0sIHByb3BzWzFdLCBwcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRUb2xlcmFuY2UnOgogICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFN0ZXAnOgogICAgICAgIHN0YXRlLmNvbmZpZy5zdGVwID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRJdGVyYXRpb25zJzoKICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QnJvYWRwaGFzZSc6CiAgICAgICAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICAgICAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICAgICAgICBTQVBCcm9hZHBoYXNlCiAgICAgICAgfTsKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1twcm9wcyArICdCcm9hZHBoYXNlJ10gfHwgTmFpdmVCcm9hZHBoYXNlKShzdGF0ZS53b3JsZCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBeGlzSW5kZXgnOgogICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gcHJvcHMgPT09IHVuZGVmaW5lZCB8fCBwcm9wcyA9PT0gbnVsbCA/IDAgOiBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hcHBseUZvcmNlKG5ldyBWZWMzKC4uLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4ucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5SW1wdWxzZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmFwcGx5SW1wdWxzZShuZXcgVmVjMyguLi5wcm9wc1swXSksIG5ldyBWZWMzKC4uLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUxvY2FsRm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4ucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hcHBseUxvY2FsSW1wdWxzZShuZXcgVmVjMyguLi5wcm9wc1swXSksIG5ldyBWZWMzKC4uLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhZGRDb25zdHJhaW50JzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYm9keUEsIGJvZHlCLCBvcHRuc10gPSBwcm9wczsKICAgICAgICAgIGxldCB7CiAgICAgICAgICAgIHBpdm90QSwKICAgICAgICAgICAgcGl2b3RCLAogICAgICAgICAgICBheGlzQSwKICAgICAgICAgICAgYXhpc0IsCiAgICAgICAgICAgIC4uLm9wdGlvbnMKICAgICAgICAgIH0gPSBvcHRuczsgLy8gaXMgdGhlcmUgYSBiZXR0ZXIgd2F5IHRvIGVuZm9yY2UgZGVmYXVsdHM/CgogICAgICAgICAgcGl2b3RBID0gQXJyYXkuaXNBcnJheShwaXZvdEEpID8gbmV3IFZlYzMoLi4ucGl2b3RBKSA6IHVuZGVmaW5lZDsKICAgICAgICAgIHBpdm90QiA9IEFycmF5LmlzQXJyYXkocGl2b3RCKSA/IG5ldyBWZWMzKC4uLnBpdm90QikgOiB1bmRlZmluZWQ7CiAgICAgICAgICBheGlzQSA9IEFycmF5LmlzQXJyYXkoYXhpc0EpID8gbmV3IFZlYzMoLi4uYXhpc0EpIDogdW5kZWZpbmVkOwogICAgICAgICAgYXhpc0IgPSBBcnJheS5pc0FycmF5KGF4aXNCKSA/IG5ldyBWZWMzKC4uLmF4aXNCKSA6IHVuZGVmaW5lZDsKICAgICAgICAgIGxldCBjb25zdHJhaW50OwoKICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBwaXZvdEEsIHN0YXRlLmJvZGllc1tib2R5Ql0sIHBpdm90Qiwgb3B0bnMubWF4Rm9yY2UpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnQ29uZVR3aXN0JzoKICAgICAgICAgICAgICBjb25zdHJhaW50ID0gbmV3IENvbmVUd2lzdENvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgICAgICAgcGl2b3RBLAogICAgICAgICAgICAgICAgcGl2b3RCLAogICAgICAgICAgICAgICAgYXhpc0EsCiAgICAgICAgICAgICAgICBheGlzQiwKICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICAgICAgICBwaXZvdEEsCiAgICAgICAgICAgICAgICBwaXZvdEIsCiAgICAgICAgICAgICAgICBheGlzQSwKICAgICAgICAgICAgICAgIGF4aXNCLAogICAgICAgICAgICAgICAgLi4ub3B0aW9ucwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnRGlzdGFuY2UnOgogICAgICAgICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgRGlzdGFuY2VDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIG9wdG5zLmRpc3RhbmNlLCBvcHRucy5tYXhGb3JjZSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdMb2NrJzoKICAgICAgICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIG9wdG5zKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIG9wdG5zKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdHJhaW50LnV1aWQgPSB1dWlkOwogICAgICAgICAgc3RhdGUud29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcigoewogICAgICAgICAgdXVpZDogdGhpc0lkCiAgICAgICAgfSkgPT4gdGhpc0lkID09PSB1dWlkKS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2VuYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcigoewogICAgICAgICAgdXVpZDogdGhpc0lkCiAgICAgICAgfSkgPT4gdGhpc0lkID09PSB1dWlkKS5tYXAoYyA9PiBjLmVuYWJsZSgpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2Rpc2FibGVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoKHsKICAgICAgICAgIHV1aWQ6IHRoaXNJZAogICAgICAgIH0pID0+IHRoaXNJZCA9PT0gdXVpZCkubWFwKGMgPT4gYy5kaXNhYmxlKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoKHsKICAgICAgICAgIHV1aWQ6IHRoaXNJZAogICAgICAgIH0pID0+IHRoaXNJZCA9PT0gdXVpZCkubWFwKGMgPT4gYy5lbmFibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2Rpc2FibGVDb25zdHJhaW50TW90b3InOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcigoewogICAgICAgICAgdXVpZDogdGhpc0lkCiAgICAgICAgfSkgPT4gdGhpc0lkID09PSB1dWlkKS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3RvclNwZWVkJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoKHsKICAgICAgICAgIHV1aWQ6IHRoaXNJZAogICAgICAgIH0pID0+IHRoaXNJZCA9PT0gdXVpZCkubWFwKGMgPT4gYy5zZXRNb3RvclNwZWVkKHByb3BzKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb25zdHJhaW50TW90b3JNYXhGb3JjZSc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKCh7CiAgICAgICAgICB1dWlkOiB0aGlzSWQKICAgICAgICB9KSA9PiB0aGlzSWQgPT09IHV1aWQpLm1hcChjID0+IGMuc2V0TW90b3JNYXhGb3JjZShwcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYm9keUEsIGJvZHlCLCBvcHRuc10gPSBwcm9wczsKICAgICAgICAgIGxldCB7CiAgICAgICAgICAgIHdvcmxkQW5jaG9yQSwKICAgICAgICAgICAgd29ybGRBbmNob3JCLAogICAgICAgICAgICBsb2NhbEFuY2hvckEsCiAgICAgICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICAgICAgcmVzdExlbmd0aCwKICAgICAgICAgICAgc3RpZmZuZXNzLAogICAgICAgICAgICBkYW1waW5nCiAgICAgICAgICB9ID0gb3B0bnM7CiAgICAgICAgICB3b3JsZEFuY2hvckEgPSBBcnJheS5pc0FycmF5KHdvcmxkQW5jaG9yQSkgPyBuZXcgVmVjMyguLi53b3JsZEFuY2hvckEpIDogdW5kZWZpbmVkOwogICAgICAgICAgd29ybGRBbmNob3JCID0gQXJyYXkuaXNBcnJheSh3b3JsZEFuY2hvckIpID8gbmV3IFZlYzMoLi4ud29ybGRBbmNob3JCKSA6IHVuZGVmaW5lZDsKICAgICAgICAgIGxvY2FsQW5jaG9yQSA9IEFycmF5LmlzQXJyYXkobG9jYWxBbmNob3JBKSA/IG5ldyBWZWMzKC4uLmxvY2FsQW5jaG9yQSkgOiB1bmRlZmluZWQ7CiAgICAgICAgICBsb2NhbEFuY2hvckIgPSBBcnJheS5pc0FycmF5KGxvY2FsQW5jaG9yQikgPyBuZXcgVmVjMyguLi5sb2NhbEFuY2hvckIpIDogdW5kZWZpbmVkOwogICAgICAgICAgbGV0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgICAgIHdvcmxkQW5jaG9yQiwKICAgICAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgICAgICBsb2NhbEFuY2hvckIsCiAgICAgICAgICAgIHJlc3RMZW5ndGgsCiAgICAgICAgICAgIHN0aWZmbmVzcywKICAgICAgICAgICAgZGFtcGluZwogICAgICAgICAgfSk7CiAgICAgICAgICBzcHJpbmcudXVpZCA9IHV1aWQ7CgogICAgICAgICAgbGV0IHBvc3RTdGVwU3ByaW5nID0gZSA9PiBzcHJpbmcuYXBwbHlGb3JjZSgpOwoKICAgICAgICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCgogICAgICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5zcHJpbmdzW3V1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW3V1aWRdLnN0aWZmbmVzcyA9IHByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW3V1aWRdLnJlc3RMZW5ndGggPSBwcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXS5kYW1waW5nID0gcHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXknOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgZnJvbSwKICAgICAgICAgICAgdG8sCiAgICAgICAgICAgIC4uLm9wdGlvbnMKICAgICAgICAgIH0gPSBwcm9wczsKICAgICAgICAgIGNvbnN0IHJheSA9IG5ldyBSYXkoZnJvbSA/IG5ldyBWZWMzKC4uLmZyb20pIDogdW5kZWZpbmVkLCB0byA/IG5ldyBWZWMzKC4uLnRvKSA6IHVuZGVmaW5lZCk7CiAgICAgICAgICBvcHRpb25zLm1vZGUgPSBSYXlbb3B0aW9ucy5tb2RlLnRvVXBwZXJDYXNlKCldOwogICAgICAgICAgb3B0aW9ucy5yZXN1bHQgPSBuZXcgUmF5Y2FzdFJlc3VsdCgpOwoKICAgICAgICAgIHN0YXRlLnJheXNbdXVpZF0gPSAoKSA9PiB7CiAgICAgICAgICAgIHJheS5pbnRlcnNlY3RXb3JsZChzdGF0ZS53b3JsZCwgb3B0aW9ucyk7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICBib2R5LAogICAgICAgICAgICAgIHNoYXBlLAogICAgICAgICAgICAgIHJheUZyb21Xb3JsZCwKICAgICAgICAgICAgICByYXlUb1dvcmxkLAogICAgICAgICAgICAgIGhpdE5vcm1hbFdvcmxkLAogICAgICAgICAgICAgIGhpdFBvaW50V29ybGQsCiAgICAgICAgICAgICAgLi4ucmVzdAogICAgICAgICAgICB9ID0gb3B0aW9ucy5yZXN1bHQ7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgICAgICAgIHR5cGU6ICdyYXloaXQnLAogICAgICAgICAgICAgIHJheTogewogICAgICAgICAgICAgICAgZnJvbSwKICAgICAgICAgICAgICAgIHRvLAogICAgICAgICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgICAgICAgIGNvbGxpc2lvbkZpbHRlckdyb3VwOiByYXkuY29sbGlzaW9uRmlsdGVyR3JvdXAsCiAgICAgICAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJNYXNrOiByYXkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgICAgICAgIHV1aWQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJvZHk6IGJvZHkgPyBib2R5LnV1aWQgOiBudWxsLAogICAgICAgICAgICAgIHNoYXBlOiBzaGFwZSA/IHsgLi4uc2hhcGUsCiAgICAgICAgICAgICAgICBib2R5OiBib2R5LnV1aWQKICAgICAgICAgICAgICB9IDogbnVsbCwKICAgICAgICAgICAgICByYXlGcm9tV29ybGQ6IHJheUZyb21Xb3JsZC50b0FycmF5KCksCiAgICAgICAgICAgICAgcmF5VG9Xb3JsZDogcmF5VG9Xb3JsZC50b0FycmF5KCksCiAgICAgICAgICAgICAgaGl0Tm9ybWFsV29ybGQ6IGhpdE5vcm1hbFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICAgICAgICBoaXRQb2ludFdvcmxkOiBoaXRQb2ludFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICAgICAgICAuLi5yZXN0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW3V1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5yYXlzW3V1aWRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gcHJvcHM7CiAgICAgICAgICBjb25zdCB2ZWhpY2xlID0gbmV3IFJheWNhc3RWZWhpY2xlKHsKICAgICAgICAgICAgY2hhc3Npc0JvZHk6IHN0YXRlLmJvZGllc1tjaGFzc2lzQm9keV0sCiAgICAgICAgICAgIGluZGV4Rm9yd2FyZEF4aXM6IGluZGV4Rm9yd2FyZEF4aXMsCiAgICAgICAgICAgIGluZGV4UmlnaHRBeGlzOiBpbmRleFJpZ2h0QXhpcywKICAgICAgICAgICAgaW5kZXhVcEF4aXM6IGluZGV4VXBBeGlzCiAgICAgICAgICB9KTsKICAgICAgICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdoZWVsSW5mb3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3Qgd2hlZWxJbmZvID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICAgICAgd2hlZWxJbmZvLmRpcmVjdGlvbkxvY2FsID0gbmV3IFZlYzMoLi4ud2hlZWxJbmZvLmRpcmVjdGlvbkxvY2FsKTsKICAgICAgICAgICAgd2hlZWxJbmZvLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCA9IG5ldyBWZWMzKC4uLndoZWVsSW5mby5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwpOwogICAgICAgICAgICB3aGVlbEluZm8uYXhsZUxvY2FsID0gbmV3IFZlYzMoLi4ud2hlZWxJbmZvLmF4bGVMb2NhbCk7CiAgICAgICAgICAgIHZlaGljbGUuYWRkV2hlZWwod2hlZWxJbmZvKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2ZWhpY2xlLnByZVN0ZXAgPSAoKSA9PiB7CiAgICAgICAgICAgIHN0YXRlLnZlaGljbGVzW3V1aWRdLnVwZGF0ZVZlaGljbGUoc3RhdGUud29ybGQuZHQpOwogICAgICAgICAgfTsKCiAgICAgICAgICB2ZWhpY2xlLnBvc3RTdGVwID0gKCkgPT4gewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0YXRlLnZlaGljbGVzW3V1aWRdLndoZWVsSW5mb3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1t1dWlkXS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICAgICAgICBjb25zdCB0ID0gc3RhdGUudmVoaWNsZXNbdXVpZF0ud2hlZWxJbmZvc1tpXS53b3JsZFRyYW5zZm9ybTsKICAgICAgICAgICAgICBjb25zdCB3aGVlbEJvZHkgPSBzdGF0ZS5ib2RpZXNbd2hlZWxzW2ldXTsKICAgICAgICAgICAgICB3aGVlbEJvZHkucG9zaXRpb24uY29weSh0LnBvc2l0aW9uKTsKICAgICAgICAgICAgICB3aGVlbEJvZHkucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHN0YXRlLnZlaGljbGVzW3V1aWRdID0gdmVoaWNsZTsKICAgICAgICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1t1dWlkXS5wcmVTdGVwKTsKICAgICAgICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUudmVoaWNsZXNbdXVpZF0ucG9zdFN0ZXApOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1t1dWlkXS5wcmVTdGVwKTsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUudmVoaWNsZXNbdXVpZF0ucG9zdFN0ZXApOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbdXVpZF0ud29ybGQgPSBudWxsOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnZlaGljbGVzW3V1aWRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVTdGVlcmluZ1ZhbHVlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbdmFsdWUsIHdoZWVsSW5kZXhdID0gcHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1t1dWlkXS5zZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FwcGx5UmF5Y2FzdFZlaGljbGVFbmdpbmVGb3JjZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3ZhbHVlLCB3aGVlbEluZGV4XSA9IHByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbdXVpZF0uYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gcHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1t1dWlkXS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgfTsKCn0oKSk7Cgo=",l=null,c=!1,function(e){return I=I||g(s,l,c),new Worker(I,e)});class u{constructor(e=[0,0,0,0,0,0,0,0,0]){this.elements=void 0,this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e=new h){const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t=new h){const n=this.elements,i=e.x,o=e.y,r=e.z;return t.x=n[0]*i+n[1]*o+n[2]*r,t.y=n[3]*i+n[4]*o+n[5]*r,t.z=n[6]*i+n[7]*o+n[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t=new u){const n=this.elements,i=e.elements,o=t.elements,r=n[0],a=n[1],g=n[2],s=n[3],l=n[4],c=n[5],I=n[6],C=n[7],d=n[8],h=i[0],A=i[1],p=i[2],m=i[3],b=i[4],f=i[5],y=i[6],G=i[7],v=i[8];return o[0]=r*h+a*m+g*y,o[1]=r*A+a*b+g*G,o[2]=r*p+a*f+g*v,o[3]=s*h+l*m+c*y,o[4]=s*A+l*b+c*G,o[5]=s*p+l*f+c*v,o[6]=I*h+C*m+d*y,o[7]=I*A+C*b+d*G,o[8]=I*p+C*f+d*v,t}scale(e,t=new u){const n=this.elements,i=t.elements;for(let o=0;3!==o;o++)i[3*o+0]=e.x*n[3*o+0],i[3*o+1]=e.y*n[3*o+1],i[3*o+2]=e.z*n[3*o+2];return t}solve(e,t=new h){const n=[];let i,o;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(o=0;o<3;o++)n[i+4*o]=this.elements[i+3*o];n[3]=e.x,n[7]=e.y,n[11]=e.z;let r=3;const a=r;let g;let s;do{if(i=a-r,0===n[i+4*i])for(o=i+1;o<a;o++)if(0!==n[i+4*o]){g=4;do{s=4-g,n[s+4*i]+=n[s+4*o]}while(--g);break}if(0!==n[i+4*i])for(o=i+1;o<a;o++){const e=n[i+4*o]/n[i+4*i];g=4;do{s=4-g,n[s+4*o]=s<=i?0:n[s+4*o]-n[s+4*i]*e}while(--g)}}while(--r);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t}e(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e=new u){const t=d;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let o=3;const r=o;let a;let g;do{if(n=r-o,0===t[n+6*n])for(i=n+1;i<r;i++)if(0!==t[n+6*i]){a=6;do{g=6-a,t[g+6*n]+=t[g+6*i]}while(--a);break}if(0!==t[n+6*n])for(i=n+1;i<r;i++){const e=t[n+6*i]/t[n+6*n];a=6;do{g=6-a,t[g+6*i]=g<=n?0:t[g+6*i]-t[g+6*n]*e}while(--a)}}while(--o);n=2;do{i=n-1;do{const e=t[n+6*i]/t[n+6*n];a=6;do{g=6-a,t[g+6*i]=t[g+6*i]-t[g+6*n]*e}while(--a)}while(i--)}while(--n);n=2;do{const e=1/t[n+6*n];a=6;do{g=6-a,t[g+6*n]=t[g+6*n]*e}while(--a)}while(n--);n=2;do{i=2;do{if(g=t[3+i+6*n],isNaN(g)||g===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(n,i,g)}while(i--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,o=e.w,r=t+t,a=n+n,g=i+i,s=t*r,l=t*a,c=t*g,I=n*a,C=n*g,u=i*g,d=o*r,h=o*a,A=o*g,p=this.elements;return p[0]=1-(I+u),p[1]=l-A,p[2]=c+h,p[3]=l+A,p[4]=1-(s+u),p[5]=C-d,p[6]=c-h,p[7]=C+d,p[8]=1-(s+I),this}transpose(e=new u){const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class h{constructor(e=0,t=0,n=0){this.x=void 0,this.y=void 0,this.z=void 0,this.x=e,this.y=t,this.z=n}cross(e,t=new h){const n=e.x,i=e.y,o=e.z,r=this.x,a=this.y,g=this.z;return t.x=a*o-g*i,t.y=g*n-r*o,t.z=r*i-a*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new h(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new h(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new u([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const e=1/i;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return i}unit(e=new h){const t=this.x,n=this.y,i=this.z;let o=Math.sqrt(t*t+n*n+i*i);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=i*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z;return Math.sqrt((o-t)*(o-t)+(r-n)*(r-n)+(a-i)*(a-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z;return(o-t)*(o-t)+(r-n)*(r-n)+(a-i)*(a-i)}scale(e,t=new h){const n=this.x,i=this.y,o=this.z;return t.x=e*n,t.y=e*i,t.z=e*o,t}vmul(e,t=new h){return t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n=new h){return n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e=new h){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=A,o=1/n;i.set(this.x*o,this.y*o,this.z*o);const r=p;Math.abs(i.x)<.9?(r.set(1,0,0),i.cross(r,e)):(r.set(0,1,0),i.cross(r,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,o=this.y,r=this.z;n.x=i+(e.x-i)*t,n.y=o+(e.y-o)*t,n.z=r+(e.z-r)*t}almostEquals(e,t=1e-6){return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e=1e-6){return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(m),m.almostEquals(e,t)}clone(){return new h(this.x,this.y,this.z)}}h.ZERO=void 0,h.UNIT_X=void 0,h.UNIT_Y=void 0,h.UNIT_Z=void 0,h.ZERO=new h(0,0,0),h.UNIT_X=new h(1,0,0),h.UNIT_Y=new h(0,1,0),h.UNIT_Z=new h(0,0,1);const A=new h,p=new h,m=new h;class b{constructor(e={}){this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new h,this.upperBound=new h,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const o=this.lowerBound,r=this.upperBound,a=n;o.copy(e[0]),a&&a.vmult(o,o),r.copy(o);for(let g=1;g<e.length;g++){let t=e[g];a&&(a.vmult(t,f),t=f),t.x>r.x&&(r.x=t.x),t.x<o.x&&(o.x=t.x),t.y>r.y&&(r.y=t.y),t.y<o.y&&(o.y=t.y),t.z>r.z&&(r.z=t.z),t.z<o.z&&(o.z=t.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),i&&(o.x-=i,o.y-=i,o.z-=i,r.x+=i,r.y+=i,r.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new b).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound,r=i.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,a=i.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,g=i.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return r&&a&&g}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound;return t.x<=i.x&&n.x>=o.x&&t.y<=i.y&&n.y>=o.y&&t.z<=i.z&&n.z>=o.z}getCorners(e,t,n,i,o,r,a,g){const s=this.lowerBound,l=this.upperBound;e.copy(s),t.set(l.x,s.y,s.z),n.set(l.x,l.y,s.z),i.set(s.x,l.y,l.z),o.set(l.x,s.y,l.z),r.set(s.x,l.y,s.z),a.set(s.x,s.y,l.z),g.copy(l)}toLocalFrame(e,t){const n=y,i=n[0],o=n[1],r=n[2],a=n[3],g=n[4],s=n[5],l=n[6],c=n[7];this.getCorners(i,o,r,a,g,s,l,c);for(let I=0;8!==I;I++){const t=n[I];e.pointToLocal(t,t)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=y,i=n[0],o=n[1],r=n[2],a=n[3],g=n[4],s=n[5],l=n[6],c=n[7];this.getCorners(i,o,r,a,g,s,l,c);for(let I=0;8!==I;I++){const t=n[I];e.pointToWorld(t,t)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,o=1/t.y,r=1/t.z,a=(this.lowerBound.x-n.x)*i,g=(this.upperBound.x-n.x)*i,s=(this.lowerBound.y-n.y)*o,l=(this.upperBound.y-n.y)*o,c=(this.lowerBound.z-n.z)*r,I=(this.upperBound.z-n.z)*r,C=Math.max(Math.max(Math.min(a,g),Math.min(s,l)),Math.min(c,I)),u=Math.min(Math.min(Math.max(a,g),Math.max(s,l)),Math.max(c,I));return!(u<0)&&!(C>u)}}const f=new h,y=[new h,new h,new h,new h,new h,new h,new h,new h];class G{constructor(e=0,t=0,n=0,i=1){this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e=new h){this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const t=v,n=B;e.tangents(t,n),this.setFromAxisAngle(t,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t=new G){const n=this.x,i=this.y,o=this.z,r=this.w,a=e.x,g=e.y,s=e.z,l=e.w;return t.x=n*l+r*a+i*s-o*g,t.y=i*l+r*g+o*a-n*s,t.z=o*l+r*s+n*g-i*a,t.w=r*l-n*a-i*g-o*s,t}inverse(e=new G){const t=this.x,n=this.y,i=this.z,o=this.w;this.conjugate(e);const r=1/(t*t+n*n+i*i+o*o);return e.x*=r,e.y*=r,e.z*=r,e.w*=r,e}conjugate(e=new G){return e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t=new h){const n=e.x,i=e.y,o=e.z,r=this.x,a=this.y,g=this.z,s=this.w,l=s*n+a*o-g*i,c=s*i+g*n-r*o,I=s*o+r*i-a*n,C=-r*n-a*i-g*o;return t.x=l*s+C*-r+c*-g-I*-a,t.y=c*s+C*-a+I*-r-l*-g,t.z=I*s+C*-g+l*-a-c*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t="YZX"){let n,i,o;const r=this.x,a=this.y,g=this.z,s=this.w;switch(t){case"YZX":const e=r*a+g*s;if(e>.499&&(n=2*Math.atan2(r,s),i=Math.PI/2,o=0),e<-.499&&(n=-2*Math.atan2(r,s),i=-Math.PI/2,o=0),void 0===n){const t=r*r,l=a*a,c=g*g;n=Math.atan2(2*a*s-2*r*g,1-2*l-2*c),i=Math.asin(2*e),o=Math.atan2(2*r*s-2*a*g,1-2*t-2*c)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=n,e.z=i,e.x=o}setFromEuler(e,t,n,i="XYZ"){const o=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(n/2),g=Math.sin(e/2),s=Math.sin(t/2),l=Math.sin(n/2);return"XYZ"===i?(this.x=g*r*a+o*s*l,this.y=o*s*a-g*r*l,this.z=o*r*l+g*s*a,this.w=o*r*a-g*s*l):"YXZ"===i?(this.x=g*r*a+o*s*l,this.y=o*s*a-g*r*l,this.z=o*r*l-g*s*a,this.w=o*r*a+g*s*l):"ZXY"===i?(this.x=g*r*a-o*s*l,this.y=o*s*a+g*r*l,this.z=o*r*l+g*s*a,this.w=o*r*a-g*s*l):"ZYX"===i?(this.x=g*r*a-o*s*l,this.y=o*s*a+g*r*l,this.z=o*r*l-g*s*a,this.w=o*r*a+g*s*l):"YZX"===i?(this.x=g*r*a+o*s*l,this.y=o*s*a+g*r*l,this.z=o*r*l-g*s*a,this.w=o*r*a-g*s*l):"XZY"===i&&(this.x=g*r*a-o*s*l,this.y=o*s*a-g*r*l,this.z=o*r*l+g*s*a,this.w=o*r*a+g*s*l),this}clone(){return new G(this.x,this.y,this.z,this.w)}slerp(e,t,n=new G){const i=this.x,o=this.y,r=this.z,a=this.w;let g,s,l,c,I,C=e.x,u=e.y,d=e.z,h=e.w;return s=i*C+o*u+r*d+a*h,s<0&&(s=-s,C=-C,u=-u,d=-d,h=-h),1-s>1e-6?(g=Math.acos(s),l=Math.sin(g),c=Math.sin((1-t)*g)/l,I=Math.sin(t*g)/l):(c=1-t,I=t),n.x=c*i+I*C,n.y=c*o+I*u,n.z=c*r+I*d,n.w=c*a+I*h,n}integrate(e,t,n,i=new G){const o=e.x*n.x,r=e.y*n.y,a=e.z*n.z,g=this.x,s=this.y,l=this.z,c=this.w,I=.5*t;return i.x+=I*(o*c+r*l-a*s),i.y+=I*(r*c+a*g-o*l),i.z+=I*(a*c+o*s-r*g),i.w+=I*(-o*g-r*s-a*l),i}}const v=new h,B=new h;class Z{constructor(e={}){this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=Z.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,n,i){throw"calculateWorldAABB() not implemented for shape type "+this.type}}Z.idCounter=0,Z.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class w{constructor(e={}){this.position=void 0,this.quaternion=void 0,this.position=new h,this.quaternion=new G,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return w.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return w.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t=new h){return this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i=new h){return n.vsub(e,i),t.conjugate(W),W.vmult(i,i),i}static pointToWorldFrame(e,t,n,i=new h){return t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n=new h){return e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i=new h){return t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const W=new G;class S extends Z{constructor(e={}){const{vertices:t=[],faces:n=[],normals:i=[],axes:o,boundingSphereRadius:r}=e;super({type:Z.types.CONVEXPOLYHEDRON}),this.vertices=void 0,this.faces=void 0,this.faceNormals=void 0,this.worldVertices=void 0,this.worldVerticesNeedsUpdate=void 0,this.worldFaceNormals=void 0,this.worldFaceNormalsNeedsUpdate=void 0,this.uniqueAxes=void 0,this.uniqueEdges=void 0,this.vertices=t,this.faces=n,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),r?this.boundingSphereRadius=r:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=o?o.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new h;for(let o=0;o!==e.length;o++){const r=e[o],a=r.length;for(let e=0;e!==a;e++){const o=(e+1)%a;t[r[e]].vsub(t[r[o]],i),i.normalize();let g=!1;for(let e=0;e!==n.length;e++)if(n[e].almostEquals(i)||n[e].almostEquals(i)){g=!0;break}g||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error("Vertex "+this.faces[e][i]+" not found!");const t=this.faceNormals[e]||new h;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+t.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let t=0;t<this.faces[e].length;t++)console.warn(".vertices["+this.faces[e][t]+"] = Vec3("+this.vertices[this.faces[e][t]].toString()+")")}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],o=this.vertices[n[1]],r=this.vertices[n[2]];S.computeNormal(i,o,r,t)}static computeNormal(e,t,n,i){const o=new h,r=new h;t.vsub(e,r),n.vsub(t,o),o.cross(r,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,o,r,a,g,s){const l=new h;let c=-1,I=-Number.MAX_VALUE;for(let u=0;u<n.faces.length;u++){l.copy(n.faceNormals[u]),o.vmult(l,l);const e=l.dot(r);e>I&&(I=e,c=u)}const C=[];for(let u=0;u<n.faces[c].length;u++){const e=n.vertices[n.faces[c][u]],t=new h;t.copy(e),o.vmult(t,t),i.vadd(t,t),C.push(t)}c>=0&&this.clipFaceAgainstHull(r,e,t,C,a,g,s)}findSeparatingAxis(e,t,n,i,o,r,a,g){const s=new h,l=new h,c=new h,I=new h,C=new h,u=new h;let d=Number.MAX_VALUE;const A=this;if(A.uniqueAxes)for(let h=0;h!==A.uniqueAxes.length;h++){n.vmult(A.uniqueAxes[h],s);const a=A.testSepAxis(s,e,t,n,i,o);if(!1===a)return!1;a<d&&(d=a,r.copy(s))}else{const g=a?a.length:A.faces.length;for(let l=0;l<g;l++){const g=a?a[l]:l;s.copy(A.faceNormals[g]),n.vmult(s,s);const c=A.testSepAxis(s,e,t,n,i,o);if(!1===c)return!1;c<d&&(d=c,r.copy(s))}}if(e.uniqueAxes)for(let h=0;h!==e.uniqueAxes.length;h++){o.vmult(e.uniqueAxes[h],l);const a=A.testSepAxis(l,e,t,n,i,o);if(!1===a)return!1;a<d&&(d=a,r.copy(l))}else{const a=g?g.length:e.faces.length;for(let s=0;s<a;s++){const a=g?g[s]:s;l.copy(e.faceNormals[a]),o.vmult(l,l);const c=A.testSepAxis(l,e,t,n,i,o);if(!1===c)return!1;c<d&&(d=c,r.copy(l))}}for(let h=0;h!==A.uniqueEdges.length;h++){n.vmult(A.uniqueEdges[h],I);for(let a=0;a!==e.uniqueEdges.length;a++)if(o.vmult(e.uniqueEdges[a],C),I.cross(C,u),!u.almostZero()){u.normalize();const a=A.testSepAxis(u,e,t,n,i,o);if(!1===a)return!1;a<d&&(d=a,r.copy(u))}}return i.vsub(t,c),c.dot(r)>0&&r.negate(r),!0}testSepAxis(e,t,n,i,o,r){S.project(this,e,n,i,R),S.project(t,e,o,r,V);const a=R[0],g=R[1],s=V[0],l=V[1];if(a<l||s<g)return!1;const c=a-l,I=s-g;return c<I?c:I}calculateLocalInertia(e,t){const n=new h,i=new h;this.computeLocalAABB(i,n);const o=n.x-i.x,r=n.y-i.y,a=n.z-i.z;t.x=1/12*e*(2*r*2*r+2*a*2*a),t.y=1/12*e*(2*o*2*o+2*a*2*a),t.z=1/12*e*(2*r*2*r+2*o*2*o)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,o,r,a){const g=new h,s=new h,l=new h,c=new h,I=new h,C=new h,u=new h,d=new h,A=this,p=i,m=[];let b=-1,f=Number.MAX_VALUE;for(let h=0;h<A.faces.length;h++){g.copy(A.faceNormals[h]),n.vmult(g,g);const t=g.dot(e);t<f&&(f=t,b=h)}if(b<0)return;const y=A.faces[b];y.connectedFaces=[];for(let h=0;h<A.faces.length;h++)for(let e=0;e<A.faces[h].length;e++)-1!==y.indexOf(A.faces[h][e])&&h!==b&&-1===y.connectedFaces.indexOf(h)&&y.connectedFaces.push(h);const G=y.length;for(let h=0;h<G;h++){const e=A.vertices[y[h]],i=A.vertices[y[(h+1)%G]];e.vsub(i,s),l.copy(s),n.vmult(l,l),t.vadd(l,l),c.copy(this.faceNormals[b]),n.vmult(c,c),t.vadd(c,c),l.cross(c,I),I.negate(I),C.copy(e),n.vmult(C,C),t.vadd(C,C);const o=y.connectedFaces[h];u.copy(this.faceNormals[o]);const r=this.getPlaneConstantOfFace(o);d.copy(u),n.vmult(d,d);const a=r-d.dot(t);for(this.clipFaceAgainstPlane(p,m,d,a);p.length;)p.shift();for(;m.length;)p.push(m.shift())}u.copy(this.faceNormals[b]);const v=this.getPlaneConstantOfFace(b);d.copy(u),n.vmult(d,d);const B=v-d.dot(t);for(let h=0;h<p.length;h++){let e=d.dot(p[h])+B;if(e<=o&&(console.log("clamped: depth="+e+" to minDist="+o),e=o),e<=r){const t=p[h];if(e<=1e-6){const n={point:t,normal:d,depth:e};a.push(n)}}}}clipFaceAgainstPlane(e,t,n,i){let o,r;const a=e.length;if(a<2)return t;let g=e[e.length-1],s=e[0];o=n.dot(g)+i;for(let l=0;l<a;l++){if(s=e[l],r=n.dot(s)+i,o<0)if(r<0){const e=new h;e.copy(s),t.push(e)}else{const e=new h;g.lerp(s,o/(o-r),e),t.push(e)}else if(r<0){const e=new h;g.lerp(s,o/(o-r),e),t.push(e),t.push(s)}g=s,o=r}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new h);const n=this.vertices,i=this.worldVertices;for(let o=0;o!==this.vertices.length;o++)t.vmult(n[o],i[o]),e.vadd(i[o],i[o]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const o=n[i];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new h);const n=this.faceNormals,i=this.worldFaceNormals;for(let o=0;o!==t;o++)e.vmult(n[o],i[o]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const o=this.vertices;let r,a,g,s,l,c,I=new h;for(let C=0;C<o.length;C++){I.copy(o[C]),t.vmult(I,I),e.vadd(I,I);const n=I;(void 0===r||n.x<r)&&(r=n.x),(void 0===s||n.x>s)&&(s=n.x),(void 0===a||n.y<a)&&(a=n.y),(void 0===l||n.y>l)&&(l=n.y),(void 0===g||n.z<g)&&(g=n.z),(void 0===c||n.z>c)&&(c=n.z)}n.set(r,a,g),i.set(s,l,c)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e=new h){const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let e=0;e<n;e++){const n=i[e];t.vmult(n,n)}for(let e=0;e<this.faceNormals.length;e++){const n=this.faceNormals[e];t.vmult(n,n)}}if(e)for(let o=0;o<n;o++){const t=i[o];t.vadd(e,t)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,o=new h;this.getAveragePointLocal(o);for(let r=0;r<this.faces.length;r++){let a=i[r];const g=t[n[r][0]],s=new h;e.vsub(g,s);const l=a.dot(s),c=new h;o.vsub(g,c);const I=a.dot(c);if(l<0&&I>0||l>0&&I<0)return!1}return-1}static project(e,t,n,i,o){const r=e.vertices.length,a=x;let g=0,s=0;const l=X,c=e.vertices;l.setZero(),w.vectorToLocalFrame(n,i,t,a),w.pointToLocalFrame(n,i,l,l);const I=l.dot(a);s=g=c[0].dot(a);for(let C=1;C<r;C++){const e=c[C].dot(a);e>g&&(g=e),e<s&&(s=e)}if(s-=I,g-=I,s>g){const e=s;s=g,g=e}o[0]=g,o[1]=s}}const R=[],V=[],x=new h,X=new h;class H extends Z{constructor(e){super({type:Z.types.BOX}),this.halfExtents=void 0,this.convexPolyhedronRepresentation=void 0,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=h,o=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],r=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],a=new S({vertices:o,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:r});this.convexPolyhedronRepresentation=a,a.material=this.material}calculateLocalInertia(e,t=new h){return H.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==t)for(let o=0;o!==n.length;o++)t.vmult(n[o],n[o]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,o=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let r=0;r<o.length;r++)Y.set(o[r][0],o[r][1],o[r][2]),t.vmult(Y,Y),e.vadd(Y,Y),n(Y.x,Y.y,Y.z)}calculateWorldAABB(e,t,n,i){const o=this.halfExtents;K[0].set(o.x,o.y,o.z),K[1].set(-o.x,o.y,o.z),K[2].set(-o.x,-o.y,o.z),K[3].set(-o.x,-o.y,-o.z),K[4].set(o.x,-o.y,-o.z),K[5].set(o.x,o.y,-o.z),K[6].set(-o.x,o.y,-o.z),K[7].set(o.x,-o.y,o.z);const r=K[0];t.vmult(r,r),e.vadd(r,r),i.copy(r),n.copy(r);for(let a=1;a<8;a++){const o=K[a];t.vmult(o,o),e.vadd(o,o);const r=o.x,g=o.y,s=o.z;r>i.x&&(i.x=r),g>i.y&&(i.y=g),s>i.z&&(i.z=s),r<n.x&&(n.x=r),g<n.y&&(n.y=g),s<n.z&&(n.z=s)}}}const Y=new h,K=[new h,new h,new h,new h,new h,new h,new h,new h],N=1,M=2,F=4,z=0,L=1,k=2;class E extends class{constructor(){this._listeners=void 0}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[e]||!n[e].includes(t))}hasAnyEventListener(e){if(void 0===this._listeners)return!1;return void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[e])return this;const i=n[e].indexOf(t);return-1!==i&&n[e].splice(i,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}{constructor(e={}){super(),this.id=void 0,this.index=void 0,this.world=void 0,this.preStep=void 0,this.postStep=void 0,this.vlambda=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.collisionResponse=void 0,this.position=void 0,this.previousPosition=void 0,this.interpolatedPosition=void 0,this.initPosition=void 0,this.velocity=void 0,this.initVelocity=void 0,this.force=void 0,this.mass=void 0,this.invMass=void 0,this.material=void 0,this.linearDamping=void 0,this.type=void 0,this.allowSleep=void 0,this.sleepState=void 0,this.sleepSpeedLimit=void 0,this.sleepTimeLimit=void 0,this.timeLastSleepy=void 0,this.wakeUpAfterNarrowphase=void 0,this.torque=void 0,this.quaternion=void 0,this.initQuaternion=void 0,this.previousQuaternion=void 0,this.interpolatedQuaternion=void 0,this.angularVelocity=void 0,this.initAngularVelocity=void 0,this.shapes=void 0,this.shapeOffsets=void 0,this.shapeOrientations=void 0,this.inertia=void 0,this.invInertia=void 0,this.invInertiaWorld=void 0,this.invMassSolve=void 0,this.invInertiaSolve=void 0,this.invInertiaWorldSolve=void 0,this.fixedRotation=void 0,this.angularDamping=void 0,this.linearFactor=void 0,this.angularFactor=void 0,this.aabb=void 0,this.aabbNeedsUpdate=void 0,this.boundingRadius=void 0,this.wlambda=void 0,this.isTrigger=void 0,this.id=E.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new h,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new h,this.previousPosition=new h,this.interpolatedPosition=new h,this.initPosition=new h,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new h,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new h,this.force=new h;const t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?E.STATIC:E.DYNAMIC,typeof e.type==typeof E.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=E.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new h,this.quaternion=new G,this.initQuaternion=new G,this.previousQuaternion=new G,this.interpolatedQuaternion=new G,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new h,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new h,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new h,this.invInertia=new h,this.invInertiaWorld=new u,this.invMassSolve=0,this.invInertiaSolve=new h,this.invInertiaWorldSolve=new u,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new h(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new h(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new b,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new h,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=E.AWAKE,this.wakeUpAfterNarrowphase=!1,e===E.SLEEPING&&this.dispatchEvent(E.wakeupEvent)}sleep(){this.sleepState=E.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===E.AWAKE&&n<i?(this.sleepState=E.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(E.sleepyEvent)):t===E.SLEEPY&&n>i?this.wakeUp():t===E.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(E.sleepEvent))}}updateSolveMassProperties(){this.sleepState===E.SLEEPING||this.type===E.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t=new h){return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t=new h){return this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t=new h){return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t=new h){return this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new h,o=new G;return t&&i.copy(t),n&&o.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let o=0;o!==n;o++){const n=e[o];n.updateBoundingSphereRadius();const r=t[o].length(),a=n.boundingSphereRadius;r+a>i&&(i=r+a)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,o=T,r=U,a=this.quaternion,g=this.aabb,s=_;for(let l=0;l!==i;l++){const i=e[l];a.vmult(t[l],o),o.vadd(this.position,o),a.mult(n[l],r),i.calculateWorldAABB(o,r,s.lowerBound,s.upperBound),0===l?g.copy(s):g.extend(s)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const e=J,n=D;e.setRotationFromQuaternion(this.quaternion),e.transpose(n),e.scale(t,e),e.mmult(n,this.invInertiaWorld)}else;}applyForce(e,t=new h){if(this.type!==E.DYNAMIC)return;this.sleepState===E.SLEEPING&&this.wakeUp();const n=P;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t=new h){if(this.type!==E.DYNAMIC)return;const n=Q,i=O;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===E.DYNAMIC&&(this.sleepState===E.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t=new h){if(this.type!==E.DYNAMIC)return;this.sleepState===E.SLEEPING&&this.wakeUp();const n=t,i=j;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const o=q;n.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}applyLocalImpulse(e,t=new h){if(this.type!==E.DYNAMIC)return;const n=$,i=ee;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=te;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),H.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new h;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==E.DYNAMIC&&this.type!==E.KINEMATIC||this.sleepState===E.SLEEPING)return;const i=this.velocity,o=this.angularVelocity,r=this.position,a=this.force,g=this.torque,s=this.quaternion,l=this.invMass,c=this.invInertiaWorld,I=this.linearFactor,C=l*e;i.x+=a.x*C*I.x,i.y+=a.y*C*I.y,i.z+=a.z*C*I.z;const u=c.elements,d=this.angularFactor,h=g.x*d.x,A=g.y*d.y,p=g.z*d.z;o.x+=e*(u[0]*h+u[1]*A+u[2]*p),o.y+=e*(u[3]*h+u[4]*A+u[5]*p),o.z+=e*(u[6]*h+u[7]*A+u[8]*p),r.x+=i.x*e,r.y+=i.y*e,r.z+=i.z*e,s.integrate(this.angularVelocity,e,this.angularFactor,s),t&&(n?s.normalizeFast():s.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}E.idCounter=0,E.COLLIDE_EVENT_NAME="collide",E.DYNAMIC=N,E.STATIC=M,E.KINEMATIC=F,E.AWAKE=z,E.SLEEPY=L,E.SLEEPING=k,E.wakeupEvent={type:"wakeup"},E.sleepyEvent={type:"sleepy"},E.sleepEvent={type:"sleep"};const T=new h,U=new G,_=new b,J=new u,D=new u,P=new h,Q=new h,O=new h,j=new h,q=new h,$=new h,ee=new h,te=new h;class ne{constructor(){this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new h,this.rayToWorld=new h,this.hitNormalWorld=new h,this.hitPointWorld=new h,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,o,r,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=o,this.body=r,this.distance=a}}let ie,oe,re,ae,ge,se,le;const ce=1,Ie=2,Ce=4;ie=Z.types.SPHERE,oe=Z.types.PLANE,re=Z.types.BOX,ae=Z.types.CYLINDER,ge=Z.types.CONVEXPOLYHEDRON,se=Z.types.HEIGHTFIELD,le=Z.types.TRIMESH;class ue{get[ie](){return this._intersectSphere}get[oe](){return this._intersectPlane}get[re](){return this._intersectBox}get[ae](){return this._intersectConvex}get[ge](){return this._intersectConvex}get[se](){return this._intersectHeightfield}get[le](){return this._intersectTrimesh}constructor(e=new h,t=new h){this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new h,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ue.ANY,this.result=new ne,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||ue.ANY,this.result=t.result||new ne,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(de),he.length=0,e.broadphase.aabbQuery(e,de,he),this.intersectBodies(he),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse)return;if(0==(this.collisionFilterGroup&e.collisionFilterMask)||0==(e.collisionFilterGroup&this.collisionFilterMask))return;const i=me,o=be;for(let r=0,a=e.shapes.length;r<a;r++){const t=e.shapes[r];if((!n||t.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],i),i.vadd(e.position,i),this.intersectShape(t,o,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){if(function(e,t,n){n.vsub(e,Le);const i=Le.dot(t);t.scale(i,ke),ke.vadd(e,ke);return n.distanceTo(ke)}(this.from,this.direction,n)>e.boundingSphereRadius)return;const o=this[e.type];o&&o.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,o)}_intersectPlane(e,t,n,i,o){const r=this.from,a=this.to,g=this.direction,s=new h(0,0,1);t.vmult(s,s);const l=new h;r.vsub(n,l);const c=l.dot(s);a.vsub(n,l);if(c*l.dot(s)>0)return;if(r.distanceTo(a)<c)return;const I=s.dot(g);if(Math.abs(I)<this.precision)return;const C=new h,u=new h,d=new h;r.vsub(n,C);const A=-s.dot(C)/I;g.scale(A,u),r.vadd(u,d),this.reportIntersection(s,d,o,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,o=this.from;t.x=Math.min(i.x,o.x),t.y=Math.min(i.y,o.y),t.z=Math.min(i.z,o.z),n.x=Math.max(i.x,o.x),n.y=Math.max(i.y,o.y),n.z=Math.max(i.z,o.z)}_intersectHeightfield(e,t,n,i,o){e.data,e.elementSize;const r=we;r.from.copy(this.from),r.to.copy(this.to),w.pointToLocalFrame(n,t,r.from,r.from),w.pointToLocalFrame(n,t,r.to,r.to),r.updateDirection();const a=We;let g,s,l,c;g=s=0,l=c=e.data.length-1;const I=new b;r.getAABB(I),e.getIndexOfPosition(I.lowerBound.x,I.lowerBound.y,a,!0),g=Math.max(g,a[0]),s=Math.max(s,a[1]),e.getIndexOfPosition(I.upperBound.x,I.upperBound.y,a,!0),l=Math.min(l,a[0]+1),c=Math.min(c,a[1]+1);for(let C=g;C<l;C++)for(let a=s;a<c;a++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(C,a,I),I.overlapsRay(r)){if(e.getConvexTrianglePillar(C,a,!1),w.pointToWorldFrame(n,t,e.pillarOffset,Ze),this._intersectConvex(e.pillarConvex,t,Ze,i,o,Be),this.result.shouldStop)return;e.getConvexTrianglePillar(C,a,!0),w.pointToWorldFrame(n,t,e.pillarOffset,Ze),this._intersectConvex(e.pillarConvex,t,Ze,i,o,Be)}}}_intersectSphere(e,t,n,i,o){const r=this.from,a=this.to,g=e.radius,s=(a.x-r.x)**2+(a.y-r.y)**2+(a.z-r.z)**2,l=2*((a.x-r.x)*(r.x-n.x)+(a.y-r.y)*(r.y-n.y)+(a.z-r.z)*(r.z-n.z)),c=l**2-4*s*((r.x-n.x)**2+(r.y-n.y)**2+(r.z-n.z)**2-g**2),I=Se,C=Re;if(!(c<0))if(0===c)r.lerp(a,c,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,o,i,-1);else{const e=(-l-Math.sqrt(c))/(2*s),t=(-l+Math.sqrt(c))/(2*s);if(e>=0&&e<=1&&(r.lerp(a,e,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,o,i,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(r.lerp(a,t,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,o,i,-1))}}_intersectConvex(e,t,n,i,o,r){const a=Ve,g=xe,s=r&&r.faceList||null,l=e.faces,c=e.vertices,I=e.faceNormals,C=this.direction,u=this.from,d=this.to,h=u.distanceTo(d),A=s?s.length:l.length,p=this.result;for(let m=0;!p.shouldStop&&m<A;m++){const e=s?s[m]:m,r=l[e],d=I[e],A=t,b=n;g.copy(c[r[0]]),A.vmult(g,g),g.vadd(b,g),g.vsub(u,g),A.vmult(d,a);const f=C.dot(a);if(Math.abs(f)<this.precision)continue;const y=a.dot(g)/f;if(!(y<0)){C.scale(y,fe),fe.vadd(u,fe),ye.copy(c[r[0]]),A.vmult(ye,ye),b.vadd(ye,ye);for(let t=1;!p.shouldStop&&t<r.length-1;t++){Ge.copy(c[r[t]]),ve.copy(c[r[t+1]]),A.vmult(Ge,Ge),A.vmult(ve,ve),b.vadd(Ge,Ge),b.vadd(ve,ve);const n=fe.distanceTo(u);!ue.pointInTriangle(fe,ye,Ge,ve)&&!ue.pointInTriangle(fe,Ge,ye,ve)||n>h||this.reportIntersection(a,fe,o,i,e)}}}}_intersectTrimesh(e,t,n,i,o,r){const a=Xe,g=Fe,s=ze,l=xe,c=He,I=Ye,C=Ke,u=Me,d=Ne,h=e.indices;e.vertices;const A=this.from,p=this.to,m=this.direction;s.position.copy(n),s.quaternion.copy(t),w.vectorToLocalFrame(n,t,m,c),w.pointToLocalFrame(n,t,A,I),w.pointToLocalFrame(n,t,p,C),C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,I.x*=e.scale.x,I.y*=e.scale.y,I.z*=e.scale.z,C.vsub(I,c),c.normalize();const b=I.distanceSquared(C);e.tree.rayQuery(this,s,g);for(let f=0,y=g.length;!this.result.shouldStop&&f!==y;f++){const r=g[f];e.getNormal(r,a),e.getVertex(h[3*r],ye),ye.vsub(I,l);const s=c.dot(a),C=a.dot(l)/s;if(C<0)continue;c.scale(C,fe),fe.vadd(I,fe),e.getVertex(h[3*r+1],Ge),e.getVertex(h[3*r+2],ve);const A=fe.distanceSquared(I);!ue.pointInTriangle(fe,Ge,ye,ve)&&!ue.pointInTriangle(fe,ye,Ge,ve)||A>b||(w.vectorToWorldFrame(t,a,d),w.pointToWorldFrame(n,t,fe,u),this.reportIntersection(d,u,o,i,r))}g.length=0}reportIntersection(e,t,n,i,o){const r=this.from,a=this.to,g=r.distanceTo(t),s=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(s.hitFaceIndex=void 0!==o?o:-1,this.mode){case ue.ALL:this.hasHit=!0,s.set(r,a,e,t,n,i,g),s.hasHit=!0,this.callback(s);break;case ue.CLOSEST:(g<s.distance||!s.hasHit)&&(this.hasHit=!0,s.hasHit=!0,s.set(r,a,e,t,n,i,g));break;case ue.ANY:this.hasHit=!0,s.hasHit=!0,s.set(r,a,e,t,n,i,g),s.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,Le),n.vsub(t,Ae),e.vsub(t,pe);const o=Le.dot(Le),r=Le.dot(Ae),a=Le.dot(pe),g=Ae.dot(Ae),s=Ae.dot(pe);let l,c;return(l=g*a-r*s)>=0&&(c=o*s-r*a)>=0&&l+c<o*g-r*r}}ue.CLOSEST=ce,ue.ANY=Ie,ue.ALL=Ce;const de=new b,he=[],Ae=new h,pe=new h,me=new h,be=new G,fe=new h,ye=new h,Ge=new h,ve=new h,Be={faceList:[0]},Ze=new h,we=new ue,We=[],Se=new h,Re=new h,Ve=new h,xe=new h,Xe=new h,He=new h,Ye=new h,Ke=new h,Ne=new h,Me=new h;new b;const Fe=[],ze=new w,Le=new h,ke=new h;class Ee{constructor(e={}){this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;let t="";"string"==typeof e&&(t=e,e={}),this.name=t,this.id=Ee.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}Ee.idCounter=0,new ue;class Te extends Z{constructor(e){if(super({type:Z.types.SPHERE}),this.radius=void 0,this.radius=void 0!==e?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t=new h){const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const o=this.radius,r=["x","y","z"];for(let a=0;a<r.length;a++){const t=r[a];n[t]=e[t]-o,i[t]=e[t]+o}}}class Ue extends S{constructor(e=1,t=1,n=1,i=8){if(e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const o=i,r=[],a=[],g=[],s=[],l=[],c=Math.cos,I=Math.sin;r.push(new h(-t*I(0),.5*-n,t*c(0))),s.push(0),r.push(new h(-e*I(0),.5*n,e*c(0))),l.push(1);for(let u=0;u<o;u++){const i=2*Math.PI/o*(u+1),C=2*Math.PI/o*(u+.5);u<o-1?(r.push(new h(-t*I(i),.5*-n,t*c(i))),s.push(2*u+2),r.push(new h(-e*I(i),.5*n,e*c(i))),l.push(2*u+3),g.push([2*u,2*u+1,2*u+3,2*u+2])):g.push([2*u,2*u+1,1,0]),(o%2==1||u<o/2)&&a.push(new h(-I(C),0,c(C)))}g.push(s),a.push(new h(0,1,0));const C=[];for(let u=0;u<l.length;u++)C.push(l[l.length-u-1]);g.push(C),super({vertices:r,faces:g,axes:a}),this.radiusTop=void 0,this.radiusBottom=void 0,this.height=void 0,this.numSegments=void 0,this.type=Z.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=i}}class _e extends Z{constructor(){super({type:Z.types.PARTICLE})}calculateLocalInertia(e,t=new h){return t.set(0,0,0),t}volume(){return 0}updateBoundingSphereRadius(){this.boundingSphereRadius=0}calculateWorldAABB(e,t,n,i){n.copy(e),i.copy(e)}}class Je extends Z{constructor(){super({type:Z.types.PLANE}),this.worldNormal=void 0,this.worldNormalNeedsUpdate=void 0,this.boundingSphereRadius=void 0,this.worldNormal=new h,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t=new h){return t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,i){De.set(0,0,1),t.vmult(De,De);const o=Number.MAX_VALUE;n.set(-o,-o,-o),i.set(o,o,o),1===De.x?i.x=e.x:-1===De.x&&(n.x=e.x),1===De.y?i.y=e.y:-1===De.y&&(n.y=e.y),1===De.z?i.z=e.z:-1===De.z&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const De=new h;class Pe extends Z{constructor(e,t={}){t=class{static defaults(e={},t){for(let n in t)n in e||(e[n]=t[n]);return e}}.defaults(t,{maxValue:null,minValue:null,elementSize:1}),super({type:Z.types.HEIGHTFIELD}),this.data=void 0,this.maxValue=void 0,this.minValue=void 0,this.elementSize=void 0,this.cacheEnabled=void 0,this.pillarConvex=void 0,this.pillarOffset=void 0,this._cachedPillars=void 0,this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementSize=t.elementSize,null===t.minValue&&this.updateMinValue(),null===t.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,this.pillarConvex=new S,this.pillarOffset=new h,this.updateBoundingSphereRadius(),this._cachedPillars={}}update(){this._cachedPillars={}}updateMinValue(){const e=this.data;let t=e[0][0];for(let n=0;n!==e.length;n++)for(let i=0;i!==e[n].length;i++){const o=e[n][i];o<t&&(t=o)}this.minValue=t}updateMaxValue(){const e=this.data;let t=e[0][0];for(let n=0;n!==e.length;n++)for(let i=0;i!==e[n].length;i++){const o=e[n][i];o>t&&(t=o)}this.maxValue=t}setHeightValueAtIndex(e,t,n){this.data[e][t]=n,this.clearCachedConvexTrianglePillar(e,t,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),t>0&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),t>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)}getRectMinMax(e,t,n,i,o=[]){const r=this.data;let a=this.minValue;for(let g=e;g<=n;g++)for(let e=t;e<=i;e++){const t=r[g][e];t>a&&(a=t)}o[0]=this.minValue,o[1]=a}getIndexOfPosition(e,t,n,i){const o=this.elementSize,r=this.data;let a=Math.floor(e/o),g=Math.floor(t/o);return n[0]=a,n[1]=g,i&&(a<0&&(a=0),g<0&&(g=0),a>=r.length-1&&(a=r.length-1),g>=r[0].length-1&&(g=r[0].length-1)),!(a<0||g<0||a>=r.length-1||g>=r[0].length-1)}getTriangleAt(e,t,n,i,o,r){const a=Qe;this.getIndexOfPosition(e,t,a,n);let g=a[0],s=a[1];const l=this.data;n&&(g=Math.min(l.length-2,Math.max(0,g)),s=Math.min(l[0].length-2,Math.max(0,s)));const c=this.elementSize,I=(e/c-g)**2+(t/c-s)**2>(e/c-(g+1))**2+(t/c-(s+1))**2;return this.getTriangle(g,s,I,i,o,r),I}getNormalAt(e,t,n,i){const o=et,r=tt,a=nt,g=it,s=ot;this.getTriangleAt(e,t,n,o,r,a),r.vsub(o,g),a.vsub(o,s),g.cross(s,i),i.normalize()}getAabbAtIndex(e,t,{lowerBound:n,upperBound:i}){const o=this.data,r=this.elementSize;n.set(e*r,t*r,o[e][t]),i.set((e+1)*r,(t+1)*r,o[e+1][t+1])}getHeightAt(e,t,n){const i=this.data,o=je,r=qe,a=$e,g=Qe;this.getIndexOfPosition(e,t,g,n);let s=g[0],l=g[1];n&&(s=Math.min(i.length-2,Math.max(0,s)),l=Math.min(i[0].length-2,Math.max(0,l)));const c=this.getTriangleAt(e,t,n,o,r,a);!function(e,t,n,i,o,r,a,g,s){s.x=((r-g)*(e-a)+(a-o)*(t-g))/((r-g)*(n-a)+(a-o)*(i-g)),s.y=((g-i)*(e-a)+(n-a)*(t-g))/((r-g)*(n-a)+(a-o)*(i-g)),s.z=1-s.x-s.y}(e,t,o.x,o.y,r.x,r.y,a.x,a.y,Oe);const I=Oe;return c?i[s+1][l+1]*I.x+i[s][l+1]*I.y+i[s+1][l]*I.z:i[s][l]*I.x+i[s+1][l]*I.y+i[s][l+1]*I.z}getCacheConvexTrianglePillarKey(e,t,n){return e+"_"+t+"_"+(n?1:0)}getCachedConvexTrianglePillar(e,t,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]}setCachedConvexTrianglePillar(e,t,n,i,o){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]={convex:i,offset:o}}clearCachedConvexTrianglePillar(e,t,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]}getTriangle(e,t,n,i,o,r){const a=this.data,g=this.elementSize;n?(i.set((e+1)*g,(t+1)*g,a[e+1][t+1]),o.set(e*g,(t+1)*g,a[e][t+1]),r.set((e+1)*g,t*g,a[e+1][t])):(i.set(e*g,t*g,a[e][t]),o.set((e+1)*g,t*g,a[e+1][t]),r.set(e*g,(t+1)*g,a[e][t+1]))}getConvexTrianglePillar(e,t,n){let i=this.pillarConvex,o=this.pillarOffset;if(this.cacheEnabled){const r=this.getCachedConvexTrianglePillar(e,t,n);if(r)return this.pillarConvex=r.convex,void(this.pillarOffset=r.offset);i=new S,o=new h,this.pillarConvex=i,this.pillarOffset=o}const r=this.data,a=this.elementSize,g=i.faces;i.vertices.length=6;for(let c=0;c<6;c++)i.vertices[c]||(i.vertices[c]=new h);g.length=5;for(let c=0;c<5;c++)g[c]||(g[c]=[]);const s=i.vertices,l=(Math.min(r[e][t],r[e+1][t],r[e][t+1],r[e+1][t+1])-this.minValue)/2+this.minValue;n?(o.set((e+.75)*a,(t+.75)*a,l),s[0].set(.25*a,.25*a,r[e+1][t+1]-l),s[1].set(-.75*a,.25*a,r[e][t+1]-l),s[2].set(.25*a,-.75*a,r[e+1][t]-l),s[3].set(.25*a,.25*a,-Math.abs(l)-1),s[4].set(-.75*a,.25*a,-Math.abs(l)-1),s[5].set(.25*a,-.75*a,-Math.abs(l)-1),g[0][0]=0,g[0][1]=1,g[0][2]=2,g[1][0]=5,g[1][1]=4,g[1][2]=3,g[2][0]=2,g[2][1]=5,g[2][2]=3,g[2][3]=0,g[3][0]=3,g[3][1]=4,g[3][2]=1,g[3][3]=0,g[4][0]=1,g[4][1]=4,g[4][2]=5,g[4][3]=2):(o.set((e+.25)*a,(t+.25)*a,l),s[0].set(-.25*a,-.25*a,r[e][t]-l),s[1].set(.75*a,-.25*a,r[e+1][t]-l),s[2].set(-.25*a,.75*a,r[e][t+1]-l),s[3].set(-.25*a,-.25*a,-Math.abs(l)-1),s[4].set(.75*a,-.25*a,-Math.abs(l)-1),s[5].set(-.25*a,.75*a,-Math.abs(l)-1),g[0][0]=0,g[0][1]=1,g[0][2]=2,g[1][0]=5,g[1][1]=4,g[1][2]=3,g[2][0]=0,g[2][1]=2,g[2][2]=5,g[2][3]=3,g[3][0]=1,g[3][1]=0,g[3][2]=3,g[3][3]=4,g[4][0]=4,g[4][1]=5,g[4][2]=2,g[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,n,i,o)}calculateLocalInertia(e,t=new h){return t.set(0,0,0),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){const e=this.data,t=this.elementSize;this.boundingSphereRadius=new h(e.length*t,e[0].length*t,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()}setHeightsFromImage(e,t){const{x:n,z:i,y:o}=t,r=document.createElement("canvas");r.width=e.width,r.height=e.height;const a=r.getContext("2d");a.drawImage(e,0,0);const g=a.getImageData(0,0,e.width,e.height),s=this.data;s.length=0,this.elementSize=Math.abs(n)/g.width;for(let l=0;l<g.height;l++){const e=[];for(let t=0;t<g.width;t++){const o=(g.data[4*(l*g.height+t)]+g.data[4*(l*g.height+t)+1]+g.data[4*(l*g.height+t)+2])/4/255*i;n<0?e.push(o):e.unshift(o)}o<0?s.unshift(e):s.push(e)}this.updateMaxValue(),this.updateMinValue(),this.update()}}const Qe=[],Oe=new h,je=new h,qe=new h,$e=new h,et=new h,tt=new h,nt=new h,it=new h,ot=new h;class rt{constructor(e={}){this.root=void 0,this.aabb=void 0,this.data=void 0,this.children=void 0,this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new b,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,n=0){const i=this.data;if(!this.aabb.contains(e))return!1;const o=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let i=!1;o.length||(this.subdivide(),i=!0);for(let r=0;8!==r;r++)if(o[r].insert(e,t,n+1))return!0;i&&(o.length=0)}return i.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,n=e.upperBound,i=this.children;i.push(new rt({aabb:new b({lowerBound:new h(0,0,0)})}),new rt({aabb:new b({lowerBound:new h(1,0,0)})}),new rt({aabb:new b({lowerBound:new h(1,1,0)})}),new rt({aabb:new b({lowerBound:new h(1,1,1)})}),new rt({aabb:new b({lowerBound:new h(0,1,1)})}),new rt({aabb:new b({lowerBound:new h(0,0,1)})}),new rt({aabb:new b({lowerBound:new h(1,0,1)})}),new rt({aabb:new b({lowerBound:new h(0,1,0)})})),n.vsub(t,gt),gt.scale(.5,gt);const o=this.root||this;for(let r=0;8!==r;r++){const e=i[r];e.root=o;const n=e.aabb.lowerBound;n.x*=gt.x,n.y*=gt.y,n.z*=gt.z,n.vadd(t,n),n.vadd(gt,e.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t}rayQuery(e,t,n){return e.getAABB(st),st.toLocalFrame(t,st),this.aabbQuery(st,n),n}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class at extends rt{constructor(e,t={}){super({root:null,aabb:e}),this.maxDepth=void 0,this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}}const gt=new h,st=new b;class lt extends Z{constructor(e,t){super({type:Z.types.TRIMESH}),this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.aabb=void 0,this.edges=void 0,this.scale=void 0,this.tree=void 0,this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new b,this.edges=null,this.scale=new h(1,1,1),this.tree=new at,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const n=new b,i=new h,o=new h,r=new h,a=[i,o,r];for(let g=0;g<this.indices.length/3;g++){const t=3*g;this._getUnscaledVertex(this.indices[t],i),this._getUnscaledVertex(this.indices[t+1],o),this._getUnscaledVertex(this.indices[t+2],r),n.setFromPoints(a),e.insert(n,g)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){It.copy(e);const n=this.scale,i=n.x,o=n.y,r=n.z,a=It.lowerBound,g=It.upperBound;return a.x/=i,a.y/=o,a.z/=r,g.x/=i,g.y/=o,g.z/=r,this.tree.aabbQuery(It,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=ct,t=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,o=this.indices[i],r=this.indices[i+1],a=this.indices[i+2];this.getVertex(o,At),this.getVertex(r,pt),this.getVertex(a,mt),lt.computeNormal(pt,At,mt,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}}updateEdges(){const e={},t=(t,n)=>{e[t<n?t+"_"+n:n+"_"+t]=!0};for(let i=0;i<this.indices.length/3;i++){const e=3*i,n=this.indices[e],o=this.indices[e+1],r=this.indices[e+2];t(n,o),t(o,r),t(r,n)}const n=Object.keys(e);this.edges=new Int16Array(2*n.length);for(let i=0;i<n.length;i++){const e=n[i].split("_");this.edges[2*i]=parseInt(e[0],10),this.edges[2*i+1]=parseInt(e[1],10)}}getEdgeVertex(e,t,n){const i=this.edges[2*e+(t?1:0)];this.getVertex(i,n)}getEdgeVector(e,t){const n=Ct,i=ut;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)}static computeNormal(e,t,n,i){t.vsub(e,ht),n.vsub(t,dt),dt.cross(ht,i),i.isZero()||i.normalize()}getVertex(e,t){const n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){const n=3*e,i=this.vertices;return t.set(i[n],i[n+1],i[n+2])}getWorldVertex(e,t,n,i){return this.getVertex(e,i),w.pointToWorldFrame(t,n,i,i),i}getTriangleVertices(e,t,n,i){const o=3*e;this.getVertex(this.indices[o],t),this.getVertex(this.indices[o+1],n),this.getVertex(this.indices[o+2],i)}getNormal(e,t){const n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(e,t){this.computeLocalAABB(bt);const n=bt.upperBound.x-bt.lowerBound.x,i=bt.upperBound.y-bt.lowerBound.y,o=bt.upperBound.z-bt.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*o*2*o),1/12*e*(2*n*2*n+2*o*2*o),1/12*e*(2*i*2*i+2*n*2*n))}computeLocalAABB(e){const t=e.lowerBound,n=e.upperBound,i=this.vertices.length;this.vertices;const o=ft;this.getVertex(0,o),t.copy(o),n.copy(o);for(let r=0;r!==i;r++)this.getVertex(r,o),o.x<t.x?t.x=o.x:o.x>n.x&&(n.x=o.x),o.y<t.y?t.y=o.y:o.y>n.y&&(n.y=o.y),o.z<t.z?t.z=o.z:o.z>n.z&&(n.z=o.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,n=new h;for(let i=0,o=t.length/3;i!==o;i++){this.getVertex(i,n);const t=n.lengthSquared();t>e&&(e=t)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const o=yt,r=Gt;o.position=e,o.quaternion=t,this.aabb.toWorldFrame(o,r),n.copy(r.lowerBound),i.copy(r.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e=1,t=.5,n=8,i=6,o=2*Math.PI){const r=[],a=[];for(let g=0;g<=n;g++)for(let a=0;a<=i;a++){const s=a/i*o,l=g/n*Math.PI*2,c=(e+t*Math.cos(l))*Math.cos(s),I=(e+t*Math.cos(l))*Math.sin(s),C=t*Math.sin(l);r.push(c,I,C)}for(let g=1;g<=n;g++)for(let e=1;e<=i;e++){const t=(i+1)*g+e-1,n=(i+1)*(g-1)+e-1,o=(i+1)*(g-1)+e,r=(i+1)*g+e;a.push(t,n,r),a.push(n,o,r)}return new lt(r,a)}}const ct=new h,It=new b,Ct=new h,ut=new h,dt=new h,ht=new h,At=new h,pt=new h,mt=new h,bt=new b,ft=new h,yt=new w,Gt=new b;Z.types.SPHERE,Z.types.SPHERE,Z.types.PLANE,Z.types.BOX,Z.types.BOX,Z.types.SPHERE,Z.types.BOX,Z.types.PLANE,Z.types.BOX,Z.types.CONVEXPOLYHEDRON,Z.types.SPHERE,Z.types.CONVEXPOLYHEDRON,Z.types.PLANE,Z.types.CONVEXPOLYHEDRON,Z.types.BOX,Z.types.CONVEXPOLYHEDRON,Z.types.SPHERE,Z.types.HEIGHTFIELD,Z.types.BOX,Z.types.HEIGHTFIELD,Z.types.CONVEXPOLYHEDRON,Z.types.HEIGHTFIELD,Z.types.PARTICLE,Z.types.SPHERE,Z.types.PLANE,Z.types.PARTICLE,Z.types.BOX,Z.types.PARTICLE,Z.types.PARTICLE,Z.types.CONVEXPOLYHEDRON,Z.types.CYLINDER,Z.types.SPHERE,Z.types.CYLINDER,Z.types.PLANE,Z.types.CYLINDER,Z.types.BOX,Z.types.CYLINDER,Z.types.CONVEXPOLYHEDRON,Z.types.CYLINDER,Z.types.HEIGHTFIELD,Z.types.CYLINDER,Z.types.PARTICLE,Z.types.CYLINDER,Z.types.SPHERE,Z.types.TRIMESH,Z.types.PLANE,Z.types.TRIMESH,new b,new b,new ue;const vt=globalThis.performance||{};if(!vt.now){let e=Date.now();vt.timing&&vt.timing.navigationStart&&(e=vt.timing.navigationStart),vt.now=()=>Date.now()-e}function Bt(e,t,n={}){var i;const o=[],a=new r.MeshBasicMaterial({color:null!=(i=n.color)?i:65280,wireframe:!0}),g=new h,s=new h,l=new h,c=new G,I=new r.SphereGeometry(1),C=new r.BoxGeometry(1,1,1),u=new r.PlaneGeometry(10,10,10,10);function d(t){let n=new r.Mesh;const{SPHERE:i,BOX:o,PLANE:c,CYLINDER:d,CONVEXPOLYHEDRON:h,TRIMESH:A,HEIGHTFIELD:p}=Z.types;switch(t.type){case i:n=new r.Mesh(I,a);break;case o:n=new r.Mesh(C,a);break;case c:n=new r.Mesh(u,a);break;case d:{const e=new r.CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,t.numSegments);n=new r.Mesh(e,a),t.geometryId=e.id;break}case h:{const e=function(e){const t=new r.BufferGeometry,n=[];for(let o=0;o<e.vertices.length;o++){const t=e.vertices[o];n.push(t.x,t.y,t.z)}t.setAttribute("position",new r.Float32BufferAttribute(n,3));const i=[];for(let o=0;o<e.faces.length;o++){const t=e.faces[o],n=t[0];for(let e=1;e<t.length-1;e++){const o=t[e],r=t[e+1];i.push(n,o,r)}}return t.setIndex(i),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);n=new r.Mesh(e,a),t.geometryId=e.id;break}case A:{const e=function(e){const t=new r.BufferGeometry,n=[],i=g,o=s,a=l;for(let r=0;r<e.indices.length/3;r++)e.getTriangleVertices(r,i,o,a),n.push(i.x,i.y,i.z),n.push(o.x,o.y,o.z),n.push(a.x,a.y,a.z);return t.setAttribute("position",new r.Float32BufferAttribute(n,3)),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);n=new r.Mesh(e,a),t.geometryId=e.id;break}case p:{const e=function(e){const t=new r.BufferGeometry,n=[],i=g,o=s,a=l;for(let r=0;r<e.data.length-1;r++)for(let t=0;t<e.data[r].length-1;t++)for(let g=0;g<2;g++)e.getConvexTrianglePillar(r,t,0===g),i.copy(e.pillarConvex.vertices[0]),o.copy(e.pillarConvex.vertices[1]),a.copy(e.pillarConvex.vertices[2]),i.vadd(e.pillarOffset,i),o.vadd(e.pillarOffset,o),a.vadd(e.pillarOffset,a),n.push(i.x,i.y,i.z),n.push(o.x,o.y,o.z),n.push(a.x,a.y,a.z);return t.setAttribute("position",new r.Float32BufferAttribute(n,3)),t.computeBoundingSphere(),t.computeVertexNormals(),t}(t);n=new r.Mesh(e,a),t.geometryId=e.id;break}}return e.add(n),n}function A(t,n){let i=o[t],a=!1;return function(e,t){if(!e)return!1;const{geometry:n}=e;return n instanceof r.SphereGeometry&&t.type===Z.types.SPHERE||n instanceof r.BoxGeometry&&t.type===Z.types.BOX||n instanceof r.PlaneGeometry&&t.type===Z.types.PLANE||n.id===t.geometryId&&t.type===Z.types.CYLINDER||n.id===t.geometryId&&t.type===Z.types.CONVEXPOLYHEDRON||n.id===t.geometryId&&t.type===Z.types.TRIMESH||n.id===t.geometryId&&t.type===Z.types.HEIGHTFIELD}(i,n)||(i&&e.remove(i),o[t]=i=d(n),a=!0),function(e,t){const{SPHERE:n,BOX:i,PLANE:o,CYLINDER:r,CONVEXPOLYHEDRON:a,TRIMESH:g,HEIGHTFIELD:s}=Z.types;switch(t.type){case n:{const{radius:n}=t;e.scale.set(n,n,n);break}case i:e.scale.copy(t.halfExtents),e.scale.multiplyScalar(2);break;case o:break;case r:case a:e.scale.set(1,1,1);break;case g:e.scale.copy(t.scale);break;case s:e.scale.set(1,1,1)}}(i,n),a}function p(){const i=o,r=g,a=c;let s=0;for(const e of t)for(let t=0;t!==e.shapes.length;t++){const o=e.shapes[t],g=A(s,o),l=i[s];l&&(e.quaternion.vmult(e.shapeOffsets[t],r),e.position.vadd(r,r),e.quaternion.mult(e.shapeOrientations[t],a),l.position.copy(r),l.quaternion.copy(a),g&&n.onInit instanceof Function&&n.onInit(e,l,o),!g&&n.onUpdate instanceof Function&&n.onUpdate(e,l,o)),s++}for(let t=s;t<i.length;t++){const n=i[t];n&&e.remove(n)}i.length=s,!1!==n.autoUpdate&&requestAnimationFrame(p)}return!1!==n.autoUpdate&&requestAnimationFrame(p),{update:p}}function Zt(){const{debugInfo:e,refs:t}=(0,i.useContext)(a),n=(0,i.useMemo)((()=>new r.Scene),[]),[,o]=(0,i.useState)(0),g=(0,i.useMemo)((()=>e?Bt(n,e.bodies,{autoUpdate:!1}):null),[n,e]);return(0,i.useEffect)((()=>{if(null===e||null===g)return void console.warn("Please don't use <CannonDebugRenderer /> directly. Add 'debug' prop to <Physics />");let n=-1;const i=()=>{for(const n in e.refs)e.refs[n].position.copy(t[n].position),e.refs[n].quaternion.copy(t[n].quaternion);g.update(),o((e=>e+1)),n=requestAnimationFrame(i)};return i(),()=>{cancelAnimationFrame(n)}}),[]),i.createElement(i.Fragment,null,n.children.map((e=>i.createElement("primitive",{key:e.uuid,object:e}))))}function wt({children:e,step:t=1/60,gravity:n=[0,-10,0],tolerance:r=.001,iterations:g=5,allowSleep:s=!1,broadphase:l="Naive",axisIndex:c=0,defaultContactMaterial:I={contactEquationStiffness:1e6},size:u=1e3,debug:d=!1}){const{gl:h,invalidate:A}=(0,o.Ky)(),[p]=(0,i.useState)((()=>new C)),[m]=(0,i.useState)({}),[b]=(0,i.useState)((()=>({positions:new Float32Array(3*u),quaternions:new Float32Array(4*u)}))),[f]=(0,i.useState)({}),[y]=(0,i.useState)({}),[G]=(0,i.useState)(d?{bodies:[],refs:{}}:null),v=(0,i.useRef)({}),B=(0,i.useMemo)((()=>()=>{0!==b.positions.byteLength&&0!==b.quaternions.byteLength&&p.postMessage({op:"step",...b},[b.positions.buffer,b.quaternions.buffer])}),[]),Z=(0,i.useRef)(!1);(0,o.xQ)((()=>{var e,t,n,i,o,r;(B(),null!=(e=h.xr)&&e.enabled)&&(null!=(t=h.xr)&&t.isPresenting&&!Z.current&&(null==(n=h.xr)||null==n.getSession||null==(i=n.getSession())||i.requestAnimationFrame(B)),null!=(o=h.xr)&&o.isPresenting||!Z.current||requestAnimationFrame(B),Z.current=null==(r=h.xr)?void 0:r.isPresenting)})),(0,i.useEffect)((()=>{p.postMessage({op:"init",props:{gravity:n,tolerance:r,step:t,iterations:g,broadphase:l,allowSleep:s,axisIndex:c,defaultContactMaterial:I}});let e,i,o=0;return p.onmessage=t=>{switch(t.data.op){case"frame":if(t.data.bodies)for(o=0;o<t.data.bodies.length;o++)e=t.data.bodies[o],v.current[e]=t.data.bodies.indexOf(e);for(b.positions=t.data.positions,b.quaternions=t.data.quaternions,o=0;o<t.data.observations.length;o++)i=t.data.observations[o],y[i[0]]&&y[i[0]](i[1]);t.data.active&&A();break;case"event":switch(t.data.type){case"collide":f[t.data.target]({...t.data,target:m[t.data.target],body:m[t.data.body]});break;case"rayhit":f[t.data.ray.uuid]({...t.data,body:t.data.body?m[t.data.body]:null})}}},()=>p.terminate()}),[]),function({worker:e,gravity:t,tolerance:n,step:o,iterations:r,broadphase:a,axisIndex:g}){(0,i.useEffect)((()=>{e.postMessage({op:"setGravity",props:t})}),[t]),(0,i.useEffect)((()=>{e.postMessage({op:"setTolerance",props:n})}),[n]),(0,i.useEffect)((()=>{e.postMessage({op:"setStep",props:o})}),[o]),(0,i.useEffect)((()=>{e.postMessage({op:"setIterations",props:r})}),[r]),(0,i.useEffect)((()=>{e.postMessage({op:"setBroadphase",props:a})}),[a]),(0,i.useEffect)((()=>{e.postMessage({op:"setAxisIndex",props:g})}),[g])}({worker:p,axisIndex:c,broadphase:l,gravity:n,iterations:g,step:t,tolerance:r});const w=(0,i.useMemo)((()=>({worker:p,bodies:v,refs:m,buffers:b,events:f,subscriptions:y,debugInfo:G})),[p,v,m,b,f,y,G]);return i.createElement(a.Provider,{value:w},d&&i.createElement(Zt,null),e)}function Wt(e,t){switch(e){case"Box":return new H(new h(...t.map((e=>e/2))));case"ConvexPolyhedron":const[e,n,i]=t;return new S({vertices:e.map((([e,t,n])=>new h(e,t,n))),normals:i?i.map((([e,t,n])=>new h(e,t,n))):null,faces:n});case"Cylinder":return new Ue(...t);case"Heightfield":return new Pe(...t);case"Particle":return new _e;case"Plane":return new Je;case"Sphere":return new Te(...t);case"Trimesh":return new lt(...t)}}const St=new r.Object3D;function Rt(e,t){return e+t.charAt(0).toUpperCase()+t.slice(1)}function Vt(e,t){return void 0!==t?`${e.current.uuid}/${t}`:e.current.uuid}function xt(e,t,n,i,o){return e.current&&t.postMessage({op:n,uuid:Vt(e,i),props:o})}function Xt(e,t,n,i,o,r){return a=>{const g=Kt++;return n[g]=a,xt(e,t,"subscribe",o,{id:g,type:i,target:null==r?"bodies":r}),()=>{delete n[g],t.postMessage({op:"unsubscribe",props:g})}}}function Ht(e,t,n){return t.args=n(t.args),e.userData=t.userData||{},e.position.set(...t.position||[0,0,0]),e.rotation.set(...t.rotation||[0,0,0]),t}function Yt(e,t,n){void 0!==t&&(e.position.fromArray(n.positions,3*t),e.quaternion.fromArray(n.quaternions,4*t))}let Kt=0;function Nt(e,t,n,g,s=[]){const l=(0,i.useRef)(null),c=g||l,{worker:I,bodies:C,buffers:u,refs:d,events:A,subscriptions:p,debugInfo:m}=(0,i.useContext)(a);(0,i.useLayoutEffect)((()=>{c.current||(c.current=new r.Object3D);const i=c.current,o=I;let a,g=[i.uuid];return i instanceof r.InstancedMesh?(i.instanceMatrix.setUsage(r.DynamicDrawUsage),g=new Array(i.count).fill(0).map(((e,t)=>`${i.uuid}/${t}`)),a=g.map(((e,o)=>{const r=Ht(St,t(o),n);return St.updateMatrix(),i.setMatrixAt(o,St.matrix),i.instanceMatrix.needsUpdate=!0,r}))):a=[Ht(i,t(0),n)],a.forEach(((t,n)=>{if(d[g[n]]=i,m){const i=((e,t,n)=>{const{args:i=[],position:o=[0,0,0],rotation:r=[0,0,0],scale:a=[1,1,1],velocity:g=[0,0,0],angularVelocity:s=[0,0,0],linearFactor:l=[1,1,1],angularFactor:c=[1,1,1],type:I,mass:C,material:u,shapes:d,onCollide:A,collisionResponse:p,...m}=t,b=new E({...m,mass:"Static"===I?0:C,type:I?E[I.toUpperCase()]:void 0,material:u?new Ee(u):void 0});return b.uuid=e,void 0!==p&&(b.collisionResponse=p),"Compound"===n?d.forEach((({type:e,args:t,position:n,rotation:i,material:o,...r})=>{const a=b.addShape(Wt(e,t),n?new h(...n):void 0,i?(new G).setFromEuler(...i):void 0);o&&(a.material=new Ee(o)),Object.assign(a,r)})):b.addShape(Wt(n,i)),b.position.set(o[0],o[1],o[2]),b.quaternion.setFromEuler(r[0],r[1],r[2]),b.velocity.set(g[0],g[1],g[2]),b.angularVelocity.set(s[0],s[1],s[2]),b.linearFactor.set(l[0],l[1],l[2]),b.angularFactor.set(c[0],c[1],c[2]),b})(g[n],t,e);m.bodies.push(i),m.refs[g[n]]=i}t.onCollide&&(A[g[n]]=t.onCollide,t.onCollide=!0)})),o.postMessage({op:"addBodies",type:e,uuid:g,props:a}),()=>{a.forEach(((e,t)=>{if(delete d[g[t]],m){const e=m.bodies.indexOf(m.refs[g[t]]);e>-1&&m.bodies.splice(e,1),delete m.refs[g[t]]}e.onCollide&&delete A[g[t]]})),o.postMessage({op:"removeBodies",uuid:g})}}),s),(0,o.xQ)((()=>{if(c.current&&u.positions.length&&u.quaternions.length)if(c.current instanceof r.InstancedMesh)for(let e=0;e<c.current.count;e++){const t=C.current[`${c.current.uuid}/${e}`];void 0!==t&&(Yt(St,t,u),St.updateMatrix(),c.current.setMatrixAt(e,St.matrix)),c.current.instanceMatrix.needsUpdate=!0}else Yt(c.current,C.current[c.current.uuid],u)}));const b=(0,i.useMemo)((()=>{const e=(e,t)=>({set:(n,i,o)=>xt(c,I,Rt("set",e),t,[n,i,o]),copy:({x:n,y:i,z:o})=>xt(c,I,Rt("set",e),t,[n,i,o]),subscribe:Xt(c,I,p,e,t)}),t=(e,t)=>({set:n=>xt(c,I,Rt("set",e),t,n),subscribe:Xt(c,I,p,e,t)});function n(n){return{position:e("position",n),rotation:e("quaternion",n),velocity:e("velocity",n),angularVelocity:e("angularVelocity",n),linearFactor:e("linearFactor",n),angularFactor:e("angularFactor",n),mass:t("mass",n),linearDamping:t("linearDamping",n),angularDamping:t("angularDamping",n),allowSleep:t("allowSleep",n),sleepSpeedLimit:t("sleepSpeedLimit",n),sleepTimeLimit:t("sleepTimeLimit",n),collisionFilterGroup:t("collisionFilterGroup",n),collisionFilterMask:t("collisionFilterMask",n),collisionResponse:t("collisionResponse",n),fixedRotation:t("fixedRotation",n),userData:t("userData",n),isTrigger:t("isTrigger",n),applyForce(e,t){xt(c,I,"applyForce",n,[e,t])},applyImpulse(e,t){xt(c,I,"applyImpulse",n,[e,t])},applyLocalForce(e,t){xt(c,I,"applyLocalForce",n,[e,t])},applyLocalImpulse(e,t){xt(c,I,"applyLocalImpulse",n,[e,t])}}}const i={};return{...n(void 0),at:e=>i[e]||(i[e]=n(e))}}),[]);return[c,b]}function Mt(e,t,n){return Nt("Plane",e,(()=>[]),t,n)}function Ft(e,t,n){return Nt("Box",e,(e=>e||[1,1,1]),t,n)}function zt(e){return i.createElement(i.Suspense,{fallback:null},i.createElement(wt,e))}},4855:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var i=n(7560),o=n(8283),r=n(2784),a=n(7209),g=n(3703);const s=(0,r.forwardRef)(((e={enableDamping:!0},t)=>{const{camera:n}=e,s=(0,o.Z)(e,["camera"]),l=(0,a.Ky)((({invalidate:e})=>e)),c=(0,a.Ky)((({camera:e})=>e)),I=(0,a.Ky)((({gl:e})=>e.domElement)),C=n||c,u=(0,r.useMemo)((()=>new g.o(C)),[C]);return(0,r.useEffect)((()=>(u.connect(I),u.addEventListener("change",l),()=>{u.dispose(),u.removeEventListener("change",l)})),[u,l,I]),(0,a.xQ)((()=>u.update())),(0,r.createElement)("primitive",(0,i.Z)({ref:t,dispose:void 0,object:u,enableDamping:!0},s))}))},9713:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});var i=n(7560),o=n(8283),r=n(2784),a=n(7209),g=n(3703);const s=(0,r.forwardRef)(((e,t)=>{let{camera:n,regress:s,enableDamping:l=!0}=e,c=(0,o.Z)(e,["camera","regress","enableDamping"]);const I=(0,a.Ky)((({invalidate:e})=>e)),C=(0,a.Ky)((({camera:e})=>e)),u=(0,a.Ky)((({gl:e})=>e)),d=(0,a.Ky)((({performance:e})=>e)),h=n||C,A=(0,r.useMemo)((()=>new g.z(h)),[h]);return(0,a.xQ)((()=>A.update())),(0,r.useEffect)((()=>{const e=()=>{I(),s&&d.regress()};return A.connect(u.domElement),A.addEventListener("change",e),()=>{A.removeEventListener("change",e),A.dispose()}}),[s,A,I]),(0,r.createElement)("primitive",(0,i.Z)({ref:t,object:A,enableDamping:l},c))}))},6784:function(e,t,n){"use strict";n.d(t,{c:function(){return s}});var i=n(7560),o=n(8283),r=n(2784),a=n(7209);var g=function(e){return function(t){e.forEach((function(e){"function"==typeof e?e(t):null!=e&&(e.current=t)}))}};const s=(0,r.forwardRef)(((e,t)=>{let{makeDefault:n=!1}=e,s=(0,o.Z)(e,["makeDefault"]);const l=(0,a.Ky)((({set:e})=>e)),c=(0,a.Ky)((({camera:e})=>e)),I=(0,a.Ky)((({size:e})=>e)),C=(0,r.useRef)();return(0,r.useLayoutEffect)((()=>{const{current:e}=C;e&&(e.aspect=I.width/I.height,e.updateProjectionMatrix())}),[I,s]),(0,r.useLayoutEffect)((()=>{if(n&&C.current){const e=c;return l((()=>({camera:C.current}))),()=>l((()=>({camera:e})))}}),[c,C,n,l]),(0,r.createElement)("perspectiveCamera",(0,i.Z)({ref:g([C,t])},s))}))},7015:function(e,t,n){"use strict";n.d(t,{x:function(){return _}});var i=n(7560),o=n(8283),r=n(2784),a=n(7209),g=n(2955);function s(){var e,t=0,n=[],i=0,o=0;var r=u((function(e){o||g(1,e)})),a=u((function(e){o||g(-1,e)}));function g(n,i){o++;var r=0;try{i===A&&d();var a=n>0&&C(i);a?a.call(i,u((function(e){r++,g(1,e)})),u((function(e){r++,g(-1,e)}))):(t=n,e=i,l())}catch(s){t||r||g(-1,s)}}function l(){i||(setTimeout(c,0),i=1)}function c(){var e=n;i=0,n=[],e.forEach(I)}function I(e){e()}function C(e){var t=e&&(h(e)||"object"==typeof e)&&e.then;return h(t)&&t}function u(e){var t=0;return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];t++||e.apply(this,n)}}function d(){throw new TypeError("Chaining cycle detected")}var h=function(e){return"function"==typeof e},A={then:function(i,o){var r=s();return n.push((function(){var n=t>0?i:o;if(h(n))try{var a=n(e);a===r&&d();var g=C(a);g?g.call(a,r.resolve,r.reject):r.resolve(a)}catch(s){r.reject(s)}else r[t>0?"resolve":"reject"](e)})),t&&l(),r},resolve:r,reject:a};return A}function l(){var e,t,n=new Promise((function(n,i){e=n,t=i}));return{then:n.then.bind(n),resolve:e,reject:t}}s.all=l.all=function(e){var t=0,n=[],i=c();return 0===e.length?i.resolve([]):e.forEach((function(o,r){var a=c();a.resolve(o),a.then((function(o){t++,n[r]=o,t===e.length&&i.resolve(n)}),i.reject)})),i};var c="function"==typeof Promise?l:s;function I(){var e=Object.create(null);function t(i,o){var r=i.id,a=i.name,g=i.dependencies;void 0===g&&(g=[]);var s=i.init;void 0===s&&(s=function(){});var l=i.getTransferables;if(void 0===l&&(l=null),!e[r])try{g=g.map((function(n){return n&&n.isWorkerModule&&(t(n,(function(e){if(e instanceof Error)throw e})),n=e[n.id].value),n})),s=n("<"+a+">.init",s),l&&(l=n("<"+a+">.getTransferables",l));var c=null;"function"==typeof s?c=s.apply(void 0,g):console.error("worker module init function failed to rehydrate"),e[r]={id:r,value:c,getTransferables:l},o(c)}catch(I){I&&I.noLog||console.error(I),o(I)}}function n(e,t){var n=void 0;self.troikaDefine=function(e){return n=e};var i=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(o){console.error(o)}return URL.revokeObjectURL(i),delete self.troikaDefine,n}self.addEventListener("message",(function(n){var i=n.data,o=i.messageId,r=i.action,a=i.data;try{"registerModule"===r&&t(a,(function(e){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===r&&function(t,n){var i,o=t.id,r=t.args;e[o]&&"function"==typeof e[o].value||n(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var a=(i=e[o]).value.apply(i,r);a&&"function"==typeof a.then?a.then(g,(function(e){return n(e instanceof Error?e:new Error(""+e))})):g(a)}catch(s){n(s)}function g(t){try{var i=e[o].getTransferables&&e[o].getTransferables(t);i&&Array.isArray(i)&&i.length||(i=void 0),n(t,i)}catch(s){console.error(s),n(s)}}}(a,(function(e,t){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:e},t||void 0)}))}catch(g){postMessage({messageId:o,success:!1,error:g.stack})}}))}var C=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return C=function(){return e},e},u=0,d=0,h=!1,A=Object.create(null),p=function(){var e=Object.create(null);return e._count=0,e}();function m(e){if(!(e&&"function"==typeof e.init||h))throw new Error("requires `options.init` function");var t=e.dependencies,n=e.init,i=e.getTransferables,o=e.workerId;if(!C())return function(e){var t=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t._getInitResult().then((function(t){if("function"==typeof t)return t.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var n=e.dependencies,i=e.init;n=Array.isArray(n)?n.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var o=c.all(n).then((function(e){return i.apply(null,e)}));return t._getInitResult=function(){return o},o},t}(e);null==o&&(o="#default");var r="workerModule"+ ++u,a=e.name||r,g=null;function s(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return g||(g=f(o,"registerModule",s.workerModuleData)),g.then((function(t){if(t.isCallable)return f(o,"callModule",{id:r,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!=typeof e||e.workerModuleData||(h=!0,e=m({workerId:o,name:"<"+a+"> function dependency: "+e.name,init:"function(){return (\n"+b(e)+"\n)}"}),h=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),s.workerModuleData={isWorkerModule:!0,id:r,name:a,dependencies:t,init:b(n),getTransferables:i&&b(i)},s}function b(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function f(e,t,n){var i=c(),o=++d;return p[o]=function(e){e.success?i.resolve(e.result):i.reject(new Error("Error in worker "+t+" call: "+e.error))},p._count++,p._count>1e3&&console.warn("Large number of open WorkerModule requests, some may not be returning"),function(e){var t=A[e];if(!t){var n=b(I);(t=A[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,n=t.messageId,i=p[n];if(!i)throw new Error("WorkerModule response with empty or unknown messageId");delete p[n],p._count--,i(t)}}return t}(e).postMessage({messageId:o,action:t,data:n}),i}var y=m({name:"Thenable",dependencies:[c],init:function(e){return e}});const G=/\bvoid\s+main\s*\(\s*\)\s*{/g;function v(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){let n=g.ShaderChunk[t];return n?v(n):e}))}const B=Object.assign||function(){let e=arguments[0];for(let t=1,n=arguments.length;t<n;t++){let n=arguments[t];if(n)for(let t in n)n.hasOwnProperty(t)&&(e[t]=n[t])}return e},Z=Date.now(),w=new WeakMap,W=new Map;let S=1e10;function R(e,t){const n=function(e){const t=JSON.stringify(e,x);let n=H.get(t);null==n&&H.set(t,n=++X);return n}(t);let i=w.get(e);if(i||w.set(e,i=Object.create(null)),i[n])return new i[n];const o=`_onBeforeCompile${n}`,r=function(i){e.onBeforeCompile.call(this,i);const r=n+"|||"+i.vertexShader+"|||"+i.fragmentShader;let a=W[r];if(!a){const e=function({vertexShader:e,fragmentShader:t},n,i){let{vertexDefs:o,vertexMainIntro:r,vertexMainOutro:a,vertexTransform:g,fragmentDefs:s,fragmentMainIntro:l,fragmentMainOutro:c,fragmentColorTransform:I,customRewriter:C,timeUniform:u}=n;o=o||"",r=r||"",a=a||"",s=s||"",l=l||"",c=c||"",(g||C)&&(e=v(e));(I||C)&&(t=v(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(C){let n=C({vertexShader:e,fragmentShader:t});e=n.vertexShader,t=n.fragmentShader}if(I){let e=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(t=>(e.push(t),""))),c=`${I}\n${e.join("\n")}\n${c}`}if(u){const e=`\nuniform float ${u};\n`;o=e+o,s=e+s}g&&(o=`${o}\nvoid troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${g}\n}\n`,r=`\ntroika_position_${i} = vec3(position);\ntroika_normal_${i} = vec3(normal);\ntroika_uv_${i} = vec2(uv);\ntroikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});\n${r}\n`,e=(e=`vec3 troika_position_${i};\nvec3 troika_normal_${i};\nvec2 troika_uv_${i};\n${e}\n`).replace(/\b(position|normal|uv)\b/g,((e,t,n,o)=>/\battribute\s+vec[23]\s+$/.test(o.substr(0,n))?t:`troika_${t}_${i}`)));return e=V(e,i,o,r,a),t=V(t,i,s,l,c),{vertexShader:e,fragmentShader:t}}(i,t,n);a=W[r]=e}i.vertexShader=a.vertexShader,i.fragmentShader=a.fragmentShader,B(i.uniforms,this.uniforms),t.timeUniform&&(i.uniforms[t.timeUniform]={get value(){return Date.now()-Z}}),this[o]&&this[o](i)},a=function(){return s(t.chained?e:e.clone())},s=function(i){const o=Object.create(i,l);return Object.defineProperty(o,"baseMaterial",{value:e}),Object.defineProperty(o,"id",{value:S++}),o.uuid=g.MathUtils.generateUUID(),o.uniforms=B({},i.uniforms,t.uniforms),o.defines=B({},i.defines,t.defines),o.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",o.extensions=B({},i.extensions,t.extensions),o._listeners=void 0,o},l={constructor:{value:a},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return n}},onBeforeCompile:{get:()=>r,set(e){this[o]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(B(this.extensions,t.extensions),B(this.defines,t.defines),B(this.uniforms,g.UniformsUtils.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const t=new e.constructor;return s(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let n=this._depthMaterial;return n||(n=this._depthMaterial=R(e.isDerivedMaterial?e.getDepthMaterial():new g.MeshDepthMaterial({depthPacking:g.RGBADepthPacking}),t),n.defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let n=this._distanceMaterial;return n||(n=this._distanceMaterial=R(e.isDerivedMaterial?e.getDistanceMaterial():new g.MeshDistanceMaterial,t),n.defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:t,_distanceMaterial:n}=this;t&&t.dispose(),n&&n.dispose(),e.dispose.call(this)}}};return i[n]=a,new a}function V(e,t,n,i,o){return(i||o||n)&&(e=e.replace(G,`\n${n}\nvoid troikaOrigMain${t}() {`),e+=`\nvoid main() {\n  ${i}\n  troikaOrigMain${t}();\n  ${o}\n}`),e}function x(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let X=0;const H=new Map;g.DoubleSide;const Y=m({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var n=t._bin,i=new Uint8Array(e);if("ttcf"==n.readASCII(i,0,4)){var o=4;n.readUshort(i,o),o+=2,n.readUshort(i,o),o+=2;var r=n.readUint(i,o);o+=4;for(var a=[],g=0;g<r;g++){var s=n.readUint(i,o);o+=4,a.push(t._readFont(i,s))}return a}return[t._readFont(i,0)]},_readFont:function(e,n){var i=t._bin,o=n;i.readFixed(e,n),n+=4;var r=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],g={_data:e,_offset:o},s={},l=0;l<r;l++){var c=i.readASCII(e,n,4);n+=4,i.readUint(e,n),n+=4;var I=i.readUint(e,n);n+=4;var C=i.readUint(e,n);n+=4,s[c]={offset:I,length:C}}for(l=0;l<a.length;l++){var u=a[l];s[u]&&(g[u.trim()]=t[u.trim()].parse(e,s[u].offset,s[u].length,g))}return g},_tabOffset:function(e,n,i){for(var o=t._bin,r=o.readUshort(e,i+4),a=i+12,g=0;g<r;g++){var s=o.readASCII(e,a,4);a+=4,o.readUint(e,a),a+=4;var l=o.readUint(e,a);if(a+=4,o.readUint(e,a),a+=4,s==n)return l}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,n){return t._bin.readShort(e,n)/16384},readInt:function(e,n){var i=t._bin.t.uint8;return i[0]=e[n+3],i[1]=e[n+2],i[2]=e[n+1],i[3]=e[n],t._bin.t.int32[0]},readInt8:function(e,n){return t._bin.t.uint8[0]=e[n],t._bin.t.int8[0]},readShort:function(e,n){var i=t._bin.t.uint8;return i[1]=e[n],i[0]=e[n+1],t._bin.t.int16[0]},readUshort:function(e,t){return e[t]<<8|e[t+1]},readUshorts:function(e,n,i){for(var o=[],r=0;r<i;r++)o.push(t._bin.readUshort(e,n+2*r));return o},readUint:function(e,n){var i=t._bin.t.uint8;return i[3]=e[n],i[2]=e[n+1],i[1]=e[n+2],i[0]=e[n+3],t._bin.t.uint32[0]},readUint64:function(e,n){return 4294967296*t._bin.readUint(e,n)+t._bin.readUint(e,n+4)},readASCII:function(e,t,n){for(var i="",o=0;o<n;o++)i+=String.fromCharCode(e[t+o]);return i},readUnicode:function(e,t,n){for(var i="",o=0;o<n;o++){var r=e[t++]<<8|e[t++];i+=String.fromCharCode(r)}return i},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,n,i){var o=t._bin._tdec;return o&&0==n&&i==e.length?o.decode(e):t._bin.readASCII(e,n,i)},readBytes:function(e,t,n){for(var i=[],o=0;o<n;o++)i.push(e[t+o]);return i},readASCIIArray:function(e,t,n){for(var i=[],o=0;o<n;o++)i.push(String.fromCharCode(e[t+o]));return i}},t._bin.t={buff:new ArrayBuffer(8)},t._bin.t.int8=new Int8Array(t._bin.t.buff),t._bin.t.uint8=new Uint8Array(t._bin.t.buff),t._bin.t.int16=new Int16Array(t._bin.t.buff),t._bin.t.uint16=new Uint16Array(t._bin.t.buff),t._bin.t.int32=new Int32Array(t._bin.t.buff),t._bin.t.uint32=new Uint32Array(t._bin.t.buff),t._lctf={},t._lctf.parse=function(e,n,i,o,r){var a=t._bin,g={},s=n;a.readFixed(e,n),n+=4;var l=a.readUshort(e,n);n+=2;var c=a.readUshort(e,n);n+=2;var I=a.readUshort(e,n);return n+=2,g.scriptList=t._lctf.readScriptList(e,s+l),g.featureList=t._lctf.readFeatureList(e,s+c),g.lookupList=t._lctf.readLookupList(e,s+I,r),g},t._lctf.readLookupList=function(e,n,i){var o=t._bin,r=n,a=[],g=o.readUshort(e,n);n+=2;for(var s=0;s<g;s++){var l=o.readUshort(e,n);n+=2;var c=t._lctf.readLookupTable(e,r+l,i);a.push(c)}return a},t._lctf.readLookupTable=function(e,n,i){var o=t._bin,r=n,a={tabs:[]};a.ltype=o.readUshort(e,n),n+=2,a.flag=o.readUshort(e,n),n+=2;var g=o.readUshort(e,n);n+=2;for(var s=a.ltype,l=0;l<g;l++){var c=o.readUshort(e,n);n+=2;var I=i(e,s,r+c,a);a.tabs.push(I)}return a},t._lctf.numOfOnes=function(e){for(var t=0,n=0;n<32;n++)0!=(e>>>n&1)&&t++;return t},t._lctf.readClassDef=function(e,n){var i=t._bin,o=[],r=i.readUshort(e,n);if(n+=2,1==r){var a=i.readUshort(e,n);n+=2;var g=i.readUshort(e,n);n+=2;for(var s=0;s<g;s++)o.push(a+s),o.push(a+s),o.push(i.readUshort(e,n)),n+=2}if(2==r){var l=i.readUshort(e,n);for(n+=2,s=0;s<l;s++)o.push(i.readUshort(e,n)),n+=2,o.push(i.readUshort(e,n)),n+=2,o.push(i.readUshort(e,n)),n+=2}return o},t._lctf.getInterval=function(e,t){for(var n=0;n<e.length;n+=3){var i=e[n],o=e[n+1];if(e[n+2],i<=t&&t<=o)return n}return-1},t._lctf.readCoverage=function(e,n){var i=t._bin,o={};o.fmt=i.readUshort(e,n),n+=2;var r=i.readUshort(e,n);return n+=2,1==o.fmt&&(o.tab=i.readUshorts(e,n,r)),2==o.fmt&&(o.tab=i.readUshorts(e,n,3*r)),o},t._lctf.coverageIndex=function(e,n){var i=e.tab;if(1==e.fmt)return i.indexOf(n);if(2==e.fmt){var o=t._lctf.getInterval(i,n);if(-1!=o)return i[o+2]+(n-i[o])}return-1},t._lctf.readFeatureList=function(e,n){var i=t._bin,o=n,r=[],a=i.readUshort(e,n);n+=2;for(var g=0;g<a;g++){var s=i.readASCII(e,n,4);n+=4;var l=i.readUshort(e,n);n+=2;var c=t._lctf.readFeatureTable(e,o+l);c.tag=s.trim(),r.push(c)}return r},t._lctf.readFeatureTable=function(e,n){var i=t._bin,o=n,r={},a=i.readUshort(e,n);n+=2,a>0&&(r.featureParams=o+a);var g=i.readUshort(e,n);n+=2,r.tab=[];for(var s=0;s<g;s++)r.tab.push(i.readUshort(e,n+2*s));return r},t._lctf.readScriptList=function(e,n){var i=t._bin,o=n,r={},a=i.readUshort(e,n);n+=2;for(var g=0;g<a;g++){var s=i.readASCII(e,n,4);n+=4;var l=i.readUshort(e,n);n+=2,r[s.trim()]=t._lctf.readScriptTable(e,o+l)}return r},t._lctf.readScriptTable=function(e,n){var i=t._bin,o=n,r={},a=i.readUshort(e,n);n+=2,r.default=t._lctf.readLangSysTable(e,o+a);var g=i.readUshort(e,n);n+=2;for(var s=0;s<g;s++){var l=i.readASCII(e,n,4);n+=4;var c=i.readUshort(e,n);n+=2,r[l.trim()]=t._lctf.readLangSysTable(e,o+c)}return r},t._lctf.readLangSysTable=function(e,n){var i=t._bin,o={};i.readUshort(e,n),n+=2,o.reqFeature=i.readUshort(e,n),n+=2;var r=i.readUshort(e,n);return n+=2,o.features=i.readUshorts(e,n,r),o},t.CFF={},t.CFF.parse=function(e,n,i){var o=t._bin;(e=new Uint8Array(e.buffer,n,i))[n=0],e[++n],e[++n],e[++n],n++;var r=[];n=t.CFF.readIndex(e,n,r);for(var a=[],g=0;g<r.length-1;g++)a.push(o.readASCII(e,n+r[g],r[g+1]-r[g]));n+=r[r.length-1];var s=[];n=t.CFF.readIndex(e,n,s);var l=[];for(g=0;g<s.length-1;g++)l.push(t.CFF.readDict(e,n+s[g],n+s[g+1]));n+=s[s.length-1];var c=l[0],I=[];n=t.CFF.readIndex(e,n,I);var C=[];for(g=0;g<I.length-1;g++)C.push(o.readASCII(e,n+I[g],I[g+1]-I[g]));if(n+=I[I.length-1],t.CFF.readSubrs(e,n,c),c.CharStrings){n=c.CharStrings,I=[],n=t.CFF.readIndex(e,n,I);var u=[];for(g=0;g<I.length-1;g++)u.push(o.readBytes(e,n+I[g],I[g+1]-I[g]));c.CharStrings=u}if(c.ROS){n=c.FDArray;var d=[];for(n=t.CFF.readIndex(e,n,d),c.FDArray=[],g=0;g<d.length-1;g++){var h=t.CFF.readDict(e,n+d[g],n+d[g+1]);t.CFF._readFDict(e,h,C),c.FDArray.push(h)}n+=d[d.length-1],n=c.FDSelect,c.FDSelect=[];var A=e[n];if(n++,3!=A)throw A;var p=o.readUshort(e,n);for(n+=2,g=0;g<p+1;g++)c.FDSelect.push(o.readUshort(e,n),e[n+2]),n+=3}return c.Encoding&&(c.Encoding=t.CFF.readEncoding(e,c.Encoding,c.CharStrings.length)),c.charset&&(c.charset=t.CFF.readCharset(e,c.charset,c.CharStrings.length)),t.CFF._readFDict(e,c,C),c},t.CFF._readFDict=function(e,n,i){var o;for(var r in n.Private&&(o=n.Private[1],n.Private=t.CFF.readDict(e,o,o+n.Private[0]),n.Private.Subrs&&t.CFF.readSubrs(e,o+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(r)&&(n[r]=i[n[r]-426+35])},t.CFF.readSubrs=function(e,n,i){var o=t._bin,r=[];n=t.CFF.readIndex(e,n,r);var a,g=r.length;a=g<1240?107:g<33900?1131:32768,i.Bias=a,i.Subrs=[];for(var s=0;s<r.length-1;s++)i.Subrs.push(o.readBytes(e,n+r[s],r[s+1]-r[s]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var n=0;n<e.charset.length;n++)if(e.charset[n]==t)return n;return-1},t.CFF.glyphBySE=function(e,n){return n<0||n>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[n])},t.CFF.readEncoding=function(e,n,i){t._bin;var o=[".notdef"],r=e[n];if(n++,0!=r)throw"error: unknown encoding format: "+r;var a=e[n];n++;for(var g=0;g<a;g++)o.push(e[n+g]);return o},t.CFF.readCharset=function(e,n,i){var o=t._bin,r=[".notdef"],a=e[n];if(n++,0==a)for(var g=0;g<i;g++){var s=o.readUshort(e,n);n+=2,r.push(s)}else{if(1!=a&&2!=a)throw"error: format: "+a;for(;r.length<i;){s=o.readUshort(e,n),n+=2;var l=0;for(1==a?(l=e[n],n++):(l=o.readUshort(e,n),n+=2),g=0;g<=l;g++)r.push(s),s++}}return r},t.CFF.readIndex=function(e,n,i){var o=t._bin,r=o.readUshort(e,n)+1,a=e[n+=2];if(n++,1==a)for(var g=0;g<r;g++)i.push(e[n+g]);else if(2==a)for(g=0;g<r;g++)i.push(o.readUshort(e,n+2*g));else if(3==a)for(g=0;g<r;g++)i.push(16777215&o.readUint(e,n+3*g-1));else if(1!=r)throw"unsupported offset size: "+a+", count: "+r;return(n+=r*a)-1},t.CFF.getCharString=function(e,n,i){var o=t._bin,r=e[n],a=e[n+1],g=(e[n+2],e[n+3],e[n+4],1),s=null,l=null;r<=20&&(s=r,g=1),12==r&&(s=100*r+a,g=2),21<=r&&r<=27&&(s=r,g=1),28==r&&(l=o.readShort(e,n+1),g=3),29<=r&&r<=31&&(s=r,g=1),32<=r&&r<=246&&(l=r-139,g=1),247<=r&&r<=250&&(l=256*(r-247)+a+108,g=2),251<=r&&r<=254&&(l=256*-(r-251)-a-108,g=2),255==r&&(l=o.readInt(e,n+1)/65535,g=5),i.val=null!=l?l:"o"+s,i.size=g},t.CFF.readCharString=function(e,n,i){for(var o=n+i,r=t._bin,a=[];n<o;){var g=e[n],s=e[n+1],l=(e[n+2],e[n+3],e[n+4],1),c=null,I=null;g<=20&&(c=g,l=1),12==g&&(c=100*g+s,l=2),19!=g&&20!=g||(c=g,l=2),21<=g&&g<=27&&(c=g,l=1),28==g&&(I=r.readShort(e,n+1),l=3),29<=g&&g<=31&&(c=g,l=1),32<=g&&g<=246&&(I=g-139,l=1),247<=g&&g<=250&&(I=256*(g-247)+s+108,l=2),251<=g&&g<=254&&(I=256*-(g-251)-s-108,l=2),255==g&&(I=r.readInt(e,n+1)/65535,l=5),a.push(null!=I?I:"o"+c),n+=l}return a},t.CFF.readDict=function(e,n,i){for(var o=t._bin,r={},a=[];n<i;){var g=e[n],s=e[n+1],l=(e[n+2],e[n+3],e[n+4],1),c=null,I=null;if(28==g&&(I=o.readShort(e,n+1),l=3),29==g&&(I=o.readInt(e,n+1),l=5),32<=g&&g<=246&&(I=g-139,l=1),247<=g&&g<=250&&(I=256*(g-247)+s+108,l=2),251<=g&&g<=254&&(I=256*-(g-251)-s-108,l=2),255==g)throw I=o.readInt(e,n+1)/65535,l=5,"unknown number";if(30==g){var C=[];for(l=1;;){var u=e[n+l];l++;var d=u>>4,h=15&u;if(15!=d&&C.push(d),15!=h&&C.push(h),15==h)break}for(var A="",p=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],m=0;m<C.length;m++)A+=p[C[m]];I=parseFloat(A)}g<=21&&(c=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][g],l=1,12==g&&(c=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][s],l=2)),null!=c?(r[c]=1==a.length?a[0]:a,a=[]):a.push(I),n+=l}return r},t.cmap={},t.cmap.parse=function(e,n,i){e=new Uint8Array(e.buffer,n,i),n=0;var o=t._bin,r={};o.readUshort(e,n),n+=2;var a=o.readUshort(e,n);n+=2;var g=[];r.tables=[];for(var s=0;s<a;s++){var l=o.readUshort(e,n);n+=2;var c=o.readUshort(e,n);n+=2;var I=o.readUint(e,n);n+=4;var C="p"+l+"e"+c,u=g.indexOf(I);if(-1==u){var d;u=r.tables.length,g.push(I);var h=o.readUshort(e,I);0==h?d=t.cmap.parse0(e,I):4==h?d=t.cmap.parse4(e,I):6==h?d=t.cmap.parse6(e,I):12==h?d=t.cmap.parse12(e,I):console.debug("unknown format: "+h,l,c,I),r.tables.push(d)}if(null!=r[C])throw"multiple tables for one platform+encoding";r[C]=u}return r},t.cmap.parse0=function(e,n){var i=t._bin,o={};o.format=i.readUshort(e,n),n+=2;var r=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,o.map=[];for(var a=0;a<r-6;a++)o.map.push(e[n+a]);return o},t.cmap.parse4=function(e,n){var i=t._bin,o=n,r={};r.format=i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2;var g=i.readUshort(e,n);n+=2;var s=g/2;r.searchRange=i.readUshort(e,n),n+=2,r.entrySelector=i.readUshort(e,n),n+=2,r.rangeShift=i.readUshort(e,n),n+=2,r.endCount=i.readUshorts(e,n,s),n+=2*s,n+=2,r.startCount=i.readUshorts(e,n,s),n+=2*s,r.idDelta=[];for(var l=0;l<s;l++)r.idDelta.push(i.readShort(e,n)),n+=2;for(r.idRangeOffset=i.readUshorts(e,n,s),n+=2*s,r.glyphIdArray=[];n<o+a;)r.glyphIdArray.push(i.readUshort(e,n)),n+=2;return r},t.cmap.parse6=function(e,n){var i=t._bin,o={};o.format=i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,o.firstCode=i.readUshort(e,n),n+=2;var r=i.readUshort(e,n);n+=2,o.glyphIdArray=[];for(var a=0;a<r;a++)o.glyphIdArray.push(i.readUshort(e,n)),n+=2;return o},t.cmap.parse12=function(e,n){var i=t._bin,o={};o.format=i.readUshort(e,n),n+=2,n+=2,i.readUint(e,n),n+=4,i.readUint(e,n),n+=4;var r=i.readUint(e,n);n+=4,o.groups=[];for(var a=0;a<r;a++){var g=n+12*a,s=i.readUint(e,g+0),l=i.readUint(e,g+4),c=i.readUint(e,g+8);o.groups.push([s,l,c])}return o},t.glyf={},t.glyf.parse=function(e,t,n,i){for(var o=[],r=0;r<i.maxp.numGlyphs;r++)o.push(null);return o},t.glyf._parseGlyf=function(e,n){var i=t._bin,o=e._data,r=t._tabOffset(o,"glyf",e._offset)+e.loca[n];if(e.loca[n]==e.loca[n+1])return null;var a={};if(a.noc=i.readShort(o,r),r+=2,a.xMin=i.readShort(o,r),r+=2,a.yMin=i.readShort(o,r),r+=2,a.xMax=i.readShort(o,r),r+=2,a.yMax=i.readShort(o,r),r+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var g=0;g<a.noc;g++)a.endPts.push(i.readUshort(o,r)),r+=2;var s=i.readUshort(o,r);if(r+=2,o.length-r<s)return null;a.instructions=i.readBytes(o,r,s),r+=s;var l=a.endPts[a.noc-1]+1;for(a.flags=[],g=0;g<l;g++){var c=o[r];if(r++,a.flags.push(c),0!=(8&c)){var I=o[r];r++;for(var C=0;C<I;C++)a.flags.push(c),g++}}for(a.xs=[],g=0;g<l;g++){var u=0!=(2&a.flags[g]),d=0!=(16&a.flags[g]);u?(a.xs.push(d?o[r]:-o[r]),r++):d?a.xs.push(0):(a.xs.push(i.readShort(o,r)),r+=2)}for(a.ys=[],g=0;g<l;g++)u=0!=(4&a.flags[g]),d=0!=(32&a.flags[g]),u?(a.ys.push(d?o[r]:-o[r]),r++):d?a.ys.push(0):(a.ys.push(i.readShort(o,r)),r+=2);var h=0,A=0;for(g=0;g<l;g++)h+=a.xs[g],A+=a.ys[g],a.xs[g]=h,a.ys[g]=A}else{var p;a.parts=[];do{p=i.readUshort(o,r),r+=2;var m={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(m),m.glyphIndex=i.readUshort(o,r),r+=2,1&p){var b=i.readShort(o,r);r+=2;var f=i.readShort(o,r);r+=2}else b=i.readInt8(o,r),r++,f=i.readInt8(o,r),r++;2&p?(m.m.tx=b,m.m.ty=f):(m.p1=b,m.p2=f),8&p?(m.m.a=m.m.d=i.readF2dot14(o,r),r+=2):64&p?(m.m.a=i.readF2dot14(o,r),r+=2,m.m.d=i.readF2dot14(o,r),r+=2):128&p&&(m.m.a=i.readF2dot14(o,r),r+=2,m.m.b=i.readF2dot14(o,r),r+=2,m.m.c=i.readF2dot14(o,r),r+=2,m.m.d=i.readF2dot14(o,r),r+=2)}while(32&p);if(256&p){var y=i.readUshort(o,r);for(r+=2,a.instr=[],g=0;g<y;g++)a.instr.push(o[r]),r++}}return a},t.GPOS={},t.GPOS.parse=function(e,n,i,o){return t._lctf.parse(e,n,i,o,t.GPOS.subt)},t.GPOS.subt=function(e,n,i,o){var r=t._bin,a=i,g={};if(g.fmt=r.readUshort(e,i),i+=2,1==n||2==n||3==n||7==n||8==n&&g.fmt<=2){var s=r.readUshort(e,i);i+=2,g.coverage=t._lctf.readCoverage(e,s+a)}if(1==n&&1==g.fmt){var l=r.readUshort(e,i);i+=2;var c=t._lctf.numOfOnes(l);0!=l&&(g.pos=t.GPOS.readValueRecord(e,i,l))}else if(2==n&&g.fmt>=1&&g.fmt<=2){l=r.readUshort(e,i),i+=2;var I=r.readUshort(e,i);i+=2,c=t._lctf.numOfOnes(l);var C=t._lctf.numOfOnes(I);if(1==g.fmt){g.pairsets=[];var u=r.readUshort(e,i);i+=2;for(var d=0;d<u;d++){var h=a+r.readUshort(e,i);i+=2;var A=r.readUshort(e,h);h+=2;for(var p=[],m=0;m<A;m++){var b=r.readUshort(e,h);h+=2,0!=l&&(Z=t.GPOS.readValueRecord(e,h,l),h+=2*c),0!=I&&(w=t.GPOS.readValueRecord(e,h,I),h+=2*C),p.push({gid2:b,val1:Z,val2:w})}g.pairsets.push(p)}}if(2==g.fmt){var f=r.readUshort(e,i);i+=2;var y=r.readUshort(e,i);i+=2;var G=r.readUshort(e,i);i+=2;var v=r.readUshort(e,i);for(i+=2,g.classDef1=t._lctf.readClassDef(e,a+f),g.classDef2=t._lctf.readClassDef(e,a+y),g.matrix=[],d=0;d<G;d++){var B=[];for(m=0;m<v;m++){var Z=null,w=null;0!=l&&(Z=t.GPOS.readValueRecord(e,i,l),i+=2*c),0!=I&&(w=t.GPOS.readValueRecord(e,i,I),i+=2*C),B.push({val1:Z,val2:w})}g.matrix.push(B)}}}else{if(9==n&&1==g.fmt){var W=r.readUshort(e,i);i+=2;var S=r.readUint(e,i);if(i+=4,9==o.ltype)o.ltype=W;else if(o.ltype!=W)throw"invalid extension substitution";return t.GPOS.subt(e,o.ltype,a+S)}console.debug("unsupported GPOS table LookupType",n,"format",g.fmt)}return g},t.GPOS.readValueRecord=function(e,n,i){var o=t._bin,r=[];return r.push(1&i?o.readShort(e,n):0),n+=1&i?2:0,r.push(2&i?o.readShort(e,n):0),n+=2&i?2:0,r.push(4&i?o.readShort(e,n):0),n+=4&i?2:0,r.push(8&i?o.readShort(e,n):0),n+=8&i?2:0,r},t.GSUB={},t.GSUB.parse=function(e,n,i,o){return t._lctf.parse(e,n,i,o,t.GSUB.subt)},t.GSUB.subt=function(e,n,i,o){var r=t._bin,a=i,g={};if(g.fmt=r.readUshort(e,i),i+=2,1!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||4==n||5==n&&g.fmt<=2||6==n&&g.fmt<=2){var s=r.readUshort(e,i);i+=2,g.coverage=t._lctf.readCoverage(e,a+s)}if(1==n&&g.fmt>=1&&g.fmt<=2){if(1==g.fmt)g.delta=r.readShort(e,i),i+=2;else if(2==g.fmt){var l=r.readUshort(e,i);i+=2,g.newg=r.readUshorts(e,i,l),i+=2*g.newg.length}}else if(4==n){g.vals=[],l=r.readUshort(e,i),i+=2;for(var c=0;c<l;c++){var I=r.readUshort(e,i);i+=2,g.vals.push(t.GSUB.readLigatureSet(e,a+I))}}else if(5==n&&2==g.fmt){if(2==g.fmt){var C=r.readUshort(e,i);i+=2,g.cDef=t._lctf.readClassDef(e,a+C),g.scset=[];var u=r.readUshort(e,i);for(i+=2,c=0;c<u;c++){var d=r.readUshort(e,i);i+=2,g.scset.push(0==d?null:t.GSUB.readSubClassSet(e,a+d))}}}else if(6==n&&3==g.fmt){if(3==g.fmt){for(c=0;c<3;c++){l=r.readUshort(e,i),i+=2;for(var h=[],A=0;A<l;A++)h.push(t._lctf.readCoverage(e,a+r.readUshort(e,i+2*A)));i+=2*l,0==c&&(g.backCvg=h),1==c&&(g.inptCvg=h),2==c&&(g.ahedCvg=h)}l=r.readUshort(e,i),i+=2,g.lookupRec=t.GSUB.readSubstLookupRecords(e,i,l)}}else{if(7==n&&1==g.fmt){var p=r.readUshort(e,i);i+=2;var m=r.readUint(e,i);if(i+=4,9==o.ltype)o.ltype=p;else if(o.ltype!=p)throw"invalid extension substitution";return t.GSUB.subt(e,o.ltype,a+m)}console.debug("unsupported GSUB table LookupType",n,"format",g.fmt)}return g},t.GSUB.readSubClassSet=function(e,n){var i=t._bin.readUshort,o=n,r=[],a=i(e,n);n+=2;for(var g=0;g<a;g++){var s=i(e,n);n+=2,r.push(t.GSUB.readSubClassRule(e,o+s))}return r},t.GSUB.readSubClassRule=function(e,n){var i=t._bin.readUshort,o={},r=i(e,n),a=i(e,n+=2);n+=2,o.input=[];for(var g=0;g<r-1;g++)o.input.push(i(e,n)),n+=2;return o.substLookupRecords=t.GSUB.readSubstLookupRecords(e,n,a),o},t.GSUB.readSubstLookupRecords=function(e,n,i){for(var o=t._bin.readUshort,r=[],a=0;a<i;a++)r.push(o(e,n),o(e,n+2)),n+=4;return r},t.GSUB.readChainSubClassSet=function(e,n){var i=t._bin,o=n,r=[],a=i.readUshort(e,n);n+=2;for(var g=0;g<a;g++){var s=i.readUshort(e,n);n+=2,r.push(t.GSUB.readChainSubClassRule(e,o+s))}return r},t.GSUB.readChainSubClassRule=function(e,n){for(var i=t._bin,o={},r=["backtrack","input","lookahead"],a=0;a<r.length;a++){var g=i.readUshort(e,n);n+=2,1==a&&g--,o[r[a]]=i.readUshorts(e,n,g),n+=2*o[r[a]].length}return g=i.readUshort(e,n),n+=2,o.subst=i.readUshorts(e,n,2*g),n+=2*o.subst.length,o},t.GSUB.readLigatureSet=function(e,n){var i=t._bin,o=n,r=[],a=i.readUshort(e,n);n+=2;for(var g=0;g<a;g++){var s=i.readUshort(e,n);n+=2,r.push(t.GSUB.readLigature(e,o+s))}return r},t.GSUB.readLigature=function(e,n){var i=t._bin,o={chain:[]};o.nglyph=i.readUshort(e,n),n+=2;var r=i.readUshort(e,n);n+=2;for(var a=0;a<r-1;a++)o.chain.push(i.readUshort(e,n)),n+=2;return o},t.head={},t.head.parse=function(e,n,i){var o=t._bin,r={};return o.readFixed(e,n),n+=4,r.fontRevision=o.readFixed(e,n),n+=4,o.readUint(e,n),n+=4,o.readUint(e,n),n+=4,r.flags=o.readUshort(e,n),n+=2,r.unitsPerEm=o.readUshort(e,n),n+=2,r.created=o.readUint64(e,n),n+=8,r.modified=o.readUint64(e,n),n+=8,r.xMin=o.readShort(e,n),n+=2,r.yMin=o.readShort(e,n),n+=2,r.xMax=o.readShort(e,n),n+=2,r.yMax=o.readShort(e,n),n+=2,r.macStyle=o.readUshort(e,n),n+=2,r.lowestRecPPEM=o.readUshort(e,n),n+=2,r.fontDirectionHint=o.readShort(e,n),n+=2,r.indexToLocFormat=o.readShort(e,n),n+=2,r.glyphDataFormat=o.readShort(e,n),n+=2,r},t.hhea={},t.hhea.parse=function(e,n,i){var o=t._bin,r={};return o.readFixed(e,n),n+=4,r.ascender=o.readShort(e,n),n+=2,r.descender=o.readShort(e,n),n+=2,r.lineGap=o.readShort(e,n),n+=2,r.advanceWidthMax=o.readUshort(e,n),n+=2,r.minLeftSideBearing=o.readShort(e,n),n+=2,r.minRightSideBearing=o.readShort(e,n),n+=2,r.xMaxExtent=o.readShort(e,n),n+=2,r.caretSlopeRise=o.readShort(e,n),n+=2,r.caretSlopeRun=o.readShort(e,n),n+=2,r.caretOffset=o.readShort(e,n),n+=2,n+=8,r.metricDataFormat=o.readShort(e,n),n+=2,r.numberOfHMetrics=o.readUshort(e,n),n+=2,r},t.hmtx={},t.hmtx.parse=function(e,n,i,o){for(var r=t._bin,a={aWidth:[],lsBearing:[]},g=0,s=0,l=0;l<o.maxp.numGlyphs;l++)l<o.hhea.numberOfHMetrics&&(g=r.readUshort(e,n),n+=2,s=r.readShort(e,n),n+=2),a.aWidth.push(g),a.lsBearing.push(s);return a},t.kern={},t.kern.parse=function(e,n,i,o){var r=t._bin,a=r.readUshort(e,n);if(n+=2,1==a)return t.kern.parseV1(e,n-2,i,o);var g=r.readUshort(e,n);n+=2;for(var s={glyph1:[],rval:[]},l=0;l<g;l++){n+=2,i=r.readUshort(e,n),n+=2;var c=r.readUshort(e,n);n+=2;var I=c>>>8;if(0!=(I&=15))throw"unknown kern table format: "+I;n=t.kern.readFormat0(e,n,s)}return s},t.kern.parseV1=function(e,n,i,o){var r=t._bin;r.readFixed(e,n),n+=4;var a=r.readUint(e,n);n+=4;for(var g={glyph1:[],rval:[]},s=0;s<a;s++){r.readUint(e,n),n+=4;var l=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2;var c=l>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;n=t.kern.readFormat0(e,n,g)}return g},t.kern.readFormat0=function(e,n,i){var o=t._bin,r=-1,a=o.readUshort(e,n);n+=2,o.readUshort(e,n),n+=2,o.readUshort(e,n),n+=2,o.readUshort(e,n),n+=2;for(var g=0;g<a;g++){var s=o.readUshort(e,n);n+=2;var l=o.readUshort(e,n);n+=2;var c=o.readShort(e,n);n+=2,s!=r&&(i.glyph1.push(s),i.rval.push({glyph2:[],vals:[]}));var I=i.rval[i.rval.length-1];I.glyph2.push(l),I.vals.push(c),r=s}return n},t.loca={},t.loca.parse=function(e,n,i,o){var r=t._bin,a=[],g=o.head.indexToLocFormat,s=o.maxp.numGlyphs+1;if(0==g)for(var l=0;l<s;l++)a.push(r.readUshort(e,n+(l<<1))<<1);if(1==g)for(l=0;l<s;l++)a.push(r.readUint(e,n+(l<<2)));return a},t.maxp={},t.maxp.parse=function(e,n,i){var o=t._bin,r={},a=o.readUint(e,n);return n+=4,r.numGlyphs=o.readUshort(e,n),n+=2,65536==a&&(r.maxPoints=o.readUshort(e,n),n+=2,r.maxContours=o.readUshort(e,n),n+=2,r.maxCompositePoints=o.readUshort(e,n),n+=2,r.maxCompositeContours=o.readUshort(e,n),n+=2,r.maxZones=o.readUshort(e,n),n+=2,r.maxTwilightPoints=o.readUshort(e,n),n+=2,r.maxStorage=o.readUshort(e,n),n+=2,r.maxFunctionDefs=o.readUshort(e,n),n+=2,r.maxInstructionDefs=o.readUshort(e,n),n+=2,r.maxStackElements=o.readUshort(e,n),n+=2,r.maxSizeOfInstructions=o.readUshort(e,n),n+=2,r.maxComponentElements=o.readUshort(e,n),n+=2,r.maxComponentDepth=o.readUshort(e,n),n+=2),r},t.name={},t.name.parse=function(e,n,i){var o=t._bin,r={};o.readUshort(e,n),n+=2;var a=o.readUshort(e,n);n+=2,o.readUshort(e,n);for(var g,s=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],l=n+=2,c=0;c<a;c++){var I=o.readUshort(e,n);n+=2;var C=o.readUshort(e,n);n+=2;var u=o.readUshort(e,n);n+=2;var d=o.readUshort(e,n);n+=2;var h=o.readUshort(e,n);n+=2;var A=o.readUshort(e,n);n+=2;var p,m=s[d],b=l+12*a+A;if(0==I)p=o.readUnicode(e,b,h/2);else if(3==I&&0==C)p=o.readUnicode(e,b,h/2);else if(0==C)p=o.readASCII(e,b,h);else if(1==C)p=o.readUnicode(e,b,h/2);else if(3==C)p=o.readUnicode(e,b,h/2);else{if(1!=I)throw"unknown encoding "+C+", platformID: "+I;p=o.readASCII(e,b,h),console.debug("reading unknown MAC encoding "+C+" as ASCII")}var f="p"+I+","+u.toString(16);null==r[f]&&(r[f]={}),r[f][void 0!==m?m:d]=p,r[f]._lang=u}for(var y in r)if(null!=r[y].postScriptName&&1033==r[y]._lang)return r[y];for(var y in r)if(null!=r[y].postScriptName&&0==r[y]._lang)return r[y];for(var y in r)if(null!=r[y].postScriptName&&3084==r[y]._lang)return r[y];for(var y in r)if(null!=r[y].postScriptName)return r[y];for(var y in r){g=y;break}return console.debug("returning name table with languageID "+r[g]._lang),r[g]},t["OS/2"]={},t["OS/2"].parse=function(e,n,i){var o=t._bin.readUshort(e,n);n+=2;var r={};if(0==o)t["OS/2"].version0(e,n,r);else if(1==o)t["OS/2"].version1(e,n,r);else if(2==o||3==o||4==o)t["OS/2"].version2(e,n,r);else{if(5!=o)throw"unknown OS/2 table version: "+o;t["OS/2"].version5(e,n,r)}return r},t["OS/2"].version0=function(e,n,i){var o=t._bin;return i.xAvgCharWidth=o.readShort(e,n),n+=2,i.usWeightClass=o.readUshort(e,n),n+=2,i.usWidthClass=o.readUshort(e,n),n+=2,i.fsType=o.readUshort(e,n),n+=2,i.ySubscriptXSize=o.readShort(e,n),n+=2,i.ySubscriptYSize=o.readShort(e,n),n+=2,i.ySubscriptXOffset=o.readShort(e,n),n+=2,i.ySubscriptYOffset=o.readShort(e,n),n+=2,i.ySuperscriptXSize=o.readShort(e,n),n+=2,i.ySuperscriptYSize=o.readShort(e,n),n+=2,i.ySuperscriptXOffset=o.readShort(e,n),n+=2,i.ySuperscriptYOffset=o.readShort(e,n),n+=2,i.yStrikeoutSize=o.readShort(e,n),n+=2,i.yStrikeoutPosition=o.readShort(e,n),n+=2,i.sFamilyClass=o.readShort(e,n),n+=2,i.panose=o.readBytes(e,n,10),n+=10,i.ulUnicodeRange1=o.readUint(e,n),n+=4,i.ulUnicodeRange2=o.readUint(e,n),n+=4,i.ulUnicodeRange3=o.readUint(e,n),n+=4,i.ulUnicodeRange4=o.readUint(e,n),n+=4,i.achVendID=[o.readInt8(e,n),o.readInt8(e,n+1),o.readInt8(e,n+2),o.readInt8(e,n+3)],n+=4,i.fsSelection=o.readUshort(e,n),n+=2,i.usFirstCharIndex=o.readUshort(e,n),n+=2,i.usLastCharIndex=o.readUshort(e,n),n+=2,i.sTypoAscender=o.readShort(e,n),n+=2,i.sTypoDescender=o.readShort(e,n),n+=2,i.sTypoLineGap=o.readShort(e,n),n+=2,i.usWinAscent=o.readUshort(e,n),n+=2,i.usWinDescent=o.readUshort(e,n),n+2},t["OS/2"].version1=function(e,n,i){var o=t._bin;return n=t["OS/2"].version0(e,n,i),i.ulCodePageRange1=o.readUint(e,n),n+=4,i.ulCodePageRange2=o.readUint(e,n),n+4},t["OS/2"].version2=function(e,n,i){var o=t._bin;return n=t["OS/2"].version1(e,n,i),i.sxHeight=o.readShort(e,n),n+=2,i.sCapHeight=o.readShort(e,n),n+=2,i.usDefault=o.readUshort(e,n),n+=2,i.usBreak=o.readUshort(e,n),n+=2,i.usMaxContext=o.readUshort(e,n),n+2},t["OS/2"].version5=function(e,n,i){var o=t._bin;return n=t["OS/2"].version2(e,n,i),i.usLowerOpticalPointSize=o.readUshort(e,n),n+=2,i.usUpperOpticalPointSize=o.readUshort(e,n),n+2},t.post={},t.post.parse=function(e,n,i){var o=t._bin,r={};return r.version=o.readFixed(e,n),n+=4,r.italicAngle=o.readFixed(e,n),n+=4,r.underlinePosition=o.readShort(e,n),n+=2,r.underlineThickness=o.readShort(e,n),n+=2,r},t.SVG={},t.SVG.parse=function(e,n,i){var o=t._bin,r={entries:[]},a=n;o.readUshort(e,n),n+=2;var g=o.readUint(e,n);n+=4,o.readUint(e,n),n+=4,n=g+a;var s=o.readUshort(e,n);n+=2;for(var l=0;l<s;l++){var c=o.readUshort(e,n);n+=2;var I=o.readUshort(e,n);n+=2;var C=o.readUint(e,n);n+=4;var u=o.readUint(e,n);n+=4;for(var d=new Uint8Array(e.buffer,a+C+g,u),h=o.readUTF8(d,0,d.length),A=c;A<=I;A++)r.entries[A]=h}return r},t.SVG.toPath=function(e){var n={cmds:[],crds:[]};if(null==e)return n;for(var i=(new DOMParser).parseFromString(e,"image/svg+xml").firstChild;"svg"!=i.tagName;)i=i.nextSibling;var o=i.getAttribute("viewBox");o=o?o.trim().split(" ").map(parseFloat):[0,0,1e3,1e3],t.SVG._toPath(i.children,n);for(var r=0;r<n.crds.length;r+=2){var a=n.crds[r],g=n.crds[r+1];a-=o[0],g=-(g-=o[1]),n.crds[r]=a,n.crds[r+1]=g}return n},t.SVG._toPath=function(e,n,i){for(var o=0;o<e.length;o++){var r=e[o],a=r.tagName,g=r.getAttribute("fill");if(null==g&&(g=i),"g"==a)t.SVG._toPath(r.children,n,g);else if("path"==a){n.cmds.push(g||"#000000");var s=r.getAttribute("d"),l=t.SVG._tokens(s);t.SVG._toksToPath(l,n),n.cmds.push("X")}else"defs"==a||console.debug(a,r)}},t.SVG._tokens=function(e){for(var t=[],n=0,i=!1,o="";n<e.length;){var r=e.charCodeAt(n),a=e.charAt(n);n++;var g=48<=r&&r<=57||"."==a||"-"==a;i?"-"==a?(t.push(parseFloat(o)),o=a):g?o+=a:(t.push(parseFloat(o)),","!=a&&" "!=a&&t.push(a),i=!1):g?(o=a,i=!0):","!=a&&" "!=a&&t.push(a)}return i&&t.push(parseFloat(o)),t},t.SVG._toksToPath=function(e,n){for(var i=0,o=0,r=0,a=0,g=0,s={M:2,L:2,H:1,V:1,S:4,C:6},l=n.cmds,c=n.crds;i<e.length;){var I=e[i];if(i++,"z"==I)l.push("Z"),o=a,r=g;else for(var C=I.toUpperCase(),u=s[C],d=t.SVG._reps(e,i,u),h=0;h<d;h++){var A=0,p=0;if(I!=C&&(A=o,p=r),"M"==C)o=A+e[i++],r=p+e[i++],l.push("M"),c.push(o,r),a=o,g=r;else if("L"==C)o=A+e[i++],r=p+e[i++],l.push("L"),c.push(o,r);else if("H"==C)o=A+e[i++],l.push("L"),c.push(o,r);else if("V"==C)r=p+e[i++],l.push("L"),c.push(o,r);else if("C"==C){var m=A+e[i++],b=p+e[i++],f=A+e[i++],y=p+e[i++],G=A+e[i++],v=p+e[i++];l.push("C"),c.push(m,b,f,y,G,v),o=G,r=v}else if("S"==C){var B=Math.max(c.length-4,0);m=o+o-c[B],b=r+r-c[B+1],f=A+e[i++],y=p+e[i++],G=A+e[i++],v=p+e[i++],l.push("C"),c.push(m,b,f,y,G,v),o=G,r=v}else console.debug("Unknown SVG command "+I)}}},t.SVG._reps=function(e,t,n){for(var i=t;i<e.length&&"string"!=typeof e[i];)i+=n;return(i-t)/n},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var n=e.cmap,i=-1;if(null!=n.p0e4?i=n.p0e4:null!=n.p3e1?i=n.p3e1:null!=n.p1e0?i=n.p1e0:null!=n.p0e3&&(i=n.p0e3),-1==i)throw"no familiar platform and encoding!";var o=n.tables[i];if(0==o.format)return t>=o.map.length?0:o.map[t];if(4==o.format){for(var r=-1,a=0;a<o.endCount.length;a++)if(t<=o.endCount[a]){r=a;break}return-1==r||o.startCount[r]>t?0:65535&(0!=o.idRangeOffset[r]?o.glyphIdArray[t-o.startCount[r]+(o.idRangeOffset[r]>>1)-(o.idRangeOffset.length-r)]:t+o.idDelta[r])}if(12==o.format){if(t>o.groups[o.groups.length-1][1])return 0;for(a=0;a<o.groups.length;a++){var g=o.groups[a];if(g[0]<=t&&t<=g[1])return g[2]+(t-g[0])}return 0}throw"unknown cmap table format "+o.format},t.U.glyphToPath=function(e,n){var i={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[n]){var o=e.SVG.entries[n];return null==o?i:("string"==typeof o&&(o=t.SVG.toPath(o),e.SVG.entries[n]=o),o)}if(e.CFF){var r={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},a=e.CFF,g=e.CFF.Private;if(a.ROS){for(var s=0;a.FDSelect[s+2]<=n;)s+=2;g=a.FDArray[a.FDSelect[s+1]].Private}t.U._drawCFF(e.CFF.CharStrings[n],r,a,g,i)}else e.glyf&&t.U._drawGlyf(n,e,i);return i},t.U._drawGlyf=function(e,n,i){var o=n.glyf[e];null==o&&(o=n.glyf[e]=t.glyf._parseGlyf(n,e)),null!=o&&(o.noc>-1?t.U._simpleGlyph(o,i):t.U._compoGlyph(o,n,i))},t.U._simpleGlyph=function(e,n){for(var i=0;i<e.noc;i++){for(var o=0==i?0:e.endPts[i-1]+1,r=e.endPts[i],a=o;a<=r;a++){var g=a==o?r:a-1,s=a==r?o:a+1,l=1&e.flags[a],c=1&e.flags[g],I=1&e.flags[s],C=e.xs[a],u=e.ys[a];if(a==o)if(l){if(!c){t.U.P.moveTo(n,C,u);continue}t.U.P.moveTo(n,e.xs[g],e.ys[g])}else c?t.U.P.moveTo(n,e.xs[g],e.ys[g]):t.U.P.moveTo(n,(e.xs[g]+C)/2,(e.ys[g]+u)/2);l?c&&t.U.P.lineTo(n,C,u):I?t.U.P.qcurveTo(n,C,u,e.xs[s],e.ys[s]):t.U.P.qcurveTo(n,C,u,(C+e.xs[s])/2,(u+e.ys[s])/2)}t.U.P.closePath(n)}},t.U._compoGlyph=function(e,n,i){for(var o=0;o<e.parts.length;o++){var r={cmds:[],crds:[]},a=e.parts[o];t.U._drawGlyf(a.glyphIndex,n,r);for(var g=a.m,s=0;s<r.crds.length;s+=2){var l=r.crds[s],c=r.crds[s+1];i.crds.push(l*g.a+c*g.b+g.tx),i.crds.push(l*g.c+c*g.d+g.ty)}for(s=0;s<r.cmds.length;s++)i.cmds.push(r.cmds[s])}},t.U._getGlyphClass=function(e,n){var i=t._lctf.getInterval(n,e);return-1==i?0:n[i+2]},t.U.getPairAdjustment=function(e,n,i){var o=0;if(e.GPOS)for(var r=e.GPOS,a=r.lookupList,g=r.featureList,s=[],l=0;l<g.length;l++){var c=g[l];if("kern"==c.tag)for(var I=0;I<c.tab.length;I++)if(!s[c.tab[I]]){s[c.tab[I]]=!0;for(var C=a[c.tab[I]],u=0;u<C.tabs.length;u++)if(null!=C.tabs[u]){var d,h=C.tabs[u];if(!h.coverage||-1!=(d=t._lctf.coverageIndex(h.coverage,n)))if(1==C.ltype);else if(2==C.ltype){var A;if(1==h.fmt){var p=h.pairsets[d];for(l=0;l<p.length;l++)p[l].gid2==i&&(A=p[l])}else if(2==h.fmt){var m=t.U._getGlyphClass(n,h.classDef1),b=t.U._getGlyphClass(i,h.classDef2);A=h.matrix[m][b]}A&&A.val1&&A.val1[2]&&(o+=A.val1[2]),A&&A.val2&&A.val2[0]&&(o+=A.val2[0])}}}}if(e.kern){var f=e.kern.glyph1.indexOf(n);if(-1!=f){var y=e.kern.rval[f].glyph2.indexOf(i);-1!=y&&(o+=e.kern.rval[f].vals[y])}}return o},t.U.stringToGlyphs=function(e,n){for(var i=[],o=0;o<n.length;o++)(r=n.codePointAt(o))>65535&&o++,i.push(t.U.codeToGlyph(e,r));for(o=0;o<n.length;o++){var r;if(2367==(r=n.codePointAt(o))){var a=i[o-1];i[o-1]=i[o],i[o]=a}r>65535&&o++}var g=e.GSUB;if(null==g)return i;for(var s=g.lookupList,l=g.featureList,c=["rlig","liga","mset","isol","init","fina","medi","half","pres","blws"],I=[],C=0;C<l.length;C++){var u=l[C];if(-1!=c.indexOf(u.tag))for(var d=0;d<u.tab.length;d++)if(!I[u.tab[d]]){I[u.tab[d]]=!0;for(var h=s[u.tab[d]],A=0;A<i.length;A++){var p=t.U._getWPfeature(n,A);-1!="isol,init,fina,medi".indexOf(u.tag)&&u.tag!=p||t.U._applySubs(i,A,h,s)}}}return i},t.U._getWPfeature=function(e,t){var n='\n\t" ,.:;!?()  \u060c',i="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac",o=0==t||-1!=n.indexOf(e[t-1]),r=t==e.length-1||-1!=n.indexOf(e[t+1]);return o||-1==i.indexOf(e[t-1])||(o=!0),r||-1==i.indexOf(e[t])||(r=!0),r||-1=="\ua872\u0acd\u0ad7".indexOf(e[t+1])||(r=!0),o||-1=="\ua872\u0acd\u0ad7".indexOf(e[t])||(o=!0),o?r?"isol":"init":r?"fina":"medi"},t.U._applySubs=function(e,n,i,o){for(var r=e.length-n-1,a=0;a<i.tabs.length;a++)if(null!=i.tabs[a]){var g,s=i.tabs[a];if(!s.coverage||-1!=(g=t._lctf.coverageIndex(s.coverage,e[n])))if(1==i.ltype)e[n],1==s.fmt?e[n]=e[n]+s.delta:e[n]=s.newg[g];else if(4==i.ltype)for(var l=s.vals[g],c=0;c<l.length;c++){var I=l[c],C=I.chain.length;if(!(C>r)){for(var u=!0,d=0,h=0;h<C;h++){for(;-1==e[n+d+(1+h)];)d++;I.chain[h]!=e[n+d+(1+h)]&&(u=!1)}if(u){for(e[n]=I.nglyph,h=0;h<C+d;h++)e[n+h+1]=-1;break}}}else if(5==i.ltype&&2==s.fmt)for(var A=t._lctf.getInterval(s.cDef,e[n]),p=s.cDef[A+2],m=s.scset[p],b=0;b<m.length;b++){var f=m[b],y=f.input;if(!(y.length>r)){for(u=!0,h=0;h<y.length;h++){var G=t._lctf.getInterval(s.cDef,e[n+1+h]);if(-1==A&&s.cDef[G+2]!=y[h]){u=!1;break}}if(u){var v=f.substLookupRecords;for(c=0;c<v.length;c+=2)v[c],v[c+1]}}}else if(6==i.ltype&&3==s.fmt){if(!t.U._glsCovered(e,s.backCvg,n-s.backCvg.length))continue;if(!t.U._glsCovered(e,s.inptCvg,n))continue;if(!t.U._glsCovered(e,s.ahedCvg,n+s.inptCvg.length))continue;var B=s.lookupRec;for(b=0;b<B.length;b+=2){A=B[b];var Z=o[B[b+1]];t.U._applySubs(e,n+A,Z,o)}}}},t.U._glsCovered=function(e,n,i){for(var o=0;o<n.length;o++)if(-1==t._lctf.coverageIndex(n[o],e[i+o]))return!1;return!0},t.U.glyphsToPath=function(e,n,i){for(var o={cmds:[],crds:[]},r=0,a=0;a<n.length;a++){var g=n[a];if(-1!=g){for(var s=a<n.length-1&&-1!=n[a+1]?n[a+1]:0,l=t.U.glyphToPath(e,g),c=0;c<l.crds.length;c+=2)o.crds.push(l.crds[c]+r),o.crds.push(l.crds[c+1]);for(i&&o.cmds.push(i),c=0;c<l.cmds.length;c++)o.cmds.push(l.cmds[c]);i&&o.cmds.push("X"),r+=e.hmtx.aWidth[g],a<n.length-1&&(r+=t.U.getPairAdjustment(e,g,s))}}return o},t.U.pathToSVG=function(e,t){null==t&&(t=5);for(var n=[],i=0,o={M:2,L:2,Q:4,C:6},r=0;r<e.cmds.length;r++){var a=e.cmds[r],g=i+(o[a]?o[a]:0);for(n.push(a);i<g;){var s=e.crds[i++];n.push(parseFloat(s.toFixed(t))+(i==g?"":" "))}}return n.join("")},t.U.pathToContext=function(e,t){for(var n=0,i=e.crds,o=0;o<e.cmds.length;o++){var r=e.cmds[o];"M"==r?(t.moveTo(i[n],i[n+1]),n+=2):"L"==r?(t.lineTo(i[n],i[n+1]),n+=2):"C"==r?(t.bezierCurveTo(i[n],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5]),n+=6):"Q"==r?(t.quadraticCurveTo(i[n],i[n+1],i[n+2],i[n+3]),n+=4):"#"==r.charAt(0)?(t.beginPath(),t.fillStyle=r):"Z"==r?t.closePath():"X"==r&&t.fill()}},t.U.P={},t.U.P.moveTo=function(e,t,n){e.cmds.push("M"),e.crds.push(t,n)},t.U.P.lineTo=function(e,t,n){e.cmds.push("L"),e.crds.push(t,n)},t.U.P.curveTo=function(e,t,n,i,o,r,a){e.cmds.push("C"),e.crds.push(t,n,i,o,r,a)},t.U.P.qcurveTo=function(e,t,n,i,o){e.cmds.push("Q"),e.crds.push(t,n,i,o)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,n,i,o,r){for(var a=n.stack,g=n.nStems,s=n.haveWidth,l=n.width,c=n.open,I=0,C=n.x,u=n.y,d=0,h=0,A=0,p=0,m=0,b=0,f=0,y=0,G=0,v=0,B={val:0,size:0};I<e.length;){t.CFF.getCharString(e,I,B);var Z=B.val;if(I+=B.size,"o1"==Z||"o18"==Z)a.length%2!=0&&!s&&(l=a.shift()+o.nominalWidthX),g+=a.length>>1,a.length=0,s=!0;else if("o3"==Z||"o23"==Z)a.length%2!=0&&!s&&(l=a.shift()+o.nominalWidthX),g+=a.length>>1,a.length=0,s=!0;else if("o4"==Z)a.length>1&&!s&&(l=a.shift()+o.nominalWidthX,s=!0),c&&t.U.P.closePath(r),u+=a.pop(),t.U.P.moveTo(r,C,u),c=!0;else if("o5"==Z)for(;a.length>0;)C+=a.shift(),u+=a.shift(),t.U.P.lineTo(r,C,u);else if("o6"==Z||"o7"==Z)for(var w=a.length,W="o6"==Z,S=0;S<w;S++){var R=a.shift();W?C+=R:u+=R,W=!W,t.U.P.lineTo(r,C,u)}else if("o8"==Z||"o24"==Z){w=a.length;for(var V=0;V+6<=w;)d=C+a.shift(),h=u+a.shift(),A=d+a.shift(),p=h+a.shift(),C=A+a.shift(),u=p+a.shift(),t.U.P.curveTo(r,d,h,A,p,C,u),V+=6;"o24"==Z&&(C+=a.shift(),u+=a.shift(),t.U.P.lineTo(r,C,u))}else{if("o11"==Z)break;if("o1234"==Z||"o1235"==Z||"o1236"==Z||"o1237"==Z)"o1234"==Z&&(h=u,A=(d=C+a.shift())+a.shift(),v=p=h+a.shift(),b=p,y=u,C=(f=(m=(G=A+a.shift())+a.shift())+a.shift())+a.shift(),t.U.P.curveTo(r,d,h,A,p,G,v),t.U.P.curveTo(r,m,b,f,y,C,u)),"o1235"==Z&&(d=C+a.shift(),h=u+a.shift(),A=d+a.shift(),p=h+a.shift(),G=A+a.shift(),v=p+a.shift(),m=G+a.shift(),b=v+a.shift(),f=m+a.shift(),y=b+a.shift(),C=f+a.shift(),u=y+a.shift(),a.shift(),t.U.P.curveTo(r,d,h,A,p,G,v),t.U.P.curveTo(r,m,b,f,y,C,u)),"o1236"==Z&&(d=C+a.shift(),h=u+a.shift(),A=d+a.shift(),v=p=h+a.shift(),b=p,f=(m=(G=A+a.shift())+a.shift())+a.shift(),y=b+a.shift(),C=f+a.shift(),t.U.P.curveTo(r,d,h,A,p,G,v),t.U.P.curveTo(r,m,b,f,y,C,u)),"o1237"==Z&&(d=C+a.shift(),h=u+a.shift(),A=d+a.shift(),p=h+a.shift(),G=A+a.shift(),v=p+a.shift(),m=G+a.shift(),b=v+a.shift(),f=m+a.shift(),y=b+a.shift(),Math.abs(f-C)>Math.abs(y-u)?C=f+a.shift():u=y+a.shift(),t.U.P.curveTo(r,d,h,A,p,G,v),t.U.P.curveTo(r,m,b,f,y,C,u));else if("o14"==Z){if(a.length>0&&!s&&(l=a.shift()+i.nominalWidthX,s=!0),4==a.length){var x=a.shift(),X=a.shift(),H=a.shift(),Y=a.shift(),K=t.CFF.glyphBySE(i,H),N=t.CFF.glyphBySE(i,Y);t.U._drawCFF(i.CharStrings[K],n,i,o,r),n.x=x,n.y=X,t.U._drawCFF(i.CharStrings[N],n,i,o,r)}c&&(t.U.P.closePath(r),c=!1)}else if("o19"==Z||"o20"==Z)a.length%2!=0&&!s&&(l=a.shift()+o.nominalWidthX),g+=a.length>>1,a.length=0,s=!0,I+=g+7>>3;else if("o21"==Z)a.length>2&&!s&&(l=a.shift()+o.nominalWidthX,s=!0),u+=a.pop(),C+=a.pop(),c&&t.U.P.closePath(r),t.U.P.moveTo(r,C,u),c=!0;else if("o22"==Z)a.length>1&&!s&&(l=a.shift()+o.nominalWidthX,s=!0),C+=a.pop(),c&&t.U.P.closePath(r),t.U.P.moveTo(r,C,u),c=!0;else if("o25"==Z){for(;a.length>6;)C+=a.shift(),u+=a.shift(),t.U.P.lineTo(r,C,u);d=C+a.shift(),h=u+a.shift(),A=d+a.shift(),p=h+a.shift(),C=A+a.shift(),u=p+a.shift(),t.U.P.curveTo(r,d,h,A,p,C,u)}else if("o26"==Z)for(a.length%2&&(C+=a.shift());a.length>0;)d=C,h=u+a.shift(),C=A=d+a.shift(),u=(p=h+a.shift())+a.shift(),t.U.P.curveTo(r,d,h,A,p,C,u);else if("o27"==Z)for(a.length%2&&(u+=a.shift());a.length>0;)h=u,A=(d=C+a.shift())+a.shift(),p=h+a.shift(),C=A+a.shift(),u=p,t.U.P.curveTo(r,d,h,A,p,C,u);else if("o10"==Z||"o29"==Z){var M="o10"==Z?o:i;if(0==a.length)console.debug("error: empty stack");else{var F=a.pop(),z=M.Subrs[F+M.Bias];n.x=C,n.y=u,n.nStems=g,n.haveWidth=s,n.width=l,n.open=c,t.U._drawCFF(z,n,i,o,r),C=n.x,u=n.y,g=n.nStems,s=n.haveWidth,l=n.width,c=n.open}}else if("o30"==Z||"o31"==Z){var L=a.length,k=(V=0,"o31"==Z);for(V+=L-(w=-3&L);V<w;)k?(h=u,A=(d=C+a.shift())+a.shift(),u=(p=h+a.shift())+a.shift(),w-V==5?(C=A+a.shift(),V++):C=A,k=!1):(d=C,h=u+a.shift(),A=d+a.shift(),p=h+a.shift(),C=A+a.shift(),w-V==5?(u=p+a.shift(),V++):u=p,k=!0),t.U.P.curveTo(r,d,h,A,p,C,u),V+=4}else{if("o"==(Z+"").charAt(0))throw console.debug("Unknown operation: "+Z,e),Z;a.push(Z)}}}n.x=C,n.y=u,n.nStems=g,n.haveWidth=s,n.width=l,n.open=c};var n=t,i={Typr:n};return e.Typr=n,e.default=i,e}({}).Typr},function(){return function(e){var t=Uint8Array,n=Uint16Array,i=Uint32Array,o=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),r=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=function(e,t){for(var o=new n(31),r=0;r<31;++r)o[r]=t+=1<<e[r-1];var a=new i(o[30]);for(r=1;r<30;++r)for(var g=o[r];g<o[r+1];++g)a[g]=g-o[r]<<5|r;return[o,a]},s=g(o,2),l=s[0],c=s[1];l[28]=258,c[258]=28;for(var I=g(r,0)[0],C=new n(32768),u=0;u<32768;++u){var d=(43690&u)>>>1|(21845&u)<<1;d=(61680&(d=(52428&d)>>>2|(13107&d)<<2))>>>4|(3855&d)<<4,C[u]=((65280&d)>>>8|(255&d)<<8)>>>1}var h=function(e,t,i){for(var o=e.length,r=0,a=new n(t);r<o;++r)++a[e[r]-1];var g,s=new n(t);for(r=0;r<t;++r)s[r]=s[r-1]+a[r-1]<<1;if(i){g=new n(1<<t);var l=15-t;for(r=0;r<o;++r)if(e[r])for(var c=r<<4|e[r],I=t-e[r],u=s[e[r]-1]++<<I,d=u|(1<<I)-1;u<=d;++u)g[C[u]>>>l]=c}else for(g=new n(o),r=0;r<o;++r)g[r]=C[s[e[r]-1]++]>>>15-e[r];return g},A=new t(288);for(u=0;u<144;++u)A[u]=8;for(u=144;u<256;++u)A[u]=9;for(u=256;u<280;++u)A[u]=7;for(u=280;u<288;++u)A[u]=8;var p=new t(32);for(u=0;u<32;++u)p[u]=5;var m=h(A,9,1),b=h(p,5,1),f=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},y=function(e,t,n){var i=t/8>>0;return(e[i]|e[i+1]<<8)>>>(7&t)&n},G=function(e,t){var n=t/8>>0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>>(7&t)},v=function(e,g,s){var c=e.length,C=!g||s,u=!s||s.i;s||(s={}),g||(g=new t(3*c));var d,A=function(e){var n=g.length;if(e>n){var i=new t(Math.max(2*n,e));i.set(g),g=i}},p=s.f||0,v=s.p||0,B=s.b||0,Z=s.l,w=s.d,W=s.m,S=s.n,R=8*c;do{if(!Z){s.f=p=y(e,v,1);var V=y(e,v+1,3);if(v+=3,!V){var x=e[(E=((d=v)/8>>0)+(7&d&&1)+4)-4]|e[E-3]<<8,X=E+x;if(X>c){if(u)throw"unexpected EOF";break}C&&A(B+x),g.set(e.subarray(E,X),B),s.b=B+=x,s.p=v=8*X;continue}if(1==V)Z=m,w=b,W=9,S=5;else{if(2!=V)throw"invalid block type";var H=y(e,v,31)+257,Y=y(e,v+10,15)+4,K=H+y(e,v+5,31)+1;v+=14;for(var N=new t(K),M=new t(19),F=0;F<Y;++F)M[a[F]]=y(e,v+3*F,7);v+=3*Y;var z=f(M),L=(1<<z)-1;if(!u&&v+K*(z+7)>R)break;var k=h(M,z,1);for(F=0;F<K;){var E,T=k[y(e,v,L)];if(v+=15&T,(E=T>>>4)<16)N[F++]=E;else{var U=0,_=0;for(16==E?(_=3+y(e,v,3),v+=2,U=N[F-1]):17==E?(_=3+y(e,v,7),v+=3):18==E&&(_=11+y(e,v,127),v+=7);_--;)N[F++]=U}}var J=N.subarray(0,H),D=N.subarray(H);W=f(J),S=f(D),Z=h(J,W,1),w=h(D,S,1)}if(v>R)throw"unexpected EOF"}C&&A(B+131072);for(var P=(1<<W)-1,Q=(1<<S)-1,O=W+S+18;u||v+O<R;){var j=(U=Z[G(e,v)&P])>>>4;if((v+=15&U)>R)throw"unexpected EOF";if(!U)throw"invalid length/literal";if(j<256)g[B++]=j;else{if(256==j){Z=null;break}var q=j-254;if(j>264){var $=o[F=j-257];q=y(e,v,(1<<$)-1)+l[F],v+=$}var ee=w[G(e,v)&Q],te=ee>>>4;if(!ee)throw"invalid distance";if(v+=15&ee,D=I[te],te>3&&($=r[te],D+=G(e,v)&(1<<$)-1,v+=$),v>R)throw"unexpected EOF";C&&A(B+131072);for(var ne=B+q;B<ne;B+=4)g[B]=g[B-D],g[B+1]=g[B+1-D],g[B+2]=g[B+2-D],g[B+3]=g[B+3-D];B=ne}}s.l=Z,s.p=v,s.b=B,Z&&(p=1,s.m=W,s.d=w,s.n=S)}while(!p);return B==g.length?g:function(e,o,r){(null==o||o<0)&&(o=0),(null==r||r>e.length)&&(r=e.length);var a=new(e instanceof n?n:e instanceof i?i:t)(r-o);return a.set(e.subarray(o,r)),a}(g,0,B)};return e.convert_streams=function(e){var t=new DataView(e),n=0;function i(){var e=t.getUint16(n);return n+=2,e}function o(){var e=t.getUint32(n);return n+=4,e}function r(e){p.setUint16(m,e),m+=2}function a(e){p.setUint32(m,e),m+=4}for(var g={signature:o(),flavor:o(),length:o(),numTables:i(),reserved:i(),totalSfntSize:o(),majorVersion:i(),minorVersion:i(),metaOffset:o(),metaLength:o(),metaOrigLength:o(),privOffset:o(),privLength:o()},s=0;Math.pow(2,s)<=g.numTables;)s++;s--;for(var l=16*Math.pow(2,s),c=16*g.numTables-l,I=12,C=[],u=0;u<g.numTables;u++)C.push({tag:o(),offset:o(),compLength:o(),origLength:o(),origChecksum:o()}),I+=16;var d,h=new Uint8Array(12+16*C.length+C.reduce((function(e,t){return e+t.origLength+4}),0)),A=h.buffer,p=new DataView(A),m=0;return a(g.flavor),r(g.numTables),r(l),r(s),r(c),C.forEach((function(e){a(e.tag),a(e.origChecksum),a(I),a(e.origLength),e.outOffset=I,(I+=e.origLength)%4!=0&&(I+=4-I%4)})),C.forEach((function(t){var n,i=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var o=new Uint8Array(t.origLength);n=new Uint8Array(i,2),v(n,o)}else o=new Uint8Array(i);h.set(o,t.outOffset);var r=0;(I=t.outOffset+t.origLength)%4!=0&&(r=4-I%4),h.set(new Uint8Array(r).buffer,t.outOffset+t.origLength),d=I+r})),A.slice(0,d)},e}({}).convert_streams},function(e,t){const n={M:2,L:2,Q:4,C:6,Z:0};return function(i){const o=new Uint8Array(i,0,4),r=e._bin.readASCII(o,0,4);if("wOFF"===r)i=t(i);else if("wOF2"===r)throw new Error("woff2 fonts not supported");return function(t){const i=Object.create(null),o={unitsPerEm:t.head.unitsPerEm,ascender:t.hhea.ascender,descender:t.hhea.descender,forEachGlyph(r,a,g,s){let l=0;const c=1/o.unitsPerEm*a,I=e.U.stringToGlyphs(t,r);let C=0,u=-1;return I.forEach(((o,I)=>{if(-1!==o){let r=i[o];if(!r){const{cmds:a,crds:g}=e.U.glyphToPath(t,o);let s,l,c,I;if(g.length){s=l=1/0,c=I=-1/0;for(let e=0,t=g.length;e<t;e+=2){let t=g[e],n=g[e+1];t<s&&(s=t),n<l&&(l=n),t>c&&(c=t),n>I&&(I=n)}}else s=c=l=I=0;r=i[o]={index:o,advanceWidth:t.hmtx.aWidth[o],xMin:s,yMin:l,xMax:c,yMax:I,pathCommandCount:a.length,forEachPathCommand(e){let t=0;const i=[];for(let o=0,r=a.length;o<r;o++){const r=n[a[o]];i.length=1+r,i[0]=a[o];for(let e=1;e<=r;e++)i[e]=g[t++];e.apply(null,i)}}}}-1!==u&&(l+=e.U.getPairAdjustment(t,u,o)*c),s.call(null,r,l,C),r.advanceWidth&&(l+=r.advanceWidth*c),g&&(l+=g*a),u=o}C+=r.codePointAt(C)>65535?2:1})),l}};return o}(e.parse(i)[0])}}],init:(e,t,n)=>n(e(),t())}),K={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},N=new g.Color;let M=!1;const F=Object.create(null);function z(e,t){if(M=!0,(e=L({},e)).font=function(e){k||(k="undefined"==typeof document?{}:document.createElement("a"));return k.href=e,k.href}(e.font||K.defaultFontURL),e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||K.sdfGlyphSize,null!=e.colorRanges){let t={};for(let n in e.colorRanges)if(e.colorRanges.hasOwnProperty(n)){let i=e.colorRanges[n];"number"!=typeof i&&(i=N.set(i).getHex()),t[n]=i}e.colorRanges=t}Object.freeze(e);const{textureWidth:n,sdfExponent:i}=K,{sdfGlyphSize:o}=e;let r=`${e.font}@${o}`,a=F[r];a||(a=F[r]={sdfTexture:new g.DataTexture(new Uint8Array(o*n),n,o,g.LuminanceFormat,void 0,void 0,void 0,void 0,g.LinearFilter,g.LinearFilter)},a.sdfTexture.font=e.font),E(e).then((n=>{n.newGlyphSDFs&&(n.newGlyphSDFs.forEach((({textureData:e,atlasIndex:t})=>{const n=a.sdfTexture.image;for(;n.data.length<(t+1)*o*o;){const e=new Uint8Array(2*n.data.length);e.set(n.data),n.data=e,n.height*=2}const i=n.width/o,r=n.width*o*Math.floor(t/i)+t%i*o;for(let a=0;a<o;a++){const t=a*o,i=r+a*n.width;for(let r=0;r<o;r++)n.data[i+r]=e[t+r]}})),a.sdfTexture.needsUpdate=!0),t(Object.freeze({parameters:e,sdfTexture:a.sdfTexture,sdfGlyphSize:o,sdfExponent:i,glyphBounds:n.glyphBounds,glyphAtlasIndices:n.glyphAtlasIndices,glyphColors:n.glyphColors,caretPositions:n.caretPositions,caretHeight:n.caretHeight,chunkedBounds:n.chunkedBounds,ascender:n.ascender,descender:n.descender,lineHeight:n.lineHeight,topBaseline:n.topBaseline,blockBounds:n.blockBounds,visibleBounds:n.visibleBounds,timings:n.timings,get totalBounds(){return console.log("totalBounds deprecated, use blockBounds instead"),n.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");const[e,t,i,o]=n.blockBounds;return[i-e,o-t]}}))}))}function L(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}let k;const E=m({name:"TextBuilder",dependencies:[m({name:"FontProcessor",dependencies:[K,Y,function(){let e=!1;const t=[];function n(){e&&(t.sort((function(e,t){return e.maxX-t.maxX})),e=!1)}function i(e,t,n,i,o,r){const a=o-n,g=r-i,s=a*a+g*g,l=s?Math.max(0,Math.min(1,((e-n)*a+(t-i)*g)/s)):0,c=e-(n+l*a),I=t-(i+l*g);return c*c+I*I}return{addLineSegment:function(n,i,o,r){const a={x0:n,y0:i,x1:o,y1:r,minX:Math.min(n,o),minY:Math.min(i,r),maxX:Math.max(n,o),maxY:Math.max(i,r)};t.push(a),e=!0},findNearestSignedDistance:function(e,o){n();let r=1/0,a=1/0;for(let n=t.length;n--;){const g=t[n];if(g.maxX+a<=e)break;if(e+a>g.minX&&o-a<g.maxY&&o+a>g.minY){const t=i(e,o,g.x0,g.y0,g.x1,g.y1);t<r&&(r=t,a=Math.sqrt(r))}}return function(e,i){n();let o=!1;for(let n=t.length;n--;){const r=t[n];if(r.maxX<=e)break;if(r.minY<i&&r.maxY>i){r.y0>i!=r.y1>i&&e<(r.x1-r.x0)*(i-r.y0)/(r.y1-r.y0)+r.x0&&(o=!o)}}return o}(e,o)&&(a=-a),a}}},function(e,t){const{sdfExponent:n,sdfMargin:i}=t;function o(e,t,n,i,o,r,a){const g=1-a;return{x:g*g*e+2*g*a*n+a*a*o,y:g*g*t+2*g*a*i+a*a*r}}function r(e,t,n,i,o,r,a,g,s){const l=1-s;return{x:l*l*l*e+3*l*l*s*n+3*l*s*s*o+s*s*s*a,y:l*l*l*t+3*l*l*s*i+3*l*s*s*r+s*s*s*g}}return function(t,a){const g=new Uint8Array(a*a),s=t.xMax-t.xMin,l=t.yMax-t.yMin,c=Math.max(s,l),I=Math.max(s,l)/a*(i*a+.5),C=t.xMin-I,u=t.yMin-I,d=t.xMax+I,h=t.yMax+I,A=d-C,p=h-u,m=Math.max(A,p);function b(e){return u+p*e/a}if(t.pathCommandCount){const i=e(t);let s,l,I,u;t.forEachPathCommand(((e,t,n,a,g,c,C)=>{switch(e){case"M":I=s=t,u=l=n;break;case"L":t===I&&n===u||i.addLineSegment(I,u,I=t,u=n);break;case"Q":{let e={x:I,y:u};for(let r=1;r<16;r++){let s=o(I,u,t,n,a,g,r/15);i.addLineSegment(e.x,e.y,s.x,s.y),e=s}I=a,u=g;break}case"C":{let e={x:I,y:u};for(let o=1;o<16;o++){let s=r(I,u,t,n,a,g,c,C,o/15);i.addLineSegment(e.x,e.y,s.x,s.y),e=s}I=c,u=C;break}case"Z":I===s&&u===l||i.addLineSegment(I,u,s,l)}}));for(let e=0;e<a;e++)for(let t=0;t<a;t++){const o=i.findNearestSignedDistance(C+A*(e+.5)/a,b(t+.5),c);let r=Math.pow(1-Math.abs(o)/m,n)/2;o<0&&(r=1-r),r=Math.max(0,Math.min(255,Math.round(255*r))),g[t*a+e]=r}}return{textureData:g,renderingBounds:[C,u,d,h]}}},function(e,t,n){const{defaultFontURL:i}=n,o=Object.create(null),r=Object.create(null),a=1/0;function g(t,n){t||(t=i);let o=r[t];o?o.pending?o.pending.push(n):n(o):(r[t]={pending:[n]},function(t,n){!function o(){const r=e=>{console.error(`Failure loading font ${t}${t===i?"":"; trying fallback"}`,e),t!==i&&(t=i,o())};try{const i=new XMLHttpRequest;i.open("get",t,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)r(new Error(i.statusText));else if(i.status>0)try{const t=e(i.response);n(t)}catch(t){r(t)}},i.onerror=r,i.send()}catch(a){r(a)}}()}(t,(e=>{let n=r[t].pending;r[t]=e,n.forEach((t=>t(e)))})))}function s({text:e="",font:n=i,sdfGlyphSize:r=64,fontSize:s=1,letterSpacing:C=0,lineHeight:u="normal",maxWidth:d=a,textAlign:h="left",textIndent:A=0,whiteSpace:p="normal",overflowWrap:m="normal",anchorX:b=0,anchorY:f=0,includeCaretPositions:y=!1,chunkedBoundsSize:G=8192,colorRanges:v=null},B,Z=!1){const w=c(),W={total:0,fontLoad:0,layout:0,sdf:{},sdfTotal:0};e.indexOf("\r")>-1&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),s=+s,C=+C,d=+d,u=u||"normal",A=+A,function(e,t,n){e||(e=i);let r=`${e}@${t}`,a=o[r];a?n(a):g(e,(e=>{a=o[r]||(o[r]={fontObj:e,glyphs:{},glyphCount:0}),n(a)}))}(n,r,(n=>{const i=n.fontObj,o=isFinite(d);let g=null,S=null,R=null,V=null,x=null,X=null,H=null,Y=0,K=0,N="nowrap"!==p;const{ascender:M,descender:F,unitsPerEm:z}=i;W.fontLoad=c()-w;const L=c(),k=s/z;"normal"===u&&(u=(M-F)/z);const E=((u*=s)-(M-F)*k)/2,T=-(M*k+E),U=Math.min(u,(M-F)*k),_=(M+F)/2*k-U/2;let J=A,D=new I;const P=[D];i.forEachGlyph(e,s,C,((t,n,i)=>{const r=e.charAt(i),a=t.advanceWidth*k,g=D.count;let l;if("isEmpty"in t||(t.isWhitespace=!!r&&/\s/.test(r),t.isEmpty=t.xMin===t.xMax||t.yMin===t.yMax),t.isWhitespace||t.isEmpty||K++,N&&o&&!t.isWhitespace&&n+a+J>d&&g){if(D.glyphAt(g-1).glyphObj.isWhitespace)l=new I,J=-n;else for(let e=g;e--;){if(0===e&&"break-word"===m){l=new I,J=-n;break}if(D.glyphAt(e).glyphObj.isWhitespace){l=D.splitAt(e+1);const t=l.glyphAt(0).x;J-=t;for(let e=l.count;e--;)l.glyphAt(e).x-=t;break}}l&&(D.isSoftWrapped=!0,D=l,P.push(D),Y=d)}let c=D.glyphAt(D.count);c.glyphObj=t,c.x=n+J,c.width=a,c.charIndex=i,"\n"===r&&(D=new I,P.push(D),J=-(n+a+C*s)+A)})),P.forEach((e=>{for(let t=e.count;t--;){let{glyphObj:n,x:i,width:o}=e.glyphAt(t);if(!n.isWhitespace)return e.width=i+o,void(e.width>Y&&(Y=e.width))}}));let Q=0,O=0;if(b&&("number"==typeof b?Q=-b:"string"==typeof b&&(Q=-Y*("left"===b?0:"center"===b?.5:"right"===b?1:l(b)))),f)if("number"==typeof f)O=-f;else if("string"==typeof f){let e=P.length*u;O="top"===f?0:"top-baseline"===f?-T:"middle"===f?e/2:"bottom"===f?e:"bottom-baseline"===f?e-E+F*k:l(f)*e}if(!Z){S=new Float32Array(4*K),R=new Float32Array(K),X=[a,a,-1/0,-1/0],H=[];let i=T;y&&(x=new Float32Array(3*e.length)),v&&(V=new Uint8Array(3*K));let o,s,l=0,I=-1,C=-1;P.forEach((d=>{const{count:A,width:p}=d;if(A>0){let u=0,m=0;if("center"===h)u=(Y-p)/2;else if("right"===h)u=Y-p;else if("justify"===h&&d.isSoftWrapped){let e=0;for(let t=A;t--;)if(!d.glyphAt(t).glyphObj.isWhitespace){for(;t--;)d.glyphAt(t).glyphObj,d.glyphAt(t).glyphObj.isWhitespace&&e++;break}m=(Y-p)/e}for(let h=0;h<A;h++){const A=d.glyphAt(h),p=A.glyphObj;if(u&&(A.x+=u),0!==m&&p.isWhitespace&&(u+=m,A.width+=m),y){const{charIndex:e}=A;for(x[3*e]=A.x+Q,x[3*e+1]=A.x+A.width+Q,x[3*e+2]=i+_+O;e-I>1;)x[3*(I+1)]=x[3*I],x[3*(I+1)+1]=x[3*I+1],x[3*(I+1)+2]=x[3*I+2],I++;I=e}if(v){const{charIndex:e}=A;for(;e>C;)C++,v.hasOwnProperty(C)&&(s=v[C])}if(!p.isWhitespace&&!p.isEmpty){const I=l++;let C=n.glyphs[p.index];if(!C){const i=c(),o=t(p,r);W.sdf[e.charAt(A.charIndex)]=c()-i,o.atlasIndex=n.glyphCount++,g||(g=[]),g.push(o),C=n.glyphs[p.index]={atlasIndex:o.atlasIndex,glyphObj:p,renderingBounds:o.renderingBounds}}const u=C.renderingBounds,d=4*I,h=A.x+Q,m=i+O;S[d]=h+u[0]*k,S[d+1]=m+u[1]*k,S[d+2]=h+u[2]*k,S[d+3]=m+u[3]*k;const b=h+p.xMin*k,f=m+p.yMin*k,y=h+p.xMax*k,B=m+p.yMax*k;b<X[0]&&(X[0]=b),f<X[1]&&(X[1]=f),y>X[2]&&(X[2]=y),B>X[3]&&(X[3]=B),I%G==0&&(o={start:I,end:I,rect:[a,a,-1/0,-1/0]},H.push(o)),o.end++;const Z=o.rect;if(b<Z[0]&&(Z[0]=b),f<Z[1]&&(Z[1]=f),y>Z[2]&&(Z[2]=y),B>Z[3]&&(Z[3]=B),R[I]=C.atlasIndex,v){const e=3*I;V[e]=s>>16&255,V[e+1]=s>>8&255,V[e+2]=255&s}}}}i-=u}))}for(let e in W.sdf)W.sdfTotal+=W.sdf[e];W.layout=c()-L-W.sdfTotal,W.total=c()-w,B({glyphBounds:S,glyphAtlasIndices:R,caretPositions:x,caretHeight:U,glyphColors:V,chunkedBounds:H,ascender:M*k,descender:F*k,lineHeight:u,topBaseline:T,blockBounds:[Q,O-P.length*u,Q+Y,O],visibleBounds:X,newGlyphSDFs:g,timings:W})}))}function l(e){let t=e.match(/^([\d.]+)%$/),n=t?parseFloat(t[1]):NaN;return isNaN(n)?0:n/100}function c(){return(self.performance||Date).now()}function I(){this.data=[]}return I.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/4)},glyphAt(e){let t=I.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new I;return t.data=this.data.splice(4*e),t}},I.flyweight=["glyphObj","x","width","charIndex"].reduce(((e,t,n,i)=>(Object.defineProperty(e,t,{get(){return this.data[4*this.index+n]},set(e){this.data[4*this.index+n]=e}}),e)),{data:null,index:0}),{process:s,measure:function(e,t){s(e,(e=>{const[n,i,o,r]=e.blockBounds;t({width:o-n,height:r-i})}),{metricsOnly:!0})},loadFont:g}}],init(e,t,n,i,o){const{sdfExponent:r,sdfMargin:a,defaultFontURL:g}=e;return o(t,i(n,{sdfExponent:r,sdfMargin:a}),{defaultFontURL:g})}}),y],init:(e,t)=>function(n){const i=new t;return e.process(n,i.resolve),i},getTransferables(e){const t=[e.glyphBounds.buffer,e.glyphAtlasIndices.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),e.newGlyphSDFs&&e.newGlyphSDFs.forEach((e=>{t.push(e.textureData.buffer)})),t}}),T=(()=>{const e={};const t=new g.Vector3,n="aTroikaGlyphIndex";class i extends g.InstancedBufferGeometry{constructor(){super(),this.detail=1,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new g.Sphere,this.boundingBox=new g.Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,("number"!=typeof t||t<1)&&(t=1);let n=function(t){let n=e[t];return n||(n=e[t]=new g.PlaneBufferGeometry(1,1,t,t).translate(.5,.5,0)),n}(t);["position","normal","uv"].forEach((e=>{this.attributes[e]=n.attributes[e].clone()})),this.setIndex(n.getIndex().clone())}}get detail(){return this._detail}updateGlyphs(e,i,a,g,s){o(this,"aTroikaGlyphBounds",e,4),o(this,n,i,1),o(this,"aTroikaGlyphColor",s,3),this._chunkedBounds=g,r(this,i.length);const l=this.boundingSphere;l.center.set((a[0]+a[2])/2,(a[1]+a[3])/2,0),l.radius=l.center.distanceTo(t.set(a[0],a[1],0));const c=this.boundingBox;c.min.set(a[0],a[1],0),c.max.set(a[2],a[3],0)}applyClipRect(e){let t=this.getAttribute(n).count,i=this._chunkedBounds;if(i)for(let n=i.length;n--;){t=i[n].end;let o=i[n].rect;if(o[1]<e.w&&o[3]>e.y&&o[0]<e.z&&o[2]>e.x)break}r(this,t)}}function o(e,t,n,i){const o=e.getAttribute(t);n?o&&o.array.length===n.length?(o.array.set(n),o.needsUpdate=!0):(e.setAttribute(t,new g.InstancedBufferAttribute(n,i)),delete e._maxInstanceCount,e.dispose()):o&&e.deleteAttribute(t)}function r(e,t){e[e.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=t}return i.prototype.setAttribute||(i.prototype.setAttribute=function(e,t){return this.attributes[e]=t,this}),i})();const U=(()=>{const e=new g.MeshBasicMaterial({color:16777215,side:g.DoubleSide,transparent:!0}),t=8421504,n=new g.Matrix4,i=new g.Vector3,o=new g.Vector3,r=[],a=new g.Vector3,s="+x+y";function l(e){return Array.isArray(e)?e[0]:e}const c=new g.Mesh(new g.PlaneBufferGeometry(1,1).translate(.5,.5,0),e),I={type:"syncstart"},C={type:"synccomplete"},u=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],d=u.concat("material","color","depthOffset","clipRect","orientation","glyphGeometryDetail");class h extends g.Mesh{constructor(){super(new T,null),this.text="",this.anchorX=0,this.anchorY=0,this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=t,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=s,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(I),z({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize},(t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{n.forEach((e=>e&&e()))}))),this.dispatchEvent(C),e&&e()}))))}onBeforeRender(e,t,n,i,o,r){this.sync(),o.isTroikaTextMaterial&&this._prepareForRender(o)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let t=this._derivedMaterial;const n=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=e.clone());if(t&&t.baseMaterial===n||(t=this._derivedMaterial=function(e){const t=R(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new g.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new g.Vector4(0,0,0,0)},uTroikaClipRect:{value:new g.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new g.Vector2},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new g.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new g.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerGlyph = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerGlyph * vec2(\n  mod(aTroikaGlyphIndex, txCols),\n  floor(aTroikaGlyphIndex / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerGlyph);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of encoding in SDFGenerator.js\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  return texture2D(uTroikaSDFTexture, textureUV).r;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat distance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(distance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  distance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:t}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(t)&&(t=t.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(e)||(e=e.replace(G,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}(n),n.addEventListener("dispose",(function e(){n.removeEventListener("dispose",e),t.dispose()}))),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let e=t._outlineMtl;return e||(e=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),e.isTextOutlineMaterial=!0,e.depthWrite=!1,e.map=null,t.addEventListener("dispose",(function n(){t.removeEventListener("dispose",n),e.dispose()}))),[e,t]}return t}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get customDepthMaterial(){return l(this.material).getDepthMaterial()}get customDistanceMaterial(){return l(this.material).getDistanceMaterial()}_prepareForRender(e){const r=e.isTextOutlineMaterial,l=e.uniforms,c=this.textRenderInfo;if(c){const{sdfTexture:e,blockBounds:n}=c;l.uTroikaSDFTexture.value=e,l.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),l.uTroikaSDFGlyphSize.value=c.sdfGlyphSize,l.uTroikaSDFExponent.value=c.sdfExponent,l.uTroikaTotalBounds.value.fromArray(n),l.uTroikaUseGlyphColors.value=!r&&!!c.glyphColors;let i,o,a,g=0,s=0,I=0,C=0,u=0;if(r){let{outlineWidth:e,outlineOffsetX:t,outlineOffsetY:n,outlineBlur:o,outlineOpacity:r}=this;g=this._parsePercent(e)||0,s=Math.max(0,this._parsePercent(o)||0),i=r,C=this._parsePercent(t)||0,u=this._parsePercent(n)||0}else I=Math.max(0,this._parsePercent(this.strokeWidth)||0),I&&(a=this.strokeColor,l.uTroikaStrokeColor.value.set(null==a?t:a),o=this.strokeOpacity,null==o&&(o=1)),i=this.fillOpacity;l.uTroikaDistanceOffset.value=g,l.uTroikaPositionOffset.value.set(C,u),l.uTroikaBlurRadius.value=s,l.uTroikaStrokeWidth.value=I,l.uTroikaStrokeOpacity.value=o,l.uTroikaFillOpacity.value=null==i?1:i;let d=this.clipRect;if(d&&Array.isArray(d)&&4===d.length)l.uTroikaClipRect.value.fromArray(d);else{const e=100*(this.fontSize||.1);l.uTroikaClipRect.value.set(n[0]-e,n[1]-e,n[2]+e,n[3]+e)}this.geometry.applyClipRect(l.uTroikaClipRect.value)}l.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const I=r?this.outlineColor||0:this.color;if(null==I)delete e.color;else{const t=e.hasOwnProperty("color")?e.color:e.color=new g.Color;I===t._input&&"object"!=typeof I||t.set(t._input=I)}let C=this.orientation||s;if(C!==e._orientation){let t=l.uTroikaOrient.value;C=C.replace(/[^-+xyz]/g,"");let r=C!==s&&C.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,e,g,s,l]=r;i.set(0,0,0)[g]="-"===e?1:-1,o.set(0,0,0)[l]="-"===s?-1:1,n.lookAt(a,i.cross(o),o),t.setFromMatrix4(n)}else t.identity();e._orientation=C}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}raycast(e,t){const i=this.textRenderInfo;if(i){const o=i.blockBounds;c.matrixWorld.multiplyMatrices(this.matrixWorld,n.set(o[2]-o[0],0,0,o[0],0,o[3]-o[1],0,o[1],0,0,1,0,0,0,0,1)),r.length=0,c.raycast(e,r);for(let e=0;e<r.length;e++)r[e].object=this,t.push(r[e])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,d.forEach((t=>{this[t]=e[t]})),this}clone(){return(new this.constructor).copy(this)}}u.forEach((e=>{const t="_private_"+e;Object.defineProperty(h.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}));let A=!1;return Object.defineProperty(h.prototype,"anchor",{get(){return this._deprecated_anchor},set(e){this._deprecated_anchor=e,A||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),A=!0),Array.isArray(e)?(this.anchorX=100*(+e[0]||0)+"%",this.anchorY=100*(+e[1]||0)+"%"):this.anchorX=this.anchorY=0}}),h})();new WeakMap;new WeakMap;const _=(0,r.forwardRef)(((e,t)=>{let{anchorX:n="center",anchorY:g="middle",children:s,onSync:l}=e,c=(0,o.Z)(e,["anchorX","anchorY","children","onSync"]);const I=(0,a.Ky)((({invalidate:e})=>e)),[C]=(0,r.useState)((()=>new U)),[u,d]=(0,r.useMemo)((()=>{let e=[],t="";return r.Children.forEach(s,(n=>{"string"==typeof n||"number"==typeof n?t+=n:e.push(n)})),[e,t]}),[s]);return(0,r.useLayoutEffect)((()=>{C.sync((()=>{I(),l&&l(C)}))})),(0,r.useEffect)((()=>()=>C.dispose()),[C]),(0,r.createElement)("primitive",(0,i.Z)({object:C,ref:t,text:d,anchorX:n,anchorY:g},c),u)}))},7934:function(e,t,n){"use strict";n.d(t,{V:function(){return m}});var i=n(7560),o=n(8283),r=n(2784),a=n(8316),g=n(2955),s=n(7209);const l=new g.Vector3,c=new g.Vector3,I=new g.Vector3;function C(e,t,n){const i=l.setFromMatrixPosition(e.matrixWorld);i.project(t);const o=n.width/2,r=n.height/2;return[i.x*o+o,-i.y*r+r]}const u=e=>Math.abs(e)<1e-10?0:e;function d(e,t,n=""){let i="matrix3d(";for(let o=0;16!==o;o++)i+=u(t[o]*e.elements[o])+(15!==o?",":")");return n+i}const h=(A=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>d(e,A));var A;const p=(e,t)=>{return d(e,[1/(n=t),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n},m=(0,r.forwardRef)(((e,t)=>{var n;let{children:d,eps:A=.001,style:m,className:b,prepend:f,center:y,fullscreen:G,portal:v,distanceFactor:B,sprite:Z=!1,transform:w=!1,zIndexRange:W=[16777271,0],calculatePosition:S=C}=e,R=(0,o.Z)(e,["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","zIndexRange","calculatePosition"]);const V=(0,s.Ky)((({gl:e})=>e)),x=(0,s.Ky)((({camera:e})=>e)),X=(0,s.Ky)((({scene:e})=>e)),H=(0,s.Ky)((({size:e})=>e)),[Y]=(0,r.useState)((()=>document.createElement("div"))),K=(0,r.useRef)(null),N=(0,r.useRef)(0),M=(0,r.useRef)([0,0]),F=(0,r.useRef)(null),z=(0,r.useRef)(null),L=null!=(n=null==v?void 0:v.current)?n:V.domElement.parentNode;(0,r.useEffect)((()=>{if(K.current){if(X.updateMatrixWorld(),w)Y.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=S(K.current,x,H);Y.style.cssText="position:absolute;top:0;left:0;transform:translate3d("+e[0]+"px,"+e[1]+"px,0);transform-origin:0 0;"}return L&&(f?L.prepend(Y):L.appendChild(Y)),()=>{L&&L.removeChild(Y),(0,a.unmountComponentAtNode)(Y)}}}),[L,w]);const k=(0,r.useMemo)((()=>w?{position:"absolute",top:0,left:0,width:H.width,height:H.height,transformStyle:"preserve-3d",pointerEvents:"none"}:(0,i.Z)({position:"absolute",transform:y?"translate3d(-50%,-50%,0)":"none"},G&&{top:-H.height/2,left:-H.width/2,width:H.width,height:H.height},m)),[m,y,G,H,w]),E=(0,r.useMemo)((()=>(0,i.Z)({position:"absolute",pointerEvents:"auto"},m)),[m]);return(0,r.useLayoutEffect)((()=>{w?(0,a.render)((0,r.createElement)("div",{ref:F,style:k},(0,r.createElement)("div",{ref:z,style:E},(0,r.createElement)("div",{ref:t,className:b,children:d}))),Y):(0,a.render)((0,r.createElement)("div",{ref:t,style:k,className:b,children:d}),Y)})),(0,s.xQ)((()=>{if(K.current){x.updateMatrixWorld();const e=w?M.current:S(K.current,x,H);if(w||Math.abs(N.current-x.zoom)>A||Math.abs(M.current[0]-e[0])>A||Math.abs(M.current[1]-e[1])>A){if(Y.style.display=function(e,t){const n=l.setFromMatrixPosition(e.matrixWorld),i=c.setFromMatrixPosition(t.matrixWorld),o=n.sub(i),r=t.getWorldDirection(I);return o.angleTo(r)>Math.PI/2}(K.current,x)?"none":"block",Y.style.zIndex=""+function(e,t,n){if(t instanceof g.PerspectiveCamera||t instanceof g.OrthographicCamera){const i=l.setFromMatrixPosition(e.matrixWorld),o=c.setFromMatrixPosition(t.matrixWorld),r=i.distanceTo(o),a=(n[1]-n[0])/(t.far-t.near),g=n[1]-a*t.far;return Math.round(a*r+g)}}(K.current,x,W),w){const[e,t]=[H.width/2,H.height/2],n=x.projectionMatrix.elements[5]*t,{isOrthographicCamera:i,top:o,left:r,bottom:a,right:g}=x,s=h(x.matrixWorldInverse),l=i?"scale("+n+")translate("+u(-(g+r)/2)+"px,"+u((o+a)/2)+"px)":"translateZ("+n+"px)";let c=K.current.matrixWorld;Z&&(c=x.matrixWorldInverse.clone().transpose().copyPosition(c).scale(K.current.scale),c.elements[3]=c.elements[7]=c.elements[11]=0,c.elements[15]=1),Y.style.width=H.width+"px",Y.style.height=H.height+"px",Y.style.perspective=i?"":n+"px",F.current&&z.current&&(F.current.style.transform=""+l+s+"translate("+e+"px,"+t+"px)",z.current.style.transform=p(c,1/((B||10)/400)))}else{const t=void 0===B?1:function(e,t){if(t instanceof g.OrthographicCamera)return t.zoom;if(t instanceof g.PerspectiveCamera){const n=l.setFromMatrixPosition(e.matrixWorld),i=c.setFromMatrixPosition(t.matrixWorld),o=t.fov*Math.PI/180,r=n.distanceTo(i);return 1/(2*Math.tan(o/2)*r)}return 1}(K.current,x)*B;Y.style.transform="translate3d("+e[0]+"px,"+e[1]+"px,0) scale("+t+")"}M.current=e,N.current=x.zoom}}})),(0,r.createElement)("group",(0,i.Z)({},R,{ref:K}))}))},7209:function(e,t,n){"use strict";n.d(t,{Xz:function(){return T},gy:function(){return F},nH:function(){return ee},z6:function(){return j},xQ:function(){return _},U2:function(){return P},Ky:function(){return U}});var i=n(2955),o=n(2784),r=n(2467),a=n(2414),g=n(7962),s=n.n(g),l=n(4616),c=n(9378),I=n.n(c);const C=[];function u(e,t,n,i=0,o=!1){for(const a of t)if(I()(n,a.args)){if(o)return;if(a.error)throw a.error;if(a.response)return a.response;throw a.promise}const r={args:n,promise:e(...n).then((e=>r.response=null==e||e)).catch((e=>r.error=null!=e?e:"unknown error")).then((()=>{i>0&&setTimeout((()=>{const e=t.indexOf(r);-1!==e&&t.splice(e,1)}),i)}))};if(t.push(r),!o)throw r.promise}function d(e,...t){if(void 0===t||0===t.length)e.splice(0,e.length);else{const n=e.find((e=>I()(t,e.args)));if(n){const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}}function h(e,...t){return u(e,C,t,h.lifespan)}h.lifespan=0,h.clear=(...e)=>d(C,...e),h.preload=(e,...t)=>{u(e,C,t,h.lifespan,!0)},h.peek=(...e)=>{var t;return null==(t=C.find((t=>I()(e,t.args))))?void 0:t.response};var A=n(6386);function p(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:i,overflowY:o}=window.getComputedStyle(e);return[n,i,o].some((e=>"auto"===e||"scroll"===e))&&t.push(e),[...t,...p(e.parentElement)]}const m=["x","y","top","bottom","left","right","width","height"],b=(e,t)=>m.every((n=>e[n]===t[n]));var f=function({debounce:e,scroll:t,polyfill:n}={debounce:0,scroll:!1}){const i=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[r,a]=(0,o.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),g=(0,o.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:r}),s=e?"number"==typeof e?e:e.scroll:null,l=e?"number"==typeof e?e:e.resize:null,c=(0,o.useRef)(!1);(0,o.useEffect)((()=>(c.current=!0,()=>{c.current=!1})));const[I,C,u]=(0,o.useMemo)((()=>{const e=()=>{if(!g.current.element)return;const{left:e,top:t,width:n,height:i,bottom:o,right:r,x:s,y:l}=g.current.element.getBoundingClientRect(),I={left:e,top:t,width:n,height:i,bottom:o,right:r,x:s,y:l};Object.freeze(I),c.current&&!b(g.current.lastBounds,I)&&a(g.current.lastBounds=I)};return[e,l?(0,A.debounce)(e,l):e,s?(0,A.debounce)(e,s):e]}),[a,s,l]);function d(){g.current.scrollContainers&&(g.current.scrollContainers.forEach((e=>e.removeEventListener("scroll",u,!0))),g.current.scrollContainers=null),g.current.resizeObserver&&(g.current.resizeObserver.disconnect(),g.current.resizeObserver=null)}function h(){g.current.element&&(g.current.resizeObserver=new i(u),g.current.resizeObserver.observe(g.current.element),t&&g.current.scrollContainers&&g.current.scrollContainers.forEach((e=>e.addEventListener("scroll",u,{capture:!0,passive:!0}))))}var m,f,y;return m=u,f=Boolean(t),(0,o.useEffect)((()=>{if(f){const e=m;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",e,!0)}}}),[m,f]),y=C,(0,o.useEffect)((()=>{const e=y;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[y]),(0,o.useEffect)((()=>{d(),h()}),[t,u,C]),(0,o.useEffect)((()=>d),[]),[e=>{e&&e!==g.current.element&&(d(),g.current.element=e,g.current.scrollContainers=p(e),h())},r,I]};const y={obj:e=>e===Object(e)&&!y.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){if(typeof e!=typeof t||!!e!=!!t)return!1;if(y.str(e)||y.num(e)||y.obj(e))return e===t;if(y.arr(e)&&e==t)return!0;let n;for(n in e)if(!(n in t))return!1;for(n in t)if(e[n]!==t[n])return!1;return!y.und(n)||e===t}};function G(e){return(e.eventObject||e.object).uuid+"/"+e.index}function v(e){const t=new i.Vector3;function n(t){const{internal:n}=e.getState(),i=t.offsetX-n.initialClick[0],o=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+o*o))}function o(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var n;return null==(n=e.__r3f.handlers)?void 0:n["onPointer"+t]}))))}function r(t){const{internal:n}=e.getState();Array.from(n.hovered.values()).forEach((e=>{if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index))){const i=e.eventObject.__r3f.handlers;if(n.hovered.delete(G(e)),i){const n={...e,intersections:t||[]};null==i.onPointerOut||i.onPointerOut(n),null==i.onPointerLeave||i.onPointerLeave(n)}}}))}function a(e,t){t.forEach((t=>{var n;return null==(n=t.__r3f.handlers)||null==n.onPointerMissed?void 0:n.onPointerMissed(e)}))}return{handlePointer:i=>{switch(i){case"onPointerLeave":case"onPointerCancel":return()=>r([]);case"onLostPointerCapture":return()=>(e.getState().internal.captured=void 0,r([]))}return g=>{const{onPointerMissed:s,internal:l}=e.getState();!function(t){var n;const i=e.getState(),{raycaster:o,mouse:r,camera:a,size:g}=i,{offsetX:s,offsetY:l}=null!=(n=null==o.computeOffsets?void 0:o.computeOffsets(t,i))?n:t,{width:c,height:I}=g;r.set(s/c*2-1,-l/I*2+1),o.setFromCamera(r,a)}(g);const c="onPointerMove"===i,I=function(t,n){const{internal:i}=e.getState();return i.captured&&"click"!==n.type&&"wheel"!==n.type&&i.captured.forEach((e=>{t.find((t=>t.eventObject===e.eventObject))||t.push(e)})),t}(function(t){const n=e.getState(),{raycaster:i,internal:o}=n;if(!i.enabled)return[];const r=new Set,a=[],g=t?t(o.interaction):o.interaction;let s=i.intersectObjects(g,!0).filter((e=>{const t=G(e);return!r.has(t)&&(r.add(t),!0)}));i.filter&&(s=i.filter(s,n));for(const e of s){let t=e.object;for(;t;){var l;(null==(l=t.__r3f)?void 0:l.handlers)&&a.push({...e,eventObject:t}),t=t.parent}}return a}(c?o:void 0),g);c&&r(I),function(i,o,a){const{raycaster:g,mouse:s,camera:l,internal:c}=e.getState();if(i.length){const e=t.set(s.x,s.y,0).unproject(l),I="click"===o.type?n(o):0,C=e=>o.target.releasePointerCapture(e),u={stopped:!1,captured:!1};for(const t of i){const n=e=>{u.captured||(u.captured=!0,c.captured=[]),c.captured&&c.captured.push(t),o.target.setPointerCapture(e)};let s={};for(let e in Object.getPrototypeOf(o))s[e]=o[e];let d={...t,...s,intersections:i,stopped:u.stopped,delta:I,unprojectedPoint:e,ray:g.ray,camera:l,stopPropagation:()=>{const e=c.captured;(!e||e.find((e=>e.eventObject.id===t.eventObject.id)))&&(d.stopped=u.stopped=!0,c.hovered.size&&Array.from(c.hovered.values()).find((e=>e.eventObject===t.eventObject)))&&r([...i.slice(0,i.indexOf(t)),t])},target:{...o.target,setPointerCapture:n,releasePointerCapture:C},currentTarget:{...o.currentTarget,setPointerCapture:n,releasePointerCapture:C},sourceEvent:o};if(a(d),!0===u.stopped)break}}}(I,g,(e=>{const t=e.eventObject,n=t.__r3f.handlers;if(n)if(c){if(n.onPointerOver||n.onPointerEnter||n.onPointerOut||n.onPointerLeave){const t=G(e),i=l.hovered.get(t);i?i.stopped&&e.stopPropagation():(l.hovered.set(t,e),null==n.onPointerOver||n.onPointerOver(e),null==n.onPointerEnter||n.onPointerEnter(e))}null==n.onPointerMove||n.onPointerMove(e)}else{const o=null==n?void 0:n[i];o&&("onClick"!==i&&"onContextMenu"!==i&&"onDoubleClick"!==i||l.initialHits.includes(t))&&(o(e),a(g,l.interaction.filter((e=>e!==t))))}})),"onPointerDown"===i&&(l.initialClick=[g.offsetX,g.offsetY],l.initialHits=I.map((e=>e.eventObject))),"onClick"!==i&&"onContextMenu"!==i&&"onDoubleClick"!==i||I.length||n(g)<=2&&(a(g,l.interaction),s&&s())}}}}const B=e=>e&&!!e.getState,Z=(e,t)=>{var n,i;return{root:B(e)?e:null!=(n=null==(i=e.__r3f)?void 0:i.root)?n:t.__r3f.root,container:B(e)?e.getState().scene:e}},w="__default",W={},S=["children","key","ref"];let R={};function V(e,t){const n=e;return n.__r3f||(n.__r3f={root:null,memoizedProps:{},objects:[],...t}),e}const x=e=>e&&e.isOrthographicCamera,X=o.createContext(null);function H(e,t){const n=t.length;return t.push(e),()=>{t.splice(n,1)}}let Y,K=[],N=[],M=[];const F=e=>H(e,K);function z(e,t){for(Y=0;Y<e.length;Y++)e[Y](t)}function L(e,t){const n=t.clock.getDelta();for(Y=0;Y<t.internal.subscribers.length;Y++)t.internal.subscribers[Y].ref.current(t,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function k(e){const{handlePointer:t}=v(e),n={onClick:"click",onContextMenu:"contextmenu",onDoubleClick:"dblclick",onWheel:"wheel",onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerLeave:"pointerleave",onPointerMove:"pointermove",onPointerCancel:"pointercancel",onLostPointerCapture:"lostpointercapture"};return{connected:!1,handlers:Object.keys(n).reduce(((e,n)=>({...e,[n]:t(n)})),{}),connect:t=>{var i;const{set:o,events:r}=e.getState();null==r.disconnect||r.disconnect(),o((e=>({events:{...e.events,connected:t}}))),Object.entries(null!=(i=null==r?void 0:r.handlers)?i:[]).forEach((([e,i])=>t.addEventListener(n[e],i,{passive:!0})))},disconnect:()=>{const{set:t,events:i}=e.getState();var o;i.connected&&(Object.entries(null!=(o=i.handlers)?o:[]).forEach((([e,t])=>{i&&i.connected instanceof HTMLElement&&i.connected.removeEventListener(n[e],t)})),t((e=>({events:{...e.events,connected:!1}}))))}}}const E="undefined"!=typeof window?o.useLayoutEffect:o.useEffect;function T({children:e,tabIndex:t,resize:n,id:g,style:s,className:l,events:c,...I}){const[C,u]=f({scroll:!0,debounce:{scroll:50,resize:0},...n}),d=o.useRef(null);return E((()=>{u.width>0&&u.height>0&&function(e,t,{gl:n,size:g,mode:s=O[1],events:l,onCreated:c,...I}={}){var C,u,d,h,A;g||(g={width:null!=(u=null==(d=t.parentElement)?void 0:d.clientWidth)?u:0,height:null!=(h=null==(A=t.parentElement)?void 0:A.clientHeight)?h:0});let p=Q.get(t),m=null==p?void 0:p.fiber,b=null==p?void 0:p.store,f=null==(C=b)?void 0:C.getState();if(m&&f){const e=f.internal.lastProps;void 0===I.dpr||y.equ(e.dpr,I.dpr)||f.setDpr(I.dpr),void 0===g||y.equ(e.size,g)||f.setSize(g.width,g.height);I.linear!==e.linear&&(ne(t),m=void 0)}if(!m){const e=((e,t)=>{return n=e,n&&n.render?e:new i.WebGLRenderer({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e});var n})(n,t);I.vr&&(e.xr.enabled=!0,e.setAnimationLoop((e=>q(e,!0)))),b=((e,t,n,o)=>{const{gl:g,size:s,shadows:l=!1,linear:c=!1,flat:I=!1,vr:C=!1,orthographic:u=!1,frameloop:d="always",dpr:h=1,performance:A,clock:p=new i.Clock,raycaster:m,camera:b,onPointerMissed:f}=o;l&&(g.shadowMap.enabled=!0,"object"==typeof l?Object.assign(g.shadowMap,l):g.shadowMap.type=i.PCFSoftShadowMap),c||(I||(g.toneMapping=i.ACESFilmicToneMapping),g.outputEncoding=i.sRGBEncoding);const y=(0,r.Z)(((r,a)=>{const s=new i.Raycaster,{params:l,...y}=m||{};e(s,{enabled:!0,...y,params:{...s.params,...l}},{});const G=b instanceof i.Camera,v=G?b:u?new i.OrthographicCamera(0,0,0,0,.1,1e3):new i.PerspectiveCamera(75,0,.1,1e3);function B(e){return Array.isArray(e)?Math.min(Math.max(e[0],window.devicePixelRatio),e[1]):e}G||(v.position.z=5,b&&e(v,b,{}),v.lookAt(0,0,0));const Z=B(h),w=new i.Vector3,W=new i.Vector3;function S(e=a().camera,t=W,n=a().size){const{width:i,height:o}=n,r=i/o,g=e.getWorldPosition(w).distanceTo(t);if(x(e))return{width:i/e.zoom,height:o/e.zoom,factor:1,distance:g,aspect:r};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*g,a=n*(i/o);return{width:a,height:n,factor:i/a,distance:g,aspect:r}}}let R;const X=e=>r((t=>({performance:{...t.performance,current:e}})));return{gl:g,set:r,get:a,invalidate:()=>t(a()),advance:(e,t)=>n(e,t,a()),linear:c,flat:I,scene:V(new i.Scene),camera:v,raycaster:s,clock:p,mouse:new i.Vector2,vr:C,frameloop:d,onPointerMissed:f,performance:{current:1,min:.5,max:1,debounce:200,...A,regress:()=>{const e=a();R&&clearTimeout(R),e.performance.current!==e.performance.min&&X(e.performance.min),R=setTimeout((()=>X(a().performance.max)),e.performance.debounce)}},size:{width:0,height:0},viewport:{initialDpr:Z,dpr:Z,width:0,height:0,aspect:0,distance:0,factor:0,getCurrentViewport:S},setSize:(e,t)=>{const n={width:e,height:t};r((e=>({size:n,viewport:{...e.viewport,...S(v,W,n)}})))},setDpr:e=>r((t=>({viewport:{...t.viewport,dpr:B(e)}}))),events:{connected:!1},internal:{active:!1,priority:0,frames:0,lastProps:o,interaction:[],hovered:new Map,subscribers:[],captured:void 0,initialClick:[0,0],initialHits:[],subscribe:(e,t=0)=>(r((({internal:n})=>({internal:{...n,priority:n.priority+(t?1:0),subscribers:[...n.subscribers,{ref:e,priority:t}].sort(((e,t)=>e.priority-t.priority))}}))),()=>{r((({internal:n})=>({internal:{...n,priority:n.priority-(t?1:0),subscribers:n.subscribers.filter((t=>t.ref!==e))}})))})}}}));y.subscribe((()=>{const{camera:e,size:t,viewport:n,internal:o}=y.getState();o.lastProps.camera instanceof i.Camera||(x(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld()),g.setPixelRatio(n.dpr),g.setSize(t.width,t.height)}),(e=>[e.viewport.dpr,e.size]),a.Z);const G=y.getState();return s&&G.setSize(s.width,s.height),y.subscribe((e=>t(e))),y})(ee,j,q,{gl:e,size:g,...I});const o=b.getState();o.get,m=$.createContainer(b,O.indexOf(s),!1,null),Q.set(t,{fiber:m,store:b}),l&&o.set({events:l(b)})}if(b&&m)return $.updateContainer(o.createElement(te,{store:b,element:e,onCreated:c,target:t}),m,null,(()=>{})),b;throw"Error creating root!"}(e,d.current,{...I,size:u,events:c||k})}),[u,e]),o.useEffect((()=>{const e=d.current;return()=>ne(e)}),[]),o.createElement("div",{ref:C,id:g,className:l,tabIndex:t,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",...s}},o.createElement("canvas",{ref:d,style:{display:"block"}}))}function U(e=(e=>e),t){const n=o.useContext(X);if(!n)throw"R3F hooks can only be used within the Canvas component!";return n(e,t)}function _(e,t=0){const{subscribe:n}=o.useContext(X).getState().internal,i=o.useRef(e);return o.useLayoutEffect((()=>{i.current=e}),[e]),o.useEffect((()=>{const e=n(i,t);return()=>e()}),[t,n]),null}function J(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function D(e,t){return function(n,...i){const o=new n;return e&&e(o),Promise.all(i.map((e=>new Promise(((n,i)=>o.load(e,(e=>{e.scene&&Object.assign(e,J(e.scene)),n(e)}),t,(t=>{var n;return i(null!=(n=t.message)?n:`failure loading ${e}`)})))))))}}function P(e,t,n,i){const o=Array.isArray(t)?t:[t],r=h(D(n,i),e,...o);return Array.isArray(t)?r:r[0]}P.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return h.preload(D(n),e,...i)};const Q=new Map,O=["legacy","blocking","concurrent"],{invalidate:j,advance:q}=function(e){let t,n=!1;function i(o){if(n=!0,t=0,z(K,o),e.forEach((e=>{const n=e.store.getState();n.internal.active&&("always"===n.frameloop||n.internal.frames>0)&&(t+=L(0,n))})),z(N,o),t>0)return requestAnimationFrame(i);z(M,o),n=!1}return{loop:i,invalidate:function t(o){if(!o)return e.forEach((e=>t(e.store.getState())));!o.vr&&o.internal.active&&"never"!==o.frameloop&&(o.internal.frames=Math.min(60,o.internal.frames+1),n||(n=!0,requestAnimationFrame(i)))},advance:function(t,n=!0,i){n&&z(K,t),i?L(0,i):e.forEach((e=>L(0,e.store.getState()))),n&&z(N,t)}}}(Q),{reconciler:$,applyProps:ee}=function(e){function t(e,t,r={},a=!1){var g,s,l;const c=null!=(g=null==e?void 0:e.__r3f)?g:{},I=c.root,C=null!=(s=null==I||null==I.getState?void 0:I.getState())?s:{},u=[],d=[],h={};let A=0;Object.entries(t).forEach((([e,t])=>{-1===S.indexOf(e)&&(h[e]=t)})),c.memoizedProps&&c.memoizedProps.args&&(h.args=c.memoizedProps.args),c.memoizedProps&&c.memoizedProps.attach&&(h.attach=c.memoizedProps.attach),e.__r3f&&(e.__r3f.memoizedProps=h);let p=Object.keys(t);for(A=0;A<p.length;A++)y.equ(t[p[A]],r[p[A]])&&u.push(p[A]),y.fun(t[p[A]])&&/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p[A])&&d.push(p[A]);const m=[];if(a)for(p=Object.keys(r),A=0;A<p.length;A++)t.hasOwnProperty(p[A])||m.push(p[A]);const b=[...u,...S];null!=(l=e.__r3f)&&l.instance&&b.push("object");const f={...t};for(p=Object.keys(f),A=0;A<p.length;A++)b.indexOf(p[A])>-1&&delete f[p[A]];const G=Object.entries(f);for(A=0;A<m.length;A++)"children"!==m[A]&&G.unshift([m[A],w+"remove"]);if(G.length>0){if(G.forEach((([t,o])=>{if(!d.includes(t)){let r=e,a=r[t];if(t.includes("-")){const n=t.split("-");if(a=n.reduce(((e,t)=>e[t]),e),!a||!a.set){const[i,...o]=n.reverse();r=o.reverse().reduce(((e,t)=>e[t]),e),t=i}}if(o===w+"remove")if(a&&a.constructor)o=new a.constructor(h.args);else if(r.constructor){const e=new r.constructor(r.__r3f.memoizedProps.args);o=e[a],e.dispose&&e.dispose()}else o=0;if(a&&a.set&&(a.copy||a instanceof i.Layers)){if(Array.isArray(o))a.fromArray?a.fromArray(o):a.set(...o);else if(a.copy&&o&&o.constructor&&a.constructor.name===o.constructor.name)a.copy(o);else if(void 0!==o){const e=a instanceof i.Color;!e&&a.setScalar?a.setScalar(o):a instanceof i.Layers&&o instanceof i.Layers?a.mask=o.mask:a.set(o),!C.linear&&e&&a.convertSRGBToLinear()}}else r[t]=o,!C.linear&&r[t]instanceof i.Texture&&(r[t].encoding=i.sRGBEncoding);n(e)}})),a&&I&&e.raycast&&c.handlers){c.handlers=void 0;const t=C.internal.interaction.indexOf(e);t>-1&&C.internal.interaction.splice(t,1)}d.length&&(a&&I&&e.raycast&&C.internal.interaction.push(e),c.handlers=d.reduce(((e,n)=>({...e,[n]:t[n]})),{})),e.parent&&o(e)}}function n(e){var t,n;const i=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function o(e){null==e.onUpdate||e.onUpdate(e)}function r(e,{args:n=[],...o},r,a,g){let s,l=`${e[0].toUpperCase()}${e.slice(1)}`;if(!B(r)&&g){const e=t=>t.return?e(t.return):t.stateNode&&t.stateNode.containerInfo;r=e(g)}if(!r||!B(r))throw`No valid root for ${l}!`;if("primitive"===e){if(void 0===o.object)throw"Primitives without 'object' are invalid!";s=V(o.object,{root:r,instance:!0})}else{const e=R[l]||i[l];if(!e)throw`${l} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;const t=y.arr(n);s=V(t?new e(...n):new e(n),{root:r,memoizedProps:{args:t&&0===n.length?null:n}})}return l.endsWith("Geometry")?o={attach:"geometry",...o}:l.endsWith("Material")&&(o={attach:"material",...o}),t(s,o,{}),s}function a(e,t){t&&(t.isObject3D?e.add(t):(e.__r3f.objects.push(t),t.parent=e,t.attachArray?(y.arr(e[t.attachArray])||(e[t.attachArray]=[]),e[t.attachArray].push(t)):t.attachObject?(y.obj(e[t.attachObject[0]])||(e[t.attachObject[0]]={}),e[t.attachObject[0]][t.attachObject[1]]=t):t.attach&&(e[t.attach]=t)),o(t),n(t))}function g(e,t,i){if(t){if(t.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});const n=e.children.filter((e=>e!==t)),o=n.indexOf(i);e.children=[...n.slice(0,o),t,...n.slice(o)]}else{if(!t.attachArray)return a(e,t);{e.__r3f.objects.push(t),t.parent=e;const n=e[t.attachArray];y.arr(n)||(e[t.attachArray]=[]),n.splice(n.indexOf(i),0,t)}}o(t),n(t)}}function c(e,t,n=!1){e&&[...e].forEach((e=>I(t,e,n)))}function I(e,t,i){if(t){var o,r;if(t.isObject3D)e.remove(t),null!=(r=t.__r3f)&&r.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter((e=>e!==t)),n.initialHits=n.initialHits.filter((e=>e!==t)),n.hovered.forEach(((e,i)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(i)}))}(t.__r3f.root,t);else t.parent=null,e.__r3f.objects&&(e.__r3f.objects=e.__r3f.objects.filter((e=>e!==t))),t.attachArray?e[t.attachArray]=e[t.attachArray].filter((e=>e!==t)):t.attachObject?delete e[t.attachObject[0]][t.attachObject[1]]:t.attach&&(e[t.attach]=null);const g=null==(o=t.__r3f)?void 0:o.instance,s=void 0===i?null!==t.dispose&&!g:i;var a;if(!g)c(null==(a=t.__r3f)?void 0:a.objects,t,s),c(t.children,t,s);t.__r3f&&(delete t.__r3f.root,delete t.__r3f.objects,delete t.__r3f.handlers,delete t.__r3f.memoizedProps,g||delete t.__r3f),s&&t.dispose&&"Scene"!==t.type&&(0,l.unstable_runWithPriority)(l.unstable_IdlePriority,(()=>t.dispose())),n(e)}}function C(e,t,n,i){const o=e.parent;if(!o)return;const g=r(t,n,e.__r3f.root);I(o,e),a(o,g),[i,i.alternate].forEach((e=>{null!==e&&(e.stateNode=g,e.ref&&("function"==typeof e.ref?e.ref(g):e.ref.current=g))}))}return{reconciler:s()({now:l.unstable_now,createInstance:r,removeChild:I,appendChild:a,appendInitialChild:a,insertBefore:g,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:y.fun(setTimeout)?setTimeout:void 0,cancelTimeout:y.fun(clearTimeout)?clearTimeout:void 0,setTimeout:y.fun(setTimeout)?setTimeout:void 0,clearTimeout:y.fun(clearTimeout)?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:(e,t)=>{const{container:n,root:i}=Z(e,t);n.__r3f.root=i,a(n,t)},removeChildFromContainer:(e,t)=>{const{container:n}=Z(e,t);I(n,t)},insertInContainerBefore:(e,t,n)=>{const{container:i}=Z(e,t);g(i,t,n)},commitUpdate(e,n,i,o,r,a){if(e.__r3f.instance&&r.object&&r.object!==e)C(e,i,r,a);else{const{args:n=[],...g}=r,{args:s=[],...l}=o;n.some(((e,t)=>y.obj(e)?Object.entries(e).some((([e,n])=>n!==s[t][e])):e!==s[t]))?C(e,i,r,a):t(e,g,l,!0)}},hideInstance(e){e.isObject3D&&(e.visible=!1,n(e))},unhideInstance(e,t){(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0,n(e))},hideTextInstance(){throw new Error("Text is not allowed in the R3F tree.")},getPublicInstance:e=>e,getRootHostContext:e=>W,getChildHostContext:e=>W,createTextInstance(){},finalizeInitialChildren:e=>!!e.__r3f.handlers,commitMount(e){e.raycast&&e.__r3f.handlers&&e.__r3f.root.getState().internal.interaction.push(e)},prepareUpdate:()=>W,shouldDeprioritizeSubtree:()=>!1,prepareForCommit:()=>null,preparePortalMount(...e){},resetAfterCommit(){},shouldSetTextContent:()=>!1,clearContainer:()=>!1}),applyProps:t}}();function te({store:e,element:t,onCreated:n,target:i}){return o.useEffect((()=>{const t=e.getState();t.set((e=>({internal:{...e.internal,active:!0}}))),null==t.events.connect||t.events.connect(i),n&&n(t)}),[]),o.createElement(X.Provider,{value:e},t)}function ne(e,t){const n=Q.get(e),i=null==n?void 0:n.fiber;if(i){const o=null==n?void 0:n.store.getState();o&&(o.internal.active=!1),$.updateContainer(null,i,null,(()=>{o&&setTimeout((()=>{var n,i,r;null==o.events.disconnect||o.events.disconnect(),null==(n=o.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(r=o.gl)||null==r.forceContextLoss||r.forceContextLoss(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const i in e){var t,n;null==(t=(n=i).dispose)||t.call(n),delete e[i]}}(o),Q.delete(e),t&&t(e)}),500)}))}}$.act,y.fun(Symbol)&&Symbol.for&&Symbol.for("react.portal");$.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:"17.0.2"})},4571:function(e,t,n){"use strict";n.d(t,{Zb:function(){return Pn},P:function(){return wi},_u:function(){return ui}});var i=n(2784),o=n(7550);let r=f();const a=e=>A(e,r);let g=f();a.write=e=>A(e,g);let s=f();a.onStart=e=>A(e,s);let l=f();a.onFrame=e=>A(e,l);let c=f();a.onFinish=e=>A(e,c);let I=[];a.setTimeout=(e,t)=>{let n=a.now()+t,i=()=>{let e=I.findIndex((e=>e.cancel==i));~e&&I.splice(e,1),G.count-=~e?1:0},o={time:n,handler:e,cancel:i};return I.splice(C(n),0,o),G.count+=1,p(),o};let C=e=>~(~I.findIndex((t=>t.time>e))||~I.length);a.cancel=e=>{r.delete(e),g.delete(e)},a.sync=e=>{h=!0,a.batchedUpdates(e),h=!1},a.throttle=e=>{let t;function n(){try{e(...t)}finally{t=null}}function i(...e){t=e,a.onStart(n)}return i.handler=e,i.cancel=()=>{s.delete(n),t=null},i};let u="undefined"!=typeof window?window.requestAnimationFrame:()=>{};a.use=e=>u=e,a.now="undefined"!=typeof performance?()=>performance.now():Date.now,a.batchedUpdates=e=>e(),a.catch=console.error,a.frameLoop="always",a.advance=()=>{"demand"!==a.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):b()};let d=-1,h=!1;function A(e,t){h?(t.delete(e),e(0)):(t.add(e),p())}function p(){d<0&&(d=0,"demand"!==a.frameLoop&&u(m))}function m(){~d&&(u(m),a.batchedUpdates(b))}function b(){let e=d;d=a.now();let t=C(d);t&&(y(I.splice(0,t),(e=>e.handler())),G.count-=t),s.flush(),r.flush(e?Math.min(64,d-e):16.667),l.flush(),g.flush(),c.flush()}function f(){let e=new Set,t=e;return{add(n){G.count+=t!=e||e.has(n)?0:1,e.add(n)},delete:n=>(G.count-=t==e&&e.has(n)?1:0,e.delete(n)),flush(n){t.size&&(e=new Set,G.count-=t.size,y(t,(t=>t(n)&&e.add(t))),G.count+=e.size,t=e)}}}function y(e,t){e.forEach((e=>{try{t(e)}catch(n){a.catch(n)}}))}const G={count:0,clear(){d=-1,I=[],s=f(),r=f(),l=f(),g=f(),c=f(),G.count=0}};function v(){}const B={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function Z(e,t){if(B.arr(e)){if(!B.arr(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}const w=(e,t)=>e.forEach(t);function W(e,t,n){for(const i in e)t.call(n,e[i],i)}const S=e=>B.und(e)?[]:B.arr(e)?e:[e];function R(e,t){if(e.size){const n=Array.from(e);e.clear(),w(n,t)}}const V=(e,...t)=>R(e,(e=>e(...t)));let x,X,H=null,Y=!1,K=v;var N=Object.freeze({__proto__:null,get createStringInterpolator(){return x},get to(){return X},get colors(){return H},get skipAnimation(){return Y},get willAdvance(){return K},assign:e=>{e.to&&(X=e.to),e.now&&(a.now=e.now),void 0!==e.colors&&(H=e.colors),null!=e.skipAnimation&&(Y=e.skipAnimation),e.createStringInterpolator&&(x=e.createStringInterpolator),e.requestAnimationFrame&&a.use(e.requestAnimationFrame),e.batchedUpdates&&(a.batchedUpdates=e.batchedUpdates),e.willAdvance&&(K=e.willAdvance),e.frameLoop&&(a.frameLoop=e.frameLoop)}});const M=new Set;let F=[],z=[],L=0;const k={get idle(){return!M.size&&!F.length},start(e){L>e.priority?(M.add(e),a.onStart(E)):(T(e),a(_))},advance:_,sort(e){if(L)a.onFrame((()=>k.sort(e)));else{const t=F.indexOf(e);~t&&(F.splice(t,1),U(e))}},clear(){F=[],M.clear()}};function E(){M.forEach(T),M.clear(),a(_)}function T(e){F.includes(e)||U(e)}function U(e){F.splice(function(e,t){const n=e.findIndex(t);return n<0?e.length:n}(F,(t=>t.priority>e.priority)),0,e)}function _(e){const t=z;for(let n=0;n<F.length;n++){const i=F[n];L=i.priority,i.idle||(K(i),i.advance(e),i.idle||t.push(i))}return L=0,z=F,z.length=0,F=t,F.length>0}const J="[-+]?\\d*\\.?\\d+",D=J+"%";function P(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const Q=new RegExp("rgb"+P(J,J,J)),O=new RegExp("rgba"+P(J,J,J,J)),j=new RegExp("hsl"+P(J,D,D)),q=new RegExp("hsla"+P(J,D,D,J)),$=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,ee=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,te=/^#([0-9a-fA-F]{6})$/,ne=/^#([0-9a-fA-F]{8})$/;function ie(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function oe(e,t,n){const i=n<.5?n*(1+t):n+t-n*t,o=2*n-i,r=ie(o,i,e+1/3),a=ie(o,i,e),g=ie(o,i,e-1/3);return Math.round(255*r)<<24|Math.round(255*a)<<16|Math.round(255*g)<<8}function re(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function ae(e){return(parseFloat(e)%360+360)%360/360}function ge(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function se(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function le(e){let t=function(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=te.exec(e))?parseInt(t[1]+"ff",16)>>>0:H&&void 0!==H[e]?H[e]:(t=Q.exec(e))?(re(t[1])<<24|re(t[2])<<16|re(t[3])<<8|255)>>>0:(t=O.exec(e))?(re(t[1])<<24|re(t[2])<<16|re(t[3])<<8|ge(t[4]))>>>0:(t=$.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=ne.exec(e))?parseInt(t[1],16)>>>0:(t=ee.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=j.exec(e))?(255|oe(ae(t[1]),se(t[2]),se(t[3])))>>>0:(t=q.exec(e))?(oe(ae(t[1]),se(t[2]),se(t[3]))|ge(t[4]))>>>0:null}(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const ce=(e,t,n)=>{if(B.fun(e))return e;if(B.arr(e))return ce({range:e,output:t,extrapolate:n});if(B.str(e.output[0]))return x(e);const i=e,o=i.output,r=i.range||[0,1],a=i.extrapolateLeft||i.extrapolate||"extend",g=i.extrapolateRight||i.extrapolate||"extend",s=i.easing||(e=>e);return e=>{const t=function(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}(e,r);return function(e,t,n,i,o,r,a,g,s){let l=s?s(e):e;if(l<t){if("identity"===a)return l;"clamp"===a&&(l=t)}if(l>n){if("identity"===g)return l;"clamp"===g&&(l=n)}if(i===o)return i;if(t===n)return e<=t?i:o;t===-1/0?l=-l:n===1/0?l-=t:l=(l-t)/(n-t);l=r(l),i===-1/0?l=-l:o===1/0?l+=i:l=l*(o-i)+i;return l}(e,r[t],r[t+1],o[t],o[t+1],s,a,g,i.map)}};function Ie(){return(Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const Ce=Symbol.for("FluidValue.get"),ue=Symbol.for("FluidValue.observers"),de=e=>Boolean(e&&e[Ce]),he=e=>e&&e[Ce]?e[Ce]():e,Ae=e=>e[ue]||null;function pe(e,t){let n=e[ue];n&&n.forEach((e=>{!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)}))}class me{constructor(e){if(this[Ce]=void 0,this[ue]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");be(this,e)}}const be=(e,t)=>Ge(e,Ce,t);function fe(e,t){if(e[Ce]){let n=e[ue];n||Ge(e,ue,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function ye(e,t){let n=e[ue];if(n&&n.has(t)){const i=n.size-1;i?n.delete(t):e[ue]=null,e.observerRemoved&&e.observerRemoved(i,t)}}const Ge=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),ve=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Be=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi;let Ze;const we=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,We=(e,t,n,i,o)=>`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(i)}, ${o})`,Se=e=>{Ze||(Ze=H?new RegExp(`(${Object.keys(H).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map((e=>he(e).replace(Be,le).replace(Ze,le))),n=t.map((e=>e.match(ve).map(Number))),i=n[0].map(((e,t)=>n.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))).map((t=>ce(Ie({},e,{output:t}))));return e=>{let n=0;return t[0].replace(ve,(()=>String(i[n++](e)))).replace(we,We)}},Re="react-spring: ",Ve=e=>{const t=e;let n=!1;if("function"!=typeof t)throw new TypeError(`${Re}once requires a function parameter`);return(...e)=>{n||(t(...e),n=!0)}},xe=Ve(console.warn);const Xe=Ve(console.warn);function He(e){return B.str(e)&&("#"==e[0]||/\d/.test(e)||e in(H||{}))}const Ye=e=>(0,i.useEffect)(e,Ke),Ke=[];function Ne(){const e=(0,i.useState)()[1],t=(0,i.useState)(Me)[0];return Ye(t.unmount),()=>{t.current&&e({})}}function Me(){const e={current:!0,unmount:()=>()=>{e.current=!1}};return e}function Fe(e){const t=(0,i.useRef)();return(0,i.useEffect)((()=>{t.current=e})),t.current}const ze="undefined"!=typeof window&&window.document&&window.document.createElement?i.useLayoutEffect:i.useEffect,Le=Symbol.for("Animated:node"),ke=e=>e&&e[Le],Ee=(e,t)=>{return n=e,i=Le,o=t,Object.defineProperty(n,i,{value:o,writable:!0,configurable:!0});var n,i,o},Te=e=>e&&e[Le]&&e[Le].getPayload();class Ue{constructor(){this.payload=void 0,Ee(this,this)}getPayload(){return this.payload||[]}}class _e extends Ue{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,B.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new _e(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return B.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,B.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class Je extends _e{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=ce({output:[e,e]})}static create(e){return new Je(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(B.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=ce({output:[this.getValue(),e]})),this._value=0,super.reset()}}const De={dependencies:null};class Pe extends Ue{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return W(this.source,((n,i)=>{var o;(o=n)&&o[Le]===o?t[i]=n.getValue(e):de(n)?t[i]=he(n):e||(t[i]=n)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&w(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return W(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){De.dependencies&&de(e)&&De.dependencies.add(e);const t=Te(e);t&&w(t,(e=>this.add(e)))}}class Qe extends Pe{constructor(e){super(e)}static create(e){return new Qe(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.map(((t,n)=>t.setValue(e[n]))).some(Boolean):(super.setValue(e.map(Oe)),!0)}}function Oe(e){return(He(e)?Je:_e).create(e)}function je(e){const t=ke(e);return t?t.constructor:B.arr(e)?Qe:He(e)?Je:_e}function qe(){return(qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const $e=(e,t)=>{const n=!B.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,i.forwardRef)(((o,r)=>{const g=(0,i.useRef)(null),s=n&&(0,i.useCallback)((e=>{g.current=function(e,t){e&&(B.fun(e)?e(t):e.current=t);return t}(r,e)}),[r]),[l,c]=function(e,t){const n=new Set;De.dependencies=n,e.style&&(e=qe({},e,{style:t.createAnimatedStyle(e.style)}));return e=new Pe(e),De.dependencies=null,[e,n]}(o,t),I=Ne(),C=()=>{const e=g.current;if(n&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,l.getValue(!0)))&&I()},u=new et(C,c),d=(0,i.useRef)();ze((()=>{const e=d.current;d.current=u,w(c,(e=>fe(e,u))),e&&(w(e.deps,(t=>ye(t,e))),a.cancel(e.update))})),(0,i.useEffect)(C,[]),Ye((()=>()=>{const e=d.current;w(e.deps,(t=>ye(t,e)))}));const h=t.getComponentProps(l.getValue());return i.createElement(e,qe({},h,{ref:s}))}))};class et{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&a.write(this.update)}}const tt=Symbol.for("AnimatedComponent"),nt=e=>B.str(e)?e:e&&B.str(e.displayName)?e.displayName:B.fun(e)&&e.name||null;function it(){return(it=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function ot(e,...t){return B.fun(e)?e(...t):e}const rt=(e,t)=>!0===e||!!(t&&e&&(B.fun(e)?e(t):S(e).includes(t))),at=(e,t)=>B.obj(e)?t&&e[t]:e,gt=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,st=e=>e,lt=(e,t=st)=>{let n=ct;e.default&&!0!==e.default&&(e=e.default,n=Object.keys(e));const i={};for(const o of n){const n=t(e[o],o);B.und(n)||(i[o]=n)}return i},ct=["config","onProps","onStart","onChange","onPause","onResume","onRest"],It={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Ct(e){const t=function(e){const t={};let n=0;if(W(e,((e,i)=>{It[i]||(t[i]=e,n++)})),n)return t}(e);if(t){const n={to:t};return W(e,((e,i)=>i in t||(n[i]=e))),n}return it({},e)}function ut(e){return e=he(e),B.arr(e)?e.map(ut):He(e)?N.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function dt(e){for(const t in e)return!0;return!1}function ht(e){return B.fun(e)||B.arr(e)&&B.obj(e[0])}function At(e,t){var n;null==(n=e.ref)||n.delete(e),null==t||t.delete(e)}function pt(e,t){var n;t&&e.ref!==t&&(null==(n=e.ref)||n.delete(e),t.add(e),e.ref=t)}const mt={tension:170,friction:26},bt=it({},mt,{mass:1,damping:1,easing:e=>e,clamp:!1});class ft{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,bt)}}function yt(e,t){if(B.und(t.decay)){const n=!B.und(t.tension)||!B.und(t.friction);!n&&B.und(t.frequency)&&B.und(t.damping)&&B.und(t.mass)||(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}else e.duration=void 0}const Gt=[];class vt{constructor(){this.changed=!1,this.values=Gt,this.toValues=null,this.fromValues=Gt,this.to=void 0,this.from=void 0,this.config=new ft,this.immediate=!1}}function Bt(e,{key:t,props:n,defaultProps:i,state:o,actions:r}){return new Promise(((g,s)=>{var l;let c,I,C=rt(null!=(l=n.cancel)?l:null==i?void 0:i.cancel,t);if(C)h();else{B.und(n.pause)||(o.paused=rt(n.pause,t));let e=null==i?void 0:i.pause;!0!==e&&(e=o.paused||rt(e,t)),c=ot(n.delay||0,t),e?(o.resumeQueue.add(d),r.pause()):(r.resume(),d())}function u(){o.resumeQueue.add(d),o.timeouts.delete(I),I.cancel(),c=I.time-a.now()}function d(){c>0?(I=a.setTimeout(h,c),o.pauseQueue.add(u),o.timeouts.add(I)):h()}function h(){o.pauseQueue.delete(u),o.timeouts.delete(I),e<=(o.cancelId||0)&&(C=!0);try{r.start(it({},n,{callId:e,cancel:C}),g)}catch(t){s(t)}}}))}const Zt=(e,t)=>1==t.length?t[0]:t.some((e=>e.cancelled))?St(e.get()):t.every((e=>e.noop))?wt(e.get()):Wt(e.get(),t.every((e=>e.finished))),wt=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),Wt=(e,t,n=!1)=>({value:e,finished:t,cancelled:n}),St=e=>({value:e,cancelled:!0,finished:!1});function Rt(e,t,n,i){const{callId:o,parentId:r,onRest:g}=t,{asyncTo:s,promise:l}=n;return r||e!==s||t.reset?n.promise=(async()=>{n.asyncId=o,n.asyncTo=e;const c=lt(t,((e,t)=>"onRest"===t?void 0:e));let I,C;const u=new Promise(((e,t)=>(I=e,C=t))),d=e=>{const t=o<=(n.cancelId||0)&&St(i)||o!==n.asyncId&&Wt(i,!1);if(t)throw e.result=t,C(e),e},h=(e,t)=>{const r=new xt,a=new Xt;return(async()=>{if(N.skipAnimation)throw Vt(n),a.result=Wt(i,!1),C(a),a;d(r);const g=B.obj(e)?it({},e):it({},t,{to:e});g.parentId=o,W(c,((e,t)=>{B.und(g[t])&&(g[t]=e)}));const s=await i.start(g);return d(r),n.paused&&await new Promise((e=>{n.resumeQueue.add(e)})),s})()};let A;if(N.skipAnimation)return Vt(n),Wt(i,!1);try{let t;t=B.arr(e)?(async e=>{for(const t of e)await h(t)})(e):Promise.resolve(e(h,i.stop.bind(i))),await Promise.all([t.then(I),u]),A=Wt(i.get(),!0,!1)}catch(p){if(p instanceof xt)A=p.result;else{if(!(p instanceof Xt))throw p;A=p.result}}finally{o==n.asyncId&&(n.asyncId=r,n.asyncTo=r?s:void 0,n.promise=r?l:void 0)}return B.fun(g)&&a.batchedUpdates((()=>{g(A,i,i.item)})),A})():l}function Vt(e,t){R(e.timeouts,(e=>e.cancel())),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class xt extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class Xt extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const Ht=e=>e instanceof Kt;let Yt=1;class Kt extends me{constructor(...e){super(...e),this.id=Yt++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=ke(this);return e&&e.getValue()}to(...e){return N.to(this,e)}interpolate(...e){return xe(`${Re}The "interpolate" function is deprecated in v9 (use "to" instead)`),N.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){pe(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||k.sort(this),pe(this,{type:"priority",parent:this,priority:e})}}const Nt=Symbol.for("SpringPhase"),Mt=e=>(1&e[Nt])>0,Ft=e=>(2&e[Nt])>0,zt=e=>(4&e[Nt])>0,Lt=(e,t)=>t?e[Nt]|=3:e[Nt]&=-3,kt=(e,t)=>t?e[Nt]|=4:e[Nt]&=-5;class Et extends Kt{constructor(e,t){if(super(),this.key=void 0,this.animation=new vt,this.queue=void 0,this.defaultProps={},this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!B.und(e)||!B.und(t)){const n=B.obj(e)?it({},e):it({},t,{from:e});B.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(Ft(this)||this._state.asyncTo)||zt(this)}get goal(){return he(this.animation.to)}get velocity(){const e=ke(this);return e instanceof _e?e.lastVelocity||0:e.getPayload().map((e=>e.lastVelocity||0))}get hasAnimated(){return Mt(this)}get isAnimating(){return Ft(this)}get isPaused(){return zt(this)}advance(e){let t=!0,n=!1;const i=this.animation;let{config:o,toValues:r}=i;const a=Te(i.to);!a&&de(i.to)&&(r=S(he(i.to))),i.values.forEach(((g,s)=>{if(g.done)return;const l=g.constructor==Je?1:a?a[s].lastPosition:r[s];let c=i.immediate,I=l;if(!c){if(I=g.lastPosition,o.tension<=0)return void(g.done=!0);let t=g.elapsedTime+=e;const n=i.fromValues[s],r=null!=g.v0?g.v0:g.v0=B.arr(o.velocity)?o.velocity[s]:o.velocity;let a;if(B.und(o.duration))if(o.decay){const e=!0===o.decay?.998:o.decay,i=Math.exp(-(1-e)*t);I=n+r/(1-e)*(1-i),c=Math.abs(g.lastPosition-I)<.1,a=r*i}else{a=null==g.lastVelocity?r:g.lastVelocity;const t=o.precision||(n==l?.005:Math.min(1,.001*Math.abs(l-n))),i=o.restVelocity||t/10,s=o.clamp?0:o.bounce,C=!B.und(s),u=n==l?g.v0>0:n<l;let d,h=!1;const A=1,p=Math.ceil(e/A);for(let e=0;e<p&&(d=Math.abs(a)>i,d||(c=Math.abs(l-I)<=t,!c));++e){C&&(h=I==l||I>l==u,h&&(a=-a*s,I=l));a+=(1e-6*-o.tension*(I-l)+.001*-o.friction*a)/o.mass*A,I+=a*A}}else{let i=1;o.duration>0&&(this._memoizedDuration!==o.duration&&(this._memoizedDuration=o.duration,g.durationProgress>0&&(g.elapsedTime=o.duration*g.durationProgress,t=g.elapsedTime+=e)),i=(o.progress||0)+t/this._memoizedDuration,i=i>1?1:i<0?0:i,g.durationProgress=i),I=n+o.easing(i)*(l-n),a=(I-g.lastPosition)/e,c=1==i}g.lastVelocity=a,Number.isNaN(I)&&(console.warn("Got NaN while animating:",this),c=!0)}a&&!a[s].done&&(c=!1),c?g.done=!0:t=!1,g.setValue(I,o.round)&&(n=!0)}));const g=ke(this),s=g.getValue();if(t){const e=he(i.to);s===e&&!n||o.decay?n&&o.decay&&this._onChange(s):(g.setValue(e),this._onChange(e)),this._stop()}else n&&this._onChange(s)}set(e){return a.batchedUpdates((()=>{this._stop(),this._focus(e),this._set(e)})),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Ft(this)){const{to:e,config:t}=this.animation;a.batchedUpdates((()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()}))}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let n;return B.und(e)?(n=this.queue||[],this.queue=[]):n=[B.obj(e)?e:it({},t,{to:e})],Promise.all(n.map((e=>this._update(e)))).then((e=>Zt(this,e)))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),Vt(this._state,e&&this._lastCallId),a.batchedUpdates((()=>this._stop(t,e))),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:n,from:i}=e;n=B.obj(n)?n[t]:n,(null==n||ht(n))&&(n=void 0),i=B.obj(i)?i[t]:i,null==i&&(i=void 0);const o={to:n,from:i};return Mt(this)||(e.reverse&&([n,i]=[i,n]),i=he(i),B.und(i)?ke(this)||this._set(n):this._set(i)),o}_update(e,t){let n=it({},e);const{key:i,defaultProps:o}=this;n.default&&Object.assign(o,lt(n,((e,t)=>/^on/.test(t)?at(e,i):e))),Qt(this,n,"onProps"),Ot(this,"onProps",n,this);const r=this._prepareNode(n);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const a=this._state;return Bt(++this._lastCallId,{key:i,props:n,defaultProps:o,state:a,actions:{pause:()=>{zt(this)||(kt(this,!0),V(a.pauseQueue),Ot(this,"onPause",Wt(this,Tt(this,this.animation.to)),this))},resume:()=>{zt(this)&&(kt(this,!1),Ft(this)&&this._resume(),V(a.resumeQueue),Ot(this,"onResume",Wt(this,Tt(this,this.animation.to)),this))},start:this._merge.bind(this,r)}}).then((e=>{if(n.loop&&e.finished&&(!t||!e.noop)){const e=Ut(n);if(e)return this._update(e,!0)}return e}))}_merge(e,t,n){if(t.cancel)return this.stop(!0),n(St(this));const i=!B.und(e.to),o=!B.und(e.from);if(i||o){if(!(t.callId>this._lastToId))return n(St(this));this._lastToId=t.callId}const{key:r,defaultProps:g,animation:s}=this,{to:l,from:c}=s;let{to:I=l,from:C=c}=e;!o||i||t.default&&!B.und(I)||(I=C),t.reverse&&([I,C]=[C,I]);const u=!Z(C,c);u&&(s.from=C),C=he(C);const d=!Z(I,l);d&&this._focus(I);const h=ht(t.to),{config:A}=s,{decay:p,velocity:m}=A;(i||o)&&(A.velocity=0),t.config&&!h&&function(e,t,n){n&&(yt(n=it({},n),t),t=it({},n,t)),yt(e,t),Object.assign(e,t);for(const a in bt)null==e[a]&&(e[a]=bt[a]);let{mass:i,frequency:o,damping:r}=e;B.und(o)||(o<.01&&(o=.01),r<0&&(r=0),e.tension=Math.pow(2*Math.PI/o,2)*i,e.friction=4*Math.PI*r*i/o)}(A,ot(t.config,r),t.config!==g.config?ot(g.config,r):void 0);let b=ke(this);if(!b||B.und(I))return n(Wt(this,!0));const f=B.und(t.reset)?o&&!t.default:!B.und(C)&&rt(t.reset,r),y=f?C:this.get(),G=ut(I),v=B.num(G)||B.arr(G)||He(G),W=!h&&(!v||rt(g.immediate||t.immediate,r));if(d){const e=je(I);if(e!==b.constructor){if(!W)throw Error(`Cannot animate between ${b.constructor.name} and ${e.name}, as the "to" prop suggests`);b=this._set(G)}}const R=b.constructor;let x=de(I),X=!1;if(!x){const e=f||!Mt(this)&&u;(d||e)&&(X=Z(ut(y),G),x=!X),(Z(s.immediate,W)||W)&&Z(A.decay,p)&&Z(A.velocity,m)||(x=!0)}if(X&&Ft(this)&&(s.changed&&!f?x=!0:x||this._stop(l)),!h&&((x||de(l))&&(s.values=b.getPayload(),s.toValues=de(I)?null:R==Je?[1]:S(G)),s.immediate!=W&&(s.immediate=W,W||f||this._set(l)),x)){const{onRest:e}=s;w(Pt,(e=>Qt(this,t,e)));const i=Wt(this,Tt(this,l));V(this._pendingCalls,i),this._pendingCalls.add(n),s.changed&&a.batchedUpdates((()=>{s.changed=!f,null==e||e(i,this),f?ot(g.onRest,i):null==s.onStart||s.onStart(i,this)}))}f&&this._set(y),h?n(Rt(t.to,t,this._state,this)):x?this._start():Ft(this)&&!d?this._pendingCalls.add(n):n(wt(y))}_focus(e){const t=this.animation;e!==t.to&&(Ae(this)&&this._detach(),t.to=e,Ae(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;de(t)&&(fe(t,this),Ht(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;de(e)&&ye(e,this)}_set(e,t=!0){const n=he(e);if(!B.und(n)){const e=ke(this);if(!e||!Z(n,e.getValue())){const i=je(n);e&&e.constructor==i?e.setValue(n):Ee(this,i.create(n)),e&&a.batchedUpdates((()=>{this._onChange(n,t)}))}}return ke(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,Ot(this,"onStart",Wt(this,Tt(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),ot(this.animation.onChange,e,this)),ot(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;ke(this).reset(he(e.to)),e.immediate||(e.fromValues=e.values.map((e=>e.lastPosition))),Ft(this)||(Lt(this,!0),zt(this)||this._resume())}_resume(){N.skipAnimation?this.finish():k.start(this)}_stop(e,t){if(Ft(this)){Lt(this,!1);const n=this.animation;w(n.values,(e=>{e.done=!0})),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),pe(this,{type:"idle",parent:this});const i=t?St(this.get()):Wt(this.get(),Tt(this,null!=e?e:n.to));V(this._pendingCalls,i),n.changed&&(n.changed=!1,Ot(this,"onRest",i,this))}}}function Tt(e,t){const n=ut(t);return Z(ut(e.get()),n)}function Ut(e,t=e.loop,n=e.to){let i=ot(t);if(i){const o=!0!==i&&Ct(i),r=(o||e).reverse,a=!o||o.reset;return _t(it({},e,{loop:t,default:!1,pause:void 0,to:!r||ht(n)?n:void 0,from:a?e.from:void 0,reset:a},o))}}function _t(e){const{to:t,from:n}=e=Ct(e),i=new Set;return B.obj(t)&&Dt(t,i),B.obj(n)&&Dt(n,i),e.keys=i.size?Array.from(i):null,e}function Jt(e){const t=_t(e);return B.und(t.default)&&(t.default=lt(t)),t}function Dt(e,t){W(e,((e,n)=>null!=e&&t.add(n)))}const Pt=["onStart","onRest","onChange","onPause","onResume"];function Qt(e,t,n){e.animation[n]=t[n]!==gt(t,n)?at(t[n],e.key):void 0}function Ot(e,t,...n){var i,o,r,a;null==(i=(o=e.animation)[t])||i.call(o,...n),null==(r=(a=e.defaultProps)[t])||r.call(a,...n)}const jt=["onStart","onChange","onRest"];let qt=1;class $t{constructor(e,t){this.id=qt++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(it({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every((e=>e.idle))}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each(((t,n)=>e[n]=t.get())),e}set(e){for(const t in e){const n=e[t];B.und(n)||this.springs[t].set(n)}}update(e){return e&&this.queue.push(_t(e)),this}start(e){let{queue:t}=this;return e?t=S(e).map(_t):this.queue=[],this._flush?this._flush(this,t):(gn(this,t),en(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const n=this.springs;w(S(t),(t=>n[t].stop(!!e)))}else Vt(this._state,this._lastAsyncId),this.each((t=>t.stop(!!e)));return this}pause(e){if(B.und(e))this.start({pause:!0});else{const t=this.springs;w(S(e),(e=>t[e].pause()))}return this}resume(e){if(B.und(e))this.start({pause:!1});else{const t=this.springs;w(S(e),(e=>t[e].resume()))}return this}each(e){W(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:n}=this._events,i=this._active.size>0,o=this._changed.size>0;(i&&!this._started||o&&!this._started)&&(this._started=!0,R(e,(([e,t])=>{t.value=this.get(),e(t,this,this._item)})));const r=!i&&this._started,a=o||r&&n.size?this.get():null;o&&t.size&&R(t,(([e,t])=>{t.value=a,e(t,this,this._item)})),r&&(this._started=!1,R(n,(([e,t])=>{t.value=a,e(t,this,this._item)})))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}a.onFrame(this._onFrame)}}function en(e,t){return Promise.all(t.map((t=>tn(e,t)))).then((t=>Zt(e,t)))}async function tn(e,t,n){const{keys:i,to:o,from:r,loop:g,onRest:s,onResolve:l}=t,c=B.obj(t.default)&&t.default;g&&(t.loop=!1),!1===o&&(t.to=null),!1===r&&(t.from=null);const I=B.arr(o)||B.fun(o)?o:void 0;I?(t.to=void 0,t.onRest=void 0,c&&(c.onRest=void 0)):w(jt,(n=>{const i=t[n];if(B.fun(i)){const o=e._events[n];t[n]=({finished:e,cancelled:t})=>{const n=o.get(i);n?(e||(n.finished=!1),t&&(n.cancelled=!0)):o.set(i,{value:null,finished:e||!1,cancelled:t||!1})},c&&(c[n]=t[n])}}));const C=e._state;t.pause===!C.paused?(C.paused=t.pause,V(t.pause?C.pauseQueue:C.resumeQueue)):C.paused&&(t.pause=!0);const u=(i||Object.keys(e.springs)).map((n=>e.springs[n].start(t))),d=!0===t.cancel||!0===gt(t,"cancel");(I||d&&C.asyncId)&&u.push(Bt(++e._lastAsyncId,{props:t,state:C,actions:{pause:v,resume:v,start(t,n){d?(Vt(C,e._lastAsyncId),n(St(e))):(t.onRest=s,n(Rt(I,t,C,e)))}}})),C.paused&&await new Promise((e=>{C.resumeQueue.add(e)}));const h=Zt(e,await Promise.all(u));if(g&&h.finished&&(!n||!h.noop)){const n=Ut(t,g,o);if(n)return gn(e,[n]),tn(e,n,!0)}return l&&a.batchedUpdates((()=>l(h,e,e.item))),h}function nn(e,t){const n=it({},e.springs);return t&&w(S(t),(e=>{B.und(e.keys)&&(e=_t(e)),B.obj(e.to)||(e=it({},e,{to:void 0})),an(n,e,(e=>rn(e)))})),on(e,n),n}function on(e,t){W(t,((t,n)=>{e.springs[n]||(e.springs[n]=t,fe(t,e))}))}function rn(e,t){const n=new Et;return n.key=e,t&&fe(n,t),n}function an(e,t,n){t.keys&&w(t.keys,(i=>{(e[i]||(e[i]=n(i)))._prepareNode(t)}))}function gn(e,t){w(t,(t=>{an(e.springs,t,(t=>rn(t,e)))}))}function sn(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}const ln=["children"],cn=e=>{let{children:t}=e,n=sn(e,ln);const o=(0,i.useContext)(In),r=n.pause||!!o.pause,a=n.immediate||!!o.immediate;n=function(e,t){const[n]=(0,i.useState)((()=>({inputs:t,result:e()}))),o=(0,i.useRef)(),r=o.current;let a=r;a?Boolean(t&&a.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,a.inputs))||(a={inputs:t,result:e()}):a=n;return(0,i.useEffect)((()=>{o.current=a,r==n&&(n.inputs=n.result=void 0)}),[a]),a.result}((()=>({pause:r,immediate:a})),[r,a]);const{Provider:g}=In;return i.createElement(g,{value:n},t)},In=(Cn=cn,un={},Object.assign(Cn,i.createContext(un)),Cn.Provider._context=Cn,Cn.Consumer._context=Cn,Cn);var Cn,un;cn.Provider=In.Provider,cn.Consumer=In.Consumer;const dn=()=>{const e=[],t=function(t){Xe(`${Re}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);const i=[];return w(e,((e,o)=>{if(B.und(t))i.push(e.start());else{const r=n(t,e,o);r&&i.push(e.start(r))}})),i};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){const n=e.indexOf(t);~n&&e.splice(n,1)},t.pause=function(){return w(e,(e=>e.pause(...arguments))),this},t.resume=function(){return w(e,(e=>e.resume(...arguments))),this},t.set=function(t){w(e,(e=>e.set(t)))},t.start=function(t){const n=[];return w(e,((e,i)=>{if(B.und(t))n.push(e.start());else{const o=this._getProps(t,e,i);o&&n.push(e.start(o))}})),n},t.stop=function(){return w(e,(e=>e.stop(...arguments))),this},t.update=function(t){return w(e,((e,n)=>e.update(this._getProps(t,e,n)))),this};const n=function(e,t,n){return B.fun(e)?e(n,t):e};return t._getProps=n,t};function hn(e,t,n){const o=B.fun(t)&&t;o&&!n&&(n=[]);const r=(0,i.useMemo)((()=>o||3==arguments.length?dn():void 0),[]),a=(0,i.useRef)(0),g=Ne(),s=(0,i.useMemo)((()=>({ctrls:[],queue:[],flush(e,t){const n=nn(e,t);return a.current>0&&!s.queue.length&&!Object.keys(n).some((t=>!e.springs[t]))?en(e,t):new Promise((i=>{on(e,n),s.queue.push((()=>{i(en(e,t))})),g()}))}})),[]),l=(0,i.useRef)([...s.ctrls]),c=[],I=Fe(e)||0,C=l.current.slice(e,I);function u(e,n){for(let i=e;i<n;i++){const e=l.current[i]||(l.current[i]=new $t(null,s.flush)),n=o?o(i,e):t[i];n&&(c[i]=Jt(n))}}(0,i.useMemo)((()=>{l.current.length=e,u(I,e)}),[e]),(0,i.useMemo)((()=>{u(0,Math.min(I,e))}),n);const d=l.current.map(((e,t)=>nn(e,c[t]))),h=(0,i.useContext)(cn),A=Fe(h),p=h!==A&&dt(h);ze((()=>{a.current++,s.ctrls=l.current;const{queue:e}=s;e.length&&(s.queue=[],w(e,(e=>e()))),w(C,(e=>{At(e,r),e.stop(!0)})),w(l.current,((e,t)=>{null==r||r.add(e),p&&e.start({default:h});const n=c[t];n&&(pt(e,n.ref),e.ref?e.queue.push(n):e.start(n))}))})),Ye((()=>()=>{w(s.ctrls,(e=>e.stop(!0)))}));const m=d.map((e=>it({},e)));return r?[m,r]:m}function An(e,t){const n=B.fun(e),[[i],o]=hn(1,n?e:[e],n?t||[]:t);return n||2==arguments.length?[i,o]:i}let pn;!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(pn||(pn={}));class mn extends Kt{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=ce(...t);const n=this._get(),i=je(n);Ee(this,i.create(n))}advance(e){const t=this._get();Z(t,this.get())||(ke(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&fn(this._active)&&yn(this)}_get(){const e=B.arr(this.source)?this.source.map(he):S(he(this.source));return this.calc(...e)}_start(){this.idle&&!fn(this._active)&&(this.idle=!1,w(Te(this),(e=>{e.done=!1})),N.skipAnimation?(a.batchedUpdates((()=>this.advance())),yn(this)):k.start(this))}_attach(){let e=1;w(S(this.source),(t=>{de(t)&&fe(t,this),Ht(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){w(S(this.source),(e=>{de(e)&&ye(e,this)})),this._active.clear(),yn(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=S(this.source).reduce(((e,t)=>Math.max(e,(Ht(t)?t.priority:0)+1)),0))}}function bn(e){return!1!==e.idle}function fn(e){return!e.size||Array.from(e).every(bn)}function yn(e){e.idle||(e.idle=!0,w(Te(e),(e=>{e.done=!0})),pe(e,{type:"idle",parent:e}))}N.assign({createStringInterpolator:Se,to:(e,t)=>new mn(e,t)});k.advance;var Gn=n(8316);function vn(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}const Bn=["style","children","scrollTop","scrollLeft"],Zn=/^--/;function wn(e,t){return null==t||"boolean"==typeof t||""===t?"":"number"!=typeof t||0===t||Zn.test(e)||Sn.hasOwnProperty(e)&&Sn[e]?(""+t).trim():t+"px"}const Wn={};let Sn={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const Rn=["Webkit","Ms","Moz","O"];Sn=Object.keys(Sn).reduce(((e,t)=>(Rn.forEach((n=>e[((e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1))(n,t)]=e[t])),e)),Sn);const Vn=["x","y","z"],xn=/^(matrix|translate|scale|rotate|skew)/,Xn=/^(translate)/,Hn=/^(rotate|skew)/,Yn=(e,t)=>B.num(e)&&0!==e?e+t:e,Kn=(e,t)=>B.arr(e)?e.every((e=>Kn(e,t))):B.num(e)?e===t:parseFloat(e)===t;class Nn extends Pe{constructor(e){let{x:t,y:n,z:i}=e,o=vn(e,Vn);const r=[],a=[];(t||n||i)&&(r.push([t||0,n||0,i||0]),a.push((e=>[`translate3d(${e.map((e=>Yn(e,"px"))).join(",")})`,Kn(e,0)]))),W(o,((e,t)=>{if("transform"===t)r.push([e||""]),a.push((e=>[e,""===e]));else if(xn.test(t)){if(delete o[t],B.und(e))return;const n=Xn.test(t)?"px":Hn.test(t)?"deg":"";r.push(S(e)),a.push("rotate3d"===t?([e,t,i,o])=>[`rotate3d(${e},${t},${i},${Yn(o,n)})`,Kn(o,0)]:e=>[`${t}(${e.map((e=>Yn(e,n))).join(",")})`,Kn(e,t.startsWith("scale")?1:0)])}})),r.length&&(o.transform=new Mn(r,a)),super(o)}}class Mn extends me{constructor(e,t){super(),this._value=null,this.inputs=e,this.transforms=t}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return w(this.inputs,((n,i)=>{const o=he(n[0]),[r,a]=this.transforms[i](B.arr(o)?o:n.map(he));e+=" "+r,t=t&&a})),t?"none":e}observerAdded(e){1==e&&w(this.inputs,(e=>w(e,(e=>de(e)&&fe(e,this)))))}observerRemoved(e){0==e&&w(this.inputs,(e=>w(e,(e=>de(e)&&ye(e,this)))))}eventObserved(e){"change"==e.type&&(this._value=null),pe(this,e)}}const Fn=["scrollTop","scrollLeft"];N.assign({batchedUpdates:Gn.unstable_batchedUpdates,createStringInterpolator:Se,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199}});const zn=((e,{applyAnimatedValues:t=(()=>!1),createAnimatedStyle:n=(e=>new Pe(e)),getComponentProps:i=(e=>e)}={})=>{const o={applyAnimatedValues:t,createAnimatedStyle:n,getComponentProps:i},r=e=>{const t=nt(e)||"Anonymous";return(e=B.str(e)?r[e]||(r[e]=$e(e,o)):e[tt]||(e[tt]=$e(e,o))).displayName=`Animated(${t})`,e};return W(e,((t,n)=>{B.arr(e)&&(n=nt(t)),r[n]=r(t)})),{animated:r}})(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],{applyAnimatedValues:function(e,t){if(!e.nodeType||!e.setAttribute)return!1;const n="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,i=t,{style:o,children:r,scrollTop:a,scrollLeft:g}=i,s=vn(i,Bn),l=Object.values(s),c=Object.keys(s).map((t=>n||e.hasAttribute(t)?t:Wn[t]||(Wn[t]=t.replace(/([A-Z])/g,(e=>"-"+e.toLowerCase())))));void 0!==r&&(e.textContent=r);for(let I in o)if(o.hasOwnProperty(I)){const t=wn(I,o[I]);"float"===I?I="cssFloat":Zn.test(I)?e.style.setProperty(I,t):e.style[I]=t}c.forEach(((t,n)=>{e.setAttribute(t,l[n])})),void 0!==a&&(e.scrollTop=a),void 0!==g&&(e.scrollLeft=g)},createAnimatedStyle:e=>new Nn(e),getComponentProps:e=>vn(e,Fn)}).animated;var Ln,kn=n(2275);function En(e,t){return t||(t=e.slice(0)),e.raw=t,e}function Tn(){return(Tn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function Un(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}var _n,Jn,Dn,Pn=(0,kn.ZP)(i.forwardRef((function(e,t){return i.createElement(zn.div,(r=t,a=(n=e).size,g=void 0===a?1:a,s=n.rate,l=void 0===s?1:s,c=n.style,I=void 0===c?{}:c,C=Un(n,["size","rate","style"]),u=An((function(){return{xyz:[0,0,0]}})),d=u[0].xyz,h=u[1],A=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),"undefined"!=typeof window?[(e-window.innerWidth/2)/g/250,(t-window.innerHeight/2)/g/250,l]:[0,0,0]},p=(0,o.T2)({onDrag:function(e){var t=e.event;return null==t?void 0:t.stopPropagation()},onMove:function(e){var t=e.xy,n=t[0],i=t[1];return h({xyz:A(n,i)})},onHover:function(e){return!e.hovering&&h({xyz:[0,0,0]})}}),m=(0,i.useMemo)((function(){return{boxShadow:d.to((function(e,t,n){return[1.5-2*t+"rem",.5-2*e+"rem",1.5+n+"rem",n-.5+"rem","hsl(200 50% 20% / "+(15+5*n)+"%)"].join(" ")})),transform:d.to((function(e,t,n){return["perspective("+50*g+"px)","rotateX("+-t/10+"deg)","rotateY("+e/10+"deg)","scale("+(1+n/10)+")"].join(" ")})),zIndex:d.to((function(e,t,n){return e*t*n>0?1:0}))}}),[d,g]),Tn({},C,p(),{ref:r,style:Tn({},m,I)})));var n,r,a,g,s,l,c,I,C,u,d,h,A,p,m}))).attrs((function(e){var t,n,i;return{minHeight:null!=(t=null!=(n=e.min)?n:500*e.size)?t:null,maxHeight:null!=(i=e.max)?i:null}}))(Ln||(Ln=En(["\n    margin: ","px auto ","px auto;\n    padding: 0px;\n    position: relative;\n    width: min(80%, ","px);\n    border-radius: ","px;\n    overflow: hidden;\n    ","\n    ","\n    background: ",";\n    color: ","}\n"])),(function(e){return e.space}),(function(e){return e.space}),(function(e){return 500*e.size}),(function(e){return 25*e.size}),(function(e){return e.minHeight&&"min-height: "+e.minHeight+"px;"}),(function(e){return e.minHeight&&"min-height: "+e.minHeight+"px;"}),(function(e){return e.dark?"#212121":"#fff"}),(function(e){return e.color||e.dark?"#818181":"#000"}));kn.ZP.div(_n||(_n=En(["\n    position: relative;\n    left: 0;\n    bottom: 0;\n    height: auto;\n    background: #212121;\n    min-width: 100%;\n    borderRadius: ",";\n    padding     : ","\n"])),(function(e){var t=e.size,n=void 0===t?1:t;return 25*n+"px "+25*n+"px 0px 0px"}),(function(e){var t=e.size,n=void 0===t?1:t;return"0px "+50*n+"px "+25*n+"px "+50*n+"px"})),kn.ZP.div(Jn||(Jn=En(["\n    position: relative;\n    text-align: center;\n    fontSize: ","\n"])),(function(e){return~~(50*e.size)+"px"}));function Qn(e,t,n,i,o,r,a){try{var g=e[r](a),s=g.value}catch(l){return void n(l)}g.done?t(s):Promise.resolve(s).then(i,o)}function On(e,t){var n=e.active,o=void 0===n||n,r=e.dark,a=void 0===r?1:r,g=e.size,s=void 0===g?1:g,l=e.width,c=void 0===l?250:l,I=e.timeout,C=void 0===I?250:I,u=i.useState(!1),d=u[0],h=u[1],A=An({reset:!0,from:{opacity:1,r:0},to:o&&!d?function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({opacity:0,r:c*s});case 2:h(!0),setTimeout((function(){h(!1)}),C);case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){Qn(r,i,o,a,g,"next",e)}function g(e){Qn(r,i,o,a,g,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}():{opacity:1,r:0}}),p=A.opacity,m=A.r;return{style:{opacity:p,width:m,height:m},dark:a,ref:t,size:s}}var jn,qn;(0,kn.ZP)(i.forwardRef((function(e,t){return i.createElement(zn.div,On(e,t))}))).attrs((function(e){return{color:e.dark?"#818181":"#212121"}}))(Dn||(Dn=En(["\n    top: 50%;\n    left: 50%;\n    margin: 0px;\n    transform: translateX(-50%) translateY(-50%);\n    border: 1rem solid ",";\n    background: ",";\n    border-radius: 100%;\n    position: absolute;\n"])),(function(e){return e.color}),(function(e){return e.color})),kn.ZP.div.attrs((function(e){var t,n,i;return{size:null!=(t=e.size)?t:1,dark:null!=(n=e.dark)&&n,color:(null!=(i=e.color)?i:e.dark)?"#818181":"#000"}}))(jn||(jn=En(["\n    font-size: ","px;\n    color: ",";\n    width:",";\n    height: auto;\n    margin: auto;\n"])),(function(e){return 50*e.size}),(function(e){return e.color}),(function(e){return"max(70vw, 100vw - "+200*e.size+"px)"}));(0,kn.ZP)(i.forwardRef((function(e,t){return i.createElement(zn.div,(r=t,a=(n=e).fa,g=void 0===a?"":a,s=n.fab,l=void 0===s?"":s,c=n.dark,I=void 0!==c&&c,C=n.circ,u=void 0===C||C,d=n.size,h=void 0===d?1:d,A=Un(n,["fa","fab","dark","circ","size"]),p=An((function(){return{xys:[0,0,0]}})),m=p[0].xys,b=p[1],f=(0,o.r_)((function(e){var t=e.vxvy,n=t[0],i=t[1],o=e.last;return b({xys:[n,i,o?0:1]})})),y=(0,i.useMemo)((function(){return n.color||u?I?"#818181":"#fff":"#212121"}),[n.color,u,I]),G=(0,i.useMemo)((function(){return n.className+g?" fas fa-"+g:l?" fab fa-"+l:""}),[n.className,g,l]),v=(0,i.useMemo)((function(){return{filter:m.to((function(e,t,n){return["drop-shadow("+(.1+e)+"rem",.5+t+"rem",1-n/2+"rem","rgba(0,0,0, "+(.5+n/20)+"))"].join(" ")})),transform:m.to((function(e,t,n){return["perspective("+50*h+"px)","rotateX("+-t+"deg)","rotateY("+e+"deg)","scale("+(1+n/10)+")"].join(" ")}))}}),[m,h]),Tn({},A,f(),{style:v,className:G,color:y,size:h,ref:r})));var n,r,a,g,s,l,c,I,C,u,d,h,A,p,m,b,f,y,G,v})))(qn||(qn=En(["\n    top: 0px;\n    right: 0px;\n    padding: 0px;\n    text-align: center;\n    user-select: none;\n    color: ",";\n    width: ","px;\n    height: ","px;\n    font-size: ","px;\n    border-radius: ","px;\n    background: ",";\n"])),(function(e){return e.color}),(function(e){var t=e.size;return 50*(void 0===t?1:t)}),(function(e){var t=e.size;return 50*(void 0===t?1:t)}),(function(e){var t=e.size;return 50*(void 0===t?1:t)}),(function(e){var t=e.size;return 50*(void 0===t?1:t)}),(function(e){return e.circ?"#212121":""}));var $n,ei,ti,ni,ii,oi={Minus:"M888 760v0v0v-753v0h-752v0v753v0h752zM888 832h-752q-30 0 -51 -21t-21 -51v-753q0 -29 21 -50.5t51 -21.5h753q29 0 50.5 21.5t21.5 50.5v753q0 30 -21.5 51t-51.5 21v0zM732 347h-442q-14 0 -25 10.5t-11 25.5v0q0 15 11 25.5t25 10.5h442q14 0 25 -10.5t11 -25.5v0 q0 -15 -11 -25.5t-25 -10.5z",Plus:"M888 760v0v0v-753v0h-752v0v753v0h752zM888 832h-752q-30 0 -51 -21t-21 -51v-753q0 -29 21 -50.5t51 -21.5h753q29 0 50.5 21.5t21.5 50.5v753q0 30 -21.5 51t-51.5 21v0zM732 420h-184v183q0 15 -10.5 25.5t-25.5 10.5v0q-14 0 -25 -10.5t-11 -25.5v-183h-184 q-15 0 -25.5 -11t-10.5 -25v0q0 -15 10.5 -25.5t25.5 -10.5h184v-183q0 -15 11 -25.5t25 -10.5v0q15 0 25.5 10.5t10.5 25.5v183h184q15 0 25.5 10.5t10.5 25.5v0q0 14 -10.5 25t-25.5 11z"},ri={restSpeedThreshold:1,restDisplacementThreshold:.01};var ai,gi,si=(0,kn.ZP)(zn.div)($n||($n=En(["\n    padding: 4px 0px 0px 0px;\n    position: relative;\n    overflow: hidden;\n    vertical-align: middle;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    border-left: ",";\n    padding: ",";\n"])),(function(e){return"1px dashed #"+(e.dark?818181:212121)}),(function(e){return"4px 0px 0px "+25*e.size+"px"})),li=(0,kn.ZP)(zn.div)(ei||(ei=En(["\n    font-size: ","px;\n    will-change: transform, opacity, height;\n    margin-left: 6;\n"])),(function(e){return 50*e.size})),ci=(0,kn.ZP)(zn.span)(ti||(ti=En(["\n    font-size: 0.6em;\n    font-family: monospace;\n    text-transform: uppercase;\n    white-space: nowrap;\n    vertical-align: middle;\n    margin-right: ",";\n    color: ",";\n"])),(function(e){return e.type?10:0}),(function(e){return e.color})),Ii=(0,kn.ZP)(zn.div)(ni||(ni=En(["\n    display: inline-block;\n    vertical-align: middle;\n    font-size: ","px;\n    color: ",";\n"])),(function(e){return 50*e.size}),(function(e){return e.color})),Ci=kn.ZP.svg(ii||(ii=En(["\n    width: 1em;\n    height: 1em;\n    cursor: pointer;\n    margin-right: 10;\n    vertical-align: middle;\n    font-size: ","px;\n    color: ","\n"])),(function(e){return 50*e.size}),(function(e){return e.color}));function ui(e){var t=e.content,n=e.type,r=e.depth,a=void 0===r?0:r,g=e.root,s=void 0===g?1:g,l=e.size,c=void 0===l?1.5:l,I=e.dark,C=void 0!==I&&I,u=e.style,d=void 0===u?{}:u,h=e.viewBox,A=void 0===h?"64 -65 897 897":h,p=function(e){var t=e.open,n=void 0===t||t,r=e.visible,a=void 0===r||r,g=e.immediate,s=void 0===g||g,l=e.springconfig,c=(0,i.useState)({open:n,visible:a,immediate:s}),I=c[0],C=c[1],u=(0,o.T2)({onClick:function(){return C&&C((function(e){return{open:!e.open,immediate:!1}}))}}),d=An({immediate:I.immediate,config:Tn({},mt,l||ri),from:{height:0,opacity:0,transform:"translate3d(20px,0,0)"},to:{height:I.open?"auto":0,opacity:I.open?1:0,transform:I.open?"translate3d(0px,0,0)":"translate3d(20px,0,0)"}}),h=(0,i.useMemo)((function(){return e.children&&oi[I.open?"Minus":"Plus"]}),[e.children,I.open]);return(0,i.useEffect)((function(){C((function(e){return a!==e.visible?Tn({},e,{visible:a}):e}))}),[a]),[d,u,h]}(e),m=p[0],b=p[1],f=p[2],y=(0,i.useMemo)((function(){return C?"#818181":"#212121"}),[C]),G=(0,i.useMemo)((function(){return i.Children.map(e.children,(function(t){var n,o=i.Children.toArray(null==t||null==(n=t.props)?void 0:n.children)||[];return e.children&&i.createElement(ui,Tn({},e,{depth:a+1,topStyle:{},open:a<s,children:o.length>1?o.slice(1):null,immediate:!1,content:o.length>1?o[0]:t}))}))}),[e,a,s]);return i.createElement(si,{style:d,size:c},f&&!t?null:i.createElement(Ci,Tn({color:y,size:c,viewBox:A},b()),i.createElement("g",null,i.createElement("path",{d:f}))),i.createElement(ci,{color:y,type:n},n),i.createElement(Ii,{color:y,size:c},t),i.createElement(li,{depth:a,size:c,style:m},G))}(0,kn.ZP)(zn.div)(ai||(ai=En(["\n    left: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n"]))),(0,kn.ZP)(zn.div)(gi||(gi=En(["\n    position: absolute;\n    will-change: transform;\n"])));function di(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];if(i.length>0)return di(e,t)&&di.apply(void 0,[t].concat(i));if(typeof e!=typeof t)return!1;if(di.str(e)||di.num(e))return e===t;if(di.obj(e)&&di.obj(t)&&di.len(0,e)&&di.len(0,t))return!0;for(var r in e)if(!(r in t))return!1;for(var a in t)if(e[a]!==t[a])return!1;return!0}function hi(){var e;(e=console).log.apply(e,arguments)}di.arr=Array.isArray,di.fls=function(e){return di.und(e)||di.nul(e)||!1===e||""===e},di.nul=function(e){return null===e},di.und=function(e){return void 0===e},di.num=function(e){return"number"==typeof e},di.str=function(e){return"string"==typeof e},di.fun=function(e){return"function"==typeof e},di.obj=function(e){return"[object Object]"===Object.prototype.toString.call(e)},di.url=function(e){return e instanceof URL},di.set=function(e){return e instanceof Set},di.map=function(e){return e instanceof Map},di.big=function(e){return di.str(e)&&e===e.toUpperCase()},di.len=function(e,t){return t&&(di.arr(t)?t:Object.keys(t)).length===e},hi.text="\n  __                      _\n_/ __\\   ____    ____   /  _\\\n/  _/  /\\/  ___ \\/  ___ \\ \\/_ /\n\\/_   _ / /  ___/ / __  /  _\\ _   __    ____\n/ /  / /\\ \\__  \\ /  ___/ /  /\\ _\\/ __\\/ ____ \\\n\\/__/  \\/_____ /\\_____/\\/_ /\\/ _/ /  / / __  /\n                         /  _/  / /  __ /\n                         \\/___ /\\/__/\n",hi.toString=function(){return console.log(hi.text)};var Ai,pi,mi=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),t<e&&e<n};function bi(e,t,n){return void 0===e&&(e=[]),void 0===t&&(t=0),void 0===n&&(n=256),e.length<1?Array(t).fill(t>0?1/t:t):function(e,t,n){return[].concat(e.slice(0,t),t-e.length>0?Array(t-e.length).fill(n||e[0]):[])}(e,t,-1).map((function(e){return void 0===e&&(e=0),e>0&&(e<=1?e:e/n)||e<0&&-1||0})).map((function(e,t,n){return e>=0?e:1-[].concat(n.filter((function(e){return e>0})),[0]).reduce((function(e,t){return e+t}))/n.filter((function(e){return e<0})).length}))}function fi(e){var t=e.children,n=void 0===t?null:t,r=e.style,a=void 0===r?{}:r,g=e.min,s=void 0===g?0:g,l=e.width,c=void 0===l?di.und(window)?0:window.innerWidth:l,I=e.height,C=void 0===I?di.und(window)?0:window.innerHeight:I,u=e.order,d=void 0===u?[]:u,h=e.vertical,A=void 0!==h&&h,p=(0,i.useMemo)((function(){return(null==n?void 0:n.length)||0}),[n]),m=(0,i.useMemo)((function(){return A?C:c}),[A,C,c]),b=(0,i.useRef)(0),f=(0,i.useRef)(bi(d,p,m)),y=hn(p,(function(e){return{r:f.current[e]}})),G=y[0],v=y[1],B=(0,o.T2)({onDrag:function(e){var t=e.first,n=e.last,i=e.args[0],o=[e.movement,e.direction].map((function(e){return e[A?1:0]})),r=o[0],a=o[1];(0===b.current||t)&&(b.current=yi(a)),yi(a)===b.current&&v(function(e,t,n,i,o,r,a){return void 0===e&&(e=[]),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=256),function(g){return void 0===g&&(g=0),[t,t+i].every((function(e){return mi(e,-1,r)}))?g!==t&&g!==t+i||!mi(e[g]+n*i*(g===t?1:-1)/a,o,e[t]+e[t+i]-o)?null:{r:e[g]+n*i*(g===t?1:-1)/a}:g!==t&&g!==t-i||!mi(e[g]-n*i*(g===t?1:-1)/a,o,e[t]+e[t-i]-o)?null:{r:e[g]-n*i*(g===t?1:-1)/a}}}(f.current,i,r,yi(a),s,p,m)),n&&(f.current=G.map((function(e){return e.r.animation.to||0})))}}),Z=(0,i.useCallback)((function(e){var t,n,i,o;return void 0===e&&(e=0),Tn({},a,A?{width:"100%",height:null==(t=G[e])||null==(n=t.r)?void 0:n.to((function(e){return void 0===e&&(e=0),100*e+"%"}))}:{height:"100%",width:null==(i=G[e])||null==(o=i.r)?void 0:o.to((function(e){return void 0===e&&(e=0),100*e+"%"}))},{verticalAlign:"top",display:(A?"":"inline-")+"block"})}),[A,G,a]);return(0,i.useEffect)((function(){f.current=bi(d,p,m),v((function(e){return{r:f.current[e]}}))}),[d,p,m,v]),[Z,B]}function yi(e){return void 0===e&&(e=0),(e<0?-1:e>0&&1)||0===e&&0||0}var Gi,vi,Bi=(0,kn.ZP)(zn.div)(Ai||(Ai=En(["\n    width: 100%;\n    height: 100%;\n    whiteSpace: nowrap;\n"]))),Zi=(0,kn.ZP)(zn.div)(pi||(pi=En([""])));function wi(e){var t=fi(e),n=t[0],o=t[1];return i.createElement(Bi,{style:e.style},i.Children.map(e.children,(function(e,t){return i.createElement(Zi,Tn({style:n(t)},o(t),{key:t,children:e}))})))}var Wi,Si,Ri,Vi,xi;(0,kn.ZP)(zn.div)(Gi||(Gi=En(["\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    pointer-events: all;\n    overflow: hidden;\n"]))),(0,kn.ZP)(zn.div)(vi||(vi=En(["\n    position: absolute;\n    ","\n    ","\n"])),(function(e){return e.align+": 0px;"}),(function(e){var t=e.align,n=e.width,i=e.size;return"left"===t||"right"===t?"width: "+n*i+"px; height: 100%;":"width: 100%; height: "+n*i+"px;"}));var Xi;kn.ZP.div(Wi||(Wi=En(["\n    top: 0;\n    left: 0;\n"]))),(0,kn.ZP)(zn.div)(Si||(Si=En(["\n    top: 0;\n    left: 0;\n    height: 100%;\n    transition: 0.25s;\n    position: absolute;\n"]))),(0,kn.ZP)(zn.div)(Ri||(Ri=En(["\n    top: 2%;\n    left: 0px;\n    height: 96%;\n    padding-top: ","px;;\n    border-radius: ",";\n    overflow-x: scroll;\n    background: #212121;\n    position: absolute;\n"])),(function(e){var t=e.size;return 50*(void 0===t?1:t)}),(function(e){var t=e.size,n=void 0===t?1:t;return"0px "+50*n+"px "+50*n+"px 0px"})),(0,kn.ZP)(zn.div)(Vi||(Vi=En(["\n    top: ","px;\n    left: ","px;\n    position: absolute;\n"])),(function(e){var t=e.size;return 25*(void 0===t?1:t)}),(function(e){var t=e.size;return 25*(void 0===t?1:t)})),(0,kn.ZP)(zn.div)(xi||(xi=En(["\n    color: #818181;\n    display: block;\n    padding: 10px 10px 10px 50px;\n    transition: 0.75s;\n    font-size: ","px;\n"])),(function(e){var t=e.size;return 50*(void 0===t?1:t)}));var Hi,Yi,Ki,Ni,Mi,Fi;(0,kn.ZP)(zn.div)(Xi||(Xi=En(["\n    bottom: ",";\n    left: 2vw;\n    width: 96vw;\n    height: calc(100vh + 100px);\n    z-index: 1;\n    position: fixed;\n    background: rgba(0,0,0,0);\n    touch-action:  none;\n    border-radius: 4em 4em 0px;\n"])),(function(e){return"calc(-100vh + "+(e.height-100)+"px)"}));kn.ZP.div(Hi||(Hi=En(["\n    top: 0px;\n    right: 0px;\n    z-index: 100;\n    background: rgba(0,0,0,0.1);\n"]))),(0,kn.ZP)(zn.div)(Yi||(Yi=En(["\n    top: 0px;\n    right: 0px;\n    height: 100%;\n    position: absolute;\n"]))),(0,kn.ZP)(zn.div)(Ki||(Ki=En(["\n    top: ","px;\n    right: ","px;\n    transform: translate(-50%,-50%);\n    position: absolute;\n"])),(function(e){return 25*e.size}),(function(e){return 25*e.size})),(0,kn.ZP)(zn.div)(Ni||(Ni=En(["\n    margin: ",";\n    height: 96%;\n    top: 2%;\n    right: 0px;\n    overflow-x: hidden;\n    position: absolute;\n"])),(function(e){return"calc("+50*e.size*2+"px - 2%) 0px 0px 0px"})),(0,kn.ZP)(zn.div)(Mi||(Mi=En(["\n    margin: ",";\n    border-radius: ",";\n    color: #818181;\n    display: inline-block;\n    background-color: #212121;\n"])),(function(e){return 50*e.size/4+"px 0px"}),(function(e){var t=e.size;return 50*t+"px 0px  0px "+50*t+"px"})),kn.ZP.div(Fi||(Fi=En(["\n    font-size: ","px;\n    height: ","px;\n    margin: ",";\n    align-items: center;\n    display: flex;\n    z-index: 1;\n"])),(function(e){return 50*e.size}),(function(e){return 50*e.size}),(function(e){return"auto "+50*e.size/2+"px"}))},6179:function(e){"use strict";e.exports=function(e,t){if(null==e)throw new TypeError("expected first argument to be an object.");if(void 0===t||"undefined"==typeof Symbol)return e;if("function"!=typeof Object.getOwnPropertySymbols)return e;for(var n=Object.prototype.propertyIsEnumerable,i=Object(e),o=arguments.length,r=0;++r<o;)for(var a=Object(arguments[r]),g=Object.getOwnPropertySymbols(a),s=0;s<g.length;s++){var l=g[s];n.call(a,l)&&(i[l]=a[l])}return i}},387:function(e,t){"use strict";t.Z=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),i=e.name||"",o=(e.type||"").toLowerCase(),r=o.replace(/\/.*$/,"");return n.some((function(e){var t=e.trim().toLowerCase();return"."===t.charAt(0)?i.toLowerCase().endsWith(t):t.endsWith("/*")?r===t.replace(/\/.*$/,""):o===t}))}return!0}},9979:function(e,t,n){"use strict";var i=n(2784),o=n(1263);t.Z=function(e){var t=e.children,n=e.fallback;return o.Z.canUseDOM&&null!=t?i.createElement(i.Fragment,null,t()):n||null}},6386:function(e){function t(e,t,n){var i,o,r,a,g;function s(){var l=Date.now()-a;l<t&&l>=0?i=setTimeout(s,t-l):(i=null,n||(g=e.apply(r,o),r=o=null))}null==t&&(t=100);var l=function(){r=this,o=arguments,a=Date.now();var l=n&&!i;return i||(i=setTimeout(s,t)),l&&(g=e.apply(r,o),r=o=null),g};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(g=e.apply(r,o),r=o=null,clearTimeout(i),i=null)},l}t.debounce=t,e.exports=t},4401:function(e,t,n){"use strict";var i=n(2777);function o(e,t){for(var n in t)r(t,n)&&(e[n]=t[n])}function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e){i(e)||(e={});for(var t=arguments.length,n=1;n<t;n++){var r=arguments[n];i(r)&&o(e,r)}return e}},9378:function(e){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,o,r;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(o=i;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=i;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,r[o]))return!1;for(o=i;0!=o--;){var a=r[o];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n}},9556:function(e){"use strict";e.exports=function(e,t,n){for(var i in e)if(!1===t.call(n,e[i],i,e))break}},616:function(e){function t(e){return e?Array.isArray(e)?e.join("."):e:""}e.exports=function(e,n,i,o,r){if(null===(a=e)||"object"!=typeof a&&"function"!=typeof a||!n)return e;var a;if(n=t(n),i&&(n+="."+t(i)),o&&(n+="."+t(o)),r&&(n+="."+t(r)),n in e)return e[n];for(var g=n.split("."),s=g.length,l=-1;e&&++l<s;){for(var c=g[l];"\\"===c[c.length-1];)c=c.slice(0,-1)+"."+g[++l];e=e[c]}return e}},2777:function(e){"use strict";e.exports=function(e){return null!=e&&("object"==typeof e||"function"==typeof e)}},5690:function(e,t,n){"use strict";var i=n(8558);function o(e){return!0===i(e)&&"[object Object]"===Object.prototype.toString.call(e)}e.exports=function(e){var t,n;return!1!==o(e)&&("function"==typeof(t=e.constructor)&&(!1!==o(n=t.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf")))}},8558:function(e){"use strict";e.exports=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}},3419:function(e,t,n){"use strict";n.d(t,{zt:function(){return N},QX:function(){return K},cn:function(){return F},KO:function(){return z}});var i=n(2784),o=Object.defineProperty,r=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,g=Object.prototype.propertyIsEnumerable,s=(e,t,n)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,l=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&s(e,n,t[n]);if(a)for(var n of a(t))g.call(t,n)&&s(e,n,t[n]);return e};const c=Symbol(),I=Symbol(),C=(e,t)=>e.a.get(t),u=(e,t,n)=>{const i=C(e,t);return[l(l({r:0},i),{d:n?new Map(Array.from(n).map((t=>{var n,i;return[t,null!=(i=null==(n=C(e,t))?void 0:n.r)?i:0]}))):i?i.d:new Map}),null==i?void 0:i.d]},d=(e,t,n,i,o)=>{var r,a;const[g,s]=u(e,t,i);o&&!(null==(r=g.p)?void 0:r[c](o))||(null==(a=g.c)||a.call(g),delete g.e,delete g.p,delete g.c,delete g.i,"v"in g&&Object.is(g.v,n)||(g.v=n,++g.r),W(e,t,g),w(e,t,g,s))},h=(e,t,n,i,o)=>{var r,a;const[g,s]=u(e,t,i);o&&!(null==(r=g.p)?void 0:r[c](o))||(null==(a=g.c)||a.call(g),delete g.p,delete g.c,delete g.i,g.e=n,W(e,t,g),w(e,t,g,s))},A=(e,t,n,i)=>{var o,r;const[a,g]=u(e,t,i);if(!(null==(o=a.p)?void 0:o[c](n))){if(null==(r=a.c)||r.call(a),(e=>!!e[I])(n))a.p=n,delete a.c;else{const e=(e=>{let t;const n=new Promise(((n,i)=>{t=n,e.then(n,i)}));return n[c]=t=>t===n||t===e,n[I]=t,n})(n);a.p=e,a.c=e[I]}W(e,t,a),w(e,t,a,g)}},p=(e,t,n)=>{const[i]=u(e,t);n?i.w=n:delete i.w,W(e,t,i)},m=(e,t,n)=>{n.finally((()=>{b(e,t,!0)}))},b=(e,t,n)=>{if(!n){const n=C(e,t);if(n&&(n.d.forEach(((n,i)=>{if(i!==t){const t=C(e,i);!t||t.e||t.p||t.r!==t.i||b(e,i,!0)}})),Array.from(n.d.entries()).every((([t,n])=>{const i=C(e,t);return i&&!i.e&&!i.p&&i.r!==i.i&&i.r===n}))))return n}let i,o,r;const a=new Set;try{const n=t.read((n=>{if(a.add(n),n!==t){const t=b(e,n);if(t.e)throw t.e;if(t.p)throw t.p;return t.v}const i=C(e,n);if(i){if(i.p)throw i.p;return i.v}if((e=>"init"in e)(n))return n.init;throw new Error("no atom init")}));n instanceof Promise?o=n.then((n=>{d(e,t,n,a,o),S(e)})).catch((n=>{if(n instanceof Promise)return m(e,t,n),n;h(e,t,n instanceof Error?n:new Error(n),a,o),S(e)})):r=n}catch(g){g instanceof Promise?(m(e,t,g),o=g):i=g instanceof Error?g:new Error(g)}return i?h(e,t,i,a):o?A(e,t,o,a):d(e,t,r,a),C(e,t)},f=(e,t)=>!t.l.size&&(!t.d.size||1===t.d.size&&t.d.has(e)),y=(e,t)=>{const n=e.m.get(t);null==n||n.d.forEach((n=>{n!==t&&(((e,t)=>{var n;const[i]=u(e,t);null==(n=i.c)||n.call(i),delete i.p,delete i.c,i.i=i.r,W(e,t,i)})(e,n),y(e,n))}))},G=(e,t,n,i)=>{const o=!i.length,r=C(e,t);if(r&&r.w){const a=r.w.then((()=>{G(e,t,n,i),o&&S(e)}));o||i.push(a)}else try{const r=t.write((t=>{const n=b(e,t);if(n.e)throw n.e;if(n.p)throw n.p;if("v"in n)return n.v;throw new Error("no value found")}),((n,o)=>{const r=!i.length;n===t?(d(e,n,o),y(e,n)):G(e,n,o,i),r&&S(e)}),n);if(r instanceof Promise){const n=r.finally((()=>{p(e,t),o&&S(e)}));o||i.push(n),p(e,t,n)}}catch(a){if(1===i.length)throw a;o?console.error("Uncaught exception: Use promise to catch error",a):i.push(new Promise(((e,t)=>{t(a)})))}},v=(e,t,n)=>{const i=[Promise.resolve()];if(G(e,t,n,i),S(e),!(i.length<=1))return new Promise(((t,n)=>{const o=()=>{i.length<=1?(i.splice(0),t()):Promise.all(i).then((()=>{i.splice(1),S(e),o()})).catch(n)};o()}));i.splice(0)},B=(e,t,n)=>{const i=C(e,t);i&&i.d.forEach(((n,i)=>{i!==t&&(e.m.has(i)||B(e,i,t))}));const o={d:new Set(n&&[n]),l:new Set,u:void 0};if(e.m.set(t,o),(e=>!!e.write)(t)&&t.onMount){const n=n=>v(e,t,n);o.u=t.onMount(n)}return o},Z=(e,t)=>{var n;const i=null==(n=e.m.get(t))?void 0:n.u;i&&i(),e.m.delete(t);const o=C(e,t);o&&(o.p,o.d.forEach(((n,i)=>{if(i!==t){const n=e.m.get(i);n&&(n.d.delete(t),f(i,n)&&Z(e,i))}})))},w=(e,t,n,i)=>{if(i!==n.d){const o=new Set(n.d.keys());i&&i.forEach(((n,i)=>{const r=e.m.get(i);o.has(i)?o.delete(i):r&&(r.d.delete(t),f(i,r)&&Z(e,i))})),o.forEach((n=>{const i=e.m.get(n);if(i){i.d.add(t)}else B(e,n,t)}))}},W=(e,t,n)=>{const i=e.n&&!e.a.has(t);e.a.set(t,n),i&&e.n(t),++e.v,e.p.add(t)},S=e=>{e.p.forEach((t=>{const n=e.m.get(t);null==n||n.l.forEach((e=>e()))})),e.p.clear()},R=(e,t,n)=>{const i=((e,t)=>{let n=e.m.get(t);return n||(n=B(e,t)),S(e),n})(e,t).l;return i.add(n),()=>{i.delete(n),((e,t)=>{const n=e.m.get(t);n&&f(t,n)&&Z(e,t),S(e)})(e,t)}},V=Symbol(),x=Symbol(),X=(e,t,n)=>{const o=(0,i.useRef)(0),r=e[x](e[V]),[a,g]=(0,i.useState)((()=>[e,t,n,r,t(e[V])]));let s=a[4];return a[0]!==e||a[1]!==t||a[2]!==n?(s=t(e[V]),g([e,t,n,r,s])):r!==a[3]&&r!==o.current&&(s=t(e[V]),Object.is(s,a[4])||g([e,t,n,r,s])),(0,i.useEffect)((()=>{let i=!1;const r=()=>{if(!i)try{const i=t(e[V]),r=e[x](e[V]);o.current=r,g((o=>o[0]!==e||o[1]!==t||o[2]!==n||Object.is(o[4],i)?o:[o[0],o[1],o[2],r,i]))}catch(r){g((e=>[...e]))}},a=n(e[V],r);return r(),()=>{i=!0,a()}}),[e,t,n]),s},H=(e,t)=>{const n=((e,t)=>{const n={n:t,v:0,a:new WeakMap,m:new WeakMap,p:new Set};if(e)for(const[i,o]of e){const e={v:o,r:0,d:new Map};n.a.set(i,e)}return n})(e,t);return[{[V]:n,[x]:()=>n.v},(e,t)=>v(n,e,t)]},Y=new Map,K=e=>(Y.has(e)||Y.set(e,(0,i.createContext)(H())),Y.get(e));Object.defineProperty,Object.prototype.hasOwnProperty,Object.getOwnPropertySymbols,Object.prototype.propertyIsEnumerable;const N=({initialValues:e,scope:t,children:n})=>{const o=(0,i.useRef)(null);null===o.current&&(o.current=H(e));const r=K(t);return(0,i.createElement)(r.Provider,{value:o.current},n)};let M=0;function F(e,t){const n="atom"+ ++M,i={toString:()=>n};return"function"==typeof e?i.read=e:(i.init=e,i.read=e=>e(i),i.write=(e,t,n)=>{t(i,"function"==typeof n?n(e(i)):n)}),t&&(i.write=t),i}function z(e){const t=(0,i.useCallback)((t=>{const n=((e,t)=>{const n=b(e,t);return e.p.delete(t),S(e),n})(t,e);if(n.e)throw n.e;if(n.p)throw n.p;if(n.w)throw n.w;if("v"in n)return n.v;throw new Error("no atom value")}),[e]),n=(0,i.useCallback)(((t,n)=>R(t,e,n)),[e]),o=K(e.scope),[r,a]=(0,i.useContext)(o),g=X(r,t,n),s=(0,i.useCallback)((t=>{if((e=>!!e.write)(e))return a(e,t);throw new Error("not writable atom")}),[a,e]);return(0,i.useDebugValue)(g),[g,s]}},8715:function(e,t,n){"use strict";n.d(t,{yW:function(){return r}});var i=n(2784),o=n(3419);function r(e){const t=(0,o.QX)(e.scope),[,n]=(0,i.useContext)(t);return(0,i.useCallback)((t=>n(e,t)),[n,e])}Symbol();new WeakMap;o.cn,new WeakMap;Object.defineProperty,Object.prototype.hasOwnProperty,Object.getOwnPropertySymbols,Object.prototype.propertyIsEnumerable;new WeakMap},8940:function(e,t,n){"use strict";n.d(t,{Zf:function(){return is},M4:function(){return os}});var i=n(2784),o=n(7560);const r="div",a=i.forwardRef(((e,t)=>{const{as:n=r,...a}=e;return i.createElement(n,(0,o.Z)({},a,{ref:t}))}));const g=Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)?i.useLayoutEffect:()=>{};var s=n(8316);const l=i.forwardRef(((e,t)=>{var n,r;const{containerRef:l,style:c,...I}=e,C=null!==(n=null==l?void 0:l.current)&&void 0!==n?n:null===globalThis||void 0===globalThis||null===(r=globalThis.document)||void 0===r?void 0:r.body,[,u]=i.useState({});return g((()=>{u({})}),[]),C?s.createPortal(i.createElement(a,(0,o.Z)({"data-radix-portal":""},I,{ref:t,style:C===document.body?{position:"absolute",top:0,left:0,zIndex:2147483647,...c}:void 0})),C):null})),c=l;var I=Object.prototype.hasOwnProperty;function C(e,t){var n,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((i=e.length)===t.length)for(;i--&&C(e[i],t[i]););return-1===i}if(!n||"object"==typeof e){for(n in i=0,e){if(I.call(e,n)&&++i&&!I.call(t,n))return!1;if(!(n in t)||!C(e[n],t[n]))return!1}return Object.keys(t).length===i}}return e!=e&&t!=t}var u=n(2414),d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),A=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},p=function(){function e(t,n,i,o){d(this,e),this.name=t,this.fn=n,this.args=i,this.modifiers=o}return h(e,[{key:"_test",value:function(e){var t=this.fn;try{b(this.modifiers.slice(),t)(e)}catch(n){t=function(){return!1}}try{return b(this.modifiers.slice(),t)(e)}catch(n){return!1}}},{key:"_check",value:function(e){try{b(this.modifiers.slice(),this.fn)(e)}catch(t){if(b(this.modifiers.slice(),(function(e){return e}))(!1))return}if(!b(this.modifiers.slice(),this.fn)(e))throw null}},{key:"_testAsync",value:function(e){var t=this;return new Promise((function(n,i){f(t.modifiers.slice(),t.fn)(e).then((function(t){t?n(e):i(null)})).catch((function(e){return i(e)}))}))}}]),e}();function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"simple";return"object"==typeof e?e[t]:e}function b(e,t){if(e.length){var n=e.shift(),i=b(e,t);return n.perform(i)}return m(t)}function f(e,t){if(e.length){var n=e.shift(),i=f(e,t);return n.performAsync(i)}return function(e){return Promise.resolve(m(t,"async")(e))}}var y=function e(t,n,i){d(this,e),this.name=t,this.perform=n,this.performAsync=i},G=function(e){function t(e,n,i,o){d(this,t);for(var r=arguments.length,a=Array(r>4?r-4:0),g=4;g<r;g++)a[g-4]=arguments[g];var s=A(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a));return Error.captureStackTrace&&Error.captureStackTrace(s,t),s.rule=e,s.value=n,s.cause=i,s.target=o,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),t}(),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];d(this,e),this.chain=t,this.nextRuleModifiers=n}return h(e,[{key:"_applyRule",value:function(e,t){var n=this;return function(){for(var i=arguments.length,o=Array(i),r=0;r<i;r++)o[r]=arguments[r];return n.chain.push(new p(t,e.apply(n,o),o,n.nextRuleModifiers)),n.nextRuleModifiers=[],n}}},{key:"_applyModifier",value:function(e,t){return this.nextRuleModifiers.push(new y(t,e.simple,e.async)),this}},{key:"_clone",value:function(){return new e(this.chain.slice(),this.nextRuleModifiers.slice())}},{key:"test",value:function(e){return this.chain.every((function(t){return t._test(e)}))}},{key:"testAll",value:function(e){var t=[];return this.chain.forEach((function(n){try{n._check(e)}catch(i){t.push(new G(n,e,i))}})),t}},{key:"check",value:function(e){this.chain.forEach((function(t){try{t._check(e)}catch(n){throw new G(t,e,n)}}))}},{key:"testAsync",value:function(e){var t=this;return new Promise((function(n,i){B(e,t.chain.slice(),n,i)}))}}]),e}();function B(e,t,n,i){if(t.length){var o=t.shift();o._testAsync(e).then((function(){B(e,t,n,i)}),(function(t){i(new G(o,e,t))}))}else n(e)}function Z(){return W(new v)}var w={};function W(e){return new Proxy(e,{get:function(t,n){if(n in t)return t[n];var i=W(e._clone());return n in S?i._applyModifier(S[n],n):n in w?i._applyRule(w[n],n):n in V?i._applyRule(V[n],n):void 0}})}Z.extend=function(e){Object.assign(w,e)},Z.clearCustomRules=function(){w={}};var S={not:{simple:function(e){return function(t){return!e(t)}},async:function(e){return function(t){return Promise.resolve(e(t)).then((function(e){return!e})).catch((function(e){return!0}))}}},some:{simple:function(e){return function(t){return R(t).some((function(t){try{return e(t)}catch(n){return!1}}))}},async:function(e){return function(t){return Promise.all(R(t).map((function(t){try{return e(t).catch((function(e){return!1}))}catch(n){return!1}}))).then((function(e){return e.some(Boolean)}))}}},every:{simple:function(e){return function(t){return R(t).every(e)}},async:function(e){return function(t){return Promise.all(R(t).map(e)).then((function(e){return e.every(Boolean)}))}}}};function R(e){return"string"==typeof e?e.split(""):e}var V={equal:function(e){return function(t){return t==e}},exact:function(e){return function(t){return t===e}},number:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t){return"number"==typeof t&&(e||isFinite(t))}},integer:function(){return function(e){return(Number.isInteger||X)(e)}},numeric:function(){return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},string:function(){return x("string")},boolean:function(){return x("boolean")},undefined:function(){return x("undefined")},null:function(){return x("null")},array:function(){return x("array")},object:function(){return x("object")},instanceOf:function(e){return function(t){return t instanceof e}},pattern:function(e){return function(t){return e.test(t)}},lowercase:function(){return function(e){return/^([a-z]+\s*)+$/.test(e)}},uppercase:function(){return function(e){return/^([A-Z]+\s*)+$/.test(e)}},vowel:function(){return function(e){return/^[aeiou]+$/i.test(e)}},consonant:function(){return function(e){return/^(?=[^aeiou])([a-z]+)$/i.test(e)}},first:function(e){return function(t){return t[0]==e}},last:function(e){return function(t){return t[t.length-1]==e}},empty:function(){return function(e){return 0===e.length}},length:function(e,t){return function(n){return n.length>=e&&n.length<=(t||e)}},minLength:function(e){return function(t){return t.length>=e}},maxLength:function(e){return function(t){return t.length<=e}},negative:function(){return function(e){return e<0}},positive:function(){return function(e){return e>=0}},between:function(e,t){return function(n){return n>=e&&n<=t}},range:function(e,t){return function(n){return n>=e&&n<=t}},lessThan:function(e){return function(t){return t<e}},lessThanOrEqual:function(e){return function(t){return t<=e}},greaterThan:function(e){return function(t){return t>e}},greaterThanOrEqual:function(e){return function(t){return t>=e}},even:function(){return function(e){return e%2==0}},odd:function(){return function(e){return e%2!=0}},includes:function(e){return function(t){return~t.indexOf(e)}},schema:function(e){return function(e){return{simple:function(t){var n=[];if(Object.keys(e).forEach((function(i){var o=e[i];try{o.check((t||{})[i])}catch(r){r.target=i,n.push(r)}})),n.length>0)throw n;return!0},async:function(t){var n=[],i=Object.keys(e).map((function(i){return e[i].testAsync((t||{})[i]).catch((function(e){e.target=i,n.push(e)}))}));return Promise.all(i).then((function(e){if(n.length>0)throw n;return!0}))}}}(e)},passesAnyOf:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.some((function(t){return t.test(e)}))}},optional:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){return t&&"string"==typeof n&&""===n.trim()||null!=n&&e.check(n),!0}}};function x(e){return function(t){return Array.isArray(t)&&"array"===e||null===t&&"null"===e||typeof t===e}}function X(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}var H=Z,{toPrimitive:Y}=Symbol,K=Symbol.for("sxs.composers"),{assign:N,create:M,defineProperties:F,getOwnPropertyDescriptors:z}=Object,L=(e,t,n)=>N(F(e,z(n)),{[Y]:()=>e[t],toString:()=>e[t]}),k=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),E=(e,t)=>e.reduce(((e,n)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(e)?`:is(${n})`:n):n+" "+e))),e)),[]),{isArray:T}=Array,{from:U}=Array,{prototype:{toString:_}}=Object,J=/\s*,\s*(?![^()]*\))/,D=/([\d.]+)([^]*)/,P={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Q={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},O=/\s+(?![^()]*\))/,j=e=>t=>e(..."string"==typeof t?String(t).split(O):[t]),q=JSON.stringify,$={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:j(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:j(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:j(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:j(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:j(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:j(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},ee=e=>{let t,n,i,o;const r={};return a=>{const g=q(a);return g in r?r[g]:r[g]=((e,t)=>{const n=new WeakSet,i=(e,o,r,a,g)=>{let s="";e:for(const l in e){const c=64===l.charCodeAt(0);for(const I of c&&T(e[l])?e[l]:[e[l]]){if(t&&(l!==a||I!==g)){const e=t(l,I);if(null!==e){s+="object"==typeof e&&e?i(e,o,r,l,I):null==e?"":e;continue e}}if("object"==typeof I&&I&&I.toString===_){n.has(o)&&(n.delete(o),s+="}");const e=Object(l),t=c?o:o.length?E(o,l.split(J)):l.split(J);s+=i(I,t,c?r.concat(e):r),n.has(e)&&(n.delete(e),s+="}"),n.has(t)&&(n.delete(t),s+="}")}else{for(let e=0;e<r.length;++e)n.has(r[e])||(n.add(r[e]),s+=r[e]+"{");o.length&&!n.has(o)&&(n.add(o),s+=o+"{"),s+=(c?l+" ":k(l)+":")+String(I)+";"}}}return s};return i(e,[],[])})(a,((r,a)=>{const g=r.charCodeAt(0),s=64===g?r:/[A-Z]/.test(l=r)?l:l.replace(/-[^]/g,(e=>e[1].toUpperCase()));var l;const c=64===g?r:k(r);if("function"==typeof e.utils[r]){if(e.utils[r]!=i||a!=o)return i=e.utils[r],o=a,i(e)(o)}else if("function"==typeof $[s]&&($[s]!=i||a!=o))return i=$[s],o=a,i(o);if(o=a,t!=s&&n!=a&&c in P){t=s,n=a;const e=((e,t)=>t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,n,i,o)=>n+("stretch"===i?`-moz-available${o};${e}:${n}-webkit-fill-available`:`-moz-fit-content${o};${e}:${n}fit-content`)+o)))(c,String(n));if(e!=a)return{[r]:e}}let I=64===g?(r.slice(1)in e.media?"@media "+e.media[r.slice(1)]:r).replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,n,i,o,r)=>{const a=D.test(t),g=.0625*(a?-1:1),[s,l]=a?[i,t]:[t,i];return"("+("="===n[0]?"":">"===n[0]===a?"max-":"min-")+s+":"+("="!==n[0]&&1===n.length?l.replace(D,((e,t,i)=>Number(t)+g*(">"===n?1:-1)+i)):l)+(o?") and ("+(">"===o[0]?"min-":"max-")+s+":"+(1===o.length?r.replace(D,((e,t,n)=>Number(t)+g*(">"===o?-1:1)+n)):r):"")+")"})):36===g?("sx"===e.prefix?"-":"--"+e.prefix)+r.replace(/\$/g,"-"):r;const C="object"==typeof a&&a?a:"number"==typeof a&&a&&s in Q?String(a)+"px":((e,t,n)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((t,i,o,r,a)=>"$"==r==!!o?t:(i||"--"==r?"calc(":"")+"var("+("$"===r?("sx"===n.prefix?"-":"--"+n.prefix)+"-"+(a.includes("$")?"":e in n.themeMap?n.themeMap[e]+"-":"")+a.replace(/\$/g,"-"):r+a)+")"+(i||"--"==r?"*"+(i||"")+(o||"1")+")":""))))(s,String(a),e);return a!=C||c!=I?{[I]:C}:null}))}},{ownKeys:te}=Reflect,ne=class extends Set{toString(){return U(this).join("")}get hasChanged(){const{size:e}=this;return()=>e<this.size}},ie=ne;ne.prototype[Y]=ne.prototype.toString;var oe="colors",re="sizes",ae="space",ge={gap:ae,gridGap:ae,columnGap:ae,gridColumnGap:ae,rowGap:ae,gridRowGap:ae,inset:ae,insetBlock:ae,insetBlockEnd:ae,insetBlockStart:ae,insetInline:ae,insetInlineEnd:ae,insetInlineStart:ae,margin:ae,marginTop:ae,marginRight:ae,marginBottom:ae,marginLeft:ae,marginBlock:ae,marginBlockEnd:ae,marginBlockStart:ae,marginInline:ae,marginInlineEnd:ae,marginInlineStart:ae,padding:ae,paddingTop:ae,paddingRight:ae,paddingBottom:ae,paddingLeft:ae,paddingBlock:ae,paddingBlockEnd:ae,paddingBlockStart:ae,paddingInline:ae,paddingInlineEnd:ae,paddingInlineStart:ae,top:ae,right:ae,bottom:ae,left:ae,scrollMargin:ae,scrollMarginTop:ae,scrollMarginRight:ae,scrollMarginBottom:ae,scrollMarginLeft:ae,scrollMarginX:ae,scrollMarginY:ae,scrollMarginBlock:ae,scrollMarginBlockEnd:ae,scrollMarginBlockStart:ae,scrollMarginInline:ae,scrollMarginInlineEnd:ae,scrollMarginInlineStart:ae,scrollPadding:ae,scrollPaddingTop:ae,scrollPaddingRight:ae,scrollPaddingBottom:ae,scrollPaddingLeft:ae,scrollPaddingX:ae,scrollPaddingY:ae,scrollPaddingBlock:ae,scrollPaddingBlockEnd:ae,scrollPaddingBlockStart:ae,scrollPaddingInline:ae,scrollPaddingInlineEnd:ae,scrollPaddingInlineStart:ae,fontSize:"fontSizes",background:oe,backgroundColor:oe,backgroundImage:oe,border:oe,borderBlock:oe,borderBlockEnd:oe,borderBlockStart:oe,borderBottom:oe,borderBottomColor:oe,borderColor:oe,borderInline:oe,borderInlineEnd:oe,borderInlineStart:oe,borderLeft:oe,borderLeftColor:oe,borderRight:oe,borderRightColor:oe,borderTop:oe,borderTopColor:oe,caretColor:oe,color:oe,columnRuleColor:oe,fill:oe,outline:oe,outlineColor:oe,stroke:oe,textDecorationColor:oe,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:re,minBlockSize:re,maxBlockSize:re,inlineSize:re,minInlineSize:re,maxInlineSize:re,width:re,minWidth:re,maxWidth:re,height:re,minHeight:re,maxHeight:re,flexBasis:re,gridTemplateColumns:re,gridTemplateRows:re,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},se=(e,t)=>{for(var n=JSON.stringify(t),i=n.length,o=9;i;)o=Math.imul(o^n.charCodeAt(--i),9**9);return e+(o^o>>>9).toString(36).slice(-5)},le=e=>e?"-"+e:"",ce=class{constructor(e,t,n="",i=""){this.value=e,this.token=t,this.scale=n,this.prefix=i}get computedValue(){return"var("+this.variable+")"}get variable(){return"-"+le(this.prefix)+le(this.scale)+"-"+this.token}toString(){return this.computedValue}},Ie=class extends Array{toString(){return this.join("")}get hasChanged(){const e=String(this);return()=>e!==String(this)}},Ce=Ie;Ie.prototype[Y]=Ie.prototype.toString;var ue=e=>{let t,n,i,o,r,a=!1;const g="append"===e.insertionMethod?"append":"prepend";return e=>{"object"==typeof document&&(t||(t=document.head||document.documentElement),n||(n=document.getElementById("stitches")||N(document.createElement("style"),{id:"stitches",textContent:e})),i||(i=n.firstChild||new Text,a=!i.data),o||(o=n.insertBefore(new Text,i)),n.isConnected||t[g](n),o.data=e,!a&&e&&(clearTimeout(r),r=setTimeout((()=>{i.remove(),a=!0}),250)))}},de=e=>{e="object"==typeof e&&e||{};const t={};t.media=N({initial:"all"},e.media),t.theme="object"==typeof e.theme&&e.theme||{},t.themeMap="object"==typeof e.themeMap&&e.themeMap||ge,t.utils="object"==typeof e.utils&&e.utils||{};const n=new Set(e.passthru?[...e.passthru,"as","className"]:["as","className"]),i=t.prefix=e.prefix||"sx";t.insertionMethod=e.insertionMethod||"prepend";const o=("function"==typeof t.insertionMethod?t.insertionMethod:ue)(t),r="03kze",a=ee(t),g=new ie,s=new ie,l=new ie,c=new ie,I=new ie([g,s,l,c]);let C="";const u=()=>{const e=U(I).join("");C!==e&&o(C=e)},d=(e,t)=>{t="object"==typeof e&&e||Object(t);const n="root"!==(e="string"==typeof e?e:""),o=(n?".":":root,.")+(e=n&&e||se(i,t)),g=L(M(null),"className",{className:e,selector:o}),l={},c=l[o]={};for(const r in t){g[r]=M(null);for(const e in t[r]){let n=String(t[r][e]);n.includes("$")&&(n=n.replace(/\$([$\w-]+)/g,((e,t)=>t.includes("$")?e:"$"+r+e)));const o=g[r][e]=new ce(n,e,r,"sx"===i?"":i);c[o.variable]=o.value}}const I=e===i+r?"":a(l);return L(g,"className",{get className(){const{hasChanged:t}=s;return s.add(I),t()&&u(),e},selector:o})},h=(e,t="")=>{const n=new ie,i=new ie;for(const g in e)if(e[g]!==Object(e[g])||te(e[g]).length){const t=a({[g]:e[g]});("@import"===g?n:i).add(t)}const o=L(M(null),"name",{name:t}),r=L((()=>{let e=g.hasChanged,t=l.hasChanged;return n.forEach((e=>{g.add(e)})),i.forEach((e=>{l.add(e)})),(e()||t())&&u(),o}),"name",{get name(){return String(r())}});return r},A=e=>{const t=new ie,n=new Ce,o=new ie,g=new ie([t,n,o]);let{variants:s,compoundVariants:l,defaultVariants:I,...C}=e;I=Object(I);const u=se(i,e),d="."+u,h=u===i+r?"":a({[d]:C});c.add(g);const A=M(null),p=[],m=[];for(const i in s)for(const e in s[i]){const t=s[i][e];m.push({[i]:e,css:t})}m.push(...l||[]);for(const i in m){const{css:e,...t}=m[i],o=te(t),r=o.length;for(const n of o)A[n]=A[n]||M(null),A[n][t[n]]=!0;const g=(i,g)=>{i={...i};for(const e in g)void 0!==i[e]||Object(A[e])[i[e]]||(i[e]=g[e]);const s=new Set;if(o.length&&o.every((e=>{const n=i[e],o=String(t[e]);if(o===String(n))return!0;if(n===Object(n))for(const t in n)if(o==String(n[t])&&64===t.charCodeAt(0))return s.add(t),!0}))){let i=Object(e);for(const e of s)i={[e]:i};const g=u+se("",i)+"--"+(1===r?o[0]+"-"+t[o[0]]:"c"+r),l=a({["."+g]:i});return(n[r-1]||(n[r-1]=new ie)).add(l),g}};p.push(g)}return{apply(e,i,o){const r=t.hasChanged,a=n.hasChanged;if(t.add(h),e){i.add(u);for(const t of p){const n=t(e,o);n&&i.add(n)}}if(r()||a())return c.add(g),!0},inline(e,t){const n=se("-",e),i=u==="-"+n?"":a({[d+n]:e});t.add(u+n);const{hasChanged:r}=o;return i&&o.add(i),r()},className:u,defaultVariants:I,selector:d,variantProps:A}},p=d("root",t.theme),m=L({css:(...e)=>{let t,i=[],o=M(null);for(const n of e)if(n===Object(n))if(K in n)for(const e of n[K])i.push(e),N(o,e.defaultVariants);else i.push(t=A(n)),N(o,t.defaultVariants);return t||i.push(t=A({})),L((e=>{const{css:r,...a}=Object(e),g=new Set;let s,l=!1;for(const t of i)l=t.apply(a,g,o)||l;r===Object(r)&&(s=t.inline(r,g)),(l||s)&&u();for(const i in t.variantProps)n.has(i)||delete a[i];void 0!==a.className&&String(a.className).split(/\s+/).forEach(g.add,g);const c=U(g);return a.className=c.join(" "),L(M(null),"className",{get[K](){return i},className:a.className,props:a,selector:t.selector})}),"className",{get[K](){return i},get className(){return t.apply()&&u(),t.className},selector:t.selector})},config:t,global:h,keyframes:e=>{const t=se(i,e);return h({["@keyframes "+t]:e},t)},prefix:i,reset:()=>(g.clear(),s.clear(),l.clear(),c.clear(),p.className,m),theme:N(d,p),get cssText(){return C},getCssString:()=>C},"cssText",{});return m},he=Symbol.for("react.element"),Ae=Symbol.for("react.forward_ref"),pe=e=>{const t=de(e);return N(t,{styled:(...e)=>{const n=e.map((e=>Object(e).type?e.type:e)).find((e=>e))||"span",i=t.css(...e.filter((e=>K in Object(e)||e&&"object"==typeof e&&!e.$$typeof)));return Object.setPrototypeOf({render(e,t){const{props:{as:o=n,...r},...a}=i(e);return{constructor:void 0,$$typeof:he,props:r,ref:t,type:o,__v:0}},$$typeof:Ae,[K]:i[K],[Symbol.toPrimitive]:()=>i.selector,toString:()=>i.selector,get className(){return i.className},get selector(){return i.selector},type:n},Object(n))}})};function me(e,t){return e.map((function(e,n){return e+t[n]}))}function be(e,t){return e.map((function(e,n){return e-t[n]}))}function fe(e){return Math.hypot.apply(Math,e)}function ye(e,t,n){var i=fe(t),o=0===i?0:1/i,r=0===n?0:1/n,a=r*i,g=t.map((function(e){return r*e})),s=t.map((function(e){return o*e}));return{velocities:g,velocity:a,distance:fe(e),direction:s}}function Ge(e){return Math.sign?Math.sign(e):Number(e>0)-Number(e<0)||+e}function ve(e,t,n){return 0===t||Math.abs(t)===1/0?function(e,t){return Math.pow(e,5*t)}(e,n):e*t*n/(t+n*e)}function Be(e,t,n,i){return void 0===i&&(i=.15),0===i?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-ve(t-e,n-t,i)+t:e>n?+ve(e-n,n-t,i)+n:e}function Ze(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function we(){return(we=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function We(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function Se(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function xe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ve(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function Xe(){}function He(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?Xe:1===t.length?t[0]:function(){for(var e,n,i=xe(t);!(n=i()).done;){var o=n.value;e=o.apply(this,arguments)||e}return e}}function Ye(e,t){if(void 0===e){if(void 0===t)throw new Error("Must define fallback value if undefined is expected");e=t}return Array.isArray(e)?e:[e,e]}function Ke(e){if("function"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(void 0,n)}return e}function Ne(e,t){void 0===e&&(e={});for(var n={},i=0,o=Object.entries(t);i<o.length;i++){var r=o[i],a=r[0],g=r[1];switch(typeof g){case"function":n[a]=g.call(n,e[a],a,e);break;case"object":n[a]=Ne(e[a],g);break;case"boolean":g&&(n[a]=e[a])}}return n}function Me(){return"undefined"!=typeof window&&"ontouchstart"in window}function Fe(e){return"pointerId"in e?null:"touchend"===e.type?e.changedTouches:e.targetTouches}function ze(e){return Array.from(Fe(e)).map((function(e){return e.identifier}))}function Le(e){return{buttons:"buttons"in e?e.buttons:0,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,ctrlKey:e.ctrlKey}}var ke=function(e){return e};function Ee(e,t){void 0===t&&(t=ke);var n=Fe(e),i=n?n[0]:e;return t([i.clientX,i.clientY])}var Te={threshold:function(e){return void 0===e&&(e=0),Ye(e)},rubberband:function(e){switch(void 0===e&&(e=0),e){case!0:return Ye(.15);case!1:return Ye(0);default:return Ye(e)}},enabled:function(e){return void 0===e&&(e=!0),e},triggerAllEvents:function(e){return void 0===e&&(e=!1),e},initial:function(e){return void 0===e&&(e=0),"function"==typeof e?e:Ye(e)},transform:!0},Ue=we({},Te,{axis:!0,lockDirection:function(e){return void 0===e&&(e=!1),e},bounds:function(e){if(void 0===e&&(e={}),"function"==typeof e)return function(t){return Ue.bounds(e(t))};var t=e,n=t.left,i=void 0===n?-1/0:n,o=t.right,r=void 0===o?1/0:o,a=t.top,g=void 0===a?-1/0:a,s=t.bottom;return[[i,r],[g,void 0===s?1/0:s]]}}),_e="undefined"!=typeof window&&window.document&&window.document.createElement,Je={enabled:function(e){return void 0===e&&(e=!0),e},domTarget:!0,window:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return void 0===e&&(e=_e?window:void 0),e})),eventOptions:function(e){var t=void 0===e?{}:e,n=t.passive,i=void 0===n||n,o=t.capture;return{passive:i,capture:void 0!==o&&o}},transform:!0},De=we({},Ue,{useTouch:function(e){void 0===e&&(e=!1);var t=Me(),n="undefined"!=typeof window&&"onpointerdown"in window;return!(!e||!t)||!(!t||n)},experimental_preventWindowScrollY:function(e){return void 0===e&&(e=!1),e},threshold:function(e,t,n){var i=n.filterTaps,o=void 0!==i&&i,r=n.lockDirection,a=void 0!==r&&r,g=n.axis,s=Ye(e,o?3:a||(void 0===g?void 0:g)?1:0);return this.filterTaps=o,s},swipeVelocity:function(e){return void 0===e&&(e=.5),Ye(e)},swipeDistance:function(e){return void 0===e&&(e=50),Ye(e)},swipeDuration:function(e){return void 0===e&&(e=250),e},delay:function(e){switch(void 0===e&&(e=0),e){case!0:return 180;case!1:return 0;default:return e}}});function Pe(e){return void 0===e&&(e={}),Ne(e,Je)}function Qe(e){return void 0===e&&(e={}),Ne(e,De)}function Oe(e){var t=e.domTarget,n=e.eventOptions,i=e.window,o=e.enabled,r=Se(e,["domTarget","eventOptions","window","enabled"]),a=Pe({domTarget:t,eventOptions:n,window:i,enabled:o});return a.drag=Qe(r),a}function je(e){return we({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_threshold:[0,0],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:Xe,canceled:!1,memo:void 0,args:void 0},e)}function qe(){return{shared:{hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},drag:je({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),pinch:je({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),wheel:je({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),move:je({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),scroll:je({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0})}}var $e=new Map,et=function(e){return e},tt=function(){function e(e,t){var n=this;void 0===t&&(t=[]),this.controller=e,this.args=t,this.debounced=!0,this.setTimeout=function(e,t){var i;void 0===t&&(t=140),clearTimeout(n.controller.timeouts[n.stateKey]);for(var o=arguments.length,r=new Array(o>2?o-2:0),a=2;a<o;a++)r[a-2]=arguments[a];n.controller.timeouts[n.stateKey]=(i=window).setTimeout.apply(i,[e,t].concat(r))},this.clearTimeout=function(){clearTimeout(n.controller.timeouts[n.stateKey])},this.fireGestureHandler=function(e){if(void 0===e&&(e=!1),n.state._blocked)return n.debounced||(n.state._active=!1,n.clean()),null;if(!e&&!n.state.intentional&&!n.config.triggerAllEvents)return null;if(n.state.intentional){var t=n.state.active,i=n.state._active;n.state.active=i,n.state.first=i&&!t,n.state.last=t&&!i,n.controller.state.shared[n.ingKey]=i}var o=n.controller.pointerIds.size||n.controller.touchIds.size,r=n.controller.state.shared.buttons>0||o>0,a=we({},n.controller.state.shared,n.state,n.mapStateValues(n.state),{locked:!!document.pointerLockElement,touches:o,down:r}),g=n.handler(a);return n.state.memo=void 0!==g?g:n.state.memo,a},this.controller=e,this.args=t}var t,n,i,o=e.prototype;return o.updateSharedState=function(e){Object.assign(this.controller.state.shared,e)},o.updateGestureState=function(e){Object.assign(this.state,e)},o.checkIntentionality=function(e,t){return{_intentional:e,_blocked:!1}},o.getMovement=function(e){var t=this.config.rubberband,n=this.state,i=n._bounds,o=n._initial,r=n._active,a=n._intentional,g=n.lastOffset,s=n.movement,l=n._threshold,c=this.getInternalMovement(e,this.state),I=!1===a[0]?nt(c[0],l[0]):a[0],C=!1===a[1]?nt(c[1],l[1]):a[1],u=this.checkIntentionality([I,C],c);if(u._blocked)return we({},u,{_movement:c,delta:[0,0]});var d=u._intentional,h=c,A=[!1!==d[0]?c[0]-d[0]:0,!1!==d[1]?c[1]-d[1]:0],p=me(A,g),m=r?t:[0,0];return A=it(i,me(A,o),m),we({},u,{intentional:!1!==d[0]||!1!==d[1],_initial:o,_movement:h,movement:A,values:e,offset:it(i,p,m),delta:be(A,s)})},o.clean=function(){this.clearTimeout()},t=e,(n=[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}},{key:"transform",get:function(){return this.config.transform||this.controller.config.transform||et}}])&&Ze(t.prototype,n),i&&Ze(t,i),e}();function nt(e,t){return Math.abs(e)>=t&&Ge(e)*t}function it(e,t,n){var i=t[0],o=t[1],r=n[0],a=n[1],g=e[0],s=g[0],l=g[1],c=e[1],I=c[0],C=c[1];return[Be(i,s,l,r),Be(o,I,C,a)]}function ot(e,t,n){var i=e.state,o=t.timeStamp,r=t.type,a=i.values;return{_lastEventType:r,event:t,timeStamp:o,elapsedTime:n?0:o-i.startTime,previous:a}}function rt(e,t,n,i){var o=e.state,r=e.config,a=e.stateKey,g=e.args,s=e.transform,l=o.offset,c=n.timeStamp,I=r.initial,C=r.bounds,u=be(s(r.threshold),s([0,0])).map(Math.abs),d=we({},qe()[a],{_active:!0,args:g,values:t,initial:null!=i?i:t,_threshold:u,offset:l,lastOffset:l,startTime:c});return we({},d,{_initial:Ke(I,d),_bounds:Ke(C,d)})}var at=function(e){var t=this;this.classes=e,this.pointerIds=new Set,this.touchIds=new Set,this.supportsTouchEvents=Me(),this.supportsGestureEvents=function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),this.bind=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(var o,r={},a=xe(t.classes);!(o=a()).done;){var g=o.value;new g(t,n).addBindings(r)}var s=function(e){ht(r,e,(function(i){return t.nativeRefs[e](we({},t.state.shared,{event:i,args:n}))}))};for(var l in t.nativeRefs)s(l);return t.config.domTarget?It(t,r):Ct(t,r)},this.effect=function(){return t.config.domTarget&&t.bind(),t.clean},this.clean=function(){var e=dt(t.config),n=t.config.eventOptions;e&&pt(e,ut(t.domListeners),n),Object.values(t.timeouts).forEach(clearTimeout),function(e){var t=e.config,n=t.window,i=t.eventOptions,o=e.windowListeners;if(!n)return;for(var r in o){pt(n,o[r],i)}e.windowListeners={}}(t)},this.classes=e,this.state=qe(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function gt(e,t){"pointerId"in t?e.pointerIds.add(t.pointerId):e.touchIds=new Set(ze(t))}function st(e,t){"pointerId"in t?e.pointerIds.delete(t.pointerId):ze(t).forEach((function(t){return e.touchIds.delete(t)}))}function lt(e,t,n){var i=e.config,o=e.windowListeners;void 0===n&&(n=i.eventOptions),i.window&&(pt(i.window,o[t],n),delete o[t])}function ct(e,t,n,i){var o=e.config,r=e.windowListeners;void 0===n&&(n=[]),void 0===i&&(i=o.eventOptions),o.window&&(pt(o.window,r[t],i),At(o.window,r[t]=n,i))}function It(e,t){var n=e.config,i=e.domListeners,o=dt(n);if(!o)throw new Error("domTarget must be defined");var r=n.eventOptions;pt(o,ut(i),r);for(var a=0,g=Object.entries(t);a<g.length;a++){var s=g[a],l=s[0],c=s[1],I=l.slice(2).toLowerCase();i.push([I,He.apply(void 0,c)])}At(o,i,r)}function Ct(e,t){for(var n={},i=e.config.eventOptions.capture?"Capture":"",o=0,r=Object.entries(t);o<r.length;o++){var a=r[o],g=a[0],s=a[1],l=Array.isArray(s)?s:[s];n[g+i]=He.apply(void 0,l)}return n}function ut(e){return void 0===e&&(e=[]),e.splice(0,e.length)}function dt(e){var t=e.domTarget;return t&&"current"in t?t.current:t}function ht(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function At(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={});for(var i,o=xe(t);!(i=o()).done;){var r=i.value,a=r[0],g=r[1];e.addEventListener(a,g,n)}}function pt(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={});for(var i,o=xe(t);!(i=o()).done;){var r=i.value,a=r[0],g=r[1];e.removeEventListener(a,g,n)}}function mt(e,t,n){void 0===n&&(n={});var o=function(e){var t=new Set;e.drag&&t.add($e.get("drag"));e.wheel&&t.add($e.get("wheel"));e.scroll&&t.add($e.get("scroll"));e.move&&t.add($e.get("move"));e.pinch&&t.add($e.get("pinch"));e.hover&&t.add($e.get("hover"));return t}(e),r=i.useMemo((function(){return new at(o)}),[]);return r.config=t,r.handlers=e,r.nativeRefs=n,i.useEffect(r.effect,[]),r.config.domTarget?bt:r.bind}function bt(){0}var ft=function(e){function t(){return e.apply(this,arguments)||this}We(t,e);var n=t.prototype;return n.getInternalMovement=function(e,t){return be(e,t.initial)},n.checkIntentionality=function(e,t){if(!1===e[0]&&!1===e[1])return{_intentional:e,axis:this.state.axis};var n=t.map(Math.abs),i=n[0],o=n[1],r=this.state.axis||(i>o?"x":i<o?"y":void 0);return this.config.axis||this.config.lockDirection?r?this.config.axis&&r!==this.config.axis?{_intentional:e,_blocked:!0,axis:r}:(e["x"===r?1:0]=!1,{_intentional:e,_blocked:!1,axis:r}):{_intentional:[!1,!1],_blocked:!1,axis:r}:{_intentional:e,_blocked:!1,axis:r}},n.getKinematics=function(e,t){var n=this.getMovement(e);if(!n._blocked){var i=t.timeStamp-this.state.timeStamp;Object.assign(n,ye(n.movement,n.delta,i))}return n},n.mapStateValues=function(e){return{xy:e.values,vxvy:e.velocities}},t}(tt);function yt(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}var Gt=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).ingKey="dragging",t.stateKey="drag",t.setPointerCapture=function(e){if(!t.config.useTouch&&!document.pointerLockElement){var n=e.target,i=e.pointerId;n&&"setPointerCapture"in n&&n.setPointerCapture(i),t.updateGestureState({_dragTarget:n,_dragPointerId:i})}},t.releasePointerCapture=function(){if(!t.config.useTouch&&!document.pointerLockElement){var e=t.state,n=e._dragTarget,i=e._dragPointerId;if(i&&n&&"releasePointerCapture"in n&&(!("hasPointerCapture"in n)||n.hasPointerCapture(i)))try{n.releasePointerCapture(i)}catch(o){}}},t.preventScroll=function(e){t.state._dragPreventScroll&&e.cancelable&&e.preventDefault()},t.getEventId=function(e){return t.config.useTouch?e.changedTouches[0].identifier:e.pointerId},t.isValidEvent=function(e){return t.state._pointerId===t.getEventId(e)},t.shouldPreventWindowScrollY=t.config.experimental_preventWindowScrollY&&t.controller.supportsTouchEvents,t.setUpWindowScrollDetection=function(e){yt(e),ct(t.controller,t.stateKey,[["touchmove",t.preventScroll],["touchend",t.clean.bind(Re(t))],["touchcancel",t.clean.bind(Re(t))]],{passive:!1}),t.setTimeout(t.startDrag.bind(Re(t)),250,e)},t.setUpDelayedDragTrigger=function(e){t.state._dragDelayed=!0,yt(e),t.setTimeout(t.startDrag.bind(Re(t)),t.config.delay,e)},t.setStartState=function(e){var n=Ee(e,t.transform);t.updateSharedState(Le(e)),t.updateGestureState(we({},rt(Re(t),n,e),ot(Re(t),e,!0),{_pointerId:t.getEventId(e)})),t.updateGestureState(t.getMovement(n))},t.onDragStart=function(e){gt(t.controller,e),t.enabled&&!t.state._active&&(t.setStartState(e),t.setPointerCapture(e),t.shouldPreventWindowScrollY?t.setUpWindowScrollDetection(e):t.config.delay>0?t.setUpDelayedDragTrigger(e):t.startDrag(e,!0))},t.onDragChange=function(e){if(!t.state.canceled&&t.state._active&&t.isValidEvent(e)&&(t.state._lastEventType!==e.type||e.timeStamp!==t.state.timeStamp)){var n;if(document.pointerLockElement){var i=e.movementX,o=e.movementY;n=me(t.transform([i,o]),t.state.values)}else n=Ee(e,t.transform);var r=t.getKinematics(n,e);if(!t.state._dragStarted){if(t.state._dragDelayed)return void t.startDrag(e);if(!t.shouldPreventWindowScrollY)return;if(t.state._dragPreventScroll||!r.axis)return;if("x"!==r.axis)return void(t.state._active=!1);t.startDrag(e)}var a=Le(e);t.updateSharedState(a);var g=ot(Re(t),e),s=fe(r._movement),l=t.state._dragIsTap;l&&s>=3&&(l=!1),t.updateGestureState(we({},g,r,{_dragIsTap:l})),t.fireGestureHandler()}},t.onDragEnd=function(e){if(st(t.controller,e),t.isValidEvent(e)&&(t.clean(),t.state._active)){t.state._active=!1;var n=t.state._dragIsTap,i=t.state.velocities,o=i[0],r=i[1],a=t.state.movement,g=a[0],s=a[1],l=t.state._intentional,c=l[0],I=l[1],C=t.config.swipeVelocity,u=C[0],d=C[1],h=t.config.swipeDistance,A=h[0],p=h[1],m=t.config.swipeDuration,b=we({},ot(Re(t),e),t.getMovement(t.state.values)),f=[0,0];b.elapsedTime<m&&(!1!==c&&Math.abs(o)>u&&Math.abs(g)>A&&(f[0]=Ge(o)),!1!==I&&Math.abs(r)>d&&Math.abs(s)>p&&(f[1]=Ge(r))),t.updateSharedState({buttons:0}),t.updateGestureState(we({},b,{tap:n,swipe:f})),t.fireGestureHandler(t.config.filterTaps&&!0===n)}},t.clean=function(){e.prototype.clean.call(Re(t)),t.state._dragStarted=!1,t.releasePointerCapture(),lt(t.controller,t.stateKey)},t.onCancel=function(){t.state.canceled||(t.updateGestureState({canceled:!0,_active:!1}),t.updateSharedState({buttons:0}),setTimeout((function(){return t.fireGestureHandler()}),0))},t.onClick=function(e){t.state._dragIsTap||e.stopPropagation()},t}We(t,e);var n=t.prototype;return n.startDrag=function(e,t){void 0===t&&(t=!1),this.state._active&&!this.state._dragStarted&&(t||this.setStartState(e),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())},n.addBindings=function(e){(this.config.useTouch?(ht(e,"onTouchStart",this.onDragStart),ht(e,"onTouchMove",this.onDragChange),ht(e,"onTouchEnd",this.onDragEnd),ht(e,"onTouchCancel",this.onDragEnd)):(ht(e,"onPointerDown",this.onDragStart),ht(e,"onPointerMove",this.onDragChange),ht(e,"onPointerUp",this.onDragEnd),ht(e,"onPointerCancel",this.onDragEnd)),this.config.filterTaps)&&ht(e,this.controller.config.eventOptions.capture?"onClick":"onClickCapture",this.onClick)},t}(ft);function vt(e,t){var n,i,o=[],r=!1;return function(){for(var a=arguments.length,g=new Array(a),s=0;s<a;s++)g[s]=arguments[s];return r&&n===this&&t(g,o)||(i=e.apply(this,g),r=!0,n=this,o=g),i}}function Bt(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,i,o,r;if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(i=n;0!=i--;)if(!Bt(e[i],t[i]))return!1;return!0}if("function"==typeof Map&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(r=e.entries();!(i=r.next()).done;)if(!t.has(i.value[0]))return!1;for(r=e.entries();!(i=r.next()).done;)if(!Bt(i.value[1],t.get(i.value[0])))return!1;return!0}if("function"==typeof Set&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(r=e.entries();!(i=r.next()).done;)if(!t.has(i.value[0]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if((n=(o=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(t,o[i]))return!1;if("undefined"!=typeof Element&&e instanceof Element)return!1;for(i=n;0!=i--;)if(!("_owner"===o[i]&&e.$$typeof||Bt(e[o[i]],t[o[i]])))return!1;return!0}return e!=e&&t!=t}function Zt(e,t){try{return Bt(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}function wt(e,t){void 0===t&&(t={}),$e.set("drag",Gt);var n=(0,i.useRef)();return n.current||(n.current=vt(Oe,Zt)),mt({drag:e},n.current(t))}const Wt={prefix:Math.round(1e10*Math.random()),current:0},St=i.createContext(Wt);const Rt="span",Vt=i.forwardRef(((e,t)=>{const{as:n=Rt,...r}=e;return i.createElement(a,(0,o.Z)({},r,{as:n,ref:t,style:{...e.style,position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}}))}));function xt(...e){return t=>e.forEach((e=>function(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}(e,t)))}function Xt(...e){return i.useCallback(xt(...e),e)}function Ht(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(null==e||e(i),!1===n||!i.defaultPrevented)return null==t?void 0:t(i)}}const Yt=i.forwardRef(((e,t)=>{const{children:n,...r}=e;return 1===i.Children.count(n)?i.createElement(Kt,(0,o.Z)({},r,{ref:t}),n):i.createElement(i.Fragment,null,i.Children.map(n,(e=>i.isValidElement(e)&&e.type===Nt?i.createElement(Kt,(0,o.Z)({},r,{ref:t}),e.props.children):e)))}));Yt.displayName="Slot";const Kt=i.forwardRef(((e,t)=>{const{children:n,...o}=e,r=i.Children.only(n);return i.isValidElement(r)?i.cloneElement(r,{...Mt(o,r.props),ref:xt(t,r.ref)}):null}));Kt.displayName="SlotClone";const Nt=({children:e})=>e;function Mt(e,t){const n={...t};for(const i in t){const o=e[i],r=t[i];/^on[A-Z]/.test(i)&&(n[i]=Ht(r,o))}return{...e,...n}}const Ft=i.forwardRef(((e,t)=>{const{as:n=zt,...r}=e;return i.createElement(a,(0,o.Z)({},r,{as:n,ref:t}))})),zt=i.forwardRef(((e,t)=>{const{width:n=10,height:r=5,...a}=e;return i.createElement("svg",(0,o.Z)({},a,{ref:t,width:n,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),i.createElement("polygon",{points:"0,0 30,0 15,10"}))})),Lt=Ft;function kt(e){const[t,n]=i.useState(void 0);return i.useEffect((()=>{if(e){const t=new ResizeObserver((t=>{if(!Array.isArray(t))return;if(!t.length)return;const i=t[0];let o,r;if("borderBoxSize"in i){const e=i.borderBoxSize,t=Array.isArray(e)?e[0]:e;o=t.inlineSize,r=t.blockSize}else{const t=e.getBoundingClientRect();o=t.width,r=t.height}n({width:o,height:r})}));return t.observe(e,{box:"border-box"}),()=>{n(void 0),t.unobserve(e)}}}),[e]),t}let Et;const Tt=new Map;function Ut(){const e=[];Tt.forEach(((t,n)=>{const i=n.getBoundingClientRect();var o,r;r=i,((o=t.rect).width!==r.width||o.height!==r.height||o.top!==r.top||o.right!==r.right||o.bottom!==r.bottom||o.left!==r.left)&&(t.rect=i,e.push(t))})),e.forEach((e=>{e.callbacks.forEach((t=>t(e.rect)))})),Et=requestAnimationFrame(Ut)}function _t(e){const[t,n]=i.useState();return i.useEffect((()=>{if(e){const t=function(e,t){const n=Tt.get(e);return void 0===n?(Tt.set(e,{rect:{},callbacks:[t]}),1===Tt.size&&(Et=requestAnimationFrame(Ut))):n.callbacks.push(t),()=>{const n=Tt.get(e);if(void 0===n)return;const i=n.callbacks.indexOf(t);i>-1&&n.callbacks.splice(i,1),0===n.callbacks.length&&(Tt.delete(e),0===Tt.size&&cancelAnimationFrame(Et))}}(e,n);return()=>{n(void 0),t()}}}),[e]),t}function Jt(e){const t=i.createContext(null);function n(e){const{children:n,...o}=e,r=i.useMemo((()=>o),Object.values(o));return i.createElement(t.Provider,{value:r},n)}return n.displayName=e+"Provider",[n,function(n){const o=i.useContext(t);if(null===o)throw new Error(`\`${n}\` must be used within \`${e}\``);return o}]}function Dt(e,t,n){const i=e["x"===n?"left":"top"],o="x"===n?"width":"height",r=e[o],a=t[o];return{before:i-a,start:i,center:i+(r-a)/2,end:i+r-a,after:i+r}}function Pt(e){return{position:"absolute",top:0,left:0,minWidth:"max-content",willChange:"transform",transform:`translate3d(${Math.round(e.x+window.scrollX)}px, ${Math.round(e.y+window.scrollY)}px, 0)`}}function Qt(e,t,n,i,o){const r="top"===t||"bottom"===t,a=o?o.width:0,g=o?o.height:0,s=a/2+i;let l="",c="";return r?(l={start:`${s}px`,center:"center",end:e.width-s+"px"}[n],c="top"===t?`${e.height+g}px`:-g+"px"):(l="left"===t?`${e.width+g}px`:-g+"px",c={start:`${s}px`,center:"center",end:e.height-s+"px"}[n]),`${l} ${c}`}const Ot={position:"fixed",top:0,left:0,opacity:0,transform:"translate3d(0, -200%, 0)"},jt={position:"absolute",opacity:0};function qt({popperSize:e,arrowSize:t,arrowOffset:n,side:i,align:o}){const r=(e.width-t.width)/2,a=(e.height-t.width)/2,g={top:0,right:90,bottom:180,left:-90}[i],s=Math.max(t.width,t.height),l={width:`${s}px`,height:`${s}px`,transform:`rotate(${g}deg)`,willChange:"transform",position:"absolute",[i]:"100%",direction:$t(i,o)};return"top"!==i&&"bottom"!==i||("start"===o&&(l.left=`${n}px`),"center"===o&&(l.left=`${r}px`),"end"===o&&(l.right=`${n}px`)),"left"!==i&&"right"!==i||("start"===o&&(l.top=`${n}px`),"center"===o&&(l.top=`${a}px`),"end"===o&&(l.bottom=`${n}px`)),l}function $t(e,t){return("top"!==e&&"right"!==e||"end"!==t)&&("bottom"!==e&&"left"!==e||"end"===t)?"ltr":"rtl"}function en(e){return{top:"bottom",right:"left",bottom:"top",left:"right"}[e]}function tn(e,t){return{top:e.top<t.top,right:e.right>t.right,bottom:e.bottom>t.bottom,left:e.left<t.left}}const[nn,on]=Jt("Popper"),rn=i.forwardRef(((e,t)=>{const{virtualRef:n,children:r,...g}=e,s=on("PopperAnchor"),l=i.useRef(null),c=Xt(t,l);return i.useEffect((()=>{s.onAnchorChange((null==n?void 0:n.current)||l.current)})),n?null:i.createElement(a,(0,o.Z)({},g,{ref:c}),r)})),[an,gn]=Jt("PopperContent"),sn=({children:e})=>{const[t,n]=i.useState(null);return i.createElement(nn,{anchor:t,onAnchorChange:n},e)},ln=rn,cn=i.forwardRef(((e,t)=>{const{side:n="bottom",sideOffset:r,align:g="center",alignOffset:s,collisionTolerance:l,avoidCollisions:c=!0,...I}=e,C=on("PopperContent"),[u,d]=i.useState(),h=_t(C.anchor),[A,p]=i.useState(null),m=kt(A),[b,f]=i.useState(null),y=kt(b),G=Xt(t,(e=>p(e))),v=function(){const[e,t]=i.useState(void 0);return i.useEffect((()=>{let e;function n(){t({width:window.innerWidth,height:window.innerHeight})}function i(){window.clearTimeout(e),e=window.setTimeout(n,100)}return n(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}),[]),e}(),B=v?DOMRect.fromRect({...v,x:0,y:0}):void 0,{popperStyles:Z,arrowStyles:w,placedSide:W,placedAlign:S}=function({anchorRect:e,popperSize:t,arrowSize:n,arrowOffset:i=0,side:o,sideOffset:r=0,align:a,alignOffset:g=0,shouldAvoidCollisions:s=!0,collisionBoundariesRect:l,collisionTolerance:c=0}){if(!e||!t||!l)return{popperStyles:Ot,arrowStyles:jt};const I=function(e,t,n=0,i=0,o){const r=o?o.height:0,a=Dt(t,e,"x"),g=Dt(t,e,"y"),s=g.before-n-r,l=g.after+n+r,c=a.before-n-r,I=a.after+n+r;return{top:{start:{x:a.start+i,y:s},center:{x:a.center,y:s},end:{x:a.end-i,y:s}},right:{start:{x:I,y:g.start+i},center:{x:I,y:g.center},end:{x:I,y:g.end-i}},bottom:{start:{x:a.start+i,y:l},center:{x:a.center,y:l},end:{x:a.end-i,y:l}},left:{start:{x:c,y:g.start+i},center:{x:c,y:g.center},end:{x:c,y:g.end-i}}}}(t,e,r,g,n),C=I[o][a];if(!1===s){const e=Pt(C);let r=jt;return n&&(r=qt({popperSize:t,arrowSize:n,arrowOffset:i,side:o,align:a})),{popperStyles:{...e,"--radix-popper-transform-origin":Qt(t,o,a,i,n)},arrowStyles:r,placedSide:o,placedAlign:a}}const u=DOMRect.fromRect({...t,...C}),d=(h=l,A=c,DOMRect.fromRect({width:h.width-2*A,height:h.height-2*A,x:h.left+A,y:h.top+A}));var h,A;const p=tn(u,d),m=I[en(o)][a],b=function(e,t,n){const i=en(e);return t[e]&&!n[i]?i:e}(o,p,tn(DOMRect.fromRect({...t,...m}),d)),f=function(e,t,n,i,o){const r="top"===n||"bottom"===n,a=r?"left":"top",g=r?"right":"bottom",s=r?"width":"height",l=t[s]>e[s];return"start"!==i&&"center"!==i||!(o[a]&&l||o[g]&&!l)?"end"!==i&&"center"!==i||!(o[g]&&l||o[a]&&!l)?i:"start":"end"}(t,e,o,a,p),y=Pt(I[b][f]);let G=jt;return n&&(G=qt({popperSize:t,arrowSize:n,arrowOffset:i,side:b,align:f})),{popperStyles:{...y,"--radix-popper-transform-origin":Qt(t,b,f,i,n)},arrowStyles:G,placedSide:b,placedAlign:f}}({anchorRect:h,popperSize:m,arrowSize:y,arrowOffset:u,side:n,sideOffset:r,align:g,alignOffset:s,shouldAvoidCollisions:c,collisionBoundariesRect:B,collisionTolerance:l}),R=void 0!==W;return i.createElement("div",{style:Z,"data-radix-popper-content-wrapper":""},i.createElement(an,{arrowStyles:w,onArrowChange:f,onArrowOffsetChange:d},i.createElement(a,(0,o.Z)({"data-side":W,"data-align":S},I,{style:{...I.style,animation:R?void 0:"none"},ref:G}))))})),In=i.forwardRef((function(e,t){const{offset:n,...r}=e,a=gn("PopperArrow"),{onArrowOffsetChange:g}=a;return i.useEffect((()=>g(n)),[g,n]),i.createElement("span",{style:{...a.arrowStyles,pointerEvents:"none"}},i.createElement("span",{ref:a.onArrowChange,style:{display:"inline-block",verticalAlign:"top",pointerEvents:"auto"}},i.createElement(Lt,(0,o.Z)({},r,{ref:t,style:{...r.style,display:"block"}}))))})),Cn=e=>{const{present:t,children:n}=e,o=function(e){const[t,n]=i.useState(),o=i.useRef({}),r=i.useRef(e),a=i.useRef(),g=e?"mounted":"unmounted",[s,l]=function(e,t){return i.useReducer(((e,n)=>{const i=t[e][n];return null!=i?i:e}),e)}(g,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return i.useEffect((()=>{const t=o.current,n=r.current;if(n!==e){const i=a.current,o=un(t);if(e)l("MOUNT");else if("none"===o||"none"===(null==t?void 0:t.display))l("UNMOUNT");else{const e=i!==o;l(n&&e?"ANIMATION_OUT":"UNMOUNT")}r.current=e}}),[e,l]),i.useEffect((()=>{if(t){const e=e=>{const n=un(o.current).includes(e.animationName);e.target===t&&n&&l("ANIMATION_END")},n=e=>{e.target===t&&(a.current=un(o.current))};return t.addEventListener("animationstart",n),t.addEventListener("animationcancel",e),t.addEventListener("animationend",e),()=>{t.removeEventListener("animationstart",n),t.removeEventListener("animationcancel",e),t.removeEventListener("animationend",e)}}}),[t,l]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:i.useCallback((e=>{e&&(o.current=getComputedStyle(e),n(e))}),[])}}(t),r="function"==typeof n?n({present:o.isPresent}):i.Children.only(n),a=Xt(o.ref,r.ref);return"function"==typeof n||o.isPresent?i.cloneElement(r,{ref:a}):null};function un(e){return(null==e?void 0:e.animationName)||"none"}function dn(e){const t=i.useRef(e);return i.useEffect((()=>{t.current=e}),[e]),t.current}function hn(e){const t=i.useRef(e);return i.useEffect((()=>{t.current=e})),i.useCallback(((...e)=>{var n;return null===(n=t.current)||void 0===n?void 0:n.call(t,...e)}),[])}function An(e){return{type:"machine.actions.assign",assign:e}}let pn,mn;Cn.displayName="Presence";const bn=An(((e,t)=>{var n;return{...e,id:null!==(n=t.id)&&void 0!==n?n:e.id}})),fn=function(e,{debug:t=!1,warnOnUnknownTransitions:n=!1}={}){let i=e.initial,o=e.context;const r=[],a=g=>{var s,l;const c=e.states[i],I=g.type,C=null===(s=e.on)||void 0===s?void 0:s[I],u=null===(l=c.on)||void 0===l?void 0:l[I],d=null!=C?C:u;if(void 0===d)n&&console.warn(`From state: "${i}", event "${I}" has no transition to any state`);else{const{target:n,actions:s=[],cond:l=(()=>!0)}=d,I=n?e.states[n]:{};if(l(o,g)){const e=(c.exit||[]).concat(s,I.entry||[]);o=function(e,t,n){let i=n;return null==e||e.forEach((e=>{"function"==typeof e?e(i,t,a):"machine.actions.assign"===e.type&&(i=e.assign(i,t))})),i}(e,g,o),n&&(i=n,t&&(console.group("event:",g),console.log("state:",i),console.log("context:",o),console.groupEnd()),r.forEach((e=>e({state:i,context:o}))))}}};return{subscribe:function(e){return r.push(e),()=>{r.splice(r.indexOf(e),1)}},send:a,getContext:function(){return o}}}({initial:"closed",context:{id:null,delayed:!1},on:{FOCUS:{target:"open"}},states:{closed:{entry:[An((e=>({...e,id:null})))],on:{OPEN:{target:"opening"}}},opening:{entry:[(e,t,n)=>{const i=t.delayDuration,o=()=>n({type:"DELAY_TIMER_END"});void 0===i?o():pn=window.setTimeout(o,i)},bn,An((e=>({...e,delayed:!0})))],exit:[()=>clearTimeout(pn)],on:{DELAY_TIMER_END:{target:"open"},CLOSE:{target:"closed"}}},open:{entry:[bn],exit:[An((e=>({...e,delayed:!1})))],on:{OPEN:{target:"open"},CLOSE:{target:"closing",cond:(e,t)=>e.id===t.id}}},closing:{entry:[(e,t,n)=>{var i;const o=null!==(i=t.skipDelayDuration)&&void 0!==i?i:300;mn=window.setTimeout((()=>n({type:"SKIP_DELAY_TIMER_END"})),o)}],exit:[()=>clearTimeout(mn)],on:{OPEN:{target:"open"},SKIP_DELAY_TIMER_END:{target:"closed"}}}}}),[yn,Gn]=Jt("Tooltip"),vn="button",Bn=i.forwardRef(((e,t)=>{const{as:n=vn,...r}=e,a=Gn("TooltipTrigger"),g=Xt(t,(e=>a.onTriggerChange(e)));return i.createElement(ln,(0,o.Z)({type:"button","aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute},r,{as:n,ref:g,onMouseEnter:Ht(e.onMouseEnter,a.onOpen),onMouseLeave:Ht(e.onMouseLeave,a.onClose),onMouseDown:Ht(e.onMouseDown,a.onClose),onFocus:Ht(e.onFocus,a.onFocus),onBlur:Ht(e.onBlur,a.onClose),onKeyDown:Ht(e.onKeyDown,(e=>{"Enter"!==e.key&&" "!==e.key||a.onClose()}))}))})),Zn=i.forwardRef(((e,t)=>{const{forceMount:n,...r}=e,a=Gn("TooltipContent");return i.createElement(Cn,{present:n||a.open},i.createElement(wn,(0,o.Z)({ref:t},r)))})),wn=i.forwardRef(((e,t)=>{const{children:n,"aria-label":r,portalled:a=!0,...g}=e,s=Gn("TooltipContent"),c=a?l:i.Fragment;return function(e){const t=hn(e);i.useEffect((()=>{const e=e=>{"Escape"===e.key&&t(e)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[t])}((()=>s.onClose())),i.createElement(c,null,i.createElement(Sn,null),i.createElement(cn,(0,o.Z)({"data-state":s.stateAttribute},g,{ref:t,style:{...g.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)"}}),i.createElement(Nt,null,n),i.createElement(Vt,{id:s.contentId,role:"tooltip"},r||n)))})),Wn=function(e,t){const n=i.forwardRef(((n,r)=>{const a=e,g={...t.defaultProps,...n};return i.createElement(a,(0,o.Z)({},g,{ref:r}))}));return n.displayName=t.displayName||"Extended"+e.displayName,n}(In,{displayName:"TooltipArrow"});function Sn(){const e=Gn("CheckTriggerMoved"),t=_t(e.trigger),n=null==t?void 0:t.left,o=dn(n),r=null==t?void 0:t.top,a=dn(r),g=e.onClose;return i.useEffect((()=>{(void 0!==o&&o!==n||void 0!==a&&a!==r)&&g()}),[g,o,a,n,r]),null}const Rn=e=>{const{children:t,open:n,defaultOpen:o=!1,onOpenChange:r,delayDuration:a=700,skipDelayDuration:s=300}=e,[l,c]=i.useState(null),I=function(e){const t=i.useContext(St);return Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)||t!==Wt||console.warn("When server rendering, you must wrap your application in an <IdProvider> to ensure consistent ids are generated between the client and server."),i.useMemo((()=>e||`radix-id-${t.prefix}-${++t.current}`),[e])}(),[C=!1,u]=function({prop:e,defaultProp:t,onChange:n=(()=>{})}){const[o,r]=function({defaultProp:e,onChange:t}){const n=i.useState(e),[o]=n,r=i.useRef(o),a=hn(t);return i.useEffect((()=>{r.current!==o&&(a(o),r.current=o)}),[o,r,a]),n}({defaultProp:t,onChange:n}),a=void 0!==e,g=a?e:o,s=hn(n);return[g,i.useCallback((t=>{if(a){const n=t,i="function"==typeof t?n(e):t;i!==e&&s(i)}else r(t)}),[a,e,r,s])]}({prop:n,defaultProp:o,onChange:r}),[d,h]=i.useState(n?"instant-open":"closed");i.useEffect((()=>fn.subscribe((({state:e,context:t})=>{"open"===e&&t.id===I?u(!0):u(!1)}))),[I,u]),i.useEffect((()=>fn.subscribe((({state:e,context:t})=>{t.id===I?h("open"===e?t.delayed?"delayed-open":"instant-open":"closed"):h("closed")}))),[I]);const A=i.useCallback((()=>fn.send({type:"FOCUS",id:I})),[I]),p=i.useCallback((()=>fn.send({type:"OPEN",id:I,delayDuration:a})),[I,a]),m=i.useCallback((()=>fn.send({type:"CLOSE",id:I,skipDelayDuration:s})),[s,I]);return i.useEffect((()=>()=>m()),[m]),g((()=>{!0===n&&fn.send({type:"OPEN",id:I})}),[I,n]),i.createElement(sn,null,i.createElement(yn,{contentId:I,open:C,stateAttribute:d,trigger:l,onTriggerChange:c,onFocus:A,onOpen:p,onClose:m},t))},Vn=Bn,xn=Zn,Xn=Wn;function Hn(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}let Yn;!function(e){e[e.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",e[e.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",e[e.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",e[e.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",e[e.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",e[e.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",e[e.THEME_ERROR=6]="THEME_ERROR",e[e.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",e[e.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",e[e.EMPTY_KEY=9]="EMPTY_KEY"}(Yn||(Yn={}));const Kn={[Yn.UNSUPPORTED_INPUT]:(e,t)=>[`An input with type \`${e}\` input was found at path \`${t}\` but it's not supported yet.`],[Yn.NO_COMPONENT_FOR_TYPE]:(e,t)=>[`Type \`${e}\` found at path \`${t}\` can't be displayed in panel because no component supports it yet.`],[Yn.UNKNOWN_INPUT]:(e,t)=>[`input at path \`${e}\` is not recognized.`,t],[Yn.DUPLICATE_KEYS]:(e,t,n)=>[`Key \`${e}\` of path \`${t}\` already exists at path \`${n}\`. Even nested keys need to be unique. Rename one of the keys.`],[Yn.ALREADY_REGISTERED_TYPE]:e=>[`Type ${e} has already been registered. You can't register a component with the same type.`],[Yn.CLIPBOARD_ERROR]:e=>["Error copying the value",e],[Yn.THEME_ERROR]:(e,t)=>[`Error accessing the theme \`${e}.${t}\` value.`],[Yn.PATH_DOESNT_EXIST]:e=>[`Error getting the value at path \`${e}\`. There is probably an error in your \`render\` function.`],[Yn.PATH_DOESNT_EXIST]:e=>[`Error accessing the value at path \`${e}\``],[Yn.INPUT_TYPE_OVERRIDE]:(e,t,n)=>[`Input at path \`${e}\` already exists with type: \`${t}\`. Its type cannot be overridden with type \`${n}\`.`],[Yn.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function Nn(e,t,...n){const[i,...o]=Kn[t](...n);console[e]("LEVA: "+i,...o)}const Mn=Nn.bind(null,"warn"),Fn=Nn.bind(null,"log"),zn=["value"],Ln=["schema"],kn=["value"],En=[],Tn={};function Un(e){let{value:t}=e,n=Hn(e,zn);for(let i of En){const e=i(t,n);if(e)return e}}function _n(e,t){let{schema:n}=t,i=Hn(t,Ln);e in Tn?Mn(Yn.ALREADY_REGISTERED_TYPE,e):(En.push(((t,i)=>n(t,i)&&e)),Tn[e]=i)}function Jn(e,t,n,i){const{normalize:o}=Tn[e];if(o)return o(t,n,i);if("object"!=typeof t||!("value"in t))return{value:t};const{value:r}=t;return{value:r,settings:Hn(t,kn)}}function Dn(e,t,n){const{format:i}=Tn[e];return i?i(t,n):t}function Pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function On(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(n),!0).forEach((function(t){Pn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const jn=(e,t,n)=>e>n?n:e<t?t:e,qn=e=>{if(""===e||"number"==typeof e)return e;try{const t=li(e);if(!isNaN(t))return t}catch(t){}return parseFloat(e)},$n=Math.log(10);function ei(e){let t=Math.abs(+String(e).replace(".",""));if(0===t)return.01;for(;0!==t&&t%10==0;)t/=10;const n=Math.floor(Math.log(t)/$n)+1,i=Math.floor(Math.log10(Math.abs(e))),o=Math.pow(10,i-n);return Math.max(o,.001)}const ti=(e,t,n)=>n===t?0:(e-t)/(n-t),ni=(e,t,n)=>e*(n-t)+t,ii=/\(([0-9+\-*/^ .]+)\)/,oi=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,ri=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,ai=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,gi=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,si=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function li(e){if(isNaN(Number(e))){if(ii.test(e)){const t=e.replace(ii,((e,t)=>String(li(t))));return li(t)}if(oi.test(e)){return li(e.replace(oi,((e,t,n)=>String(Math.pow(Number(t),Number(n))))))}if(ri.test(e)){return li(e.replace(ri,((e,t,n)=>String(Number(t)*Number(n)))))}if(ai.test(e)){return li(e.replace(ai,((e,t,n)=>{if(0!=n)return String(Number(t)/Number(n));throw new Error("Division by zero")})))}if(gi.test(e)){return li(e.replace(gi,((e,t,n)=>String(Number(t)+Number(n)))))}if(si.test(e)){return li(e.replace(si,((e,t,n)=>String(Number(t)-Number(n)))))}return Number(e)}return Number(e)}let ci,Ii;!function(e){e.BUTTON="BUTTON",e.BUTTON_GROUP="BUTTON_GROUP",e.MONITOR="MONITOR",e.FOLDER="FOLDER"}(ci||(ci={})),function(e){e.SELECT="SELECT",e.IMAGE="IMAGE",e.NUMBER="NUMBER",e.COLOR="COLOR",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.INTERVAL="INTERVAL",e.VECTOR3D="VECTOR3D",e.VECTOR2D="VECTOR2D"}(Ii||(Ii={}));const Ci=["type","__customInput"],ui=["render","label","optional","disabled","hint","onChange","onEditStart","onEditEnd","transient"],di=["type"];function hi(e,t,n={},i){if("object"!=typeof e||Array.isArray(e))return{type:i,input:e,options:On({key:t,label:t,optional:!1,disabled:!1},n)};if("__customInput"in e){const{type:n,__customInput:i}=e;return hi(i,t,Hn(e,Ci),n)}const{render:o,label:r,optional:a,disabled:g,hint:s,onChange:l,onEditStart:c,onEditEnd:I,transient:C}=e,u=Hn(e,ui),d=On({render:o,key:t,label:null!=r?r:t,hint:s,transient:null!=C?C:!!l,onEditStart:c,onEditEnd:I},n);let{type:h}=u,A=Hn(u,di);return h=null!=i?i:h,h in ci?{type:h,input:A,options:d}:{type:h,input:A,options:On(On({},d),{},{onChange:l,optional:null!=a&&a,disabled:null!=g&&g})}}function Ai(e,t,n,i){const o=hi(e,t),{type:r,input:a,options:g}=o;if(r)return r in ci?o:{type:r,input:Jn(r,a,n,i),options:g};let s=Un(a);return s?{type:s,input:Jn(s,a,n,i),options:g}:(s=Un({value:a}),!!s&&{type:s,input:Jn(s,{value:a},n,i),options:g})}function pi(e,t,n,i,o){const{value:r,type:a,settings:g}=e;e.value=bi({type:a,value:r,settings:g},t,n,i),e.fromPanel=o}const mi=function(e,t,n){this.type="LEVA_ERROR",this.message="LEVA: "+e,this.previousValue=t,this.error=n};function bi({type:e,value:t,settings:n},i,o,r){const a="SELECT"!==e&&"function"==typeof i?i(t):i;let g;try{g=function(e,t,n,i,o,r){const{sanitize:a}=Tn[e];return a?a(t,n,i,o,r):t}(e,a,n,t,o,r)}catch(s){throw new mi(`The value \`${i}\` did not result in a correct value.`,t,s)}if(C(g,t))throw new mi(`The value \`${i}\` did not result in a value update, which remained the same: \`${t}\`.\n        You can ignore this warning if this is the intended behavior.`,t);return g}const fi=(e,t,n=!1)=>{let i=0;return function(){const o=arguments,r=n&&!i,a=()=>e.apply(this,o);window.clearTimeout(i),i=window.setTimeout(a,t),r&&a()}},yi=e=>e.shiftKey?5:e.altKey?.2:1,Gi=["value"],vi=["min","max"],Bi=(e,{min:t=-1/0,max:n=1/0,suffix:i})=>{const o=parseFloat(e);if(""===e||isNaN(o))throw Error("Invalid number");const r=jn(o,t,n);return i?r+i:r},Zi=e=>{let{value:t}=e,n=Hn(e,Gi);const{min:i=-1/0,max:o=1/0}=n,r=Hn(n,vi),a=jn(parseFloat(t),i,o);let g;if(!Number.isFinite(t)){const e=String(t).match(/[A-Z]+/i);e&&(g=e[0])}let s=n.step;s||(Number.isFinite(i)?s=Number.isFinite(o)?+(Math.abs(o-i)/100).toPrecision(1):+(Math.abs(a-i)/100).toPrecision(1):Number.isFinite(o)&&(s=+(Math.abs(o-a)/100).toPrecision(1)));const l=s?10*ei(s):ei(a);s=s||l/10;return{value:a,settings:On({initialValue:a,step:s,pad:Math.round(jn(Math.log10(1/l),0,2)),min:i,max:o,suffix:g},r)}},wi=(e,{step:t,initialValue:n})=>n+Math.round((e-n)/t)*t;var Wi=Object.freeze({__proto__:null,schema:e=>"number"==typeof e||"string"==typeof e&&!isNaN(parseFloat(e)),sanitize:Bi,format:(e,{pad:t=0,suffix:n})=>{const i=parseFloat(e).toFixed(t);return n?i+n:i},normalize:Zi,sanitizeStep:wi});function Si(){return(Si=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const Ri=(0,i.createContext)({});function Vi(){return(0,i.useContext)(Ri)}const xi=(0,i.createContext)(null),Xi=(0,i.createContext)(null),Hi=(0,i.createContext)(null);function Yi(){return(0,i.useContext)(Xi)}function Ki(e,t){const[n,i]=e.split(" "),o={};return"none"!==n&&(o.boxShadow=`${t.inset?"inset ":""}0 0 0 $borderWidths${[t.key]} $colors${"default"!==n&&n||t.borderColor}`),i&&(o.backgroundColor=i||t.backgroundColor),o}const Ni={$inputStyle:()=>e=>Ki(e,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>e=>Ki(e,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>e=>Ki(e,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>e=>Ki(e,{key:"$active",borderColor:"$accent1",inset:!0})},{styled:Mi,css:Fi,theme:zi,global:Li,keyframes:ki}=pe({insertionMethod(){let e=null,t=null;return n=>{"object"==typeof document&&(e||(e=document.head||document.documentElement),t||(t=document.getElementById("leva__stitches")||Object.assign(document.createElement("style"),{id:"leva__stitches"})),t.parentNode||e.append(t),t.textContent=n)}},prefix:"leva",theme:{colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}},utils:On(On({},Ni),{},{$flex:()=>()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:()=>e=>({"&:focus":Ni.$focusStyle()(e)}),$focusWithin:()=>e=>({"&:focus-within":Ni.$focusStyle()(e)}),$hover:()=>e=>({"&:hover":Ni.$hoverStyle()(e)}),$active:()=>e=>({"&:active":Ni.$activeStyle()(e)})})});function Ei(e){const t={colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}};if(!e)return{theme:t,className:""};Object.keys(e).forEach((n=>{Object.assign(t[n],e[n])}));const n=zi(e).className;return{theme:t,className:n}}function Ti(e,t){const{theme:n}=(0,i.useContext)(xi);return e in n&&t in n[e]?n[e][t]:(Mn(Yn.THEME_ERROR,e,t),"")}Li({".panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}})();const Ui=Mi("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}}}}),_i=Mi("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",[`& + ${Ui}`]:{paddingLeft:0}}),Ji=Mi(_i,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),Di=Mi("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:""}),Pi=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id"],Qi=["onUpdate"];function Oi(e){let{innerLabel:t,value:n,onUpdate:o,onChange:r,onKeyDown:a,type:g,id:s}=e,l=Hn(e,Pi);const{id:c,emitOnEditStart:I,emitOnEditEnd:C}=Vi(),u=s||c,d=(0,i.useRef)(null),h=(0,i.useCallback)((e=>t=>{const n=t.currentTarget.value;e(n)}),[]);i.useEffect((()=>{const e=d.current,t=h((e=>{o(e),C()}));return null==e||e.addEventListener("blur",t),()=>null==e?void 0:e.removeEventListener("blur",t)}),[h,o,C]);const A=(0,i.useCallback)((e=>{"Enter"===e.key&&h(o)(e)}),[h,o]);return i.createElement(Di,null,t&&"string"==typeof t?i.createElement(_i,null,t):t,i.createElement(Ui,Si({levaType:g,ref:d,id:u,type:"text",autoComplete:"off",spellCheck:"false",value:n,onChange:h(r),onFocus:()=>I(),onKeyPress:A,onKeyDown:a},l)))}function ji(e){let{onUpdate:t}=e,n=Hn(e,Qi);const o=(0,i.useCallback)((e=>t(qn(e))),[t]),r=(0,i.useCallback)((e=>{const n="ArrowUp"===e.key?1:"ArrowDown"===e.key?-1:0;if(n){e.preventDefault();const i=e.altKey?.1:e.shiftKey?10:1;t((e=>parseFloat(e)+n*i))}}),[t]);return i.createElement(Oi,Si({},n,{onUpdate:o,onKeyDown:r,type:"number"}))}const qi=Mi("div",{}),$i=Mi("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$elevation3",transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),eo=Mi("div",{$flex:"",color:"$highlight3",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$highlight1"},"&:hover > svg":{fill:"$highlight2"},[`&:hover + ${$i}::after`]:{backgroundColor:"$highlight2"},[`${qi}:hover > & + ${$i}::after`]:{backgroundColor:"$highlight1"},[`${qi}:hover > & > svg`]:{fill:"$highlight1"}}),to=Mi("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${qi}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),no=Mi("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${to} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},"&:hover,&:focus-within":{color:"$highlight3"}}),io=Mi(no,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),oo=Mi("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),ro=Mi("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),ao=Mi("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none"}}}}),go=Mi("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),so=Mi("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3}),lo=Mi("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),co=Mi(Xn,{fill:"$toolTipBackground"});function Io({children:e}){const{className:t}=(0,i.useContext)(xi);return i.createElement(c,{className:t},e)}const Co=["align"];function uo(){const{id:e,disable:t,disabled:n}=Vi();return i.createElement(i.Fragment,null,i.createElement(ro,{id:e+"__disable",type:"checkbox",checked:!n,onChange:()=>t(!n)}),i.createElement("label",{htmlFor:e+"__disable"}))}function ho(e){const{id:t,optional:n,hint:o}=Vi(),r=e.htmlFor||(t?{htmlFor:t}:null);return i.createElement(i.Fragment,null,n&&i.createElement(uo,null),void 0!==o?i.createElement(Rn,null,i.createElement(Vn,Si({as:go},r,e)),i.createElement(xn,{side:"top",sideOffset:2},i.createElement(lo,null,o,i.createElement(co,null)))):i.createElement(go,Si({},r,e)))}function Ao(e){let{align:t}=e,n=Hn(e,Co);const{value:o,label:r,key:a}=Vi(),{hideCopyButton:g}=(0,i.useContext)(Hi),s=!g&&void 0!==a,[l,c]=(0,i.useState)(!1);return i.createElement(oo,{align:t,onPointerLeave:()=>c(!1)},i.createElement(ho,n),s&&i.createElement("div",{title:`Click to copy ${"string"==typeof r?r:a} value`},l?i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},i.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),i.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):i.createElement("svg",{onClick:async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[a]:null!=o?o:""})),c(!0)}catch(e){Mn(Yn.CLIPBOARD_ERROR,{[a]:o})}},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},i.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),i.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const po=["toggled"],mo=Mi("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function bo(e){let{toggled:t}=e,n=Hn(e,po);return i.createElement(mo,Si({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${t?0:-90}deg)`}},n),i.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const fo=["input"];function yo(e){let{input:t}=e,n=Hn(e,fo);return t?i.createElement(io,n):i.createElement(no,n)}function Go({value:e,type:t,settings:n,setValue:o}){const[r,a]=(0,i.useState)(Dn(t,e,n)),g=(0,i.useRef)(e),s=(0,i.useRef)(n);s.current=n;const l=(0,i.useCallback)((e=>a(Dn(t,e,s.current))),[t]),c=(0,i.useCallback)((e=>{try{o(e)}catch(t){const{type:e,previousValue:n}=t;if("LEVA_ERROR"!==e)throw t;l(n)}}),[l,o]);return(0,i.useEffect)((()=>{C(e,g.current)||l(e),g.current=e}),[e,l]),{displayValue:r,onChange:a,onUpdate:c}}function vo(e,t){const{emitOnEditStart:n,emitOnEditEnd:i}=Vi();return wt((t=>{t.first&&(document.body.classList.add("panel__dragged"),n());const o=e(t);return t.last&&(document.body.classList.remove("panel__dragged"),i()),o}),t)}function Bo(){const e=(0,i.useRef)(null),t=(0,i.useRef)({x:0,y:0}),n=(0,i.useCallback)((n=>{Object.assign(t.current,n),e.current&&(e.current.style.transform=`translate3d(${t.current.x}px, ${t.current.y}px, 0)`)}),[]);return[e,n]}const Zo=["__refCount"],wo=(e,t)=>{if(!e[t])return null;return Hn(e[t],Zo)};const Wo=Mi("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),So=Mi("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),Ro=Mi("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),Vo=Mi("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),xo=Mi("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function Xo({value:e,min:t,max:n,onDrag:o,step:r,initialValue:a}){const g=(0,i.useRef)(null),s=(0,i.useRef)(null),l=(0,i.useRef)(0),c=Ti("sizes","scrubberWidth"),I=vo((({event:i,first:I,xy:[C],movement:[u],memo:d})=>{if(I){const{width:o,left:r}=g.current.getBoundingClientRect();l.current=o-parseFloat(c);d=(null==i?void 0:i.target)===s.current?e:ni((C-r)/o,t,n)}const h=d+ni(u/l.current,0,n-t);return o(wi(h,{step:r,initialValue:a})),d})),C=ti(e,t,n);return i.createElement(Vo,Si({ref:g},I()),i.createElement(So,null,i.createElement(xo,{style:{left:0,right:100*(1-C)+"%"}})),i.createElement(Ro,{ref:s,style:{left:`calc(${C} * (100% - ${c}))`}}))}const Ho=i.memo((({label:e,onUpdate:t,step:n,innerLabelTrim:o})=>{const[r,a]=(0,i.useState)(!1),g=vo((({active:e,delta:[i],event:o,memo:r=0})=>(a(e),r+=i/2,Math.abs(r)>=1&&(t((e=>parseFloat(e)+Math.floor(r)*n*yi(o))),r=0),r)));return i.createElement(Ji,Si({dragging:r,title:e.length>1?e:""},g()),e.slice(0,o))}));function Yo({label:e,id:t,displayValue:n,onUpdate:o,onChange:r,settings:a,innerLabelTrim:g=1}){const s=g>0&&i.createElement(Ho,{label:e,step:a.step,onUpdate:o,innerLabelTrim:g});return i.createElement(ji,{id:t,value:String(n),onUpdate:o,onChange:r,innerLabel:s})}const{sanitizeStep:Ko}=Wi;var No=On({component:function(){const e=Vi(),{label:t,value:n,onUpdate:o,settings:r,id:a}=e,{min:g,max:s}=r,l=s!==1/0&&g!==-1/0;return i.createElement(yo,{input:!0},i.createElement(Ao,null,t),i.createElement(Wo,{hasRange:l},l&&i.createElement(Xo,Si({value:parseFloat(n),onDrag:o},r)),i.createElement(Yo,Si({},e,{id:a,label:"value",innerLabelTrim:l?0:1}))))}},Hn(Wi,["sanitizeStep"]));var Mo=Object.freeze({__proto__:null,schema:(e,t)=>H().schema({options:H().passesAnyOf(H().object(),H().array())}).test(t),sanitize:(e,{values:t})=>{if(t.indexOf(e)<0)throw Error("Selected value doesn't match Select options");return e},format:(e,{values:t})=>t.indexOf(e),normalize:e=>{let t,n,{value:i,options:o}=e;return Array.isArray(o)?(n=o,t=o.map((e=>String(e)))):(n=Object.values(o),t=Object.keys(o)),"value"in e?n.includes(i)||(t.unshift(String(i)),n.unshift(i)):i=n[0],Object.values(o).includes(i)||(o[String(i)]=i),{value:i,settings:{keys:t,values:n}}}});const Fo=Mi("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),zo=Mi("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),Lo=Mi("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${zo}:focus + &`]:{$focusStyle:""},[`${zo}:hover + &`]:{$hoverStyle:""}});function ko({displayValue:e,value:t,onUpdate:n,id:o,settings:r}){const{keys:a,values:g}=r,s=(0,i.useRef)();return t===g[e]&&(s.current=a[e]),i.createElement(Fo,null,i.createElement(zo,{id:o,value:e,onChange:e=>n(g[Number(e.currentTarget.value)])},a.map(((e,t)=>i.createElement("option",{key:e,value:t},e)))),i.createElement(Lo,null,s.current),i.createElement(bo,{toggled:!0}))}var Eo=On({component:function(){const{label:e,value:t,displayValue:n,onUpdate:o,id:r,settings:a}=Vi();return i.createElement(yo,{input:!0},i.createElement(Ao,null,e),i.createElement(ko,{id:r,value:t,displayValue:n,onUpdate:o,settings:a}))}},Mo);const To=["displayValue","onUpdate","onChange"];function Uo(e){let{displayValue:t,onUpdate:n,onChange:o}=e,r=Hn(e,To);return i.createElement(Oi,Si({value:t,onUpdate:n,onChange:o},r))}var _o=On({component:function(){const{label:e,displayValue:t,onUpdate:n,onChange:o}=Vi();return i.createElement(yo,{input:!0},i.createElement(Ao,null,e),i.createElement(Uo,{displayValue:t,onUpdate:n,onChange:o}))}},Object.freeze({__proto__:null,schema:e=>H().string().test(e),sanitize:e=>{if("string"!=typeof e)throw Error("Invalid string");return e}}));var Jo=Object.freeze({__proto__:null,schema:e=>H().boolean().test(e),sanitize:e=>{if("boolean"!=typeof e)throw Error("Invalid boolean");return e}});const Do=Mi("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function Po({value:e,onUpdate:t,id:n}){return i.createElement(Do,null,i.createElement("input",{id:n,type:"checkbox",checked:e,onChange:e=>t(e.currentTarget.checked)}),i.createElement("label",{htmlFor:n},i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}var Qo=On({component:function(){const{label:e,value:t,onUpdate:n,id:o}=Vi();return i.createElement(yo,{input:!0},i.createElement(Ao,null,e),i.createElement(Po,{value:t,onUpdate:n,id:o}))}},Jo);const Oo=["locked"];function jo({value:e,id:t,valueKey:n,settings:o,onUpdate:r,innerLabelTrim:a}){const g=(0,i.useRef)(e[n]);g.current=e[n];const s=(0,i.useCallback)((e=>r({[n]:bi({type:"NUMBER",value:g.current,settings:o},e)})),[r,o,n]),l=Go({type:"NUMBER",value:e[n],settings:o,setValue:s});return i.createElement(Yo,{id:t,label:n,value:e[n],displayValue:l.displayValue,onUpdate:l.onUpdate,onChange:l.onChange,settings:o,innerLabelTrim:a})}const qo=Mi("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function $o(e){let{locked:t}=e,n=Hn(e,Oo);return i.createElement("svg",Si({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),t?i.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):i.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function er({value:e,onUpdate:t,settings:n,innerLabelTrim:o}){const{id:r,setSettings:a}=Vi(),{lock:g,locked:s}=n;return i.createElement(qo,{withLock:g},g&&i.createElement($o,{locked:s,onClick:()=>a({locked:!s})}),Object.keys(e).map(((a,g)=>i.createElement(jo,{id:0===g?r:`${r}.${a}`,key:a,valueKey:a,value:e,settings:n[a],onUpdate:t,innerLabelTrim:o}))))}const tr=(e,t)=>{const n={};let i=0,o=1/0;Object.entries(e).forEach((([e,r])=>{n[e]=Zi(On({value:r},t[e])).settings,i=Math.max(i,n[e].step),o=Math.min(o,n[e].pad)}));for(let r in n){const{step:e,min:a,max:g}=t[r]||{};isFinite(e)||isFinite(a)&&isFinite(g)||(n[r].step=i,n[r].pad=o)}return n},nr=["lock"],ir=["value"];function or(e){const t=H().array().length(e).every.number();return n=>t.test(n)||(t=>{if(!t||"object"!=typeof t)return!1;const n=Object.values(t);return n.length===e&&n.every((e=>isFinite(e)))})(n)}function rr(e,t,n){return function(e){return Array.isArray(e)?"array":"object"}(e)===t?e:"array"===t?Object.values(e):function(e,t){return e.reduce(((e,n,i)=>Object.assign(e,{[t[i]]:n})),{})}(e,n)}function ar(e){return{schema:or(e.length),normalize:t=>{let{value:n}=t;return function(e,t,n=[]){const{lock:i=!1}=t,o=Hn(t,nr),r=Array.isArray(e)?"array":"object",a="object"===r?Object.keys(e):n,g=rr(e,"object",a),s=(e=>!!e&&("step"in e||"min"in e||"max"in e))(o)?a.reduce(((e,t)=>Object.assign(e,{[t]:o})),{}):o;return{value:"array"===r?e:g,settings:On(On({},tr(g,s)),{},{format:r,keys:a,lock:i,locked:!1})}}(n,Hn(t,ir),e)},format:(e,t)=>((e,t)=>rr(e,"object",t.keys))(e,t),sanitize:(e,t,n)=>((e,t,n)=>{const i=rr(e,"object",t.keys);for(let a in i)i[a]=Bi(i[a],t[a]);const o=Object.keys(i);let r={};if(o.length===t.keys.length)r=i;else{const e=rr(n,"object",t.keys);if(1===o.length&&t.locked){const t=o[0],n=i[t],a=e[t],g=0!==a?n/a:1;for(let i in e)i===t?r[t]=n:r[i]=e[i]*g}else r=On(On({},e),i)}return rr(r,t.format,t.keys)})(e,t,n)}}var gr=n(8621),sr=n.n(gr);function lr(){return(lr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function cr(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t.indexOf(n=r[i])>=0||(o[n]=e[n]);return o}var Ir="undefined"!=typeof window?i.useLayoutEffect:i.useEffect;function Cr(e){var t=(0,i.useRef)(e);return(0,i.useEffect)((function(){t.current=e})),(0,i.useCallback)((function(e){return t.current&&t.current(e)}),[])}var ur,dr=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),e>n?n:e<t?t:e},hr=function(e){return"touches"in e},Ar=function(e,t){var n=e.getBoundingClientRect(),i=hr(t)?t.touches[0]:t;return{left:dr((i.pageX-(n.left+window.pageXOffset))/n.width),top:dr((i.pageY-(n.top+window.pageYOffset))/n.height)}},pr=function(e){!hr(e)&&e.preventDefault()},mr=i.memo((function(e){var t=e.onMove,n=e.onKey,o=cr(e,["onMove","onKey"]),r=(0,i.useRef)(null),a=(0,i.useRef)(!1),g=(0,i.useState)(!1),s=g[0],l=g[1],c=Cr(t),I=Cr(n),C=(0,i.useCallback)((function(e){pr(e),(hr(e)?e.touches.length>0:e.buttons>0)&&r.current?c(Ar(r.current,e)):l(!1)}),[c]),u=(0,i.useCallback)((function(e){var t,n=e.nativeEvent;pr(n),t=n,a.current&&!hr(t)||(a.current||(a.current=hr(t)),0)||(c(Ar(r.current,n)),l(!0))}),[c]),d=(0,i.useCallback)((function(e){var t=e.which||e.keyCode;t<37||t>40||(e.preventDefault(),I({left:39===t?.05:37===t?-.05:0,top:40===t?.05:38===t?-.05:0}))}),[I]),h=(0,i.useCallback)((function(){return l(!1)}),[]),A=(0,i.useCallback)((function(e){var t=e?window.addEventListener:window.removeEventListener;t(a.current?"touchmove":"mousemove",C),t(a.current?"touchend":"mouseup",h)}),[C,h]);return Ir((function(){return A(s),function(){s&&A(!1)}}),[s,A]),i.createElement("div",lr({},o,{className:"react-colorful__interactive",ref:r,onTouchStart:u,onMouseDown:u,onKeyDown:d,tabIndex:0,role:"slider"}))})),br=function(e){return e.filter(Boolean).join(" ")},fr=function(e){var t=e.color,n=e.left,o=e.top,r=void 0===o?.5:o,a=br(["react-colorful__pointer",e.className]);return i.createElement("div",{className:a,style:{top:100*r+"%",left:100*n+"%"}},i.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},yr=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*e)/n},Gr=(Math.PI,function(e){var t=e.s,n=e.v,i=e.a,o=(200-t)*n/100;return{h:yr(e.h),s:yr(o>0&&o<200?t*n/100/(o<=100?o:200-o)*100:0),l:yr(o/2),a:yr(i,2)}}),vr=function(e){var t=Gr(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},Br=function(e){var t=Gr(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},Zr=function(e){var t=e.h,n=e.s,i=e.v,o=e.a;t=t/360*6,n/=100,i/=100;var r=Math.floor(t),a=i*(1-n),g=i*(1-(t-r)*n),s=i*(1-(1-t+r)*n),l=r%6;return{r:yr(255*[i,g,a,a,s,i][l]),g:yr(255*[s,i,i,g,a,a][l]),b:yr(255*[a,a,s,i,i,g][l]),a:yr(o,2)}},wr=function(e){var t=e.r,n=e.g,i=e.b,o=e.a,r=Math.max(t,n,i),a=r-Math.min(t,n,i),g=a?r===t?(n-i)/a:r===n?2+(i-t)/a:4+(t-n)/a:0;return{h:yr(60*(g<0?g+6:g)),s:yr(r?a/r*100:0),v:yr(r/255*100),a:o}},Wr=i.memo((function(e){var t=e.hue,n=e.onChange,o=br(["react-colorful__hue",e.className]);return i.createElement("div",{className:o},i.createElement(mr,{onMove:function(e){n({h:360*e.left})},onKey:function(e){n({h:dr(t+360*e.left,0,360)})},"aria-label":"Hue","aria-valuetext":yr(t)},i.createElement(fr,{className:"react-colorful__hue-pointer",left:t/360,color:vr({h:t,s:100,v:100,a:1})})))})),Sr=i.memo((function(e){var t=e.hsva,n=e.onChange,o={backgroundColor:vr({h:t.h,s:100,v:100,a:1})};return i.createElement("div",{className:"react-colorful__saturation",style:o},i.createElement(mr,{onMove:function(e){n({s:100*e.left,v:100-100*e.top})},onKey:function(e){n({s:dr(t.s+100*e.left,0,100),v:dr(t.v-100*e.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+yr(t.s)+"%, Brightness "+yr(t.v)+"%"},i.createElement(fr,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:vr(t)})))})),Rr=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function Vr(e,t,n){var o=Cr(n),r=(0,i.useState)((function(){return e.toHsva(t)})),a=r[0],g=r[1],s=(0,i.useRef)({color:t,hsva:a});(0,i.useEffect)((function(){if(!e.equal(t,s.current.color)){var n=e.toHsva(t);s.current={hsva:n,color:t},g(n)}}),[t,e]),(0,i.useEffect)((function(){var t;Rr(a,s.current.hsva)||e.equal(t=e.fromHsva(a),s.current.color)||(s.current={hsva:a,color:t},o(t))}),[a,e,o]);var l=(0,i.useCallback)((function(e){g((function(t){return Object.assign({},t,e)}))}),[]);return[a,l]}var xr,Xr=function(){Ir((function(){if("undefined"!=typeof document&&!xr){(xr=document.createElement("style")).innerHTML='.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>\')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}';var e=ur||n.nc;e&&xr.setAttribute("nonce",e),document.head.appendChild(xr)}}),[])},Hr=function(e){var t=e.className,n=e.colorModel,o=e.color,r=void 0===o?n.defaultColor:o,a=e.onChange,g=cr(e,["className","colorModel","color","onChange"]);Xr();var s=Vr(n,r,a),l=s[0],c=s[1],I=br(["react-colorful",t]);return i.createElement("div",lr({},g,{className:I}),i.createElement(Sr,{hsva:l,onChange:c}),i.createElement(Wr,{hue:l.h,onChange:c,className:"react-colorful__last-control"}))},Yr=function(e){var t=e.className,n=e.hsva,o=e.onChange,r={backgroundImage:"linear-gradient(90deg, "+Br(Object.assign({},n,{a:0}))+", "+Br(Object.assign({},n,{a:1}))+")"},a=br(["react-colorful__alpha",t]);return i.createElement("div",{className:a},i.createElement("div",{className:"react-colorful__alpha-gradient",style:r}),i.createElement(mr,{onMove:function(e){o({a:e.left})},onKey:function(e){o({a:dr(n.a+e.left)})},"aria-label":"Alpha","aria-valuetext":yr(100*n.a)+"%"},i.createElement(fr,{className:"react-colorful__alpha-pointer",left:n.a,color:Br(n)})))},Kr=function(e){var t=e.className,n=e.colorModel,o=e.color,r=void 0===o?n.defaultColor:o,a=e.onChange,g=cr(e,["className","colorModel","color","onChange"]);Xr();var s=Vr(n,r,a),l=s[0],c=s[1],I=br(["react-colorful",t]);return i.createElement("div",lr({},g,{className:I}),i.createElement(Sr,{hsva:l,onChange:c}),i.createElement(Wr,{hue:l.h,onChange:c}),i.createElement(Yr,{hsva:l,onChange:c,className:"react-colorful__last-control"}))},Nr={defaultColor:{r:0,g:0,b:0,a:1},toHsva:wr,fromHsva:Zr,equal:Rr},Mr=function(e){return i.createElement(Kr,lr({},e,{colorModel:Nr}))},Fr={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return wr({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=Zr(e)).r,g:t.g,b:t.b};var t},equal:Rr},zr=function(e){return i.createElement(Hr,lr({},e,{colorModel:Fr}))},Lr=n(3980),kr=n.n(Lr),Er=n(5163),Tr=new Map([["avi","video/avi"],["gif","image/gif"],["ico","image/x-icon"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["mkv","video/x-matroska"],["mov","video/quicktime"],["mp4","video/mp4"],["pdf","application/pdf"],["png","image/png"],["zip","application/zip"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]]);function Ur(e,t){var n=function(e){var t=e.name;if(t&&-1!==t.lastIndexOf(".")&&!e.type){var n=t.split(".").pop().toLowerCase(),i=Tr.get(n);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}(e);if("string"!=typeof n.path){var i=e.webkitRelativePath;Object.defineProperty(n,"path",{value:"string"==typeof t?t:"string"==typeof i&&i.length>0?i:e.name,writable:!1,configurable:!1,enumerable:!0})}return n}var _r=[".DS_Store","Thumbs.db"];function Jr(e){return(null!==e.target&&e.target.files?Qr(e.target.files):[]).map((function(e){return Ur(e)}))}function Dr(e,t){return(0,Er.__awaiter)(this,void 0,void 0,(function(){var n;return(0,Er.__generator)(this,(function(i){switch(i.label){case 0:return e.items?(n=Qr(e.items).filter((function(e){return"file"===e.kind})),"drop"!==t?[2,n]:[4,Promise.all(n.map(Or))]):[3,2];case 1:return[2,Pr(jr(i.sent()))];case 2:return[2,Pr(Qr(e.files).map((function(e){return Ur(e)})))]}}))}))}function Pr(e){return e.filter((function(e){return-1===_r.indexOf(e.name)}))}function Qr(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(i)}return t}function Or(e){if("function"!=typeof e.webkitGetAsEntry)return qr(e);var t=e.webkitGetAsEntry();return t&&t.isDirectory?ea(t):qr(e)}function jr(e){return e.reduce((function(e,t){return(0,Er.__spread)(e,Array.isArray(t)?jr(t):[t])}),[])}function qr(e){var t=e.getAsFile();if(!t)return Promise.reject(e+" is not a File");var n=Ur(t);return Promise.resolve(n)}function $r(e){return(0,Er.__awaiter)(this,void 0,void 0,(function(){return(0,Er.__generator)(this,(function(t){return[2,e.isDirectory?ea(e):ta(e)]}))}))}function ea(e){var t=e.createReader();return new Promise((function(e,n){var i=[];!function o(){var r=this;t.readEntries((function(t){return(0,Er.__awaiter)(r,void 0,void 0,(function(){var r,a,g;return(0,Er.__generator)(this,(function(s){switch(s.label){case 0:if(t.length)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return r=s.sent(),e(r),[3,4];case 3:return a=s.sent(),n(a),[3,4];case 4:return[3,6];case 5:g=Promise.all(t.map($r)),i.push(g),o(),s.label=6;case 6:return[2]}}))}))}),(function(e){n(e)}))}()}))}function ta(e){return(0,Er.__awaiter)(this,void 0,void 0,(function(){return(0,Er.__generator)(this,(function(t){return[2,new Promise((function(t,n){e.file((function(n){var i=Ur(n,e.fullPath);t(i)}),(function(e){n(e)}))}))]}))}))}var na=n(387);function ia(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,r=void 0;try{for(var a,g=e[Symbol.iterator]();!(i=(a=g.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(s){o=!0,r=s}finally{try{i||null==g.return||g.return()}finally{if(o)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var ra=function(e){e=Array.isArray(e)&&1===e.length?e[0]:e;var t=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:"file-invalid-type",message:"File type must be ".concat(t)}},aa=function(e){return{code:"file-too-large",message:"File is larger than ".concat(e," bytes")}},ga=function(e){return{code:"file-too-small",message:"File is smaller than ".concat(e," bytes")}},sa={code:"too-many-files",message:"Too many files"};function la(e,t){var n="application/x-moz-file"===e.type||(0,na.Z)(e,t);return[n,n?null:ra(t)]}function ca(e,t,n){if(Ia(e.size))if(Ia(t)&&Ia(n)){if(e.size>n)return[!1,aa(n)];if(e.size<t)return[!1,ga(t)]}else{if(Ia(t)&&e.size<t)return[!1,ga(t)];if(Ia(n)&&e.size>n)return[!1,aa(n)]}return[!0,null]}function Ia(e){return null!=e}function Ca(e){var t=e.files,n=e.accept,i=e.minSize,o=e.maxSize,r=e.multiple,a=e.maxFiles;return!(!r&&t.length>1||r&&a>=1&&t.length>a)&&t.every((function(e){var t=ia(la(e,n),1)[0],r=ia(ca(e,i,o),1)[0];return t&&r}))}function ua(e){return"function"==typeof e.isPropagationStopped?e.isPropagationStopped():void 0!==e.cancelBubble&&e.cancelBubble}function da(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,(function(e){return"Files"===e||"application/x-moz-file"===e})):!!e.target&&!!e.target.files}function ha(e){e.preventDefault()}function Aa(e){return-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident/")}function pa(e){return-1!==e.indexOf("Edge/")}function ma(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return Aa(e)||pa(e)}function ba(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.some((function(t){return!ua(e)&&t&&t.apply(void 0,[e].concat(i)),ua(e)}))}}function fa(e){return function(e){if(Array.isArray(e))return va(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Ga(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ya(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,r=void 0;try{for(var a,g=e[Symbol.iterator]();!(i=(a=g.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(s){o=!0,r=s}finally{try{i||null==g.return||g.return()}finally{if(o)throw r}}return n}(e,t)||Ga(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ga(e,t){if(e){if("string"==typeof e)return va(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?va(e,t):void 0}}function va(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ba(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Za(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ba(Object(n),!0).forEach((function(t){wa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ba(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wa(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Sa=(0,i.forwardRef)((function(e,t){var n=e.children,o=xa(Wa(e,["children"])),r=o.open,a=Wa(o,["open"]);return(0,i.useImperativeHandle)(t,(function(){return{open:r}}),[r]),i.createElement(i.Fragment,null,n(Za(Za({},a),{},{open:r})))}));Sa.displayName="Dropzone";var Ra={disabled:!1,getFilesFromEvent:function(e){return(0,Er.__awaiter)(this,void 0,void 0,(function(){return(0,Er.__generator)(this,(function(t){return[2,(n=e,n.dataTransfer&&e.dataTransfer?Dr(e.dataTransfer,e.type):Jr(e))];var n}))}))},maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null};Sa.defaultProps=Ra,Sa.propTypes={children:kr().func,accept:kr().oneOfType([kr().string,kr().arrayOf(kr().string)]),multiple:kr().bool,preventDropOnDocument:kr().bool,noClick:kr().bool,noKeyboard:kr().bool,noDrag:kr().bool,noDragEventsBubbling:kr().bool,minSize:kr().number,maxSize:kr().number,maxFiles:kr().number,disabled:kr().bool,getFilesFromEvent:kr().func,onFileDialogCancel:kr().func,onDragEnter:kr().func,onDragLeave:kr().func,onDragOver:kr().func,onDrop:kr().func,onDropAccepted:kr().func,onDropRejected:kr().func,validator:kr().func};var Va={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function xa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Za(Za({},Ra),e),n=t.accept,o=t.disabled,r=t.getFilesFromEvent,a=t.maxSize,g=t.minSize,s=t.multiple,l=t.maxFiles,c=t.onDragEnter,I=t.onDragLeave,C=t.onDragOver,u=t.onDrop,d=t.onDropAccepted,h=t.onDropRejected,A=t.onFileDialogCancel,p=t.preventDropOnDocument,m=t.noClick,b=t.noKeyboard,f=t.noDrag,y=t.noDragEventsBubbling,G=t.validator,v=(0,i.useRef)(null),B=(0,i.useRef)(null),Z=(0,i.useReducer)(Xa,Va),w=ya(Z,2),W=w[0],S=w[1],R=W.isFocused,V=W.isFileDialogActive,x=W.draggedFiles,X=(0,i.useCallback)((function(){B.current&&(S({type:"openDialog"}),B.current.value=null,B.current.click())}),[S]),H=function(){V&&setTimeout((function(){B.current&&(B.current.files.length||(S({type:"closeDialog"}),"function"==typeof A&&A()))}),300)};(0,i.useEffect)((function(){return window.addEventListener("focus",H,!1),function(){window.removeEventListener("focus",H,!1)}}),[B,V,A]);var Y=(0,i.useCallback)((function(e){v.current&&v.current.isEqualNode(e.target)&&(32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),X()))}),[v,B]),K=(0,i.useCallback)((function(){S({type:"focus"})}),[]),N=(0,i.useCallback)((function(){S({type:"blur"})}),[]),M=(0,i.useCallback)((function(){m||(ma()?setTimeout(X,0):X())}),[B,m]),F=(0,i.useRef)([]),z=function(e){v.current&&v.current.contains(e.target)||(e.preventDefault(),F.current=[])};(0,i.useEffect)((function(){return p&&(document.addEventListener("dragover",ha,!1),document.addEventListener("drop",z,!1)),function(){p&&(document.removeEventListener("dragover",ha),document.removeEventListener("drop",z))}}),[v,p]);var L=(0,i.useCallback)((function(e){e.preventDefault(),e.persist(),D(e),F.current=[].concat(fa(F.current),[e.target]),da(e)&&Promise.resolve(r(e)).then((function(t){ua(e)&&!y||(S({draggedFiles:t,isDragActive:!0,type:"setDraggedFiles"}),c&&c(e))}))}),[r,c,y]),k=(0,i.useCallback)((function(e){e.preventDefault(),e.persist(),D(e);var t=da(e);if(t&&e.dataTransfer)try{e.dataTransfer.dropEffect="copy"}catch(n){}return t&&C&&C(e),!1}),[C,y]),E=(0,i.useCallback)((function(e){e.preventDefault(),e.persist(),D(e);var t=F.current.filter((function(e){return v.current&&v.current.contains(e)})),n=t.indexOf(e.target);-1!==n&&t.splice(n,1),F.current=t,t.length>0||(S({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),da(e)&&I&&I(e))}),[v,I,y]),T=(0,i.useCallback)((function(e){e.preventDefault(),e.persist(),D(e),F.current=[],da(e)&&Promise.resolve(r(e)).then((function(t){if(!ua(e)||y){var i=[],o=[];t.forEach((function(e){var t=ya(la(e,n),2),r=t[0],s=t[1],l=ya(ca(e,g,a),2),c=l[0],I=l[1],C=G?G(e):null;if(r&&c&&!C)i.push(e);else{var u=[s,I];C&&(u=u.concat(C)),o.push({file:e,errors:u.filter((function(e){return e}))})}})),(!s&&i.length>1||s&&l>=1&&i.length>l)&&(i.forEach((function(e){o.push({file:e,errors:[sa]})})),i.splice(0)),S({acceptedFiles:i,fileRejections:o,type:"setFiles"}),u&&u(i,o,e),o.length>0&&h&&h(o,e),i.length>0&&d&&d(i,e)}})),S({type:"reset"})}),[s,n,g,a,l,r,u,d,h,y]),U=function(e){return o?null:e},_=function(e){return b?null:U(e)},J=function(e){return f?null:U(e)},D=function(e){y&&e.stopPropagation()},P=(0,i.useMemo)((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,n=void 0===t?"ref":t,i=e.onKeyDown,r=e.onFocus,a=e.onBlur,g=e.onClick,s=e.onDragEnter,l=e.onDragOver,c=e.onDragLeave,I=e.onDrop,C=Wa(e,["refKey","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"]);return Za(Za(wa({onKeyDown:_(ba(i,Y)),onFocus:_(ba(r,K)),onBlur:_(ba(a,N)),onClick:U(ba(g,M)),onDragEnter:J(ba(s,L)),onDragOver:J(ba(l,k)),onDragLeave:J(ba(c,E)),onDrop:J(ba(I,T))},n,v),o||b?{}:{tabIndex:0}),C)}}),[v,Y,K,N,M,L,k,E,T,b,f,o]),Q=(0,i.useCallback)((function(e){e.stopPropagation()}),[]),O=(0,i.useMemo)((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.refKey,i=void 0===t?"ref":t,o=e.onChange,r=e.onClick,a=Wa(e,["refKey","onChange","onClick"]),g=wa({accept:n,multiple:s,type:"file",style:{display:"none"},onChange:U(ba(o,T)),onClick:U(ba(r,Q)),autoComplete:"off",tabIndex:-1},i,B);return Za(Za({},g),a)}}),[B,n,s,T,o]),j=x.length,q=j>0&&Ca({files:x,accept:n,minSize:g,maxSize:a,multiple:s,maxFiles:l}),$=j>0&&!q;return Za(Za({},W),{},{isDragAccept:q,isDragReject:$,isFocused:R&&!o,getRootProps:P,getInputProps:O,rootRef:v,inputRef:B,open:U(X)})}function Xa(e,t){switch(t.type){case"focus":return Za(Za({},e),{},{isFocused:!0});case"blur":return Za(Za({},e),{},{isFocused:!1});case"openDialog":return Za(Za({},e),{},{isFileDialogActive:!0});case"closeDialog":return Za(Za({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":var n=t.isDragActive,i=t.draggedFiles;return Za(Za({},e),{},{draggedFiles:i,isDragActive:n});case"setFiles":return Za(Za({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return Za(Za({},e),{},{isFileDialogActive:!1,isDragActive:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]});default:return e}}var Ha=n(2467),Ya=n(9654),Ka=n.n(Ya);const Na=(...e)=>e.filter(Boolean).join(".");function Ma(e,t){return(0,i.useMemo)(e,function(e,t){const n=(0,i.useRef)();return(t?C:u.Z)(e,n.current)||(n.current=e),n.current}(t,!0))}function Fa(e,t,n){return e.useStore((e=>function(e,t){return Object.entries((n=e,i=t,i.reduce(((e,t)=>(n&&n.hasOwnProperty(t)&&(e[t]=n[t]),e)),{}))).reduce(((e,[,{value:t,disabled:n,key:i}])=>(e[i]=n?void 0:t,e)),{});var n,i}(On(On({},n),e.data),t)),u.Z)}function za(e=3){const t=(0,i.useRef)(null),n=(0,i.useRef)(null),[o,r]=(0,i.useState)(!1),a=(0,i.useCallback)((()=>r(!0)),[]),g=(0,i.useCallback)((()=>r(!1)),[]);return(0,i.useLayoutEffect)((()=>{if(o){const{bottom:i,top:o,left:r}=t.current.getBoundingClientRect(),{height:a}=n.current.getBoundingClientRect(),g=i+a>window.innerHeight-40?"up":"down";n.current.style.position="fixed",n.current.style.zIndex="10000",n.current.style.left=r+"px","down"===g?n.current.style.top=i+e+"px":n.current.style.bottom=window.innerHeight-o+e+"px"}}),[e,o]),{popinRef:t,wrapperRef:n,shown:o,show:a,hide:g}}const La={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHexString",hex8:"toHex8String"};H.extend({color:()=>e=>sr()(e).isValid()});function ka(e,{format:t,hasAlpha:n,isString:i}){const o="hex"===t&&n?"hex8":t;if(i)return e.toString(o);const r=e[La[o]]();return n?r:function(e,t){const n=On({},e);return t.forEach((t=>t in e&&delete n[t])),n}(r,["a"])}const Ea=(e,t)=>{const n=sr()(e);if(!n.isValid())throw Error("Invalid color");return ka(n,t)};var Ta=Object.freeze({__proto__:null,schema:e=>H().color().test(e),sanitize:Ea,format:(e,t)=>ka(sr()(e),On(On({},t),{},{isString:!0,format:"hex"})),normalize:({value:e})=>{const t=sr()(e).getFormat(),n={format:"name"===t||"hex8"===t?"hex":t,hasAlpha:"object"==typeof e?"a"in e:"hex8"===t||/^(rgba)|(hsla)|(hsva)/.test(e),isString:"string"==typeof e};return{value:Ea(e,n),settings:n}}});const Ua=Mi("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:'url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>\')',$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),_a=Mi("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),Ja=Mi("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function Da(e,t){return"rgb"!==t?sr()(e).toRgb():e}function Pa({value:e,displayValue:t,settings:n,onUpdate:o}){const{emitOnEditStart:r,emitOnEditEnd:a}=Vi(),{format:g,hasAlpha:s}=n,{popinRef:l,wrapperRef:c,shown:I,show:C,hide:u}=za(),d=(0,i.useRef)(0),[h,A]=(0,i.useState)((()=>Da(e,g))),p=s?Mr:zr,m=()=>{u(),a(),window.clearTimeout(d.current)};return(0,i.useEffect)((()=>()=>window.clearTimeout(d.current)),[]),i.createElement(i.Fragment,null,i.createElement(Ua,{ref:l,active:I,onClick:()=>(A(Da(e,g)),C(),void r()),style:{color:t}}),I&&i.createElement(Io,null,i.createElement(so,{onPointerUp:m}),i.createElement(Ja,{ref:c,onMouseEnter:()=>window.clearTimeout(d.current),onMouseLeave:e=>0===e.buttons&&void(d.current=window.setTimeout(m,500))},i.createElement(p,{color:h,onChange:o}))))}var Qa=On({component:function(){const{value:e,displayValue:t,label:n,onChange:o,onUpdate:r,settings:a}=Vi();return i.createElement(yo,{input:!0},i.createElement(Ao,null,n),i.createElement(_a,null,i.createElement(Pa,{value:e,displayValue:t,onChange:o,onUpdate:r,settings:a}),i.createElement(Oi,{value:t,onChange:o,onUpdate:r})))}},Ta);var Oa=On({component:function(){const{label:e,displayValue:t,onUpdate:n,settings:o}=Vi();return i.createElement(yo,{input:!0},i.createElement(Ao,null,e),i.createElement(er,{value:t,settings:o,onUpdate:n}))}},ar(["x","y","z"]));const ja=Mi("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),qa=Mi("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function $a({value:e,settings:t,onUpdate:n}){const o=(0,i.useRef)(),r=(0,i.useRef)(0),a=(0,i.useRef)(0),g=(0,i.useRef)(1),[s,l]=(0,i.useState)(!1),[c,I]=(0,i.useState)(!1),[C,u]=Bo(),d=(0,i.useRef)(null),h=(0,i.useRef)(null);(0,i.useLayoutEffect)((()=>{if(s){const{top:e,left:t,width:n,height:i}=d.current.getBoundingClientRect();h.current.style.left=t+n/2+"px",h.current.style.top=e+i/2+"px"}}),[s]);const{keys:[A,p],joystick:m}=t,b="invertY"===m?1:-1,{[A]:{step:f},[p]:{step:y}}=t,G=Ti("sizes","joystickWidth"),v=Ti("sizes","joystickHeight"),B=.8*parseFloat(G)/2,Z=.8*parseFloat(v)/2,w=(0,i.useCallback)((()=>{o.current||(I(!0),r.current&&u({x:r.current*B}),a.current&&u({y:a.current*-Z}),o.current=window.setInterval((()=>{n((e=>{const t=f*r.current*g.current,n=b*y*a.current*g.current;return Array.isArray(e)?{[A]:e[0]+t,[p]:e[1]+n}:{[A]:e[A]+t,[p]:e[p]+n}}))}),16))}),[B,Z,n,u,f,y,A,p,b]),W=(0,i.useCallback)((()=>{window.clearTimeout(o.current),o.current=void 0,I(!1)}),[]);(0,i.useEffect)((()=>{function e(e){g.current=yi(e)}return window.addEventListener("keydown",e),window.addEventListener("keyup",e),()=>{window.clearTimeout(o.current),window.removeEventListener("keydown",e),window.removeEventListener("keyup",e)}}),[]);const S=vo((({first:t,active:i,delta:[o,s],movement:[c,I]})=>{t&&l(!0);const C=jn(c,-B,B),d=jn(I,-Z,Z);r.current=Math.abs(c)>Math.abs(C)?Math.sign(c-C):0,a.current=Math.abs(I)>Math.abs(d)?Math.sign(d-I):0;let h=e[A],m=e[p];i?(r.current||(h+=o*f*g.current,u({x:C})),a.current||(m-=b*s*y*g.current,u({y:d})),r.current||a.current?w():W(),n({[A]:h,[p]:m})):(l(!1),r.current=0,a.current=0,u({x:0,y:0}),W())}));return i.createElement(ja,Si({ref:d},S()),s&&i.createElement(Io,null,i.createElement(qa,{ref:h,isOutOfBounds:c},i.createElement("div",null),i.createElement("span",{ref:C}))))}const eg=Mi("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});const tg=["joystick"],ng=ar(["x","y"]);var ig=On(On({component:function(){const{label:e,displayValue:t,onUpdate:n,settings:o}=Vi();return i.createElement(yo,{input:!0},i.createElement(Ao,null,e),i.createElement(eg,{withJoystick:!!o.joystick},o.joystick&&i.createElement($a,{value:t,settings:o,onUpdate:n}),i.createElement(er,{value:t,settings:o,onUpdate:n})))}},ng),{},{normalize:e=>{let{joystick:t=!0}=e,n=Hn(e,tg);const{value:i,settings:o}=ng.normalize(n);return{value:i,settings:On(On({},o),{},{joystick:t})}}});var og=Object.freeze({__proto__:null,sanitize:e=>{if(void 0!==e){if(e instanceof File)try{return URL.createObjectURL(e)}catch(t){return}if("string"==typeof e&&0===e.indexOf("blob:"))return e;throw Error("Invalid image format [undefined | blob |\xa0File].")}},schema:(e,t)=>"object"==typeof t&&"image"in t,normalize:({image:e})=>({value:e})});const rg=Mi("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),ag=Mi("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),gg=Mi("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),sg=Mi("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),lg=Mi("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),cg=Mi("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});var Ig=On({component:function(){const{label:e,value:t,onUpdate:n}=Vi(),{popinRef:o,wrapperRef:r,shown:a,show:g,hide:s}=za(),l=(0,i.useCallback)((e=>{e.length&&n(e[0])}),[n]),c=(0,i.useCallback)((e=>{e.stopPropagation(),n(void 0)}),[n]),{getRootProps:I,getInputProps:C,isDragAccept:u}=xa({maxFiles:1,accept:"image/*",onDrop:l});return i.createElement(yo,{input:!0},i.createElement(Ao,null,e),i.createElement(rg,null,i.createElement(gg,{ref:o,hasImage:!!t,onPointerDown:()=>!!t&&g(),onPointerUp:s,style:{backgroundImage:t?`url(${t})`:"none"}}),a&&!!t&&i.createElement(Io,null,i.createElement(so,{onPointerUp:s,style:{cursor:"pointer"}}),i.createElement(sg,{ref:r,style:{backgroundImage:`url(${t})`}})),i.createElement(ag,I({isDragAccept:u}),i.createElement("input",C()),i.createElement(lg,null,u?"drop image":"click or drop")),i.createElement(cg,{onClick:c,disabled:!t})))}},og);const Cg=H().number(),ug=e=>({min:e[0],max:e[1]}),dg=(e,{bounds:[t,n]},i)=>{const o={min:i[0],max:i[1]},{min:r,max:a}=On(On({},o),e);return[jn(Number(r),t,Math.max(t,a)),jn(Number(a),Math.min(n,r),n)]};var hg=Object.freeze({__proto__:null,schema:(e,t)=>H().array().length(2).every.number().test(e)&&H().schema({min:Cg,max:Cg}).test(t),format:ug,sanitize:dg,normalize:({value:e,min:t,max:n})=>{const i={min:t,max:n},o=[t,n],r=On(On({},tr(ug(e),{min:i,max:i})),{},{bounds:o});return{value:dg(ug(e),r,e),settings:r}}});const Ag=["value","bounds","onDrag"],pg=["bounds"],mg=Mi("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function bg(e){let{value:t,bounds:[n,o],onDrag:r}=e,a=Hn(e,Ag);const g=(0,i.useRef)(null),s=(0,i.useRef)(null),l=(0,i.useRef)(null),c=(0,i.useRef)(0),I=Ti("sizes","scrubberWidth"),C=vo((({event:e,first:i,xy:[C],movement:[u],memo:d={}})=>{if(i){const{width:i,left:r}=g.current.getBoundingClientRect();c.current=i-parseFloat(I);const a=(null==e?void 0:e.target)===s.current||(null==e?void 0:e.target)===l.current;d.pos=ni((C-r)/i,n,o);const u=Math.abs(d.pos-t.min)-Math.abs(d.pos-t.max);d.key=u<0||0===u&&d.pos<=t.min?"min":"max",a&&(d.pos=t[d.key])}const h=d.pos+ni(u/c.current,0,o-n);return r({[d.key]:Ko(h,a[d.key])}),d})),u=`calc(${ti(t.min,n,o)} * (100% - ${I} - 8px) + 4px)`,d=`calc(${1-ti(t.max,n,o)} * (100% - ${I} - 8px) + 4px)`;return i.createElement(Vo,Si({ref:g},C()),i.createElement(So,null,i.createElement(xo,{style:{left:u,right:d}})),i.createElement(Ro,{position:"left",ref:s,style:{left:u}}),i.createElement(Ro,{position:"right",ref:l,style:{right:d}}))}var fg=On({component:function(){const{label:e,displayValue:t,onUpdate:n,settings:o}=Vi(),r=Hn(o,pg);return i.createElement(i.Fragment,null,i.createElement(yo,{input:!0},i.createElement(Ao,null,e),i.createElement(mg,null,i.createElement(bg,Si({value:t},o,{onDrag:n})),i.createElement(er,{value:t,settings:r,onUpdate:n,innerLabelTrim:0}))))}},hg);const yg=["type","value"],Gg=["onChange","transient","onEditStart","onEditEnd"],vg=function(){const e=(0,Ha.Z)((()=>({data:{}}))),t=(()=>{const e=new Map;return{on:(t,n)=>{let i=e.get(t);void 0===i&&(i=new Set,e.set(t,i)),i.add(n)},off:(t,n)=>{const i=e.get(t);void 0!==i&&(i.delete(n),0===i.size&&e.delete(t))},emit:(t,...n)=>{const i=e.get(t);if(void 0!==i)for(const e of i)e(...n)}}})();this.storeId="_"+Math.random().toString(36).substr(2,9),this.useStore=e;const n={},i=new Set;this.getVisiblePaths=()=>{const e=this.getData(),t=Object.keys(e),o=[];Object.entries(n).forEach((([e,n])=>{n.render&&t.some((t=>0===t.indexOf(e)))&&!n.render(this.get)&&o.push(e+".")}));const r=[];return i.forEach((t=>{t in e&&e[t].__refCount>0&&o.every((e=>-1===t.indexOf(e)))&&(!e[t].render||e[t].render(this.get))&&r.push(t)})),r},this.setOrderedPaths=e=>{e.forEach((e=>i.add(e)))},this.orderPaths=e=>(this.setOrderedPaths(e),e),this.disposePaths=t=>{e.setState((e=>{const n=e.data;return t.forEach((e=>{if(e in n){const t=n[e];t.__refCount--,0===t.__refCount&&t.type in ci&&delete n[e]}})),{data:n}}))},this.dispose=()=>{e.setState((()=>({data:{}})))},this.getFolderSettings=e=>n[e]||{},this.getData=()=>e.getState().data,this.addData=(t,n)=>{e.setState((e=>{const i=e.data;return Object.entries(t).forEach((([e,t])=>{let o=i[e];if(o){const{type:e,value:i}=t,r=Hn(t,yg);e!==o.type?Mn(Yn.INPUT_TYPE_OVERRIDE,e):((0===o.__refCount||n)&&Object.assign(o,r),o.__refCount++)}else i[e]=On(On({},t),{},{__refCount:1})})),{data:i}}))},this.setValueAtPath=(t,n,i)=>{e.setState((e=>{const o=e.data;return pi(o[t],n,t,this,i),{data:o}}))},this.setSettingsAtPath=(t,n)=>{e.setState((e=>{const i=e.data;return i[t].settings=On(On({},i[t].settings),n),{data:i}}))},this.disableInputAtPath=(t,n)=>{e.setState((e=>{const i=e.data;return i[t].disabled=n,{data:i}}))},this.set=(t,n)=>{e.setState((e=>{const i=e.data;return Object.entries(t).forEach((([e,t])=>{try{pi(i[e],t,void 0,void 0,n)}catch(o){}})),{data:i}}))},this.getInput=e=>{try{return this.getData()[e]}catch(t){Mn(Yn.PATH_DOESNT_EXIST,e)}},this.get=e=>{var t;return null===(t=this.getInput(e))||void 0===t?void 0:t.value},this.emitOnEditStart=e=>{t.emit(`onEditStart:${e}`,this.get(e),e,On(On({},this.getInput(e)),{},{get:this.get}))},this.emitOnEditEnd=e=>{t.emit(`onEditEnd:${e}`,this.get(e),e,On(On({},this.getInput(e)),{},{get:this.get}))},this.subscribeToEditStart=(e,n)=>(t.on(`onEditStart:${e}`,n),()=>t.off(e,n)),this.subscribeToEditEnd=(e,n)=>(t.on(`onEditEnd:${e}`,n),()=>t.off(e,n));const o=(e,t,i)=>{const r={};return Object.entries(e).forEach((([e,a])=>{if(""===e)return Mn(Yn.EMPTY_KEY);let g=Na(t,e);if(a.type===ci.FOLDER){const e=o(a.schema,g,i);Object.assign(r,e),g in n||(n[g]=a.settings)}else if(e in i)Mn(Yn.DUPLICATE_KEYS,e,g,i[e].path);else{const t=Ai(a,e,g,r);if(t){const{type:n,options:o,input:a}=t,{onChange:s,transient:l,onEditStart:c,onEditEnd:I}=o,C=Hn(o,Gg);r[g]=On(On(On({type:n},C),a),{},{fromPanel:!0}),i[e]={path:g,onChange:s,transient:l,onEditStart:c,onEditEnd:I}}else Mn(Yn.UNKNOWN_INPUT,g,a)}})),r};this.getDataFromSchema=e=>{const t={};return[o(e,"",t),t]}},Bg=new vg;const Zg={collapsed:!1};function wg(e,t){return{type:ci.FOLDER,schema:e,settings:On(On({},Zg),t)}}function Wg({toggle:e,toggled:t,name:n}){return i.createElement(eo,{onClick:()=>e()},i.createElement(bo,{toggled:t}),i.createElement("div",null,n))}const Sg=["type","label","path","valueKey","value","settings","setValue","disabled"];function Rg(e){let{type:t,label:n,path:o,valueKey:r,value:a,settings:g,setValue:s,disabled:l}=e,c=Hn(e,Sg);const{displayValue:I,onChange:C,onUpdate:u}=Go({type:t,value:a,settings:g,setValue:s}),d=Tn[t].component;return d?i.createElement(Ri.Provider,{value:On({key:r,path:o,id:""+o,label:n,displayValue:I,value:a,onChange:C,onUpdate:u,settings:g,setValue:s,disabled:l},c)},i.createElement(ao,{disabled:l},i.createElement(d,null))):(Mn(Yn.NO_COMPONENT_FOR_TYPE,t,o),null)}const Vg=Mi("button",{display:"block",$reset:"",fontWeight:"$button",color:"$highlight3",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""});const xg=Mi("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),Xg=Mi("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}});const Hg=Mi("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"});const Yg=(0,i.forwardRef)((function({initialValue:e},t){const n=Ti("colors","highlight3"),o=Ti("colors","elevation2"),r=Ti("colors","highlight1"),[a,g]=(0,i.useMemo)((()=>[sr()(r).setAlpha(.4).toRgbString(),sr()(r).setAlpha(.1).toRgbString()]),[r]),s=(0,i.useRef)([e]),l=(0,i.useRef)(e),c=(0,i.useRef)(e),I=(0,i.useRef)(),C=(0,i.useCallback)(((e,t)=>{if(!e)return;const{width:i,height:r}=e,I=new Path2D,C=i/100,u=.05*r;for(let n=0;n<s.current.length;n++){const e=C*n,t=r-ti(s.current[n],l.current,c.current)*(r-2*u)-u;I.lineTo(e,t)}t.clearRect(0,0,i,r);const d=new Path2D(I);d.lineTo(C*(s.current.length+1),r),d.lineTo(0,r),d.lineTo(0,0);const h=t.createLinearGradient(0,0,0,r);h.addColorStop(0,a),h.addColorStop(1,g),t.fillStyle=h,t.fill(d),t.strokeStyle=o,t.lineJoin="round",t.lineWidth=14,t.stroke(I),t.strokeStyle=n,t.lineWidth=2,t.stroke(I)}),[n,o,a,g]),[u,d]=function(e){const t=(0,i.useRef)(null),n=(0,i.useRef)(null),o=(0,i.useRef)(!1);return(0,i.useEffect)((()=>{const i=fi((()=>{t.current.width=t.current.offsetWidth*window.devicePixelRatio,t.current.height=t.current.offsetHeight*window.devicePixelRatio,e(t.current,n.current)}),250);return window.addEventListener("resize",i),o.current||(i(),o.current=!0),()=>window.removeEventListener("resize",i)}),[e]),(0,i.useEffect)((()=>{n.current=t.current.getContext("2d")}),[]),[t,n]}(C);return(0,i.useImperativeHandle)(t,(()=>({frame:e=>{(void 0===l.current||e<l.current)&&(l.current=e),(void 0===c.current||e>c.current)&&(c.current=e),function(e,t){e.push(t),e.length>100&&e.shift()}(s.current,e),I.current=requestAnimationFrame((()=>C(u.current,d.current)))}})),[u,d,C]),(0,i.useEffect)((()=>()=>cancelAnimationFrame(I.current)),[]),i.createElement(Hg,{ref:u})})),Kg=e=>Number.isFinite(e)?e.toPrecision(2):e.toString(),Ng=(0,i.forwardRef)((function({initialValue:e},t){const[n,o]=(0,i.useState)(Kg(e));return(0,i.useImperativeHandle)(t,(()=>({frame:e=>o(Kg(e))})),[]),i.createElement("div",null,n)}));function Mg(e){return"function"==typeof e?e():e.current}const Fg=["type","label","key"],zg={[ci.BUTTON]:function({onClick:e,label:t}){return i.createElement(yo,null,i.createElement(Vg,{onClick:()=>e()},t))},[ci.BUTTON_GROUP]:function(e){const{label:t,opts:n}=(({label:e,opts:t})=>{let n="string"==typeof e&&""===e.trim()?null:e,i=t;return"object"==typeof t.opts&&(void 0!==i.label&&(n=t.label),i=t.opts),{label:n,opts:i}})(e);return i.createElement(yo,{input:!!t},t&&i.createElement(Ao,null,t),i.createElement(xg,null,Object.entries(n).map((([e,t])=>i.createElement(Xg,{key:e,onClick:()=>t()},e)))))},[ci.MONITOR]:function({label:e,objectOrFn:t,settings:n}){const o=(0,i.useRef)(),r=(0,i.useRef)(Mg(t));return(0,i.useEffect)((()=>{const e=window.setInterval((()=>{var e;document.hidden||null===(e=o.current)||void 0===e||e.frame(Mg(t))}),n.interval);return()=>window.clearInterval(e)}),[t,n.interval]),i.createElement(yo,{input:!0},i.createElement(Ao,{align:"top"},e),n.graph?i.createElement(Yg,{ref:o,initialValue:r.current}):i.createElement(Ng,{ref:o,initialValue:r.current}))}},Lg=i.memo((({path:e})=>{const[t,{set:n,setSettings:o,disable:r,storeId:a,emitOnEditStart:g,emitOnEditEnd:s}]=function(e){const t=Yi(),[n,o]=(0,i.useState)(wo(t.getData(),e)),r=(0,i.useCallback)((n=>t.setValueAtPath(e,n,!0)),[e,t]),a=(0,i.useCallback)((n=>t.setSettingsAtPath(e,n)),[e,t]),g=(0,i.useCallback)((n=>t.disableInputAtPath(e,n)),[e,t]),s=(0,i.useCallback)((()=>t.emitOnEditStart(e)),[e,t]),l=(0,i.useCallback)((()=>t.emitOnEditEnd(e)),[e,t]);return(0,i.useEffect)((()=>{o(wo(t.getData(),e));const n=t.useStore.subscribe(o,(t=>wo(t.data,e)),u.Z);return()=>n()}),[t,e]),[n,{set:r,setSettings:a,disable:g,storeId:t.storeId,emitOnEditStart:s,emitOnEditEnd:l}]}(e);if(!t)return null;const{type:l,label:c,key:I}=t,C=Hn(t,Fg);if(l in ci){const t=zg[l];return i.createElement(t,Si({label:c,path:e},C))}return l in Tn?i.createElement(Rg,Si({key:a+e,type:l,label:c,storeId:a,path:e,valueKey:I,setValue:n,setSettings:o,disable:r,emitOnEditStart:g,emitOnEditEnd:s},C)):(Fn(Yn.UNSUPPORTED_INPUT,l,e),null)})),kg=({name:e,path:t,tree:n})=>{const o=Yi(),r=Na(t,e),{collapsed:a}=o.getFolderSettings(r),[g,s]=(0,i.useState)(!a);return i.createElement(qi,null,i.createElement(Wg,{name:e,toggled:g,toggle:()=>s((e=>!e))}),i.createElement(Eg,{parent:r,tree:n,toggled:g}))},Eg=i.memo((({isRoot:e=!1,fill:t=!1,flat:n=!1,parent:o,tree:r,toggled:a})=>{const{wrapperRef:g,contentRef:s}=function(e){const t=(0,i.useRef)(null),n=(0,i.useRef)(null),o=(0,i.useRef)(!0);return(0,i.useLayoutEffect)((()=>{e||(t.current.style.height="0px",t.current.style.overflow="hidden")}),[]),(0,i.useEffect)((()=>{if(o.current)return void(o.current=!1);let i;const r=t.current,a=()=>{e&&(r.style.removeProperty("height"),r.style.removeProperty("overflow"),n.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};r.addEventListener("transitionend",a,{once:!0});const{height:g}=n.current.getBoundingClientRect();return r.style.height=g+"px",e||(r.style.overflow="hidden",i=window.setTimeout((()=>r.style.height="0px"),50)),()=>{r.removeEventListener("transitionend",a),clearTimeout(i)}}),[e]),{wrapperRef:t,contentRef:n}}(a);return i.createElement($i,{ref:g,isRoot:e,fill:t,flat:n},i.createElement(to,{ref:s,isRoot:e,toggled:a},Object.entries(r).map((([e,t])=>(e=>"__levaInput"in e)(t)?i.createElement(Lg,{key:t.path,valueKey:t.valueKey,path:t.path}):i.createElement(kg,{key:e,name:e,path:o,tree:t})))))})),Tg=Mi("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${io}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),Ug=Mi("i",{$flexCenter:"",width:40,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),_g=Mi("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),Jg=Mi("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${Ug}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),Dg=Mi("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),Pg=Mi("div",{$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:40}}}}),Qg=i.forwardRef((({setFilter:e,toggle:t},n)=>{const[o,r]=(0,i.useState)(""),a=(0,i.useMemo)((()=>fi(e,250)),[e]);return(0,i.useEffect)((()=>{a(o)}),[o,a]),i.createElement(i.Fragment,null,i.createElement(Dg,{ref:n,value:o,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:e=>e.stopPropagation(),onChange:e=>{const n=e.currentTarget.value;t(!0),r(n)}}),i.createElement(Ug,{onClick:()=>(e(""),void r("")),style:{visibility:o?"visible":"hidden"}},i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},i.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))}));function Og({setFilter:e,onDrag:t,toggle:n,toggled:o,title:r,drag:a,filterEnabled:g}){const[s,l]=(0,i.useState)(!1),c=(0,i.useRef)(null);(0,i.useEffect)((()=>{var e,t;s?null===(e=c.current)||void 0===e||e.focus():null===(t=c.current)||void 0===t||t.blur()}),[s]);const I=wt((({offset:[e,n]})=>t({x:e,y:n})),{filterTaps:!0});return(0,i.useEffect)((()=>{const e=e=>{"L"===e.key&&e.shiftKey&&e.metaKey&&l((e=>!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[]),i.createElement(i.Fragment,null,i.createElement(_g,{mode:a?"drag":void 0},i.createElement(Ug,{active:!o,onClick:()=>n()},i.createElement(bo,{toggled:o,width:12,height:8})),i.createElement(Pg,Si({},a?I():{},{drag:a,filterEnabled:g}),void 0===r&&a?i.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},i.createElement("circle",{cx:"2",cy:"2",r:"2"}),i.createElement("circle",{cx:"14",cy:"2",r:"2"}),i.createElement("circle",{cx:"26",cy:"2",r:"2"}),i.createElement("circle",{cx:"2",cy:"12",r:"2"}),i.createElement("circle",{cx:"14",cy:"12",r:"2"}),i.createElement("circle",{cx:"26",cy:"12",r:"2"})):r),g&&i.createElement(Ug,{active:s,onClick:()=>l((e=>!e))},i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},i.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),i.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),i.createElement(Jg,{toggled:s},i.createElement(Qg,{ref:c,setFilter:e,toggle:n})))}const jg=["store","hidden","theme","collapsed"];function qg(e){let{store:t,hidden:n=!1,theme:o,collapsed:r=!1}=e,a=Hn(e,jg);const g=Ma((()=>Ei(o)),[o]),[s,l]=(0,i.useState)(!r);return!t||n?null:i.createElement(xi.Provider,{value:g},i.createElement($g,Si({store:t},a,{toggled:s,setToggle:l,rootClass:g.className})))}const $g=i.memo((({store:e,rootClass:t,fill:n=!1,flat:o=!1,oneLineLabels:r=!1,titleBar:a={title:void 0,drag:!0,filter:!0},hideCopyButton:g=!1,toggled:s,setToggle:l})=>{var c,I;const C=(e=>{const[t,n]=(0,i.useState)(e.getVisiblePaths());return(0,i.useEffect)((()=>{n(e.getVisiblePaths());const t=e.useStore.subscribe(n,e.getVisiblePaths,u.Z);return()=>t()}),[e]),t})(e),[d,h]=(0,i.useState)(""),A=(0,i.useMemo)((()=>((e,t)=>{const n={},i=t?t.toLowerCase():null;return e.forEach((e=>{const[t,o]=function(e){const t=e.split(".");return[t.pop(),t.join(".")||void 0]}(e);(!i||t.toLowerCase().indexOf(i)>-1)&&Ka()(n,o,{[t]:{__levaInput:!0,path:e}})})),n})(C,d)),[C,d]),[p,m]=Bo(),b=C.length>0,f="object"==typeof a&&a.title||void 0,y="object"!=typeof a||(null===(c=a.drag)||void 0===c||c),G="object"!=typeof a||(null===(I=a.filter)||void 0===I||I);return i.createElement(Hi.Provider,{value:{hideCopyButton:g}},i.createElement(Tg,{ref:p,className:t,fill:n,flat:o,oneLineLabels:r,hideTitleBar:!a,style:{display:b?"block":"none"}},a&&i.createElement(Og,{onDrag:m,setFilter:h,toggle:e=>l((t=>null!=e?e:!t)),toggled:s,title:f,drag:y,filterEnabled:G}),b&&i.createElement(Xi.Provider,{value:e},i.createElement(Eg,{isRoot:!0,fill:n,flat:o,tree:A,toggled:s}))))})),es=["isRoot"];let ts=!1,ns=null;function is(e){let{isRoot:t=!1}=e,n=Hn(e,es);return(0,i.useEffect)((()=>(ts=!0,!t&&ns&&(ns.remove(),ns=null),()=>{t||(ts=!1)})),[t]),i.createElement(qg,Si({store:Bg},n))}function os(e,t,n,o,r){const{folderName:a,schema:g,folderSettings:l,hookSettings:c,deps:I}=function(e,t,n,i,o){let r,a,g,s,l;return"string"==typeof e?(a=e,r=t,Array.isArray(n)?l=n:n&&("store"in n?(s=n,l=i):(g=n,Array.isArray(i)?l=i:(s=i,l=o)))):(r=e,Array.isArray(t)?l=t:(s=t,l=n)),{schema:r,folderName:a,folderSettings:g,hookSettings:s,deps:l||[]}}(e,t,n,o,r),C="function"==typeof g,d=(0,i.useRef)(!1),h=(0,i.useRef)(!0),A=Ma((()=>{d.current=!0;const e="function"==typeof g?g():g;return a?{[a]:wg(e,l)}:e}),I);!function(e){(0,i.useEffect)((()=>{e&&!ts&&(ns||(ns=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(ns),s.render(i.createElement(is,{isRoot:!0}),ns))),ts=!0)}),[e])}(!(null!=c&&c.store));const[p]=(0,i.useState)((()=>(null==c?void 0:c.store)||Bg)),[m,b]=(0,i.useMemo)((()=>p.getDataFromSchema(A)),[p,A]),[f,y,G,v,B]=(0,i.useMemo)((()=>{const e=[],t=[],n={},i={},o={};return Object.values(b).forEach((({path:r,onChange:a,onEditStart:g,onEditEnd:s,transient:l})=>{e.push(r),a?(n[r]=a,l||t.push(r)):t.push(r),g&&(i[r]=g),s&&(o[r]=s)})),[e,t,n,i,o]}),[b]),Z=(0,i.useMemo)((()=>p.orderPaths(f)),[f,p]),w=Fa(p,y,m),W=(0,i.useCallback)((e=>{const t=Object.entries(e).reduce(((e,[t,n])=>Object.assign(e,{[b[t].path]:n})),{});p.set(t,!1)}),[p,b]);return(0,i.useEffect)((()=>{const e=!h.current&&d.current;return p.addData(m,e),h.current=!1,d.current=!1,()=>p.disposePaths(Z)}),[p,Z,m]),(0,i.useEffect)((()=>{const e=[];return Object.entries(G).forEach((([t,n])=>{n(p.get(t),t,On({initial:!0,get:p.get},p.getInput(t)));const i=p.useStore.subscribe((([e,i])=>n(e,t,On({initial:!1,get:p.get},i))),(e=>{const n=e.data[t];return[n.disabled?void 0:n.value,n]}),u.Z);e.push(i)})),()=>e.forEach((e=>e()))}),[p,G]),(0,i.useEffect)((()=>{const e=[];return Object.entries(v).forEach((([t,n])=>e.push(p.subscribeToEditStart(t,n)))),Object.entries(B).forEach((([t,n])=>e.push(p.subscribeToEditEnd(t,n)))),()=>e.forEach((e=>e()))}),[v,B,p]),C?[w,W]:w}_n(Ii.SELECT,Eo),_n(Ii.IMAGE,Ig),_n(Ii.NUMBER,No),_n(Ii.COLOR,Qa),_n(Ii.STRING,_o),_n(Ii.BOOLEAN,Qo),_n(Ii.INTERVAL,fg),_n(Ii.VECTOR3D,Oa),_n(Ii.VECTOR2D,ig)},9654:function(e,t,n){"use strict";var i=n(6858),o=n(9719),r=n(616),a=n(262);e.exports=function(e,t,n){if(!i(e))throw new TypeError("expected an object");if("string"!=typeof t||null==n)return o.apply(null,arguments);if("string"==typeof n)return a(e,t,n),e;var g=r(e,t);return i(n)&&i(g)&&(n=o({},g,n)),a(e,t,n),e}},6858:function(e,t,n){"use strict";var i=n(5690);e.exports=function(e){return i(e)||"function"==typeof e||Array.isArray(e)}},9719:function(e,t,n){"use strict";var i=n(9314),o=n(9556);function r(e,t){for(var n=arguments.length,i=0;++i<n;){var r=arguments[i];g(r)&&o(r,a,e)}return e}function a(e,t){if(function(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e}(t)){var n=this[t];g(e)&&g(n)?r(n,e):this[t]=e}}function g(e){return i(e)&&!Array.isArray(e)}e.exports=r},9314:function(e,t,n){"use strict";var i=n(5690);e.exports=function(e){return i(e)||"function"==typeof e||Array.isArray(e)}},7345:function(e){"use strict";e.exports=JSON.parse('{"17":["#99b898","#fecea8","#ff847c","#e84a5f","#2a363b"]}')},9166:function(e,t,n){(e=n.nmd(e)).exports=function(t){var i={},o=n(7320),r=n(2784),a=n(4616);function g(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=60103,c=60106,I=60107,C=60108,u=60114,d=60109,h=60110,A=60112,p=60113,m=60120,b=60115,f=60116,y=60121,G=60129,v=60130,B=60131;if("function"==typeof Symbol&&Symbol.for){var Z=Symbol.for;l=Z("react.element"),c=Z("react.portal"),I=Z("react.fragment"),C=Z("react.strict_mode"),u=Z("react.profiler"),d=Z("react.provider"),h=Z("react.context"),A=Z("react.forward_ref"),p=Z("react.suspense"),m=Z("react.suspense_list"),b=Z("react.memo"),f=Z("react.lazy"),y=Z("react.block"),Z("react.scope"),G=Z("react.debug_trace_mode"),v=Z("react.offscreen"),B=Z("react.legacy_hidden")}var w="function"==typeof Symbol&&Symbol.iterator;function W(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=w&&e[w]||e["@@iterator"])?e:null}function S(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case I:return"Fragment";case c:return"Portal";case u:return"Profiler";case C:return"StrictMode";case p:return"Suspense";case m:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case h:return(e.displayName||"Context")+".Consumer";case d:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case b:return S(e.type);case y:return S(e._render);case f:t=e._payload,e=e._init;try{return S(e(t))}catch(n){}}return null}function R(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function V(e){if(R(e)!==e)throw Error(g(188))}function x(e){var t=e.alternate;if(!t){if(null===(t=R(e)))throw Error(g(188));return t!==e?null:e}for(var n=e,i=t;;){var o=n.return;if(null===o)break;var r=o.alternate;if(null===r){if(null!==(i=o.return)){n=i;continue}break}if(o.child===r.child){for(r=o.child;r;){if(r===n)return V(o),e;if(r===i)return V(o),t;r=r.sibling}throw Error(g(188))}if(n.return!==i.return)n=o,i=r;else{for(var a=!1,s=o.child;s;){if(s===n){a=!0,n=o,i=r;break}if(s===i){a=!0,i=o,n=r;break}s=s.sibling}if(!a){for(s=r.child;s;){if(s===n){a=!0,n=r,i=o;break}if(s===i){a=!0,i=r,n=o;break}s=s.sibling}if(!a)throw Error(g(189))}}if(n.alternate!==i)throw Error(g(190))}if(3!==n.tag)throw Error(g(188));return n.stateNode.current===n?e:t}function X(e){if(!(e=x(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function H(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var Y,K=t.getPublicInstance,N=t.getRootHostContext,M=t.getChildHostContext,F=t.prepareForCommit,z=t.resetAfterCommit,L=t.createInstance,k=t.appendInitialChild,E=t.finalizeInitialChildren,T=t.prepareUpdate,U=t.shouldSetTextContent,_=t.createTextInstance,J=t.scheduleTimeout,D=t.cancelTimeout,P=t.noTimeout,Q=t.isPrimaryRenderer,O=t.supportsMutation,j=t.supportsPersistence,q=t.supportsHydration,$=t.getInstanceFromNode,ee=t.makeOpaqueHydratingObject,te=t.makeClientId,ne=t.beforeActiveInstanceBlur,ie=t.afterActiveInstanceBlur,oe=t.preparePortalMount,re=t.supportsTestSelectors,ae=t.findFiberRoot,ge=t.getBoundingRect,se=t.getTextContent,le=t.isHiddenSubtree,ce=t.matchAccessibilityRole,Ie=t.setFocusIfFocusable,Ce=t.setupIntersectionObserver,ue=t.appendChild,de=t.appendChildToContainer,he=t.commitTextUpdate,Ae=t.commitMount,pe=t.commitUpdate,me=t.insertBefore,be=t.insertInContainerBefore,fe=t.removeChild,ye=t.removeChildFromContainer,Ge=t.resetTextContent,ve=t.hideInstance,Be=t.hideTextInstance,Ze=t.unhideInstance,we=t.unhideTextInstance,We=t.clearContainer,Se=t.cloneInstance,Re=t.createContainerChildSet,Ve=t.appendChildToContainerChildSet,xe=t.finalizeContainerChildren,Xe=t.replaceContainerChildren,He=t.cloneHiddenInstance,Ye=t.cloneHiddenTextInstance,Ke=t.canHydrateInstance,Ne=t.canHydrateTextInstance,Me=t.isSuspenseInstancePending,Fe=t.isSuspenseInstanceFallback,ze=t.getNextHydratableSibling,Le=t.getFirstHydratableChild,ke=t.hydrateInstance,Ee=t.hydrateTextInstance,Te=t.getNextHydratableInstanceAfterSuspenseInstance,Ue=t.commitHydratedContainer,_e=t.commitHydratedSuspenseInstance;function Je(e){if(void 0===Y)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Y=t&&t[1]||""}return"\n"+Y+e}var De=!1;function Pe(e,t){if(!e||De)return"";De=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(s){var i=s}Reflect.construct(e,[],t)}else{try{t.call()}catch(s){i=s}e.call(t.prototype)}else{try{throw Error()}catch(s){i=s}e()}}catch(s){if(s&&i&&"string"==typeof s.stack){for(var o=s.stack.split("\n"),r=i.stack.split("\n"),a=o.length-1,g=r.length-1;1<=a&&0<=g&&o[a]!==r[g];)g--;for(;1<=a&&0<=g;a--,g--)if(o[a]!==r[g]){if(1!==a||1!==g)do{if(a--,0>--g||o[a]!==r[g])return"\n"+o[a].replace(" at new "," at ")}while(1<=a&&0<=g);break}}}finally{De=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Je(e):""}var Qe=[],Oe=-1;function je(e){return{current:e}}function qe(e){0>Oe||(e.current=Qe[Oe],Qe[Oe]=null,Oe--)}function $e(e,t){Oe++,Qe[Oe]=e.current,e.current=t}var et={},tt=je(et),nt=je(!1),it=et;function ot(e,t){var n=e.type.contextTypes;if(!n)return et;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var o,r={};for(o in n)r[o]=t[o];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function rt(e){return null!=(e=e.childContextTypes)}function at(){qe(nt),qe(tt)}function gt(e,t,n){if(tt.current!==et)throw Error(g(168));$e(tt,t),$e(nt,n)}function st(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(g(108,S(t)||"Unknown",r));return o({},n,i)}function lt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||et,it=tt.current,$e(tt,e),$e(nt,nt.current),!0}function ct(e,t,n){var i=e.stateNode;if(!i)throw Error(g(169));n?(e=st(e,t,it),i.__reactInternalMemoizedMergedChildContext=e,qe(nt),qe(tt),$e(tt,e)):qe(nt),$e(nt,n)}var It=null,Ct=null;(0,a.unstable_now)();var ut=0,dt=8;function ht(e){if(0!=(1&e))return dt=15,1;if(0!=(2&e))return dt=14,2;if(0!=(4&e))return dt=13,4;var t=24&e;return 0!==t?(dt=12,t):0!=(32&e)?(dt=11,32):0!==(t=192&e)?(dt=10,t):0!=(256&e)?(dt=9,256):0!==(t=3584&e)?(dt=8,t):0!=(4096&e)?(dt=7,4096):0!==(t=4186112&e)?(dt=6,t):0!==(t=62914560&e)?(dt=5,t):67108864&e?(dt=4,67108864):0!=(134217728&e)?(dt=3,134217728):0!==(t=805306368&e)?(dt=2,t):0!=(1073741824&e)?(dt=1,1073741824):(dt=8,e)}function At(e,t){var n=e.pendingLanes;if(0===n)return dt=0;var i=0,o=0,r=e.expiredLanes,a=e.suspendedLanes,g=e.pingedLanes;if(0!==r)i=r,o=dt=15;else if(0!==(r=134217727&n)){var s=r&~a;0!==s?(i=ht(s),o=dt):0!==(g&=r)&&(i=ht(g),o=dt)}else 0!==(r=n&~a)?(i=ht(r),o=dt):0!==g&&(i=ht(g),o=dt);if(0===i)return 0;if(i=n&((0>(i=31-Gt(i))?0:1<<i)<<1)-1,0!==t&&t!==i&&0==(t&a)){if(ht(t),o<=dt)return t;dt=o}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)o=1<<(n=31-Gt(t)),i|=e[n],t&=~o;return i}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=bt(24&~t))?mt(10,t):e;case 10:return 0===(e=bt(192&~t))?mt(8,t):e;case 8:return 0===(e=bt(3584&~t))&&(0===(e=bt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=bt(805306368&~t))&&(t=268435456),t}throw Error(g(358,e))}function bt(e){return e&-e}function ft(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t;var i=t-1;e.suspendedLanes&=i,e.pingedLanes&=i,(e=e.eventTimes)[t=31-Gt(t)]=n}var Gt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(vt(e)/Bt|0)|0},vt=Math.log,Bt=Math.LN2;var Zt=a.unstable_runWithPriority,wt=a.unstable_scheduleCallback,Wt=a.unstable_cancelCallback,St=a.unstable_shouldYield,Rt=a.unstable_requestPaint,Vt=a.unstable_now,xt=a.unstable_getCurrentPriorityLevel,Xt=a.unstable_ImmediatePriority,Ht=a.unstable_UserBlockingPriority,Yt=a.unstable_NormalPriority,Kt=a.unstable_LowPriority,Nt=a.unstable_IdlePriority,Mt={},Ft=void 0!==Rt?Rt:function(){},zt=null,Lt=null,kt=!1,Et=Vt(),Tt=1e4>Et?Vt:function(){return Vt()-Et};function Ut(){switch(xt()){case Xt:return 99;case Ht:return 98;case Yt:return 97;case Kt:return 96;case Nt:return 95;default:throw Error(g(332))}}function _t(e){switch(e){case 99:return Xt;case 98:return Ht;case 97:return Yt;case 96:return Kt;case 95:return Nt;default:throw Error(g(332))}}function Jt(e,t){return e=_t(e),Zt(e,t)}function Dt(e,t,n){return e=_t(e),wt(e,t,n)}function Pt(){if(null!==Lt){var e=Lt;Lt=null,Wt(e)}Qt()}function Qt(){if(!kt&&null!==zt){kt=!0;var e=0;try{var t=zt;Jt(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),zt=null}catch(n){throw null!==zt&&(zt=zt.slice(e+1)),wt(Xt,Pt),n}finally{kt=!1}}}var Ot=s.ReactCurrentBatchConfig;var jt="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},qt=Object.prototype.hasOwnProperty;function $t(e,t){if(jt(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!qt.call(t,n[i])||!jt(e[n[i]],t[n[i]]))return!1;return!0}function en(e){switch(e.tag){case 5:return Je(e.type);case 16:return Je("Lazy");case 13:return Je("Suspense");case 19:return Je("SuspenseList");case 0:case 2:case 15:return e=Pe(e.type,!1);case 11:return e=Pe(e.type.render,!1);case 22:return e=Pe(e.type._render,!1);case 1:return e=Pe(e.type,!0);default:return""}}function tn(e,t){if(e&&e.defaultProps){for(var n in t=o({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var nn=je(null),on=null,rn=null,an=null;function gn(){an=rn=on=null}function sn(e,t){e=e.type._context,Q?($e(nn,e._currentValue),e._currentValue=t):($e(nn,e._currentValue2),e._currentValue2=t)}function ln(e){var t=nn.current;qe(nn),e=e.type._context,Q?e._currentValue=t:e._currentValue2=t}function cn(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function In(e,t){on=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(Ei=!0),e.firstContext=null)}function Cn(e,t){if(an!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(an=e,t=1073741823),t={context:e,observedBits:t,next:null},null===rn){if(null===on)throw Error(g(308));rn=t,on.dependencies={lanes:0,firstContext:t,responders:null}}else rn=rn.next=t;return Q?e._currentValue:e._currentValue2}var un=!1;function dn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function hn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function An(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function pn(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function mn(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var o=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?o=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?o=r=t:r=r.next=t}else o=r=t;return n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function bn(e,t,n,i){var r=e.updateQueue;un=!1;var a=r.firstBaseUpdate,g=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===g?a=c:g.next=c,g=l;var I=e.alternate;if(null!==I){var C=(I=I.updateQueue).lastBaseUpdate;C!==g&&(null===C?I.firstBaseUpdate=c:C.next=c,I.lastBaseUpdate=l)}}if(null!==a){for(C=r.baseState,g=0,I=c=l=null;;){s=a.lane;var u=a.eventTime;if((i&s)===s){null!==I&&(I=I.next={eventTime:u,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var d=e,h=a;switch(s=t,u=n,h.tag){case 1:if("function"==typeof(d=h.payload)){C=d.call(u,C,s);break e}C=d;break e;case 3:d.flags=-4097&d.flags|64;case 0:if(null==(s="function"==typeof(d=h.payload)?d.call(u,C,s):d))break e;C=o({},C,s);break e;case 2:un=!0}}null!==a.callback&&(e.flags|=32,null===(s=r.effects)?r.effects=[a]:s.push(a))}else u={eventTime:u,lane:s,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===I?(c=I=u,l=C):I=I.next=u,g|=s;if(null===(a=a.next)){if(null===(s=r.shared.pending))break;a=s.next,s.next=null,r.lastBaseUpdate=s,r.shared.pending=null}}null===I&&(l=C),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=I,Cr|=g,e.lanes=g,e.memoizedState=C}}function fn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],o=i.callback;if(null!==o){if(i.callback=null,i=n,"function"!=typeof o)throw Error(g(191,o));o.call(i)}}}var yn=(new r.Component).refs;function Gn(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:o({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var vn={isMounted:function(e){return!!(e=e._reactInternals)&&R(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Mr(),o=Fr(e),r=An(i,o);r.payload=t,null!=n&&(r.callback=n),pn(e,r),zr(e,o,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Mr(),o=Fr(e),r=An(i,o);r.tag=1,r.payload=t,null!=n&&(r.callback=n),pn(e,r),zr(e,o,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Mr(),i=Fr(e),o=An(n,i);o.tag=2,null!=t&&(o.callback=t),pn(e,o),zr(e,i,n)}};function Bn(e,t,n,i,o,r,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!$t(n,i)||!$t(o,r))}function Zn(e,t,n){var i=!1,o=et,r=t.contextType;return"object"==typeof r&&null!==r?r=Cn(r):(o=rt(t)?it:tt.current,r=(i=null!=(i=t.contextTypes))?ot(e,o):et),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=vn,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=r),t}function wn(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&vn.enqueueReplaceState(t,t.state,null)}function Wn(e,t,n,i){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=yn,dn(e);var r=t.contextType;"object"==typeof r&&null!==r?o.context=Cn(r):(r=rt(t)?it:tt.current,o.context=ot(e,r)),bn(e,n,o,i),o.state=e.memoizedState,"function"==typeof(r=t.getDerivedStateFromProps)&&(Gn(e,t,r,n),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&vn.enqueueReplaceState(o,o.state,null),bn(e,n,o,i),o.state=e.memoizedState),"function"==typeof o.componentDidMount&&(e.flags|=4)}var Sn=Array.isArray;function Rn(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(g(309));var i=n.stateNode}if(!i)throw Error(g(147,e));var o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:((t=function(e){var t=i.refs;t===yn&&(t=i.refs={}),null===e?delete t[o]:t[o]=e})._stringRef=o,t)}if("string"!=typeof e)throw Error(g(284));if(!n._owner)throw Error(g(290,e))}return e}function Vn(e,t){if("textarea"!==e.type)throw Error(g(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function xn(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Ba(e,t)).index=0,e.sibling=null,e}function r(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags=2,n):i:(t.flags=2,n):n}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function s(e,t,n,i){return null===t||6!==t.tag?((t=Sa(n,e.mode,i)).return=e,t):((t=o(t,n)).return=e,t)}function C(e,t,n,i){return null!==t&&t.elementType===n.type?((i=o(t,n.props)).ref=Rn(e,t,n),i.return=e,i):((i=Za(n.type,n.key,n.props,null,e.mode,i)).ref=Rn(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ra(n,e.mode,i)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,i,r){return null===t||7!==t.tag?((t=wa(n,e.mode,i,r)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Sa(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case l:return(n=Za(t.type,t.key,t.props,null,e.mode,n)).ref=Rn(e,null,t),n.return=e,n;case c:return(t=Ra(t,e.mode,n)).return=e,t}if(Sn(t)||W(t))return(t=wa(t,e.mode,n,null)).return=e,t;Vn(e,t)}return null}function A(e,t,n,i){var o=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==o?null:s(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===o?n.type===I?d(e,t,n.props.children,i,o):C(e,t,n,i):null;case c:return n.key===o?u(e,t,n,i):null}if(Sn(n)||W(n))return null!==o?null:d(e,t,n,i,null);Vn(e,n)}return null}function p(e,t,n,i,o){if("string"==typeof i||"number"==typeof i)return s(t,e=e.get(n)||null,""+i,o);if("object"==typeof i&&null!==i){switch(i.$$typeof){case l:return e=e.get(null===i.key?n:i.key)||null,i.type===I?d(t,e,i.props.children,o,i.key):C(t,e,i,o);case c:return u(t,e=e.get(null===i.key?n:i.key)||null,i,o)}if(Sn(i)||W(i))return d(t,e=e.get(n)||null,i,o,null);Vn(t,i)}return null}function m(o,a,g,s){for(var l=null,c=null,I=a,C=a=0,u=null;null!==I&&C<g.length;C++){I.index>C?(u=I,I=null):u=I.sibling;var d=A(o,I,g[C],s);if(null===d){null===I&&(I=u);break}e&&I&&null===d.alternate&&t(o,I),a=r(d,a,C),null===c?l=d:c.sibling=d,c=d,I=u}if(C===g.length)return n(o,I),l;if(null===I){for(;C<g.length;C++)null!==(I=h(o,g[C],s))&&(a=r(I,a,C),null===c?l=I:c.sibling=I,c=I);return l}for(I=i(o,I);C<g.length;C++)null!==(u=p(I,o,C,g[C],s))&&(e&&null!==u.alternate&&I.delete(null===u.key?C:u.key),a=r(u,a,C),null===c?l=u:c.sibling=u,c=u);return e&&I.forEach((function(e){return t(o,e)})),l}function b(o,a,s,l){var c=W(s);if("function"!=typeof c)throw Error(g(150));if(null==(s=c.call(s)))throw Error(g(151));for(var I=c=null,C=a,u=a=0,d=null,m=s.next();null!==C&&!m.done;u++,m=s.next()){C.index>u?(d=C,C=null):d=C.sibling;var b=A(o,C,m.value,l);if(null===b){null===C&&(C=d);break}e&&C&&null===b.alternate&&t(o,C),a=r(b,a,u),null===I?c=b:I.sibling=b,I=b,C=d}if(m.done)return n(o,C),c;if(null===C){for(;!m.done;u++,m=s.next())null!==(m=h(o,m.value,l))&&(a=r(m,a,u),null===I?c=m:I.sibling=m,I=m);return c}for(C=i(o,C);!m.done;u++,m=s.next())null!==(m=p(C,o,u,m.value,l))&&(e&&null!==m.alternate&&C.delete(null===m.key?u:m.key),a=r(m,a,u),null===I?c=m:I.sibling=m,I=m);return e&&C.forEach((function(e){return t(o,e)})),c}return function(e,i,r,s){var C="object"==typeof r&&null!==r&&r.type===I&&null===r.key;C&&(r=r.props.children);var u="object"==typeof r&&null!==r;if(u)switch(r.$$typeof){case l:e:{for(u=r.key,C=i;null!==C;){if(C.key===u){switch(C.tag){case 7:if(r.type===I){n(e,C.sibling),(i=o(C,r.props.children)).return=e,e=i;break e}break;default:if(C.elementType===r.type){n(e,C.sibling),(i=o(C,r.props)).ref=Rn(e,C,r),i.return=e,e=i;break e}}n(e,C);break}t(e,C),C=C.sibling}r.type===I?((i=wa(r.props.children,e.mode,s,r.key)).return=e,e=i):((s=Za(r.type,r.key,r.props,null,e.mode,s)).ref=Rn(e,i,r),s.return=e,e=s)}return a(e);case c:e:{for(C=r.key;null!==i;){if(i.key===C){if(4===i.tag&&i.stateNode.containerInfo===r.containerInfo&&i.stateNode.implementation===r.implementation){n(e,i.sibling),(i=o(i,r.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=Ra(r,e.mode,s)).return=e,e=i}return a(e)}if("string"==typeof r||"number"==typeof r)return r=""+r,null!==i&&6===i.tag?(n(e,i.sibling),(i=o(i,r)).return=e,e=i):(n(e,i),(i=Sa(r,e.mode,s)).return=e,e=i),a(e);if(Sn(r))return m(e,i,r,s);if(W(r))return b(e,i,r,s);if(u&&Vn(e,r),void 0===r&&!C)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(g(152,S(e.type)||"Component"))}return n(e,i)}}var Xn=xn(!0),Hn=xn(!1),Yn={},Kn=je(Yn),Nn=je(Yn),Mn=je(Yn);function Fn(e){if(e===Yn)throw Error(g(174));return e}function zn(e,t){$e(Mn,t),$e(Nn,e),$e(Kn,Yn),e=N(t),qe(Kn),$e(Kn,e)}function Ln(){qe(Kn),qe(Nn),qe(Mn)}function kn(e){var t=Fn(Mn.current),n=Fn(Kn.current);n!==(t=M(n,e.type,t))&&($e(Nn,e),$e(Kn,t))}function En(e){Nn.current===e&&(qe(Kn),qe(Nn))}var Tn=je(0);function Un(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Me(n)||Fe(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var _n=null,Jn=null,Dn=!1;function Pn(e,t){var n=Ga(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Qn(e,t){switch(e.tag){case 5:return null!==(t=Ke(t,e.type,e.pendingProps))&&(e.stateNode=t,!0);case 6:return null!==(t=Ne(t,e.pendingProps))&&(e.stateNode=t,!0);case 13:default:return!1}}function On(e){if(Dn){var t=Jn;if(t){var n=t;if(!Qn(e,t)){if(!(t=ze(n))||!Qn(e,t))return e.flags=-1025&e.flags|2,Dn=!1,void(_n=e);Pn(_n,n)}_n=e,Jn=Le(t)}else e.flags=-1025&e.flags|2,Dn=!1,_n=e}}function jn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;_n=e}function qn(e){if(!q||e!==_n)return!1;if(!Dn)return jn(e),Dn=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!U(t,e.memoizedProps))for(t=Jn;t;)Pn(e,t),t=ze(t);if(jn(e),13===e.tag){if(!q)throw Error(g(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(g(317));Jn=Te(e)}else Jn=_n?ze(e.stateNode):null;return!0}function $n(){q&&(Jn=_n=null,Dn=!1)}var ei=[];function ti(){for(var e=0;e<ei.length;e++){var t=ei[e];Q?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}ei.length=0}var ni=s.ReactCurrentDispatcher,ii=s.ReactCurrentBatchConfig,oi=0,ri=null,ai=null,gi=null,si=!1,li=!1;function ci(){throw Error(g(321))}function Ii(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!jt(e[n],t[n]))return!1;return!0}function Ci(e,t,n,i,o,r){if(oi=r,ri=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ni.current=null===e||null===e.memoizedState?Fi:zi,e=n(i,o),li){r=0;do{if(li=!1,!(25>r))throw Error(g(301));r+=1,gi=ai=null,t.updateQueue=null,ni.current=Li,e=n(i,o)}while(li)}if(ni.current=Mi,t=null!==ai&&null!==ai.next,oi=0,gi=ai=ri=null,si=!1,t)throw Error(g(300));return e}function ui(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===gi?ri.memoizedState=gi=e:gi=gi.next=e,gi}function di(){if(null===ai){var e=ri.alternate;e=null!==e?e.memoizedState:null}else e=ai.next;var t=null===gi?ri.memoizedState:gi.next;if(null!==t)gi=t,ai=e;else{if(null===e)throw Error(g(310));e={memoizedState:(ai=e).memoizedState,baseState:ai.baseState,baseQueue:ai.baseQueue,queue:ai.queue,next:null},null===gi?ri.memoizedState=gi=e:gi=gi.next=e}return gi}function hi(e,t){return"function"==typeof t?t(e):t}function Ai(e){var t=di(),n=t.queue;if(null===n)throw Error(g(311));n.lastRenderedReducer=e;var i=ai,o=i.baseQueue,r=n.pending;if(null!==r){if(null!==o){var a=o.next;o.next=r.next,r.next=a}i.baseQueue=o=r,n.pending=null}if(null!==o){o=o.next,i=i.baseState;var s=a=r=null,l=o;do{var c=l.lane;if((oi&c)===c)null!==s&&(s=s.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),i=l.eagerReducer===e?l.eagerState:e(i,l.action);else{var I={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===s?(a=s=I,r=i):s=s.next=I,ri.lanes|=c,Cr|=c}l=l.next}while(null!==l&&l!==o);null===s?r=i:s.next=a,jt(i,t.memoizedState)||(Ei=!0),t.memoizedState=i,t.baseState=r,t.baseQueue=s,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function pi(e){var t=di(),n=t.queue;if(null===n)throw Error(g(311));n.lastRenderedReducer=e;var i=n.dispatch,o=n.pending,r=t.memoizedState;if(null!==o){n.pending=null;var a=o=o.next;do{r=e(r,a.action),a=a.next}while(a!==o);jt(r,t.memoizedState)||(Ei=!0),t.memoizedState=r,null===t.baseQueue&&(t.baseState=r),n.lastRenderedState=r}return[r,i]}function mi(e,t,n){var i=t._getVersion;i=i(t._source);var o=Q?t._workInProgressVersionPrimary:t._workInProgressVersionSecondary;if(null!==o?e=o===i:(e=e.mutableReadLanes,(e=(oi&e)===e)&&(Q?t._workInProgressVersionPrimary=i:t._workInProgressVersionSecondary=i,ei.push(t))),e)return n(t._source);throw ei.push(t),Error(g(350))}function bi(e,t,n,i){var o=or;if(null===o)throw Error(g(349));var r=t._getVersion,a=r(t._source),s=ni.current,l=s.useState((function(){return mi(o,t,n)})),c=l[1],I=l[0];l=gi;var C=e.memoizedState,u=C.refs,d=u.getSnapshot,h=C.source;C=C.subscribe;var A=ri;return e.memoizedState={refs:u,source:t,subscribe:i},s.useEffect((function(){u.getSnapshot=n,u.setSnapshot=c;var e=r(t._source);if(!jt(a,e)){e=n(t._source),jt(I,e)||(c(e),e=Fr(A),o.mutableReadLanes|=e&o.pendingLanes),e=o.mutableReadLanes,o.entangledLanes|=e;for(var i=o.entanglements,g=e;0<g;){var s=31-Gt(g),l=1<<s;i[s]|=e,g&=~l}}}),[n,t,i]),s.useEffect((function(){return i(t._source,(function(){var e=u.getSnapshot,n=u.setSnapshot;try{n(e(t._source));var i=Fr(A);o.mutableReadLanes|=i&o.pendingLanes}catch(r){n((function(){throw r}))}}))}),[t,i]),jt(d,n)&&jt(h,t)&&jt(C,i)||((e={pending:null,dispatch:null,lastRenderedReducer:hi,lastRenderedState:I}).dispatch=c=Ni.bind(null,ri,e),l.queue=e,l.baseQueue=null,I=mi(o,t,n),l.memoizedState=l.baseState=I),I}function fi(e,t,n){return bi(di(),e,t,n)}function yi(e){var t=ui();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:hi,lastRenderedState:e}).dispatch=Ni.bind(null,ri,e),[t.memoizedState,e]}function Gi(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ri.updateQueue)?(t={lastEffect:null},ri.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function vi(e){return e={current:e},ui().memoizedState=e}function Bi(){return di().memoizedState}function Zi(e,t,n,i){var o=ui();ri.flags|=e,o.memoizedState=Gi(1|t,n,void 0,void 0===i?null:i)}function wi(e,t,n,i){var o=di();i=void 0===i?null:i;var r=void 0;if(null!==ai){var a=ai.memoizedState;if(r=a.destroy,null!==i&&Ii(i,a.deps))return void Gi(t,n,r,i)}ri.flags|=e,o.memoizedState=Gi(1|t,n,r,i)}function Wi(e,t){return Zi(516,4,e,t)}function Si(e,t){return wi(516,4,e,t)}function Ri(e,t){return wi(4,2,e,t)}function Vi(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function xi(e,t,n){return n=null!=n?n.concat([e]):null,wi(4,2,Vi.bind(null,t,e),n)}function Xi(){}function Hi(e,t){var n=di();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ii(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Yi(e,t){var n=di();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ii(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ki(e,t){var n=Ut();Jt(98>n?98:n,(function(){e(!0)})),Jt(97<n?97:n,(function(){var n=ii.transition;ii.transition=1;try{e(!1),t()}finally{ii.transition=n}}))}function Ni(e,t,n){var i=Mr(),o=Fr(e),r={lane:o,action:n,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?r.next=r:(r.next=a.next,a.next=r),t.pending=r,a=e.alternate,e===ri||null!==a&&a===ri)li=si=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var g=t.lastRenderedState,s=a(g,n);if(r.eagerReducer=a,r.eagerState=s,jt(s,g))return}catch(l){}zr(e,o,i)}}var Mi={readContext:Cn,useCallback:ci,useContext:ci,useEffect:ci,useImperativeHandle:ci,useLayoutEffect:ci,useMemo:ci,useReducer:ci,useRef:ci,useState:ci,useDebugValue:ci,useDeferredValue:ci,useTransition:ci,useMutableSource:ci,useOpaqueIdentifier:ci,unstable_isNewReconciler:!1},Fi={readContext:Cn,useCallback:function(e,t){return ui().memoizedState=[e,void 0===t?null:t],e},useContext:Cn,useEffect:Wi,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Zi(4,2,Vi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Zi(4,2,e,t)},useMemo:function(e,t){var n=ui();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ui();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ni.bind(null,ri,e),[i.memoizedState,e]},useRef:vi,useState:yi,useDebugValue:Xi,useDeferredValue:function(e){var t=yi(e),n=t[0],i=t[1];return Wi((function(){var t=ii.transition;ii.transition=1;try{i(e)}finally{ii.transition=t}}),[e]),n},useTransition:function(){var e=yi(!1),t=e[0];return vi(e=Ki.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var i=ui();return i.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},bi(i,e,t,n)},useOpaqueIdentifier:function(){if(Dn){var e=!1,t=ee((function(){throw e||(e=!0,n(te())),Error(g(355))})),n=yi(t)[1];return 0==(2&ri.mode)&&(ri.flags|=516,Gi(5,(function(){n(te())}),void 0,null)),t}return yi(t=te()),t},unstable_isNewReconciler:!1},zi={readContext:Cn,useCallback:Hi,useContext:Cn,useEffect:Si,useImperativeHandle:xi,useLayoutEffect:Ri,useMemo:Yi,useReducer:Ai,useRef:Bi,useState:function(){return Ai(hi)},useDebugValue:Xi,useDeferredValue:function(e){var t=Ai(hi),n=t[0],i=t[1];return Si((function(){var t=ii.transition;ii.transition=1;try{i(e)}finally{ii.transition=t}}),[e]),n},useTransition:function(){var e=Ai(hi)[0];return[Bi().current,e]},useMutableSource:fi,useOpaqueIdentifier:function(){return Ai(hi)[0]},unstable_isNewReconciler:!1},Li={readContext:Cn,useCallback:Hi,useContext:Cn,useEffect:Si,useImperativeHandle:xi,useLayoutEffect:Ri,useMemo:Yi,useReducer:pi,useRef:Bi,useState:function(){return pi(hi)},useDebugValue:Xi,useDeferredValue:function(e){var t=pi(hi),n=t[0],i=t[1];return Si((function(){var t=ii.transition;ii.transition=1;try{i(e)}finally{ii.transition=t}}),[e]),n},useTransition:function(){var e=pi(hi)[0];return[Bi().current,e]},useMutableSource:fi,useOpaqueIdentifier:function(){return pi(hi)[0]},unstable_isNewReconciler:!1},ki=s.ReactCurrentOwner,Ei=!1;function Ti(e,t,n,i){t.child=null===e?Hn(t,null,n,i):Xn(t,e.child,n,i)}function Ui(e,t,n,i,o){n=n.render;var r=t.ref;return In(t,o),i=Ci(e,t,n,i,r,o),null===e||Ei?(t.flags|=1,Ti(e,t,i,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~o,Io(e,t,o))}function _i(e,t,n,i,o,r){if(null===e){var a=n.type;return"function"!=typeof a||va(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Za(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ji(e,t,a,i,o,r))}return a=e.child,0==(o&r)&&(o=a.memoizedProps,(n=null!==(n=n.compare)?n:$t)(o,i)&&e.ref===t.ref)?Io(e,t,r):(t.flags|=1,(e=Ba(a,i)).ref=t.ref,e.return=t,t.child=e)}function Ji(e,t,n,i,o,r){if(null!==e&&$t(e.memoizedProps,i)&&e.ref===t.ref){if(Ei=!1,0==(r&o))return t.lanes=e.lanes,Io(e,t,r);0!=(16384&e.flags)&&(Ei=!0)}return Qi(e,t,n,i,r)}function Di(e,t,n){var i=t.pendingProps,o=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode||"unstable-defer-without-hiding"===i.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},Dr(t,n);else{if(0==(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Dr(t,e),null;t.memoizedState={baseLanes:0},Dr(t,null!==r?r.baseLanes:n)}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,Dr(t,i);return Ti(e,t,o,n),t.child}function Pi(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Qi(e,t,n,i,o){var r=rt(n)?it:tt.current;return r=ot(t,r),In(t,o),n=Ci(e,t,n,i,r,o),null===e||Ei?(t.flags|=1,Ti(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~o,Io(e,t,o))}function Oi(e,t,n,i,o){if(rt(n)){var r=!0;lt(t)}else r=!1;if(In(t,o),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Zn(t,n,i),Wn(t,n,i,o),i=!0;else if(null===e){var a=t.stateNode,g=t.memoizedProps;a.props=g;var s=a.context,l=n.contextType;"object"==typeof l&&null!==l?l=Cn(l):l=ot(t,l=rt(n)?it:tt.current);var c=n.getDerivedStateFromProps,I="function"==typeof c||"function"==typeof a.getSnapshotBeforeUpdate;I||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(g!==i||s!==l)&&wn(t,a,i,l),un=!1;var C=t.memoizedState;a.state=C,bn(t,i,a,o),s=t.memoizedState,g!==i||C!==s||nt.current||un?("function"==typeof c&&(Gn(t,n,c,i),s=t.memoizedState),(g=un||Bn(t,n,g,i,C,s,l))?(I||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4)):("function"==typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=i,t.memoizedState=s),a.props=i,a.state=s,a.context=l,i=g):("function"==typeof a.componentDidMount&&(t.flags|=4),i=!1)}else{a=t.stateNode,hn(e,t),g=t.memoizedProps,l=t.type===t.elementType?g:tn(t.type,g),a.props=l,I=t.pendingProps,C=a.context,"object"==typeof(s=n.contextType)&&null!==s?s=Cn(s):s=ot(t,s=rt(n)?it:tt.current);var u=n.getDerivedStateFromProps;(c="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(g!==I||C!==s)&&wn(t,a,i,s),un=!1,C=t.memoizedState,a.state=C,bn(t,i,a,o);var d=t.memoizedState;g!==I||C!==d||nt.current||un?("function"==typeof u&&(Gn(t,n,u,i),d=t.memoizedState),(l=un||Bn(t,n,l,i,C,d,s))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(i,d,s),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,d,s)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof a.componentDidUpdate||g===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||g===e.memoizedProps&&C===e.memoizedState||(t.flags|=256),t.memoizedProps=i,t.memoizedState=d),a.props=i,a.state=d,a.context=s,i=l):("function"!=typeof a.componentDidUpdate||g===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||g===e.memoizedProps&&C===e.memoizedState||(t.flags|=256),i=!1)}return ji(e,t,n,i,r,o)}function ji(e,t,n,i,o,r){Pi(e,t);var a=0!=(64&t.flags);if(!i&&!a)return o&&ct(t,n,!1),Io(e,t,r);i=t.stateNode,ki.current=t;var g=a&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=Xn(t,e.child,null,r),t.child=Xn(t,null,g,r)):Ti(e,t,g,r),t.memoizedState=i.state,o&&ct(t,n,!0),t.child}function qi(e){var t=e.stateNode;t.pendingContext?gt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gt(0,t.context,!1),zn(e,t.containerInfo)}var $i,eo,to,no,io={dehydrated:null,retryLane:0};function oo(e,t,n){var i,o=t.pendingProps,r=Tn.current,a=!1;return(i=0!=(64&t.flags))||(i=(null===e||null!==e.memoizedState)&&0!=(2&r)),i?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(r|=1),$e(Tn,1&r),null===e?(void 0!==o.fallback&&On(t),e=o.children,r=o.fallback,a?(e=ro(t,e,r,n),t.child.memoizedState={baseLanes:n},t.memoizedState=io,e):"number"==typeof o.unstable_expectedLoadTime?(e=ro(t,e,r,n),t.child.memoizedState={baseLanes:n},t.memoizedState=io,t.lanes=33554432,e):((n=Wa({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,a?(o=go(e,t,o.children,o.fallback,n),a=t.child,r=e.child.memoizedState,a.memoizedState=null===r?{baseLanes:n}:{baseLanes:r.baseLanes|n},a.childLanes=e.childLanes&~n,t.memoizedState=io,o):(n=ao(e,t,o.children,n),t.memoizedState=null,n))}function ro(e,t,n,i){var o=e.mode,r=e.child;return t={mode:"hidden",children:t},0==(2&o)&&null!==r?(r.childLanes=0,r.pendingProps=t):r=Wa(t,o,0,null),n=wa(n,o,i,null),r.return=e,n.return=e,r.sibling=n,e.child=r,n}function ao(e,t,n,i){var o=e.child;return e=o.sibling,n=Ba(o,{mode:"visible",children:n}),0==(2&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function go(e,t,n,i,o){var r=t.mode,a=e.child;e=a.sibling;var g={mode:"hidden",children:n};return 0==(2&r)&&t.child!==a?((n=t.child).childLanes=0,n.pendingProps=g,null!==(a=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Ba(a,g),null!==e?i=Ba(e,i):(i=wa(i,r,o,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function so(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),cn(e.return,t)}function lo(e,t,n,i,o,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o,lastEffect:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=o,a.lastEffect=r)}function co(e,t,n){var i=t.pendingProps,o=i.revealOrder,r=i.tail;if(Ti(e,t,i.children,n),0!=(2&(i=Tn.current)))i=1&i|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&so(e,n);else if(19===e.tag)so(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if($e(Tn,i),0==(2&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===Un(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),lo(t,!1,o,n,r,t.lastEffect);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===Un(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}lo(t,!0,n,null,r,t.lastEffect);break;case"together":lo(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Io(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Cr|=t.lanes,0!=(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(g(153));if(null!==t.child){for(n=Ba(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ba(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function Co(e){e.flags|=4}if(O)$i=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)k(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},eo=function(){},to=function(e,t,n,i,o){if((e=e.memoizedProps)!==i){var r=t.stateNode,a=Fn(Kn.current);n=T(r,n,e,i,o,a),(t.updateQueue=n)&&Co(t)}},no=function(e,t,n,i){n!==i&&Co(t)};else if(j){$i=function(e,t,n,i){for(var o=t.child;null!==o;){if(5===o.tag){var r=o.stateNode;n&&i&&(r=He(r,o.type,o.memoizedProps,o)),k(e,r)}else if(6===o.tag)r=o.stateNode,n&&i&&(r=Ye(r,o.memoizedProps,o)),k(e,r);else if(4!==o.tag){if(13===o.tag&&0!=(4&o.flags)&&(r=null!==o.memoizedState)){var a=o.child;if(null!==a&&(null!==a.child&&(a.child.return=a,$i(e,a,!0,r)),null!==(r=a.sibling))){r.return=o,o=r;continue}}if(null!==o.child){o.child.return=o,o=o.child;continue}}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};var uo=function(e,t,n,i){for(var o=t.child;null!==o;){if(5===o.tag){var r=o.stateNode;n&&i&&(r=He(r,o.type,o.memoizedProps,o)),Ve(e,r)}else if(6===o.tag)r=o.stateNode,n&&i&&(r=Ye(r,o.memoizedProps,o)),Ve(e,r);else if(4!==o.tag){if(13===o.tag&&0!=(4&o.flags)&&(r=null!==o.memoizedState)){var a=o.child;if(null!==a&&(null!==a.child&&(a.child.return=a,uo(e,a,!0,r)),null!==(r=a.sibling))){r.return=o,o=r;continue}}if(null!==o.child){o.child.return=o,o=o.child;continue}}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};eo=function(e){var t=e.stateNode;if(null!==e.firstEffect){var n=t.containerInfo,i=Re(n);uo(i,e,!1,!1),t.pendingChildren=i,Co(e),xe(n,i)}},to=function(e,t,n,i,o){var r=e.stateNode,a=e.memoizedProps;if((e=null===t.firstEffect)&&a===i)t.stateNode=r;else{var g=t.stateNode,s=Fn(Kn.current),l=null;a!==i&&(l=T(g,n,a,i,o,s)),e&&null===l?t.stateNode=r:(r=Se(r,l,n,a,i,t,e,g),E(r,n,i,o,s)&&Co(t),t.stateNode=r,e?Co(t):$i(r,t,!1,!1))}},no=function(e,t,n,i){n!==i?(e=Fn(Mn.current),n=Fn(Kn.current),t.stateNode=_(i,e,n,t),Co(t)):t.stateNode=e.stateNode}}else eo=function(){},to=function(){},no=function(){};function ho(e,t){if(!Dn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ao(e,t,n){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return rt(t.type)&&at(),null;case 3:return Ln(),qe(nt),qe(tt),ti(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(qn(t)?Co(t):i.hydrate||(t.flags|=256)),eo(t),null;case 5:En(t);var o=Fn(Mn.current);if(n=t.type,null!==e&&null!=t.stateNode)to(e,t,n,i,o),e.ref!==t.ref&&(t.flags|=128);else{if(!i){if(null===t.stateNode)throw Error(g(166));return null}if(e=Fn(Kn.current),qn(t)){if(!q)throw Error(g(175));e=ke(t.stateNode,t.type,t.memoizedProps,o,e,t),t.updateQueue=e,null!==e&&Co(t)}else{var r=L(n,i,o,e,t);$i(r,t,!1,!1),t.stateNode=r,E(r,n,i,o,e)&&Co(t)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)no(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(g(166));if(e=Fn(Mn.current),o=Fn(Kn.current),qn(t)){if(!q)throw Error(g(176));Ee(t.stateNode,t.memoizedProps,t)&&Co(t)}else t.stateNode=_(i,e,o,t)}return null;case 13:return qe(Tn),i=t.memoizedState,0!=(64&t.flags)?(t.lanes=n,t):(i=null!==i,o=!1,null===e?void 0!==t.memoizedProps.fallback&&qn(t):o=null!==e.memoizedState,i&&!o&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Tn.current)?0===lr&&(lr=3):(0!==lr&&3!==lr||(lr=4),null===or||0==(134217727&Cr)&&0==(134217727&ur)||Tr(or,ar))),j&&i&&(t.flags|=4),O&&(i||o)&&(t.flags|=4),null);case 4:return Ln(),eo(t),null===e&&oe(t.stateNode.containerInfo),null;case 10:return ln(t),null;case 17:return rt(t.type)&&at(),null;case 19:if(qe(Tn),null===(i=t.memoizedState))return null;if(o=0!=(64&t.flags),null===(r=i.rendering))if(o)ho(i,!1);else{if(0!==lr||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(r=Un(e))){for(t.flags|=64,ho(i,!1),null!==(e=r.updateQueue)&&(t.updateQueue=e,t.flags|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,e=n,i=t.child;null!==i;)n=e,(o=i).flags&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(r=o.alternate)?(o.childLanes=0,o.lanes=n,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,o.type=r.type,n=r.dependencies,o.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext}),i=i.sibling;return $e(Tn,1&Tn.current|2),t.child}e=e.sibling}null!==i.tail&&Tt()>pr&&(t.flags|=64,o=!0,ho(i,!1),t.lanes=33554432)}else{if(!o)if(null!==(e=Un(r))){if(t.flags|=64,o=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),ho(i,!0),null===i.tail&&"hidden"===i.tailMode&&!r.alternate&&!Dn)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*Tt()-i.renderingStartTime>pr&&1073741824!==n&&(t.flags|=64,o=!0,ho(i,!1),t.lanes=33554432);i.isBackwards?(r.sibling=t.child,t.child=r):(null!==(e=i.last)?e.sibling=r:t.child=r,i.last=r)}return null!==i.tail?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=Tt(),e.sibling=null,t=Tn.current,$e(Tn,o?1&t|2:1&t),e):null;case 23:case 24:return Pr(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==i.mode&&(t.flags|=4),null}throw Error(g(156,t.tag))}function po(e){switch(e.tag){case 1:rt(e.type)&&at();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Ln(),qe(nt),qe(tt),ti(),0!=(64&(t=e.flags)))throw Error(g(285));return e.flags=-4097&t|64,e;case 5:return En(e),null;case 13:return qe(Tn),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return qe(Tn),null;case 4:return Ln(),null;case 10:return ln(e),null;case 23:case 24:return Pr(),null;default:return null}}function mo(e,t){try{var n="",i=t;do{n+=en(i),i=i.return}while(i);var o=n}catch(r){o="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:o}}function bo(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fo="function"==typeof WeakMap?WeakMap:Map;function yo(e,t,n){(n=An(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){yr||(yr=!0,Gr=i),bo(0,t)},n}function Go(e,t,n){(n=An(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var o=t.value;n.payload=function(){return bo(0,t),i(o)}}var r=e.stateNode;return null!==r&&"function"==typeof r.componentDidCatch&&(n.callback=function(){"function"!=typeof i&&(null===vr?vr=new Set([this]):vr.add(this),bo(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var vo="function"==typeof WeakSet?WeakSet:Set;function Bo(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(n){Ia(e,n)}else t.current=null}function Zo(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:tn(t.type,n),i),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(O&&256&t.flags&&We(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(g(163))}function wo(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.destroy;n.destroy=void 0,void 0!==i&&i()}n=n.next}while(n!==t)}}function Wo(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var i=e.create;e.destroy=i()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var o=e;i=o.next,0!=(4&(o=o.tag))&&0!=(1&o)&&(sa(n,e),ga(n,e)),e=i}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(i=n.elementType===n.type?t.memoizedProps:tn(n.type,t.memoizedProps),e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&fn(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=K(n.child.stateNode);break;case 1:e=n.child.stateNode}fn(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Ae(e,n.type,n.memoizedProps,n));case 6:case 4:case 12:return;case 13:return void(q&&null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&_e(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(g(163))}function So(e,t){if(O)for(var n=e;;){if(5===n.tag){var i=n.stateNode;t?ve(i):Ze(n.stateNode,n.memoizedProps)}else if(6===n.tag)i=n.stateNode,t?Be(i):we(i,n.memoizedProps);else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function Ro(e,t){if(Ct&&"function"==typeof Ct.onCommitFiberUnmount)try{Ct.onCommitFiberUnmount(It,t)}catch(r){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var i=n,o=i.destroy;if(i=i.tag,void 0!==o)if(0!=(4&i))sa(t,n);else{i=t;try{o()}catch(r){Ia(i,r)}}n=n.next}while(n!==e)}break;case 1:if(Bo(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(r){Ia(t,r)}break;case 5:Bo(t);break;case 4:O?No(e,t):j&&j&&(t=t.stateNode.containerInfo,e=Re(t),Xe(t,e))}}function Vo(e,t){for(var n=t;;)if(Ro(e,n),null===n.child||O&&4===n.tag){if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}else n.child.return=n,n=n.child}function xo(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function Xo(e){return 5===e.tag||3===e.tag||4===e.tag}function Ho(e){if(O){e:{for(var t=e.return;null!==t;){if(Xo(t))break e;t=t.return}throw Error(g(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(g(161))}16&n.flags&&(Ge(t),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||Xo(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}i?Yo(e,n,t):Ko(e,n,t)}}function Yo(e,t,n){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,t?be(n,e,t):de(n,e);else if(4!==i&&null!==(e=e.child))for(Yo(e,t,n),e=e.sibling;null!==e;)Yo(e,t,n),e=e.sibling}function Ko(e,t,n){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,t?me(n,e,t):ue(n,e);else if(4!==i&&null!==(e=e.child))for(Ko(e,t,n),e=e.sibling;null!==e;)Ko(e,t,n),e=e.sibling}function No(e,t){for(var n,i,o=t,r=!1;;){if(!r){r=o.return;e:for(;;){if(null===r)throw Error(g(160));switch(n=r.stateNode,r.tag){case 5:i=!1;break e;case 3:case 4:n=n.containerInfo,i=!0;break e}r=r.return}r=!0}if(5===o.tag||6===o.tag)Vo(e,o),i?ye(n,o.stateNode):fe(n,o.stateNode);else if(4===o.tag){if(null!==o.child){n=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(Ro(e,o),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(r=!1)}o.sibling.return=o.return,o=o.sibling}}function Mo(e,t){if(O){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void wo(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps;e=null!==e?e.memoizedProps:i;var o=t.type,r=t.updateQueue;t.updateQueue=null,null!==r&&pe(n,r,o,e,i,t)}return;case 6:if(null===t.stateNode)throw Error(g(162));return n=t.memoizedProps,void he(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(q&&(t=t.stateNode,t.hydrate&&(t.hydrate=!1,Ue(t.containerInfo))));case 12:return;case 13:return Fo(t),void zo(t);case 19:return void zo(t);case 17:return;case 23:case 24:return void So(t,null!==t.memoizedState)}throw Error(g(163))}switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void wo(3,t);case 12:return;case 13:return Fo(t),void zo(t);case 19:return void zo(t);case 3:q&&((n=t.stateNode).hydrate&&(n.hydrate=!1,Ue(n.containerInfo)));break;case 23:case 24:return}e:if(j){switch(t.tag){case 1:case 5:case 6:case 20:break e;case 3:case 4:t=t.stateNode,Xe(t.containerInfo,t.pendingChildren);break e}throw Error(g(163))}}function Fo(e){null!==e.memoizedState&&(Ar=Tt(),O&&So(e.child,!0))}function zo(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new vo),t.forEach((function(t){var i=ua.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function Lo(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var ko=0,Eo=1,To=2,Uo=3,_o=4;if("function"==typeof Symbol&&Symbol.for){var Jo=Symbol.for;ko=Jo("selector.component"),Eo=Jo("selector.has_pseudo_class"),To=Jo("selector.role"),Uo=Jo("selector.test_id"),_o=Jo("selector.text")}function Do(e){var t=$(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw Error(g(364));return t}if(null===(e=ae(e)))throw Error(g(362));return e.stateNode.current}function Po(e,t){switch(t.$$typeof){case ko:if(e.type===t.value)return!0;break;case Eo:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var i=e[n++],o=e[n++],r=t[o];if(5!==i.tag||!le(i)){for(;null!=r&&Po(i,r);)r=t[++o];if(o===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,o),i=i.sibling}}t=!1}return t;case To:if(5===e.tag&&ce(e.stateNode,t.value))return!0;break;case _o:if((5===e.tag||6===e.tag)&&(null!==(e=se(e))&&0<=e.indexOf(t.value)))return!0;break;case Uo:if(5===e.tag&&("string"==typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(g(365,t))}return!1}function Qo(e){switch(e.$$typeof){case ko:return"<"+(S(e.value)||"Unknown")+">";case Eo:return":has("+(Qo(e)||"")+")";case To:return'[role="'+e.value+'"]';case _o:return'"'+e.value+'"';case Uo:return'[data-testname="'+e.value+'"]';default:throw Error(g(365,e))}}function Oo(e,t){var n=[];e=[e,0];for(var i=0;i<e.length;){var o=e[i++],r=e[i++],a=t[r];if(5!==o.tag||!le(o)){for(;null!=a&&Po(o,a);)a=t[++r];if(r===t.length)n.push(o);else for(o=o.child;null!==o;)e.push(o,r),o=o.sibling}}return n}function jo(e,t){if(!re)throw Error(g(363));e=Oo(e=Do(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++];if(5===i.tag)le(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}var qo=null;var $o=Math.ceil,er=s.ReactCurrentDispatcher,tr=s.ReactCurrentOwner,nr=s.IsSomeRendererActing,ir=0,or=null,rr=null,ar=0,gr=0,sr=je(0),lr=0,cr=null,Ir=0,Cr=0,ur=0,dr=0,hr=null,Ar=0,pr=1/0;function mr(){pr=Tt()+500}var br,fr=null,yr=!1,Gr=null,vr=null,Br=!1,Zr=null,wr=90,Wr=[],Sr=[],Rr=null,Vr=0,xr=null,Xr=-1,Hr=0,Yr=0,Kr=null,Nr=!1;function Mr(){return 0!=(48&ir)?Tt():-1!==Xr?Xr:Xr=Tt()}function Fr(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Ut()?1:2;if(0===Hr&&(Hr=Ir),0!==Ot.transition){0!==Yr&&(Yr=null!==hr?hr.pendingLanes:0),e=Hr;var t=4186112&~Yr;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Ut(),0!=(4&ir)&&98===e?e=mt(12,Hr):e=mt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),Hr),e}function zr(e,t,n){if(50<Vr)throw Vr=0,xr=null,Error(g(185));if(null===(e=Lr(e,t)))return null;yt(e,t,n),e===or&&(ur|=t,4===lr&&Tr(e,ar));var i=Ut();1===t?0!=(8&ir)&&0==(48&ir)?Ur(e):(kr(e,n),0===ir&&(mr(),Pt())):(0==(4&ir)||98!==i&&99!==i||(null===Rr?Rr=new Set([e]):Rr.add(e)),kr(e,n)),hr=e}function Lr(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function kr(e,t){for(var n=e.callbackNode,i=e.suspendedLanes,o=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-Gt(a),l=1<<s,c=r[s];if(-1===c){if(0==(l&i)||0!=(l&o)){c=t,ht(l);var I=dt;r[s]=10<=I?c+250:6<=I?c+5e3:-1}}else c<=t&&(e.expiredLanes|=l);a&=~l}if(i=At(e,e===or?ar:0),t=dt,0===i)null!==n&&(n!==Mt&&Wt(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Mt&&Wt(n)}15===t?(n=Ur.bind(null,e),null===zt?(zt=[n],Lt=wt(Xt,Qt)):zt.push(n),n=Mt):14===t?n=Dt(99,Ur.bind(null,e)):n=Dt(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(g(358,e))}}(t),Er.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function Er(e){if(Xr=-1,Yr=Hr=0,0!=(48&ir))throw Error(g(327));var t=e.callbackNode;if(aa()&&e.callbackNode!==t)return null;var n=At(e,e===or?ar:0);if(0===n)return null;var i=n,o=ir;ir|=16;var r=jr();for(or===e&&ar===i||(mr(),Qr(e,i));;)try{ea();break}catch(s){Or(e,s)}if(gn(),er.current=r,ir=o,null!==rr?i=0:(or=null,ar=0,i=lr),0!=(Ir&ur))Qr(e,0);else if(0!==i){if(2===i&&(ir|=64,e.hydrate&&(e.hydrate=!1,We(e.containerInfo)),0!==(n=pt(e))&&(i=qr(e,n))),1===i)throw t=cr,Qr(e,0),Tr(e,n),kr(e,Tt()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,i){case 0:case 1:throw Error(g(345));case 2:ia(e);break;case 3:if(Tr(e,n),(62914560&n)===n&&10<(i=Ar+500-Tt())){if(0!==At(e,0))break;if(((o=e.suspendedLanes)&n)!==n){Mr(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=J(ia.bind(null,e),i);break}ia(e);break;case 4:if(Tr(e,n),(4186112&n)===n)break;for(i=e.eventTimes,o=-1;0<n;){var a=31-Gt(n);r=1<<a,(a=i[a])>o&&(o=a),n&=~r}if(n=o,10<(n=(120>(n=Tt()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*$o(n/1960))-n)){e.timeoutHandle=J(ia.bind(null,e),n);break}ia(e);break;case 5:ia(e);break;default:throw Error(g(329))}}return kr(e,Tt()),e.callbackNode===t?Er.bind(null,e):null}function Tr(e,t){for(t&=~dr,t&=~ur,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Gt(t),i=1<<n;e[n]=-1,t&=~i}}function Ur(e){if(0!=(48&ir))throw Error(g(327));if(aa(),e===or&&0!=(e.expiredLanes&ar)){var t=ar,n=qr(e,t);0!=(Ir&ur)&&(n=qr(e,t=At(e,t)))}else n=qr(e,t=At(e,0));if(0!==e.tag&&2===n&&(ir|=64,e.hydrate&&(e.hydrate=!1,We(e.containerInfo)),0!==(t=pt(e))&&(n=qr(e,t))),1===n)throw n=cr,Qr(e,0),Tr(e,t),kr(e,Tt()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,ia(e),kr(e,Tt()),null}function _r(e,t){var n=ir;ir|=1;try{return e(t)}finally{0===(ir=n)&&(mr(),Pt())}}function Jr(e,t){var n=ir;if(0!=(48&n))return e(t);ir|=1;try{if(e)return Jt(99,e.bind(null,t))}finally{ir=n,Pt()}}function Dr(e,t){$e(sr,gr),gr|=t,Ir|=t}function Pr(){gr=sr.current,qe(sr)}function Qr(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==P&&(e.timeoutHandle=P,D(n)),null!==rr)for(n=rr.return;null!==n;){var i=n;switch(i.tag){case 1:null!=(i=i.type.childContextTypes)&&at();break;case 3:Ln(),qe(nt),qe(tt),ti();break;case 5:En(i);break;case 4:Ln();break;case 13:case 19:qe(Tn);break;case 10:ln(i);break;case 23:case 24:Pr()}n=n.return}or=e,rr=Ba(e.current,null),ar=gr=Ir=t,lr=0,cr=null,dr=ur=Cr=0}function Or(e,t){for(;;){var n=rr;try{if(gn(),ni.current=Mi,si){for(var i=ri.memoizedState;null!==i;){var o=i.queue;null!==o&&(o.pending=null),i=i.next}si=!1}if(oi=0,gi=ai=ri=null,li=!1,tr.current=null,null===n||null===n.return){lr=1,cr=t,rr=null;break}e:{var r=e,a=n.return,g=n,s=t;if(t=ar,g.flags|=2048,g.firstEffect=g.lastEffect=null,null!==s&&"object"==typeof s&&"function"==typeof s.then){var l=s;if(0==(2&g.mode)){var c=g.alternate;c?(g.updateQueue=c.updateQueue,g.memoizedState=c.memoizedState,g.lanes=c.lanes):(g.updateQueue=null,g.memoizedState=null)}var I=0!=(1&Tn.current),C=a;do{var u;if(u=13===C.tag){var d=C.memoizedState;if(null!==d)u=null!==d.dehydrated;else{var h=C.memoizedProps;u=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!I)}}if(u){var A=C.updateQueue;if(null===A){var p=new Set;p.add(l),C.updateQueue=p}else A.add(l);if(0==(2&C.mode)){if(C.flags|=64,g.flags|=16384,g.flags&=-2981,1===g.tag)if(null===g.alternate)g.tag=17;else{var m=An(-1,1);m.tag=2,pn(g,m)}g.lanes|=1;break e}s=void 0,g=t;var b=r.pingCache;if(null===b?(b=r.pingCache=new fo,s=new Set,b.set(l,s)):void 0===(s=b.get(l))&&(s=new Set,b.set(l,s)),!s.has(g)){s.add(g);var f=Ca.bind(null,r,l,g);l.then(f,f)}C.flags|=4096,C.lanes=t;break e}C=C.return}while(null!==C);s=Error((S(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==lr&&(lr=2),s=mo(s,g),C=a;do{switch(C.tag){case 3:r=s,C.flags|=4096,t&=-t,C.lanes|=t,mn(C,yo(0,r,t));break e;case 1:r=s;var y=C.type,G=C.stateNode;if(0==(64&C.flags)&&("function"==typeof y.getDerivedStateFromError||null!==G&&"function"==typeof G.componentDidCatch&&(null===vr||!vr.has(G)))){C.flags|=4096,t&=-t,C.lanes|=t,mn(C,Go(C,r,t));break e}}C=C.return}while(null!==C)}na(n)}catch(v){t=v,rr===n&&null!==n&&(rr=n=n.return);continue}break}}function jr(){var e=er.current;return er.current=Mi,null===e?Mi:e}function qr(e,t){var n=ir;ir|=16;var i=jr();for(or===e&&ar===t||Qr(e,t);;)try{$r();break}catch(o){Or(e,o)}if(gn(),ir=n,er.current=i,null!==rr)throw Error(g(261));return or=null,ar=0,lr}function $r(){for(;null!==rr;)ta(rr)}function ea(){for(;null!==rr&&!St();)ta(rr)}function ta(e){var t=br(e.alternate,e,gr);e.memoizedProps=e.pendingProps,null===t?na(e):rr=t,tr.current=null}function na(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(n=Ao(n,t,gr)))return void(rr=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!=(1073741824&gr)||0==(4&n.mode)){for(var i=0,o=n.child;null!==o;)i|=o.lanes|o.childLanes,o=o.sibling;n.childLanes=i}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=po(t)))return n.flags&=2047,void(rr=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(rr=t);rr=t=e}while(null!==t);0===lr&&(lr=5)}function ia(e){var t=Ut();return Jt(99,oa.bind(null,e,t)),null}function oa(e,t){do{aa()}while(null!==Zr);if(0!=(48&ir))throw Error(g(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(g(177));e.callbackNode=null;var i=n.lanes|n.childLanes,o=i,r=e.pendingLanes&~o;e.pendingLanes=o,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=o,e.mutableReadLanes&=o,e.entangledLanes&=o,o=e.entanglements;for(var a=e.eventTimes,s=e.expirationTimes;0<r;){var l=31-Gt(r),c=1<<l;o[l]=0,a[l]=-1,s[l]=-1,r&=~c}if(null!==Rr&&0==(24&i)&&Rr.has(e)&&Rr.delete(e),e===or&&(rr=or=null,ar=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){o=ir,ir|=32,tr.current=null,Kr=F(e.containerInfo),Nr=!1,fr=i;do{try{ra()}catch(m){if(null===fr)throw Error(g(330));Ia(fr,m),fr=fr.nextEffect}}while(null!==fr);Kr=null,fr=i;do{try{for(a=e;null!==fr;){var I=fr.flags;if(16&I&&O&&Ge(fr.stateNode),128&I){var C=fr.alternate;if(null!==C){var u=C.ref;null!==u&&("function"==typeof u?u(null):u.current=null)}}switch(1038&I){case 2:Ho(fr),fr.flags&=-3;break;case 6:Ho(fr),fr.flags&=-3,Mo(fr.alternate,fr);break;case 1024:fr.flags&=-1025;break;case 1028:fr.flags&=-1025,Mo(fr.alternate,fr);break;case 4:Mo(fr.alternate,fr);break;case 8:s=a,r=fr,O?No(s,r):Vo(s,r);var d=r.alternate;xo(r),null!==d&&xo(d)}fr=fr.nextEffect}}catch(m){if(null===fr)throw Error(g(330));Ia(fr,m),fr=fr.nextEffect}}while(null!==fr);Nr&&ie(),z(e.containerInfo),e.current=n,fr=i;do{try{for(I=e;null!==fr;){var h=fr.flags;if(36&h&&Wo(I,fr.alternate,fr),128&h){C=void 0;var A=fr.ref;if(null!==A){var p=fr.stateNode;switch(fr.tag){case 5:C=K(p);break;default:C=p}"function"==typeof A?A(C):A.current=C}}fr=fr.nextEffect}}catch(m){if(null===fr)throw Error(g(330));Ia(fr,m),fr=fr.nextEffect}}while(null!==fr);fr=null,Ft(),ir=o}else e.current=n;if(Br)Br=!1,Zr=e,wr=t;else for(fr=i;null!==fr;)t=fr.nextEffect,fr.nextEffect=null,8&fr.flags&&((h=fr).sibling=null,h.stateNode=null),fr=t;if(0===(i=e.pendingLanes)&&(vr=null),1===i?e===xr?Vr++:(Vr=0,xr=e):Vr=0,n=n.stateNode,Ct&&"function"==typeof Ct.onCommitFiberRoot)try{Ct.onCommitFiberRoot(It,n,void 0,64==(64&n.current.flags))}catch(m){}if(kr(e,Tt()),yr)throw yr=!1,e=Gr,Gr=null,e;return 0!=(8&ir)||Pt(),null}function ra(){for(;null!==fr;){var e=fr.alternate;Nr||null===Kr||(0!=(8&fr.flags)?H(fr,Kr)&&(Nr=!0,ne()):13===fr.tag&&Lo(e,fr)&&H(fr,Kr)&&(Nr=!0,ne()));var t=fr.flags;0!=(256&t)&&Zo(e,fr),0==(512&t)||Br||(Br=!0,Dt(97,(function(){return aa(),null}))),fr=fr.nextEffect}}function aa(){if(90!==wr){var e=97<wr?97:wr;return wr=90,Jt(e,la)}return!1}function ga(e,t){Wr.push(t,e),Br||(Br=!0,Dt(97,(function(){return aa(),null})))}function sa(e,t){Sr.push(t,e),Br||(Br=!0,Dt(97,(function(){return aa(),null})))}function la(){if(null===Zr)return!1;var e=Zr;if(Zr=null,0!=(48&ir))throw Error(g(331));var t=ir;ir|=32;var n=Sr;Sr=[];for(var i=0;i<n.length;i+=2){var o=n[i],r=n[i+1],a=o.destroy;if(o.destroy=void 0,"function"==typeof a)try{a()}catch(l){if(null===r)throw Error(g(330));Ia(r,l)}}for(n=Wr,Wr=[],i=0;i<n.length;i+=2){o=n[i],r=n[i+1];try{var s=o.create;o.destroy=s()}catch(l){if(null===r)throw Error(g(330));Ia(r,l)}}for(s=e.current.firstEffect;null!==s;)e=s.nextEffect,s.nextEffect=null,8&s.flags&&(s.sibling=null,s.stateNode=null),s=e;return ir=t,Pt(),!0}function ca(e,t,n){pn(e,t=yo(0,t=mo(n,t),1)),t=Mr(),null!==(e=Lr(e,1))&&(yt(e,1,t),kr(e,t))}function Ia(e,t){if(3===e.tag)ca(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){ca(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===vr||!vr.has(i))){var o=Go(n,e=mo(t,e),1);if(pn(n,o),o=Mr(),null!==(n=Lr(n,1)))yt(n,1,o),kr(n,o);else if("function"==typeof i.componentDidCatch&&(null===vr||!vr.has(i)))try{i.componentDidCatch(t,e)}catch(r){}break}}n=n.return}}function Ca(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=Mr(),e.pingedLanes|=e.suspendedLanes&n,or===e&&(ar&n)===n&&(4===lr||3===lr&&(62914560&ar)===ar&&500>Tt()-Ar?Qr(e,0):dr|=n),kr(e,t)}function ua(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Ut()?1:2:(0===Hr&&(Hr=Ir),0===(t=bt(62914560&~Hr))&&(t=4194304))),n=Mr(),null!==(e=Lr(e,t))&&(yt(e,t,n),kr(e,n))}br=function(e,t,n){var i=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||nt.current)Ei=!0;else{if(0==(n&i)){switch(Ei=!1,t.tag){case 3:qi(t),$n();break;case 5:kn(t);break;case 1:rt(t.type)&&lt(t);break;case 4:zn(t,t.stateNode.containerInfo);break;case 10:sn(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!=(n&t.child.childLanes)?oo(e,t,n):($e(Tn,1&Tn.current),null!==(t=Io(e,t,n))?t.sibling:null);$e(Tn,1&Tn.current);break;case 19:if(i=0!=(n&t.childLanes),0!=(64&e.flags)){if(i)return co(e,t,n);t.flags|=64}var o=t.memoizedState;if(null!==o&&(o.rendering=null,o.tail=null,o.lastEffect=null),$e(Tn,Tn.current),i)break;return null;case 23:case 24:return t.lanes=0,Di(e,t,n)}return Io(e,t,n)}Ei=0!=(16384&e.flags)}else Ei=!1;switch(t.lanes=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,o=ot(t,tt.current),In(t,n),o=Ci(null,t,i,e,o,n),t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,rt(i)){var r=!0;lt(t)}else r=!1;t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,dn(t);var a=i.getDerivedStateFromProps;"function"==typeof a&&Gn(t,i,a,e),o.updater=vn,t.stateNode=o,o._reactInternals=t,Wn(t,i,e,n),t=ji(null,t,i,!0,r,n)}else t.tag=0,Ti(null,t,o,n),t=t.child;return t;case 16:o=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,o=(r=o._init)(o._payload),t.type=o,r=t.tag=function(e){if("function"==typeof e)return va(e)?1:0;if(null!=e){if((e=e.$$typeof)===A)return 11;if(e===b)return 14}return 2}(o),e=tn(o,e),r){case 0:t=Qi(null,t,o,e,n);break e;case 1:t=Oi(null,t,o,e,n);break e;case 11:t=Ui(null,t,o,e,n);break e;case 14:t=_i(null,t,o,tn(o.type,e),i,n);break e}throw Error(g(306,o,""))}return t;case 0:return i=t.type,o=t.pendingProps,Qi(e,t,i,o=t.elementType===i?o:tn(i,o),n);case 1:return i=t.type,o=t.pendingProps,Oi(e,t,i,o=t.elementType===i?o:tn(i,o),n);case 3:if(qi(t),i=t.updateQueue,null===e||null===i)throw Error(g(282));if(i=t.pendingProps,o=null!==(o=t.memoizedState)?o.element:null,hn(e,t),bn(t,i,null,n),(i=t.memoizedState.element)===o)$n(),t=Io(e,t,n);else{if((r=(o=t.stateNode).hydrate)&&(q?(Jn=Le(t.stateNode.containerInfo),_n=t,r=Dn=!0):r=!1),r){if(q&&null!=(e=o.mutableSourceEagerHydrationData))for(o=0;o<e.length;o+=2)r=e[o],a=e[o+1],Q?r._workInProgressVersionPrimary=a:r._workInProgressVersionSecondary=a,ei.push(r);for(n=Hn(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ti(e,t,i,n),$n();t=t.child}return t;case 5:return kn(t),null===e&&On(t),i=t.type,o=t.pendingProps,r=null!==e?e.memoizedProps:null,a=o.children,U(i,o)?a=null:null!==r&&U(i,r)&&(t.flags|=16),Pi(e,t),Ti(e,t,a,n),t.child;case 6:return null===e&&On(t),null;case 13:return oo(e,t,n);case 4:return zn(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Xn(t,null,i,n):Ti(e,t,i,n),t.child;case 11:return i=t.type,o=t.pendingProps,Ui(e,t,i,o=t.elementType===i?o:tn(i,o),n);case 7:return Ti(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ti(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,o=t.pendingProps,a=t.memoizedProps,sn(t,r=o.value),null!==a){var s=a.value;if(0===(r=jt(s,r)?0:0|("function"==typeof i._calculateChangedBits?i._calculateChangedBits(s,r):1073741823))){if(a.children===o.children&&!nt.current){t=Io(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===i&&0!=(c.observedBits&r)){1===s.tag&&((c=An(-1,n&-n)).tag=2,pn(s,c)),s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),cn(s.return,n),l.lanes|=n;break}c=c.next}}else a=10===s.tag&&s.type===t.type?null:s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}}Ti(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,i=(r=t.pendingProps).children,In(t,n),i=i(o=Cn(o,r.unstable_observedBits)),t.flags|=1,Ti(e,t,i,n),t.child;case 14:return r=tn(o=t.type,t.pendingProps),_i(e,t,o,r=tn(o.type,r),i,n);case 15:return Ji(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,o=t.pendingProps,o=t.elementType===i?o:tn(i,o),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,rt(i)?(e=!0,lt(t)):e=!1,In(t,n),Zn(t,i,o),Wn(t,i,o,n),ji(null,t,i,!0,e,n);case 19:return co(e,t,n);case 23:case 24:return Di(e,t,n)}throw Error(g(156,t.tag))};var da={current:!1},ha=a.unstable_flushAllWithoutAsserting,Aa="function"==typeof ha;function pa(){if(void 0!==ha)return ha();for(var e=!1;aa();)e=!0;return e}function ma(t){try{pa(),function(t){if(null===qo)try{var n=("require"+Math.random()).slice(0,7);qo=(e&&e[n]).call(e,"timers").setImmediate}catch(i){qo=function(e){var t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(void 0)}}qo(t)}((function(){pa()?ma(t):t()}))}catch(n){t(n)}}var ba=0,fa=!1;function ya(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Ga(e,t,n,i){return new ya(e,t,n,i)}function va(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ba(e,t){var n=e.alternate;return null===n?((n=Ga(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Za(e,t,n,i,o,r){var a=2;if(i=e,"function"==typeof e)va(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case I:return wa(n.children,o,r,t);case G:a=8,o|=16;break;case C:a=8,o|=1;break;case u:return(e=Ga(12,n,t,8|o)).elementType=u,e.type=u,e.lanes=r,e;case p:return(e=Ga(13,n,t,o)).type=p,e.elementType=p,e.lanes=r,e;case m:return(e=Ga(19,n,t,o)).elementType=m,e.lanes=r,e;case v:return Wa(n,o,r,t);case B:return(e=Ga(24,n,t,o)).elementType=B,e.lanes=r,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case d:a=10;break e;case h:a=9;break e;case A:a=11;break e;case b:a=14;break e;case f:a=16,i=null;break e;case y:a=22;break e}throw Error(g(130,null==e?e:typeof e,""))}return(t=Ga(a,n,t,o)).elementType=e,t.type=i,t.lanes=r,t}function wa(e,t,n,i){return(e=Ga(7,e,i,t)).lanes=n,e}function Wa(e,t,n,i){return(e=Ga(23,e,i,t)).elementType=v,e.lanes=n,e}function Sa(e,t,n){return(e=Ga(6,e,null,t)).lanes=n,e}function Ra(e,t,n){return(t=Ga(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Va(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=P,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=ft(0),this.expirationTimes=ft(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),q&&(this.mutableSourceEagerHydrationData=null)}function xa(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(g(188));throw Error(g(268,Object.keys(e)))}return null===(e=X(t))?null:e.stateNode}function Xa(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ha(e,t){Xa(e,t),(e=e.alternate)&&Xa(e,t)}function Ya(e){return null===(e=X(e))?null:e.stateNode}function Ka(){return null}return i.IsThisRendererActing=da,i.act=function(e){function t(){ba--,nr.current=n,da.current=i}!1===fa&&(fa=!0,console.error("act(...) is not supported in production builds of React, and might not behave as expected.")),ba++;var n=nr.current,i=da.current;nr.current=!0,da.current=!0;try{var o=_r(e)}catch(r){throw t(),r}if(null!==o&&"object"==typeof o&&"function"==typeof o.then)return{then:function(e,i){o.then((function(){1<ba||!0===Aa&&!0===n?(t(),e()):ma((function(n){t(),n?i(n):e()}))}),(function(e){t(),i(e)}))}};try{1!==ba||!1!==Aa&&!1!==n||pa(),t()}catch(r){throw t(),r}return{then:function(e){e()}}},i.attemptContinuousHydration=function(e){13===e.tag&&(zr(e,67108864,Mr()),Ha(e,67108864))},i.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=Mr(),n=Fr(e);zr(e,n,t),Ha(e,n)}},i.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.hydrate){var n=ht(t.pendingLanes);t.expiredLanes|=n&t.pendingLanes,kr(t,Tt()),0==(48&ir)&&(mr(),Pt())}break;case 13:var i=Mr();Jr((function(){return zr(e,1,i)})),Ha(e,4)}},i.attemptUserBlockingHydration=function(e){13===e.tag&&(zr(e,4,Mr()),Ha(e,4))},i.batchedEventUpdates=function(e,t){var n=ir;ir|=2;try{return e(t)}finally{0===(ir=n)&&(mr(),Pt())}},i.batchedUpdates=_r,i.createComponentSelector=function(e){return{$$typeof:ko,value:e}},i.createContainer=function(e,t,n){return e=new Va(e,t,n),t=Ga(3,null,null,2===t?7:1===t?3:0),e.current=t,t.stateNode=e,dn(t),e},i.createHasPsuedoClassSelector=function(e){return{$$typeof:Eo,value:e}},i.createPortal=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}},i.createRoleSelector=function(e){return{$$typeof:To,value:e}},i.createTestNameSelector=function(e){return{$$typeof:Uo,value:e}},i.createTextSelector=function(e){return{$$typeof:_o,value:e}},i.deferredUpdates=function(e){return Jt(97,e)},i.discreteUpdates=function(e,t,n,i,o){var r=ir;ir|=4;try{return Jt(98,e.bind(null,t,n,i,o))}finally{0===(ir=r)&&(mr(),Pt())}},i.findAllNodes=jo,i.findBoundingRects=function(e,t){if(!re)throw Error(g(363));t=jo(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ge(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,o=i+n.width,r=n.y,a=r+n.height,s=t-1;0<=s;s--)if(t!==s){var l=e[s],c=l.x,I=c+l.width,C=l.y,u=C+l.height;if(i>=c&&r>=C&&o<=I&&a<=u){e.splice(t,1);break}if(!(i!==c||n.width!==l.width||u<r||C>a)){C>r&&(l.height+=C-r,l.y=r),u<a&&(l.height=a-C),e.splice(t,1);break}if(!(r!==C||n.height!==l.height||I<i||c>o)){c>i&&(l.width+=c-i,l.x=i),I<o&&(l.width=o-c),e.splice(t,1);break}}return e},i.findHostInstance=xa,i.findHostInstanceWithNoPortals=function(e){return null===(e=function(e){if(!(e=x(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child&&4!==t.tag)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}(e))?null:20===e.tag?e.stateNode.instance:e.stateNode},i.findHostInstanceWithWarning=function(e){return xa(e)},i.flushControlled=function(e){var t=ir;ir|=1;try{Jt(99,e)}finally{0===(ir=t)&&(mr(),Pt())}},i.flushDiscreteUpdates=function(){0==(49&ir)&&(function(){if(null!==Rr){var e=Rr;Rr=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,kr(e,Tt())}))}Pt()}(),aa())},i.flushPassiveEffects=aa,i.flushSync=Jr,i.focusWithin=function(e,t){if(!re)throw Error(g(363));for(t=Oo(e=Do(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!le(n)){if(5===n.tag&&Ie(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},i.getCurrentUpdateLanePriority=function(){return ut},i.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(g(363));var n=0,i=[];e=[Do(e),0];for(var o=0;o<e.length;){var r=e[o++],a=e[o++],s=t[a];if((5!==r.tag||!le(r))&&(Po(r,s)&&(i.push(Qo(s)),++a>n&&(n=a)),a<t.length))for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Qo(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},i.getPublicRootInstance=function(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:return K(e.child.stateNode);default:return e.child.stateNode}},i.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:Ya,findFiberByHostInstance:e.findFiberByHostInstance||Ka,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null},"undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t.isDisabled&&t.supportsFiber)try{It=t.inject(e),Ct=t}catch(n){}e=!0}return e},i.observeVisibleRects=function(e,t,n,i){if(!re)throw Error(g(363));e=jo(e,t);var o=Ce(e,n,i).disconnect;return{disconnect:function(){o()}}},i.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},i.runWithPriority=function(e,t){var n=ut;try{return ut=e,t()}finally{ut=n}},i.shouldSuspend=function(){return!1},i.unbatchedUpdates=function(e,t){var n=ir;ir&=-2,ir|=8;try{return e(t)}finally{0===(ir=n)&&(mr(),Pt())}},i.updateContainer=function(e,t,n,i){var o=t.current,r=Mr(),a=Fr(o);e:if(n){t:{if(R(n=n._reactInternals)!==n||1!==n.tag)throw Error(g(170));var s=n;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(rt(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(null!==s);throw Error(g(171))}if(1===n.tag){var l=n.type;if(rt(l)){n=st(n,l,s);break e}}n=s}else n=et;return null===t.context?t.context=n:t.pendingContext=n,(t=An(r,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),pn(o,t),zr(o,a,r),a},i}},7962:function(e,t,n){"use strict";e.exports=n(9166)},7550:function(e,t,n){"use strict";n.d(t,{T2:function(){return ye},r_:function(){return me}});var i=n(2784);function o(e,t){return e.map((function(e,n){return e+t[n]}))}function r(e,t){return e.map((function(e,n){return e-t[n]}))}function a(e){return Math.hypot.apply(Math,e)}function g(e,t){void 0===t&&(t=e);var n=a(t),i=0===n?0:1/n,o=t.map((function(e){return i*e}));return{distance:a(e),direction:o}}function s(e,t,n){var i=a(t),o=0===i?0:1/i,r=0===n?0:1/n,g=r*i,s=t.map((function(e){return r*e})),l=t.map((function(e){return o*e}));return{velocities:s,velocity:g,distance:a(e),direction:l}}function l(e){return Math.sign?Math.sign(e):Number(e>0)-Number(e<0)||+e}function c(e,t,n){return 0===t||Math.abs(t)===1/0?function(e,t){return Math.pow(e,5*t)}(e,n):e*t*n/(t+n*e)}function I(e,t,n,i){return void 0===i&&(i=.15),0===i?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-c(t-e,n-t,i)+t:e>n?+c(e-n,n-t,i)+n:e}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function d(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function h(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function m(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function b(){}function f(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?b:1===t.length?t[0]:function(){for(var e,n,i=m(t);!(n=i()).done;){var o=n.value;e=o.apply(this,arguments)||e}return e}}function y(e,t){if(void 0===e){if(void 0===t)throw new Error("Must define fallback value if undefined is expected");e=t}return Array.isArray(e)?e:[e,e]}function G(e,t){return Object.assign({},t,e||{})}function v(e){if("function"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(void 0,n)}return e}function B(e,t){void 0===e&&(e={});for(var n={},i=0,o=Object.entries(t);i<o.length;i++){var r=o[i],a=r[0],g=r[1];switch(typeof g){case"function":n[a]=g.call(n,e[a],a,e);break;case"object":n[a]=B(e[a],g);break;case"boolean":g&&(n[a]=e[a])}}return n}var Z={threshold:function(e){return void 0===e&&(e=0),y(e)},rubberband:function(e){switch(void 0===e&&(e=0),e){case!0:return y(.15);case!1:return y(0);default:return y(e)}},enabled:function(e){return void 0===e&&(e=!0),e},triggerAllEvents:function(e){return void 0===e&&(e=!1),e},initial:function(e){return void 0===e&&(e=0),"function"==typeof e?e:y(e)}},w=u({},Z,{axis:!0,lockDirection:function(e){return void 0===e&&(e=!1),e},bounds:function(e){if(void 0===e&&(e={}),"function"==typeof e)return function(t){return w.bounds(e(t))};var t=e,n=t.left,i=void 0===n?-1/0:n,o=t.right,r=void 0===o?1/0:o,a=t.top,g=void 0===a?-1/0:a,s=t.bottom;return[[i,r],[g,void 0===s?1/0:s]]}}),W="undefined"!=typeof window&&window.document&&window.document.createElement,S={enabled:function(e){return void 0===e&&(e=!0),e},domTarget:!0,window:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return void 0===e&&(e=W?window:void 0),e})),eventOptions:function(e){var t=void 0===e?{}:e,n=t.passive,i=void 0===n||n,o=t.capture;return{passive:i,capture:void 0!==o&&o}}},R=u({},Z,{bounds:function(e,t,n){var i=n.distanceBounds,o=void 0===i?{}:i,r=n.angleBounds,a=void 0===r?{}:r,g=function(e){var t=G(v(o,e),{min:-1/0,max:1/0});return[t.min,t.max]},s=function(e){var t=G(v(a,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof o&&"function"!=typeof a?[g(),s()]:function(e){return[g(e),s(e)]}}}),V=u({},w,{threshold:function(e,t,n){var i=n.filterTaps,o=void 0!==i&&i,r=n.lockDirection,a=void 0!==r&&r,g=n.axis,s=y(e,o?3:a||(void 0===g?void 0:g)?1:0);return this.filterTaps=o||s[0]+s[1]>0,s},swipeVelocity:function(e){return void 0===e&&(e=.5),y(e)},swipeDistance:function(e){return void 0===e&&(e=60),y(e)},delay:function(e){switch(void 0===e&&(e=0),e){case!0:return 180;case!1:return 0;default:return e}}});function x(e){return void 0===e&&(e={}),B(e,S)}function X(e){return void 0===e&&(e={}),B(e,w)}function H(e){return void 0===e&&(e={}),B(e,R)}function Y(e){return void 0===e&&(e={}),B(e,V)}function K(e){var t=e.domTarget,n=e.eventOptions,i=e.window,o=e.enabled,r=h(e,["domTarget","eventOptions","window","enabled"]),a=x({domTarget:t,eventOptions:n,window:i,enabled:o});return a.move=X(r),a}function N(e){return u({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_lastEventType:void 0,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:b,canceled:!1,memo:void 0,args:void 0},e)}function M(){return{shared:{hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1},drag:N({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,_isTap:!0,_delayedEvent:!1,_pointerId:void 0,tap:!1,swipe:[0,0]}),pinch:N({da:[0,0],vdva:[0,0],origin:void 0,turns:0}),wheel:N({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),move:N({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),scroll:N({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0})}}var F=new Map,z=function(){function e(e,t){var n=this;void 0===t&&(t=[]),this.controller=e,this.args=t,this.debounced=!0,this.setTimeout=function(e,t){var i;void 0===t&&(t=140),clearTimeout(n.controller.timeouts[n.stateKey]);for(var o=arguments.length,r=new Array(o>2?o-2:0),a=2;a<o;a++)r[a-2]=arguments[a];n.controller.timeouts[n.stateKey]=(i=window).setTimeout.apply(i,[e,t].concat(r))},this.clearTimeout=function(){clearTimeout(n.controller.timeouts[n.stateKey])},this.fireGestureHandler=function(e){if(void 0===e&&(e=!1),n.state._blocked)return n.debounced||(n.state._active=!1,n.clean()),null;if(!e&&!n.state.intentional&&!n.config.triggerAllEvents)return null;if(n.state.intentional){var t=n.state.active,i=n.state._active;n.state.active=i,n.state.first=i&&!t,n.state.last=t&&!i,n.controller.state.shared[n.ingKey]=i}var o=u({},n.controller.state.shared,n.state,n.mapStateValues(n.state)),r=n.handler(o);return n.state.memo=void 0!==r?r:n.state.memo,n.state._active||n.clean(),o}}var t,n,i,a=e.prototype;return a.updateSharedState=function(e){Object.assign(this.controller.state.shared,e)},a.updateGestureState=function(e){Object.assign(this.state,e)},a.checkIntentionality=function(e,t){return{_intentional:e,_blocked:!1}},a.getMovement=function(e){var t=this.config,n=t.initial,i=t.bounds,a=t.rubberband,g=t.threshold,s=this.state,l=s._bounds,c=s._initial,I=s._active,C=s._intentional,d=s.lastOffset,h=s.movement,A=this.getInternalMovement(e,this.state),p=!1===C[0]?L(A[0],g[0]):C[0],m=!1===C[1]?L(A[1],g[1]):C[1],b=this.checkIntentionality([p,m],A);if(b._blocked)return u({},b,{_movement:A,delta:[0,0]});var f,y,G,B,Z=b._intentional,w=A;(!1!==Z[0]&&!1===C[0]&&(y=v(n,this.state),f=v(i,this.state),c[0]=y[0],l[0]=f[0]),!1!==Z[1]&&!1===C[1])&&(y=null!=(G=y)?G:v(n,this.state),f=null!=(B=f)?B:v(i,this.state),c[1]=y[1],l[1]=f[1]);var W=[!1!==Z[0]?A[0]-Z[0]:c[0],!1!==Z[1]?A[1]-Z[1]:c[1]],S=o(W,d),R=I?a:[0,0];return W=k(l,o(W,c),R),u({},b,{intentional:!1!==Z[0]||!1!==Z[1],_initial:c,_movement:w,movement:W,values:e,offset:k(l,S,R),delta:r(W,h)})},a.clean=function(){this.clearTimeout()},t=e,(n=[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}}])&&C(t.prototype,n),i&&C(t,i),e}();function L(e,t){return Math.abs(e)>=t&&l(e)*t}function k(e,t,n){var i=t[0],o=t[1],r=n[0],a=n[1],g=e[0],s=g[0],l=g[1],c=e[1],C=c[0],u=c[1];return[I(i,s,l,r),I(o,C,u,a)]}function E(e,t,n){var i=e.state,o=e.args,r=t.timeStamp,a=t.type,g=i.values;return{_lastEventType:a,event:t,timeStamp:r,elapsedTime:n?0:r-i.startTime,args:o,previous:g}}function T(e,t,n){var i=e.state.offset,o=n.timeStamp;return u({},M()[e.stateKey],{_active:!0,values:t,initial:t,offset:i,lastOffset:i,startTime:o})}function U(e,t){return function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];return e.call.apply(e,[this,u({},t,{event:n})].concat(o))}}var _=function(e){var t=this;this.classes=e,this.bind=function(){for(var e={},n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];for(var r,a=m(t.classes);!(r=a()).done;){var g=r.value;new g(t,i).addBindings(e)}for(var s=0,l=Object.entries(t.nativeRefs);s<l.length;s++){var c=l[s],I=c[0],C=c[1];q(e,I,U(C,u({},t.state.shared,{args:i})))}return t.config.domTarget?P(t,e):Q(t,e)},this.effect=function(){return t.config.domTarget&&t.bind(),t.clean},this.clean=function(){var e=j(t.config),n=t.config.eventOptions;e&&ee(e,O(t.domListeners),n),Object.values(t.timeouts).forEach(clearTimeout),function(e){var t=e.config,n=t.window,i=t.eventOptions,o=e.windowListeners;if(!n)return;for(var r in o){ee(n,o[r],i)}e.windowListeners={}}(t)},this.state=M(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function J(e,t){var n=e.config,i=e.windowListeners;n.window&&(ee(n.window,i[t],n.eventOptions),delete i[t])}function D(e,t,n){var i=e.config,o=e.windowListeners;void 0===n&&(n=[]),i.window&&(ee(i.window,o[t],i.eventOptions),$(i.window,o[t]=n,i.eventOptions))}function P(e,t){var n=e.config,i=e.domListeners,o=j(n);if(!o)throw new Error("domTarget must be defined");var r=n.eventOptions;ee(o,O(i),r);for(var a=0,g=Object.entries(t);a<g.length;a++){var s=g[a],l=s[0],c=s[1],I=l.slice(2).toLowerCase();i.push([I,f.apply(void 0,c)])}$(o,i,r)}function Q(e,t){for(var n={},i=e.config.eventOptions.capture?"Capture":"",o=0,r=Object.entries(t);o<r.length;o++){var a=r[o],g=a[0],s=a[1],l=Array.isArray(s)?s:[s];n[g+i]=f.apply(void 0,l)}return n}function O(e){return void 0===e&&(e=[]),e.splice(0,e.length)}function j(e){var t=e.domTarget;return t&&"current"in t?t.current:t}function q(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function $(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={});for(var i,o=m(t);!(i=o()).done;){var r=i.value,a=r[0],g=r[1];e.addEventListener(a,g,n)}}function ee(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={});for(var i,o=m(t);!(i=o()).done;){var r=i.value,a=r[0],g=r[1];e.removeEventListener(a,g,n)}}function te(e,t,n){void 0===n&&(n={});var o=function(e){var t=new Set;e.drag&&t.add(F.get("drag"));e.wheel&&t.add(F.get("wheel"));e.scroll&&t.add(F.get("scroll"));e.move&&t.add(F.get("move"));e.pinch&&t.add(F.get("pinch"));e.hover&&t.add(F.get("hover"));return t}(e),r=i.useMemo((function(){return new _(o)}),[]);return r.config=t,r.handlers=e,r.nativeRefs=n,i.useEffect(r.effect,[]),r.config.domTarget?ne:r.bind}function ne(){0}var ie=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.getInternalMovement=function(e,t){return r(e,t.initial)},n.checkIntentionality=function(e,t){if(!1===e[0]&&!1===e[1])return{_intentional:e,axis:this.state.axis};var n=t.map(Math.abs),i=n[0],o=n[1],r=this.state.axis||(i>o?"x":i<o?"y":void 0);return this.config.axis||this.config.lockDirection?r?this.config.axis&&r!==this.config.axis?{_intentional:e,_blocked:!0,axis:r}:(e["x"===r?1:0]=!1,{_intentional:e,_blocked:!1,axis:r}):{_intentional:[!1,!1],_blocked:!1,axis:r}:{_intentional:e,_blocked:!1,axis:r}},n.getKinematics=function(e,t){var n=this.getMovement(e);if(!n._blocked){var i=t.timeStamp-this.state.timeStamp;Object.assign(n,s(n.movement,n.delta,i))}return n},n.mapStateValues=function(e){return{xy:e.values,vxvy:e.velocities}},t}(z);function oe(e){if("touches"in e){var t=e.targetTouches,n=e.changedTouches;return t.length>0?t:n}return null}function re(e){var t="buttons"in e?e.buttons:0,n=oe(e),i=n&&n.length||0;return{touches:i,down:i>0||t>0,buttons:t,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,ctrlKey:e.ctrlKey}}function ae(e){var t=oe(e),n=t?t[0]:e;return[n.clientX,n.clientY]}function ge(e){var t=e.currentTarget,n=t.scrollX,i=t.scrollY,o=t.scrollLeft,r=t.scrollTop;return[n||o||0,i||r||0]}function se(e){return[e.deltaX,e.deltaY]}function le(e){return[260*e.scale,e.rotation]}function ce(e){var t,n=e.targetTouches,i=n[0],o=n[1],r=o.clientX-i.clientX,a=o.clientY-i.clientY,g=(o.clientX+i.clientX)/2,s=(o.clientY+i.clientY)/2,l="nativeEvent"in e?e.nativeEvent:e;return{values:[Math.hypot(r,a),null!=(t=l.rotation)?t:-180*Math.atan2(r,a)/Math.PI],origin:[g,s]}}var Ie=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).ingKey="dragging",t.stateKey="drag",t.onDragStart=function(e){t.enabled&&!t.state._active&&(D(t.controller,t.stateKey,[["pointermove",t.onDragChange],["pointerup",t.onDragEnd],["pointercancel",t.onDragEnd]]),t.updateGestureState({_pointerId:e.pointerId}),t.config.delay>0?(t.state._delayedEvent=!0,"persist"in e&&"function"==typeof e.persist&&e.persist(),t.setTimeout(t.startDrag.bind(A(t)),t.config.delay,e)):t.startDrag(e))},t.onDragChange=function(e){if(!t.state.canceled&&e.pointerId===t.state._pointerId)if(t.state._active){var n=re(e);if(n.down){t.updateSharedState(n);var i=ae(e),o=t.getKinematics(i,e),r=E(A(t),e),g=t.state._isTap,s=a(o._movement);g&&s>=3&&(g=!1),t.updateGestureState(u({},r,o,{_isTap:g})),t.fireGestureHandler()}else t.onDragEnd(e)}else t.state._delayedEvent&&(t.clearTimeout(),t.startDrag(e))},t.onDragEnd=function(e){if(e.pointerId===t.state._pointerId){t.state._active=!1,t.updateSharedState({down:!1,buttons:0,touches:0});var n=t.state._isTap,i=t.state.velocities,o=i[0],r=i[1],a=t.state.movement,g=a[0],s=a[1],c=t.state._intentional,I=c[0],C=c[1],d=t.config.swipeVelocity,h=d[0],p=d[1],m=t.config.swipeDistance,b=m[0],f=m[1],y=u({},E(A(t),e),t.getMovement(t.state.values)),G=[0,0];y.elapsedTime<220&&(!1!==I&&Math.abs(o)>h&&Math.abs(g)>b&&(G[0]=l(o)),!1!==C&&Math.abs(r)>p&&Math.abs(s)>f&&(G[1]=l(r))),t.updateGestureState(u({},y,{tap:n,swipe:G})),t.fireGestureHandler(!0===n)}},t.clean=function(){e.prototype.clean.call(A(t)),t.state._delayedEvent=!1,J(t.controller,t.stateKey)},t.onCancel=function(){t.state.canceled||(t.updateGestureState({canceled:!0}),t.state._active=!1,t.updateSharedState({down:!1,buttons:0,touches:0}),requestAnimationFrame((function(){return t.fireGestureHandler()})))},t.onClick=function(e){t.state._isTap||e.stopPropagation()},t}d(t,e);var n=t.prototype;return n.startDrag=function(e){var t=ae(e);this.updateSharedState(re(e)),this.updateGestureState(u({},T(this,t,e),E(this,e,!0),{_pointerId:e.pointerId,cancel:this.onCancel})),this.updateGestureState(this.getMovement(t)),this.fireGestureHandler()},n.addBindings=function(e){(q(e,"onPointerDown",this.onDragStart),this.config.filterTaps)&&q(e,this.controller.config.eventOptions.capture?"onClick":"onClickCapture",this.onClick)},t}(ie);function Ce(e,t){var n,i,o=[],r=!1;return function(){for(var a=arguments.length,g=new Array(a),s=0;s<a;s++)g[s]=arguments[s];return r&&n===this&&t(g,o)||(i=e.apply(this,g),r=!0,n=this,o=g),i}}function ue(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,i,o,r;if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(i=n;0!=i--;)if(!ue(e[i],t[i]))return!1;return!0}if("function"==typeof Map&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(r=e.entries();!(i=r.next()).done;)if(!t.has(i.value[0]))return!1;for(r=e.entries();!(i=r.next()).done;)if(!ue(i.value[1],t.get(i.value[0])))return!1;return!0}if("function"==typeof Set&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(r=e.entries();!(i=r.next()).done;)if(!t.has(i.value[0]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if((n=(o=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(t,o[i]))return!1;if("undefined"!=typeof Element&&e instanceof Element)return!1;for(i=n;0!=i--;)if(!("_owner"===o[i]&&e.$$typeof||ue(e[o[i]],t[o[i]])))return!1;return!0}return e!=e&&t!=t}function de(e,t){try{return ue(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}var he=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).ingKey="pinching",t.stateKey="pinch",t.pinchShouldStart=function(e){var n=re(e).touches;return t.enabled&&2===n},t.onPinchStart=function(e){if(t.pinchShouldStart(e)){var n=ce(e),i=n.values,o=n.origin;t.updateSharedState(re(e)),t.updateGestureState(u({},T(A(t),i,e),E(A(t),e,!0),{cancel:t.onCancel,origin:o})),t.updateGestureState(t.getMovement(i)),t.fireGestureHandler()}},t.onPinchChange=function(e){var n=t.state,i=n.canceled,o=n._active;if(!i&&o){var r=re(e);t.updateSharedState(r);var a=ce(e),g=a.values,s=a.origin,l=t.getKinematics(g,e);t.updateGestureState(u({},E(A(t),e),l,{origin:s})),t.fireGestureHandler()}},t.onPinchEnd=function(e){t.state.active&&(t.state._active=!1,t.updateSharedState({down:!1,touches:0}),t.updateGestureState(u({},E(A(t),e),t.getMovement(t.state.values))),t.fireGestureHandler())},t.onCancel=function(){t.state.canceled||(t.state._active=!1,t.updateGestureState({canceled:!0}),t.updateSharedState({down:!1,touches:0}),requestAnimationFrame((function(){return t.fireGestureHandler()})))},t.onGestureStart=function(e){if(t.enabled){e.preventDefault();var n=le(e);t.updateSharedState(re(e)),t.updateGestureState(u({},T(A(t),n,e),E(A(t),e,!0),{origin:[e.clientX,e.clientY],cancel:t.onCancel})),t.updateGestureState(t.getMovement(n)),t.fireGestureHandler()}},t.onGestureChange=function(e){var n=t.state,i=n.canceled,o=n._active;if(!i&&o){e.preventDefault();var r=re(e);t.updateSharedState(r);var a=le(e),g=t.getKinematics(a,e);t.updateGestureState(u({},E(A(t),e),g,{origin:[e.clientX,e.clientY]})),t.fireGestureHandler()}},t.onGestureEnd=function(e){e.preventDefault(),t.state.active&&(t.state._active=!1,t.updateSharedState({down:!1,touches:0}),t.updateGestureState(u({},E(A(t),e),t.getMovement(t.state.values),{origin:[e.clientX,e.clientY]})),t.fireGestureHandler())},t.wheelShouldRun=function(e){return t.enabled&&e.ctrlKey},t.getWheelValuesFromEvent=function(e){var n=se(e)[1],i=t.state.values,o=i[0],r=i[1];return{values:[o-n,void 0!==r?r:0],origin:[e.clientX,e.clientY],delta:[0,n]}},t.onWheel=function(e){t.wheelShouldRun(e)&&(t.setTimeout(t.onWheelEnd),t.state._active?t.onWheelChange(e):t.onWheelStart(e))},t.onWheelStart=function(e){var n=t.getWheelValuesFromEvent(e),i=n.values,o=n.delta,r=n.origin;e.cancelable&&e.preventDefault(),t.updateSharedState(re(e)),t.updateGestureState(u({},T(A(t),i,e),E(A(t),e,!0),{initial:t.state.values,offset:i,delta:o,origin:r})),t.updateGestureState(t.getMovement(i)),t.fireGestureHandler()},t.onWheelChange=function(e){t.updateSharedState(re(e));var n=t.getWheelValuesFromEvent(e),i=n.values,o=n.origin,r=n.delta;t.updateGestureState(u({},E(A(t),e),t.getKinematics(i,e),{origin:o,delta:r})),t.fireGestureHandler()},t.onWheelEnd=function(){t.state._active=!1,t.updateGestureState(t.getMovement(t.state.values)),t.fireGestureHandler()},t}return d(t,e),t.prototype.addBindings=function(e){this.controller.config.domTarget&&("undefined"==typeof window||null!==window.ontouchstart)&&function(){try{return"constructor"in GestureEvent}catch(e){return!1}}()?(q(e,"onGestureStart",this.onGestureStart),q(e,"onGestureChange",this.onGestureChange),q(e,"onGestureEnd",this.onGestureEnd)):(q(e,"onTouchStart",this.onPinchStart),q(e,"onTouchMove",this.onPinchChange),q(e,"onTouchEnd",this.onPinchEnd),q(e,"onTouchCancel",this.onPinchEnd),q(e,"onWheel",this.onWheel))},t}(function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.getInternalMovement=function(e,t){var n=t.values[1],i=e[0],o=e[1],a=void 0===o?n:o,g=a-n,s=t.turns;return Math.abs(g)>270&&(s+=l(g)),r([i,a-360*s],t.initial)},n.getKinematics=function(e,t){var n=this.getMovement(e),i=(e[1]-n.movement[1]-this.state.initial[1])/360,o=t.timeStamp-this.state.timeStamp;return u({turns:i},n,s(n.movement,n.delta,o))},n.mapStateValues=function(e){return{da:e.values,vdva:e.velocities}},t}(z));var Ae=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).ingKey="wheeling",t.stateKey="wheel",t.debounced=!0,t.handleEvent=function(e){if((!e.ctrlKey||!("pinch"in t.controller.handlers))&&t.enabled){t.setTimeout(t.onEnd),t.updateSharedState(re(e));var n=o(se(e),t.state.values);if(t.state._active)t.updateGestureState(u({},E(A(t),e),t.getKinematics(n,e)));else{t.updateGestureState(u({},T(A(t),n,e),E(A(t),e,!0),{initial:t.state.values}));var i=t.getMovement(n),r=g(i.delta);t.updateGestureState(i),t.updateGestureState(r)}t.fireGestureHandler()}},t.onEnd=function(){var e=t.getMovement(t.state.values);t.updateGestureState(e),t.updateGestureState({_active:!1,velocities:[0,0],velocity:0}),t.fireGestureHandler()},t}return d(t,e),t.prototype.addBindings=function(e){q(e,"onWheel",this.handleEvent)},t}(ie);var pe=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).ingKey="moving",t.stateKey="move",t.debounced=!0,t.onMove=function(e){t.enabled&&(t.setTimeout(t.onMoveEnd),t.state._active?t.onMoveChange(e):t.onMoveStart(e))},t.onMoveStart=function(e){t.updateSharedState(re(e));var n=ae(e);t.updateGestureState(u({},T(A(t),n,e),E(A(t),e,!0))),t.updateGestureState(t.getMovement(n)),t.fireGestureHandler()},t.onMoveChange=function(e){t.updateSharedState(re(e));var n=ae(e);t.updateGestureState(u({},E(A(t),e),t.getKinematics(n,e))),t.fireGestureHandler()},t.onMoveEnd=function(){var e=t.state.values;t.updateGestureState(t.getMovement(e)),t.updateGestureState({velocities:[0,0],velocity:0,_active:!1}),t.fireGestureHandler()},t.onPointerEnter=function(e){if(t.controller.state.shared.hovering=!0,t.controller.config.enabled){if(t.controller.config.hover.enabled){var n=ae(e),i=u({},t.controller.state.shared,t.state,E(A(t),e,!0),{values:n,active:!0,hovering:!0});t.controller.handlers.hover(u({},i,t.mapStateValues(i)))}"move"in t.controller.handlers&&t.onMoveStart(e)}},t.onPointerLeave=function(e){if(t.controller.state.shared.hovering=!1,"move"in t.controller.handlers&&t.onMoveEnd(),t.controller.config.hover.enabled){var n=ae(e),i=u({},t.controller.state.shared,t.state,E(A(t),e),{values:n,active:!1});t.controller.handlers.hover(u({},i,t.mapStateValues(i)))}},t}return d(t,e),t.prototype.addBindings=function(e){"move"in this.controller.handlers&&q(e,"onPointerMove",this.onMove),"hover"in this.controller.handlers&&(q(e,"onPointerEnter",this.onPointerEnter),q(e,"onPointerLeave",this.onPointerLeave))},t}(ie);function me(e,t){void 0===t&&(t={}),F.set("move",pe);var n=(0,i.useRef)();return n.current||(n.current=Ce(K,de)),te({move:e},n.current(t))}var be=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).ingKey="scrolling",t.stateKey="scroll",t.debounced=!0,t.handleEvent=function(e){if(t.enabled){t.clearTimeout(),t.setTimeout(t.onEnd);var n=ge(e);if(t.updateSharedState(re(e)),t.state._active)t.updateGestureState(u({},E(A(t),e),t.getKinematics(n,e)));else{t.updateGestureState(u({},T(A(t),n,e),E(A(t),e,!0),{initial:t.state.values}));var i=t.getMovement(n),o=g(i.delta);t.updateGestureState(i),t.updateGestureState(o)}t.fireGestureHandler()}},t.onEnd=function(){t.state._active=!1,t.updateGestureState(u({},t.getMovement(t.state.values),{velocities:[0,0],velocity:0})),t.fireGestureHandler()},t}return d(t,e),t.prototype.addBindings=function(e){q(e,"onScroll",this.handleEvent)},t}(ie);var fe=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function ye(e,t){void 0===t&&(t={});var n=function(e){var t={},n={},i=new Set;for(var o in e)fe.test(o)?(i.add(RegExp.lastMatch),n[o]=e[o]):t[o]=e[o];return[n,t,i]}(e),i=n[0],o=n[1],r=n[2];F.set("drag",Ie),F.set("hover",pe),F.set("move",pe),F.set("pinch",he),F.set("scroll",be),F.set("wheel",Ae);var a=function(e,t){void 0===e&&(e={}),void 0===t&&(t=new Set);var n=e,i=n.drag,o=n.wheel,r=n.move,a=n.scroll,g=n.pinch,s=n.hover,l=x({eventOptions:n.eventOptions,window:n.window,domTarget:n.domTarget,enabled:n.enabled});return t.has("onDrag")&&(l.drag=Y(i)),t.has("onWheel")&&(l.wheel=X(o)),t.has("onScroll")&&(l.scroll=X(a)),t.has("onMove")&&(l.move=X(r)),t.has("onPinch")&&(l.pinch=H(g)),t.has("onHover")&&(l.hover=u({enabled:!0},s)),l}(t,r),g={};return r.has("onDrag")&&(g.drag=Ge(i,"onDrag")),r.has("onWheel")&&(g.wheel=Ge(i,"onWheel")),r.has("onScroll")&&(g.scroll=Ge(i,"onScroll")),r.has("onMove")&&(g.move=Ge(i,"onMove")),r.has("onPinch")&&(g.pinch=Ge(i,"onPinch")),r.has("onHover")&&(g.hover=i.onHover),te(g,a,o)}function Ge(e,t){var n=t+"Start",i=t+"End";return function(o){var r=void 0;return o.first&&n in e&&e[n](o),t in e&&(r=e[t](o)),o.last&&i in e&&e[i](o),r}}},5047:function(e){var t=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",g=o.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(x){s=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof A?t:A,r=Object.create(o.prototype),a=new S(i||[]);return r._invoke=function(e,t,n){var i=I;return function(o,r){if(i===u)throw new Error("Generator is already running");if(i===d){if("throw"===o)throw r;return V()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var g=Z(a,n);if(g){if(g===h)continue;return g}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===I)throw i=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=u;var s=c(e,t,n);if("normal"===s.type){if(i=n.done?d:C,s.arg===h)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(i=d,n.method="throw",n.arg=s.arg)}}}(e,n,a),r}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(x){return{type:"throw",arg:x}}}e.wrap=l;var I="suspendedStart",C="suspendedYield",u="executing",d="completed",h={};function A(){}function p(){}function m(){}var b={};b[r]=function(){return this};var f=Object.getPrototypeOf,y=f&&f(f(R([])));y&&y!==n&&i.call(y,r)&&(b=y);var G=m.prototype=A.prototype=Object.create(b);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function B(e,t){function n(o,r,a,g){var s=c(e[o],e,r);if("throw"!==s.type){var l=s.arg,I=l.value;return I&&"object"==typeof I&&i.call(I,"__await")?t.resolve(I.__await).then((function(e){n("next",e,a,g)}),(function(e){n("throw",e,a,g)})):t.resolve(I).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,g)}))}g(s.arg)}var o;this._invoke=function(e,i){function r(){return new t((function(t,o){n(e,i,t,o)}))}return o=o?o.then(r,r):r()}}function Z(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,Z(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=c(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var r=o.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function W(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function R(e){if(e){var n=e[r];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(i.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:V}}function V(){return{value:t,done:!0}}return p.prototype=G.constructor=m,m.constructor=p,p.displayName=s(m,g,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,g,"GeneratorFunction")),e.prototype=Object.create(G),e},e.awrap=function(e){return{__await:e}},v(B.prototype),B.prototype[a]=function(){return this},e.AsyncIterator=B,e.async=function(t,n,i,o,r){void 0===r&&(r=Promise);var a=new B(l(t,n,i,o),r);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(G),s(G,g,"Generator"),G[r]=function(){return this},G.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=R,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(W),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(i,o){return g.type="throw",g.arg=e,n.next=i,o&&(n.method="next",n.arg=t),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],g=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),W(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;W(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:R(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=t}catch(n){Function("r","regeneratorRuntime = r")(t)}},262:function(e,t,n){"use strict";var i=n(889),o=n(4401),r=n(5690),a=n(2777);function g(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e}e.exports=function(e,t,n){if(!a(e))return e;if(Array.isArray(t)&&(t=[].concat.apply([],t).join(".")),"string"!=typeof t)return e;for(var s=i(t,{sep:".",brackets:!0}).filter(g),l=s.length,c=-1,I=e;++c<l;){var C=s[c];c===l-1?r(I[C])&&r(n)?I[C]=o({},I[C],n):I[C]=n:(a(I[C])||(I[C]={}),I=I[C])}return e}},8665:function(e){e.exports=function(e,t,n,i){var o=n?n.call(i,e,t):void 0;if(void 0!==o)return!!o;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(var g=Object.prototype.hasOwnProperty.bind(t),s=0;s<r.length;s++){var l=r[s];if(!g(l))return!1;var c=e[l],I=t[l];if(!1===(o=n?n.call(i,c,I,l):void 0)||void 0===o&&c!==I)return!1}return!0}},889:function(e,t,n){"use strict";var i=n(8870);function o(e,t,n,i){var r=e.indexOf(t,n);return"\\"===e.charAt(r-1)?o(e,t,r+1):r}function r(e,t){return!0===t.keepDoubleQuotes&&'"'===e||(!0===t.keepSingleQuotes&&"'"===e||t.keepQuotes)}function a(e,t,n){return"function"==typeof e.keepEscaping?e.keepEscaping(t,n):!0===e.keepEscaping||"\\"===t[n+1]}e.exports=function(e,t,n){if("string"!=typeof e)throw new TypeError("expected a string");"function"==typeof t&&(n=t,t=null),"string"==typeof t&&(t={sep:t});var g,s=i({sep:"."},t),l=s.quotes||['"',"'","`"];!0===s.brackets?g={"<":">","(":")","[":"]","{":"}"}:s.brackets&&(g=s.brackets);var c,I=[],C=[],u=[""],d=s.sep,h=e.length,A=-1;function p(){if(g&&C.length)return g[C[C.length-1]]}for(;++A<h;){var m=e[A],b=e[A+1],f={val:m,idx:A,arr:u,str:e};if(I.push(f),"\\"!==m){if(g&&g[m]){C.push(m);var y=p(),G=A+1;if(-1!==e.indexOf(y,G+1))for(;C.length&&G<h;){var v=e[++G];if("\\"!==v)if(-1===l.indexOf(v)){if(y=p(),C.length&&-1===e.indexOf(y,G+1))break;g[v]?C.push(v):y===v&&C.pop()}else G=o(e,v,G+1);else v++}if(-1===(c=G)){u[u.length-1]+=m;continue}m=e.slice(A,c+1),f.val=m,f.idx=A=c}if(-1!==l.indexOf(m)){if(-1===(c=o(e,m,A+1))){u[u.length-1]+=m;continue}m=!0===r(m,s)?e.slice(A,c+1):e.slice(A+1,c),f.val=m,f.idx=A=c}"function"==typeof n&&(n(f,I),m=f.val,A=f.idx),f.val!==d||!1===f.split?u[u.length-1]+=f.val:u.push("")}else f.val=!0===a(s,e,A)?m+b:b,f.escaped=!0,"function"==typeof n&&n(f),u[u.length-1]+=f.val,A++}return u}},8870:function(e,t,n){"use strict";var i=n(3099),o=n(6179);function r(e,t){for(var n in t)l(t,n)&&(e[n]=t[n])}function a(e){return e&&"string"==typeof e}function g(e){var t={};for(var n in e)t[n]=e[n];return t}function s(e){return e&&"object"==typeof e||i(e)}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");s(e)||(e={});for(var t=1;t<arguments.length;t++){var n=arguments[t];a(n)&&(n=g(n)),s(n)&&(r(e,n),o(e,n))}return e}},3099:function(e,t,n){"use strict";var i=n(5690);e.exports=function(e){return i(e)||"function"==typeof e||Array.isArray(e)}},2275:function(e,t,n){"use strict";n.d(t,{ZP:function(){return xe}});var i=n(8570),o=n(2784),r=n(8665),a=n.n(r);var g=function(e){function t(e,i,s,l,C){for(var u,d,h,A,f,G=0,v=0,B=0,Z=0,w=0,X=0,Y=h=u=0,N=0,M=0,F=0,z=0,L=s.length,k=L-1,E="",T="",U="",_="";N<L;){if(d=s.charCodeAt(N),N===k&&0!==v+Z+B+G&&(0!==v&&(d=47===v?10:47),Z=B=G=0,L++,k++),0===v+Z+B+G){if(N===k&&(0<M&&(E=E.replace(I,"")),0<E.trim().length)){switch(d){case 32:case 9:case 59:case 13:case 10:break;default:E+=s.charAt(N)}d=59}switch(d){case 123:for(u=(E=E.trim()).charCodeAt(0),h=1,z=++N;N<L;){switch(d=s.charCodeAt(N)){case 123:h++;break;case 125:h--;break;case 47:switch(d=s.charCodeAt(N+1)){case 42:case 47:e:{for(Y=N+1;Y<k;++Y)switch(s.charCodeAt(Y)){case 47:if(42===d&&42===s.charCodeAt(Y-1)&&N+2!==Y){N=Y+1;break e}break;case 10:if(47===d){N=Y+1;break e}}N=Y}}break;case 91:d++;case 40:d++;case 34:case 39:for(;N++<k&&s.charCodeAt(N)!==d;);}if(0===h)break;N++}switch(h=s.substring(z,N),0===u&&(u=(E=E.replace(c,"").trim()).charCodeAt(0)),u){case 64:switch(0<M&&(E=E.replace(I,"")),d=E.charCodeAt(1)){case 100:case 109:case 115:case 45:M=i;break;default:M=x}if(z=(h=t(i,M,h,d,C+1)).length,0<H&&(f=g(3,h,M=n(x,E,F),i,S,W,z,d,C,l),E=M.join(""),void 0!==f&&0===(z=(h=f.trim()).length)&&(d=0,h="")),0<z)switch(d){case 115:E=E.replace(y,a);case 100:case 109:case 45:h=E+"{"+h+"}";break;case 107:h=(E=E.replace(p,"$1 $2"))+"{"+h+"}",h=1===V||2===V&&r("@"+h,3)?"@-webkit-"+h+"@"+h:"@"+h;break;default:h=E+h,112===l&&(T+=h,h="")}else h="";break;default:h=t(i,n(i,E,F),h,l,C+1)}U+=h,h=F=M=Y=u=0,E="",d=s.charCodeAt(++N);break;case 125:case 59:if(1<(z=(E=(0<M?E.replace(I,""):E).trim()).length))switch(0===Y&&(u=E.charCodeAt(0),45===u||96<u&&123>u)&&(z=(E=E.replace(" ",":")).length),0<H&&void 0!==(f=g(1,E,i,e,S,W,T.length,l,C,l))&&0===(z=(E=f.trim()).length)&&(E="\0\0"),u=E.charCodeAt(0),d=E.charCodeAt(1),u){case 0:break;case 64:if(105===d||99===d){_+=E+s.charAt(N);break}default:58!==E.charCodeAt(z-1)&&(T+=o(E,u,d,E.charCodeAt(2)))}F=M=Y=u=0,E="",d=s.charCodeAt(++N)}}switch(d){case 13:case 10:47===v?v=0:0===1+u&&107!==l&&0<E.length&&(M=1,E+="\0"),0<H*K&&g(0,E,i,e,S,W,T.length,l,C,l),W=1,S++;break;case 59:case 125:if(0===v+Z+B+G){W++;break}default:switch(W++,A=s.charAt(N),d){case 9:case 32:if(0===Z+G+v)switch(w){case 44:case 58:case 9:case 32:A="";break;default:32!==d&&(A=" ")}break;case 0:A="\\0";break;case 12:A="\\f";break;case 11:A="\\v";break;case 38:0===Z+v+G&&(M=F=1,A="\f"+A);break;case 108:if(0===Z+v+G+R&&0<Y)switch(N-Y){case 2:112===w&&58===s.charCodeAt(N-3)&&(R=w);case 8:111===X&&(R=X)}break;case 58:0===Z+v+G&&(Y=N);break;case 44:0===v+B+Z+G&&(M=1,A+="\r");break;case 34:case 39:0===v&&(Z=Z===d?0:0===Z?d:Z);break;case 91:0===Z+v+B&&G++;break;case 93:0===Z+v+B&&G--;break;case 41:0===Z+v+G&&B--;break;case 40:if(0===Z+v+G){if(0===u)switch(2*w+3*X){case 533:break;default:u=1}B++}break;case 64:0===v+B+Z+G+Y+h&&(h=1);break;case 42:case 47:if(!(0<Z+G+B))switch(v){case 0:switch(2*d+3*s.charCodeAt(N+1)){case 235:v=47;break;case 220:z=N,v=42}break;case 42:47===d&&42===w&&z+2!==N&&(33===s.charCodeAt(z+2)&&(T+=s.substring(z,N+1)),A="",v=0)}}0===v&&(E+=A)}X=w,w=d,N++}if(0<(z=T.length)){if(M=i,0<H&&(void 0!==(f=g(2,T,M,e,S,W,z,l,C,l))&&0===(T=f).length))return _+T+U;if(T=M.join(",")+"{"+T+"}",0!=V*R){switch(2!==V||r(T,2)||(R=0),R){case 111:T=T.replace(b,":-moz-$1")+T;break;case 112:T=T.replace(m,"::-webkit-input-$1")+T.replace(m,"::-moz-$1")+T.replace(m,":-ms-input-$1")+T}R=0}}return _+T+U}function n(e,t,n){var o=t.trim().split(h);t=o;var r=o.length,a=e.length;switch(a){case 0:case 1:var g=0;for(e=0===a?"":e[0]+" ";g<r;++g)t[g]=i(e,t[g],n).trim();break;default:var s=g=0;for(t=[];g<r;++g)for(var l=0;l<a;++l)t[s++]=i(e[l]+" ",o[g],n).trim()}return t}function i(e,t,n){var i=t.charCodeAt(0);switch(33>i&&(i=(t=t.trim()).charCodeAt(0)),i){case 38:return t.replace(A,"$1"+e.trim());case 58:return e.trim()+t.replace(A,"$1"+e.trim());default:if(0<1*n&&0<t.indexOf("\f"))return t.replace(A,(58===e.charCodeAt(0)?"":"$1")+e.trim())}return e+t}function o(e,t,n,i){var a=e+";",g=2*t+3*n+4*i;if(944===g){e=a.indexOf(":",9)+1;var s=a.substring(e,a.length-1).trim();return s=a.substring(0,e).trim()+s+";",1===V||2===V&&r(s,1)?"-webkit-"+s+s:s}if(0===V||2===V&&!r(a,1))return a;switch(g){case 1015:return 97===a.charCodeAt(10)?"-webkit-"+a+a:a;case 951:return 116===a.charCodeAt(3)?"-webkit-"+a+a:a;case 963:return 110===a.charCodeAt(5)?"-webkit-"+a+a:a;case 1009:if(100!==a.charCodeAt(4))break;case 969:case 942:return"-webkit-"+a+a;case 978:return"-webkit-"+a+"-moz-"+a+a;case 1019:case 983:return"-webkit-"+a+"-moz-"+a+"-ms-"+a+a;case 883:if(45===a.charCodeAt(8))return"-webkit-"+a+a;if(0<a.indexOf("image-set(",11))return a.replace(w,"$1-webkit-$2")+a;break;case 932:if(45===a.charCodeAt(4))switch(a.charCodeAt(5)){case 103:return"-webkit-box-"+a.replace("-grow","")+"-webkit-"+a+"-ms-"+a.replace("grow","positive")+a;case 115:return"-webkit-"+a+"-ms-"+a.replace("shrink","negative")+a;case 98:return"-webkit-"+a+"-ms-"+a.replace("basis","preferred-size")+a}return"-webkit-"+a+"-ms-"+a+a;case 964:return"-webkit-"+a+"-ms-flex-"+a+a;case 1023:if(99!==a.charCodeAt(8))break;return"-webkit-box-pack"+(s=a.substring(a.indexOf(":",15)).replace("flex-","").replace("space-between","justify"))+"-webkit-"+a+"-ms-flex-pack"+s+a;case 1005:return u.test(a)?a.replace(C,":-webkit-")+a.replace(C,":-moz-")+a:a;case 1e3:switch(t=(s=a.substring(13).trim()).indexOf("-")+1,s.charCodeAt(0)+s.charCodeAt(t)){case 226:s=a.replace(f,"tb");break;case 232:s=a.replace(f,"tb-rl");break;case 220:s=a.replace(f,"lr");break;default:return a}return"-webkit-"+a+"-ms-"+s+a;case 1017:if(-1===a.indexOf("sticky",9))break;case 975:switch(t=(a=e).length-10,g=(s=(33===a.charCodeAt(t)?a.substring(0,t):a).substring(e.indexOf(":",7)+1).trim()).charCodeAt(0)+(0|s.charCodeAt(7))){case 203:if(111>s.charCodeAt(8))break;case 115:a=a.replace(s,"-webkit-"+s)+";"+a;break;case 207:case 102:a=a.replace(s,"-webkit-"+(102<g?"inline-":"")+"box")+";"+a.replace(s,"-webkit-"+s)+";"+a.replace(s,"-ms-"+s+"box")+";"+a}return a+";";case 938:if(45===a.charCodeAt(5))switch(a.charCodeAt(6)){case 105:return s=a.replace("-items",""),"-webkit-"+a+"-webkit-box-"+s+"-ms-flex-"+s+a;case 115:return"-webkit-"+a+"-ms-flex-item-"+a.replace(v,"")+a;default:return"-webkit-"+a+"-ms-flex-line-pack"+a.replace("align-content","").replace(v,"")+a}break;case 973:case 989:if(45!==a.charCodeAt(3)||122===a.charCodeAt(4))break;case 931:case 953:if(!0===Z.test(e))return 115===(s=e.substring(e.indexOf(":")+1)).charCodeAt(0)?o(e.replace("stretch","fill-available"),t,n,i).replace(":fill-available",":stretch"):a.replace(s,"-webkit-"+s)+a.replace(s,"-moz-"+s.replace("fill-",""))+a;break;case 962:if(a="-webkit-"+a+(102===a.charCodeAt(5)?"-ms-"+a:"")+a,211===n+i&&105===a.charCodeAt(13)&&0<a.indexOf("transform",10))return a.substring(0,a.indexOf(";",27)+1).replace(d,"$1-webkit-$2")+a}return a}function r(e,t){var n=e.indexOf(1===t?":":"{"),i=e.substring(0,3!==t?n:10);return n=e.substring(n+1,e.length-1),Y(2!==t?i:i.replace(B,"$1"),n,t)}function a(e,t){var n=o(t,t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2));return n!==t+";"?n.replace(G," or ($1)").substring(4):"("+t+")"}function g(e,t,n,i,o,r,a,g,s,c){for(var I,C=0,u=t;C<H;++C)switch(I=X[C].call(l,e,u,n,i,o,r,a,g,s,c)){case void 0:case!1:case!0:case null:break;default:u=I}if(u!==t)return u}function s(e){return void 0!==(e=e.prefix)&&(Y=null,e?"function"!=typeof e?V=1:(V=2,Y=e):V=0),s}function l(e,n){var i=e;if(33>i.charCodeAt(0)&&(i=i.trim()),i=[i],0<H){var o=g(-1,n,i,i,S,W,0,0,0,0);void 0!==o&&"string"==typeof o&&(n=o)}var r=t(x,i,n,0,0);return 0<H&&(void 0!==(o=g(-2,r,i,i,S,W,r.length,0,0,0))&&(r=o)),"",R=0,W=S=1,r}var c=/^\0+/g,I=/[\0\r\f]/g,C=/: */g,u=/zoo|gra/,d=/([,: ])(transform)/g,h=/,\r+?/g,A=/([\t\r\n ])*\f?&/g,p=/@(k\w+)\s*(\S*)\s*/,m=/::(place)/g,b=/:(read-only)/g,f=/[svh]\w+-[tblr]{2}/,y=/\(\s*(.*)\s*\)/g,G=/([\s\S]*?);/g,v=/-self|flex-/g,B=/[^]*?(:[rp][el]a[\w-]+)[^]*/,Z=/stretch|:\s*\w+\-(?:conte|avail)/,w=/([^-])(image-set\()/,W=1,S=1,R=0,V=1,x=[],X=[],H=0,Y=null,K=0;return l.use=function e(t){switch(t){case void 0:case null:H=X.length=0;break;default:if("function"==typeof t)X[H++]=t;else if("object"==typeof t)for(var n=0,i=t.length;n<i;++n)e(t[n]);else K=0|!!t}return e},l.set=s,void 0!==e&&s(e),l},s={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};var l=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|inert|itemProp|itemScope|itemType|itemID|itemRef|on|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,c=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){return l.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),I=n(3463),C=n.n(I);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var d=function(e,t){for(var n=[e[0]],i=0,o=t.length;i<o;i+=1)n.push(t[i],e[i+1]);return n},h=function(e){return null!==e&&"object"==typeof e&&"[object Object]"===(e.toString?e.toString():Object.prototype.toString.call(e))&&!(0,i.typeOf)(e)},A=Object.freeze([]),p=Object.freeze({});function m(e){return"function"==typeof e}function b(e){return e.displayName||e.name||"Component"}function f(e){return e&&"string"==typeof e.styledComponentId}var y="undefined"!=typeof process&&(process.env.REACT_APP_SC_ATTR||process.env.SC_ATTR)||"data-styled",G="undefined"!=typeof window&&"HTMLElement"in window,v=Boolean("boolean"==typeof SC_DISABLE_SPEEDY?SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!==process.env.REACT_APP_SC_DISABLE_SPEEDY&&""!==process.env.REACT_APP_SC_DISABLE_SPEEDY?"false"!==process.env.REACT_APP_SC_DISABLE_SPEEDY&&process.env.REACT_APP_SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!==process.env.SC_DISABLE_SPEEDY&&""!==process.env.SC_DISABLE_SPEEDY&&("false"!==process.env.SC_DISABLE_SPEEDY&&process.env.SC_DISABLE_SPEEDY));function B(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw new Error("An error occurred. See https://git.io/JUIaE#"+e+" for more information."+(n.length>0?" Args: "+n.join(", "):""))}var Z=function(){function e(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}var t=e.prototype;return t.indexOfGroup=function(e){for(var t=0,n=0;n<e;n++)t+=this.groupSizes[n];return t},t.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var n=this.groupSizes,i=n.length,o=i;e>=o;)(o<<=1)<0&&B(16,""+e);this.groupSizes=new Uint32Array(o),this.groupSizes.set(n),this.length=o;for(var r=i;r<o;r++)this.groupSizes[r]=0}for(var a=this.indexOfGroup(e+1),g=0,s=t.length;g<s;g++)this.tag.insertRule(a,t[g])&&(this.groupSizes[e]++,a++)},t.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],n=this.indexOfGroup(e),i=n+t;this.groupSizes[e]=0;for(var o=n;o<i;o++)this.tag.deleteRule(n)}},t.getGroup=function(e){var t="";if(e>=this.length||0===this.groupSizes[e])return t;for(var n=this.groupSizes[e],i=this.indexOfGroup(e),o=i+n,r=i;r<o;r++)t+=this.tag.getRule(r)+"/*!sc*/\n";return t},e}(),w=new Map,W=new Map,S=1,R=function(e){if(w.has(e))return w.get(e);for(;W.has(S);)S++;var t=S++;return w.set(e,t),W.set(t,e),t},V=function(e){return W.get(e)},x=function(e,t){w.set(e,t),W.set(t,e)},X="style["+y+'][data-styled-version="5.3.0"]',H=new RegExp("^"+y+'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)'),Y=function(e,t,n){for(var i,o=n.split(","),r=0,a=o.length;r<a;r++)(i=o[r])&&e.registerName(t,i)},K=function(e,t){for(var n=t.innerHTML.split("/*!sc*/\n"),i=[],o=0,r=n.length;o<r;o++){var a=n[o].trim();if(a){var g=a.match(H);if(g){var s=0|parseInt(g[1],10),l=g[2];0!==s&&(x(l,s),Y(e,l,g[3]),e.getTag().insertRules(s,i)),i.length=0}else i.push(a)}}},N=function(){return"undefined"!=typeof window&&void 0!==window.__webpack_nonce__?window.__webpack_nonce__:null},M=function(e){var t=document.head,n=e||t,i=document.createElement("style"),o=function(e){for(var t=e.childNodes,n=t.length;n>=0;n--){var i=t[n];if(i&&1===i.nodeType&&i.hasAttribute(y))return i}}(n),r=void 0!==o?o.nextSibling:null;i.setAttribute(y,"active"),i.setAttribute("data-styled-version","5.3.0");var a=N();return a&&i.setAttribute("nonce",a),n.insertBefore(i,r),i},F=function(){function e(e){var t=this.element=M(e);t.appendChild(document.createTextNode("")),this.sheet=function(e){if(e.sheet)return e.sheet;for(var t=document.styleSheets,n=0,i=t.length;n<i;n++){var o=t[n];if(o.ownerNode===e)return o}B(17)}(t),this.length=0}var t=e.prototype;return t.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch(e){return!1}},t.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.getRule=function(e){var t=this.sheet.cssRules[e];return void 0!==t&&"string"==typeof t.cssText?t.cssText:""},e}(),z=function(){function e(e){var t=this.element=M(e);this.nodes=t.childNodes,this.length=0}var t=e.prototype;return t.insertRule=function(e,t){if(e<=this.length&&e>=0){var n=document.createTextNode(t),i=this.nodes[e];return this.element.insertBefore(n,i||null),this.length++,!0}return!1},t.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},e}(),L=function(){function e(e){this.rules=[],this.length=0}var t=e.prototype;return t.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},t.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.getRule=function(e){return e<this.length?this.rules[e]:""},e}(),k=G,E={isServer:!G,useCSSOMInjection:!v},T=function(){function e(e,t,n){void 0===e&&(e=p),void 0===t&&(t={}),this.options=u({},E,{},e),this.gs=t,this.names=new Map(n),!this.options.isServer&&G&&k&&(k=!1,function(e){for(var t=document.querySelectorAll(X),n=0,i=t.length;n<i;n++){var o=t[n];o&&"active"!==o.getAttribute(y)&&(K(e,o),o.parentNode&&o.parentNode.removeChild(o))}}(this))}e.registerId=function(e){return R(e)};var t=e.prototype;return t.reconstructWithOptions=function(t,n){return void 0===n&&(n=!0),new e(u({},this.options,{},t),this.gs,n&&this.names||void 0)},t.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.getTag=function(){return this.tag||(this.tag=(n=(t=this.options).isServer,i=t.useCSSOMInjection,o=t.target,e=n?new L(o):i?new F(o):new z(o),new Z(e)));var e,t,n,i,o},t.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},t.registerName=function(e,t){if(R(e),this.names.has(e))this.names.get(e).add(t);else{var n=new Set;n.add(t),this.names.set(e,n)}},t.insertRules=function(e,t,n){this.registerName(e,t),this.getTag().insertRules(R(e),n)},t.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.clearRules=function(e){this.getTag().clearGroup(R(e)),this.clearNames(e)},t.clearTag=function(){this.tag=void 0},t.toString=function(){return function(e){for(var t=e.getTag(),n=t.length,i="",o=0;o<n;o++){var r=V(o);if(void 0!==r){var a=e.names.get(r),g=t.getGroup(o);if(void 0!==a&&0!==g.length){var s=y+".g"+o+'[id="'+r+'"]',l="";void 0!==a&&a.forEach((function(e){e.length>0&&(l+=e+",")})),i+=""+g+s+'{content:"'+l+'"}/*!sc*/\n'}}}return i}(this)},e}(),U=/(a)(d)/gi,_=function(e){return String.fromCharCode(e+(e>25?39:97))};function J(e){var t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=_(t%52)+n;return(_(t%52)+n).replace(U,"$1-$2")}var D=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},P=function(e){return D(5381,e)};function Q(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(m(n)&&!f(n))return!1}return!0}var O=P("5.3.0"),j=function(){function e(e,t,n){this.rules=e,this.staticRulesId="",this.isStatic=(void 0===n||n.isStatic)&&Q(e),this.componentId=t,this.baseHash=D(O,t),this.baseStyle=n,T.registerId(t)}return e.prototype.generateAndInjectStyles=function(e,t,n){var i=this.componentId,o=[];if(this.baseStyle&&o.push(this.baseStyle.generateAndInjectStyles(e,t,n)),this.isStatic&&!n.hash)if(this.staticRulesId&&t.hasNameForId(i,this.staticRulesId))o.push(this.staticRulesId);else{var r=he(this.rules,e,t,n).join(""),a=J(D(this.baseHash,r.length)>>>0);if(!t.hasNameForId(i,a)){var g=n(r,"."+a,void 0,i);t.insertRules(i,a,g)}o.push(a),this.staticRulesId=a}else{for(var s=this.rules.length,l=D(this.baseHash,n.hash),c="",I=0;I<s;I++){var C=this.rules[I];if("string"==typeof C)c+=C;else if(C){var u=he(C,e,t,n),d=Array.isArray(u)?u.join(""):u;l=D(l,d+I),c+=d}}if(c){var h=J(l>>>0);if(!t.hasNameForId(i,h)){var A=n(c,"."+h,void 0,i);t.insertRules(i,h,A)}o.push(h)}}return o.join(" ")},e}(),q=/^\s*\/\/.*$/gm,$=[":","[",".","#"];function ee(e){var t,n,i,o,r=void 0===e?p:e,a=r.options,s=void 0===a?p:a,l=r.plugins,c=void 0===l?A:l,I=new g(s),C=[],u=function(e){function t(t){if(t)try{e(t+"}")}catch(e){}}return function(n,i,o,r,a,g,s,l,c,I){switch(n){case 1:if(0===c&&64===i.charCodeAt(0))return e(i+";"),"";break;case 2:if(0===l)return i+"/*|*/";break;case 3:switch(l){case 102:case 112:return e(o[0]+i),"";default:return i+(0===I?"/*|*/":"")}case-2:i.split("/*|*/}").forEach(t)}}}((function(e){C.push(e)})),d=function(e,i,r){return 0===i&&-1!==$.indexOf(r[n.length])||r.match(o)?e:"."+t};function h(e,r,a,g){void 0===g&&(g="&");var s=e.replace(q,""),l=r&&a?a+" "+r+" { "+s+" }":s;return t=g,n=r,i=new RegExp("\\"+n+"\\b","g"),o=new RegExp("(\\"+n+"\\b){2,}"),I(a||!r?"":r,l)}return I.use([].concat(c,[function(e,t,o){2===e&&o.length&&o[0].lastIndexOf(n)>0&&(o[0]=o[0].replace(i,d))},u,function(e){if(-2===e){var t=C;return C=[],t}}])),h.hash=c.length?c.reduce((function(e,t){return t.name||B(15),D(e,t.name)}),5381).toString():"",h}var te=o.createContext(),ne=(te.Consumer,o.createContext()),ie=(ne.Consumer,new T),oe=ee();function re(){return(0,o.useContext)(te)||ie}function ae(){return(0,o.useContext)(ne)||oe}function ge(e){var t=(0,o.useState)(e.stylisPlugins),n=t[0],i=t[1],r=re(),g=(0,o.useMemo)((function(){var t=r;return e.sheet?t=e.sheet:e.target&&(t=t.reconstructWithOptions({target:e.target},!1)),e.disableCSSOMInjection&&(t=t.reconstructWithOptions({useCSSOMInjection:!1})),t}),[e.disableCSSOMInjection,e.sheet,e.target]),s=(0,o.useMemo)((function(){return ee({options:{prefix:!e.disableVendorPrefixes},plugins:n})}),[e.disableVendorPrefixes,n]);return(0,o.useEffect)((function(){a()(n,e.stylisPlugins)||i(e.stylisPlugins)}),[e.stylisPlugins]),o.createElement(te.Provider,{value:g},o.createElement(ne.Provider,{value:s},e.children))}var se=function(){function e(e,t){var n=this;this.inject=function(e,t){void 0===t&&(t=oe);var i=n.name+t.hash;e.hasNameForId(n.id,i)||e.insertRules(n.id,i,t(n.rules,i,"@keyframes"))},this.toString=function(){return B(12,String(n.name))},this.name=e,this.id="sc-keyframes-"+e,this.rules=t}return e.prototype.getName=function(e){return void 0===e&&(e=oe),this.name+e.hash},e}(),le=/([A-Z])/,ce=/([A-Z])/g,Ie=/^ms-/,Ce=function(e){return"-"+e.toLowerCase()};function ue(e){return le.test(e)?e.replace(ce,Ce).replace(Ie,"-ms-"):e}var de=function(e){return null==e||!1===e||""===e};function he(e,t,n,i){if(Array.isArray(e)){for(var o,r=[],a=0,g=e.length;a<g;a+=1)""!==(o=he(e[a],t,n,i))&&(Array.isArray(o)?r.push.apply(r,o):r.push(o));return r}return de(e)?"":f(e)?"."+e.styledComponentId:m(e)?"function"!=typeof(l=e)||l.prototype&&l.prototype.isReactComponent||!t?e:he(e(t),t,n,i):e instanceof se?n?(e.inject(n,i),e.getName(i)):e:h(e)?function e(t,n){var i,o,r=[];for(var a in t)t.hasOwnProperty(a)&&!de(t[a])&&(h(t[a])?r.push.apply(r,e(t[a],a)):m(t[a])?r.push(ue(a)+":",t[a],";"):r.push(ue(a)+": "+(i=a,(null==(o=t[a])||"boolean"==typeof o||""===o?"":"number"!=typeof o||0===o||i in s?String(o).trim():o+"px")+";")));return n?[n+" {"].concat(r,["}"]):r}(e):e.toString();var l}function Ae(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return m(e)||h(e)?he(d(A,[e].concat(n))):0===n.length&&1===e.length&&"string"==typeof e[0]?e:he(d(e,n))}new Set;var pe=function(e,t,n){return void 0===n&&(n=p),e.theme!==n.theme&&e.theme||t||n.theme},me=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,be=/(^-|-$)/g;function fe(e){return e.replace(me,"-").replace(be,"")}var ye=function(e){return J(P(e)>>>0)};function Ge(e){return"string"==typeof e&&!0}var ve=function(e){return"function"==typeof e||"object"==typeof e&&null!==e&&!Array.isArray(e)},Be=function(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e};function Ze(e,t,n){var i=e[n];ve(t)&&ve(i)?we(i,t):e[n]=t}function we(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var o=0,r=n;o<r.length;o++){var a=r[o];if(ve(a))for(var g in a)Be(g)&&Ze(e,a[g],g)}return e}var We=o.createContext();We.Consumer;var Se={};function Re(e,t,n){var i=f(e),r=!Ge(e),a=t.attrs,g=void 0===a?A:a,s=t.componentId,l=void 0===s?function(e,t){var n="string"!=typeof e?"sc":fe(e);Se[n]=(Se[n]||0)+1;var i=n+"-"+ye("5.3.0"+n+Se[n]);return t?t+"-"+i:i}(t.displayName,t.parentComponentId):s,I=t.displayName,d=void 0===I?function(e){return Ge(e)?"styled."+e:"Styled("+b(e)+")"}(e):I,h=t.displayName&&t.componentId?fe(t.displayName)+"-"+t.componentId:t.componentId||l,y=i&&e.attrs?Array.prototype.concat(e.attrs,g).filter(Boolean):g,G=t.shouldForwardProp;i&&e.shouldForwardProp&&(G=t.shouldForwardProp?function(n,i,o){return e.shouldForwardProp(n,i,o)&&t.shouldForwardProp(n,i,o)}:e.shouldForwardProp);var v,B=new j(n,h,i?e.componentStyle:void 0),Z=B.isStatic&&0===g.length,w=function(e,t){return function(e,t,n,i){var r=e.attrs,a=e.componentStyle,g=e.defaultProps,s=e.foldedComponentIds,l=e.shouldForwardProp,I=e.styledComponentId,C=e.target,d=function(e,t,n){void 0===e&&(e=p);var i=u({},t,{theme:e}),o={};return n.forEach((function(e){var t,n,r,a=e;for(t in m(a)&&(a=a(i)),a)i[t]=o[t]="className"===t?(n=o[t],r=a[t],n&&r?n+" "+r:n||r):a[t]})),[i,o]}(pe(t,(0,o.useContext)(We),g)||p,t,r),h=d[0],A=d[1],b=function(e,t,n,i){var o=re(),r=ae();return t?e.generateAndInjectStyles(p,o,r):e.generateAndInjectStyles(n,o,r)}(a,i,h),f=n,y=A.$as||t.$as||A.as||t.as||C,G=Ge(y),v=A!==t?u({},t,{},A):t,B={};for(var Z in v)"$"!==Z[0]&&"as"!==Z&&("forwardedAs"===Z?B.as=v[Z]:(l?l(Z,c,y):!G||c(Z))&&(B[Z]=v[Z]));return t.style&&A.style!==t.style&&(B.style=u({},t.style,{},A.style)),B.className=Array.prototype.concat(s,I,b!==I?b:null,t.className,A.className).filter(Boolean).join(" "),B.ref=f,(0,o.createElement)(y,B)}(v,e,t,Z)};return w.displayName=d,(v=o.forwardRef(w)).attrs=y,v.componentStyle=B,v.displayName=d,v.shouldForwardProp=G,v.foldedComponentIds=i?Array.prototype.concat(e.foldedComponentIds,e.styledComponentId):A,v.styledComponentId=h,v.target=i?e.target:e,v.withComponent=function(e){var i=t.componentId,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(t,["componentId"]),r=i&&i+"-"+(Ge(e)?e:fe(b(e)));return Re(e,u({},o,{attrs:y,componentId:r}),n)},Object.defineProperty(v,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(t){this._foldedDefaultProps=i?we({},e.defaultProps,t):t}}),v.toString=function(){return"."+v.styledComponentId},r&&C()(v,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0,withComponent:!0}),v}var Ve=function(e){return function e(t,n,o){if(void 0===o&&(o=p),!(0,i.isValidElementType)(n))return B(1,String(n));var r=function(){return t(n,o,Ae.apply(void 0,arguments))};return r.withConfig=function(i){return e(t,n,u({},o,{},i))},r.attrs=function(i){return e(t,n,u({},o,{attrs:Array.prototype.concat(o.attrs,i).filter(Boolean)}))},r}(Re,e)};["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","textPath","tspan"].forEach((function(e){Ve[e]=Ve(e)}));!function(){function e(e,t){this.rules=e,this.componentId=t,this.isStatic=Q(e),T.registerId(this.componentId+1)}var t=e.prototype;t.createStyles=function(e,t,n,i){var o=i(he(this.rules,t,n,i).join(""),""),r=this.componentId+e;n.insertRules(r,r,o)},t.removeStyles=function(e,t){t.clearRules(this.componentId+e)},t.renderStyles=function(e,t,n,i){e>2&&T.registerId(this.componentId+e),this.removeStyles(e,n),this.createStyles(e,t,n,i)}}();!function(){function e(){var e=this;this._emitSheetCSS=function(){var t=e.instance.toString(),n=N();return"<style "+[n&&'nonce="'+n+'"',y+'="true"','data-styled-version="5.3.0"'].filter(Boolean).join(" ")+">"+t+"</style>"},this.getStyleTags=function(){return e.sealed?B(2):e._emitSheetCSS()},this.getStyleElement=function(){var t;if(e.sealed)return B(2);var n=((t={})[y]="",t["data-styled-version"]="5.3.0",t.dangerouslySetInnerHTML={__html:e.instance.toString()},t),i=N();return i&&(n.nonce=i),[o.createElement("style",u({},n,{key:"sc-0-0"}))]},this.seal=function(){e.sealed=!0},this.instance=new T({isServer:!0}),this.sealed=!1}var t=e.prototype;t.collectStyles=function(e){return this.sealed?B(2):o.createElement(ge,{sheet:this.instance},e)},t.interleaveWithNodeStream=function(e){return B(3)}}();var xe=Ve},3703:function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{o:function(){return g},z:function(){return a}});var o=n(2955);const r=(e,t)=>(e%t+t)%t;class a extends o.EventDispatcher{constructor(e,t){super(),i(this,"object",void 0),i(this,"domElement",void 0),i(this,"enabled",!0),i(this,"target",new o.Vector3),i(this,"minDistance",0),i(this,"maxDistance",1/0),i(this,"minZoom",0),i(this,"maxZoom",1/0),i(this,"minPolarAngle",0),i(this,"maxPolarAngle",Math.PI),i(this,"minAzimuthAngle",-1/0),i(this,"maxAzimuthAngle",1/0),i(this,"enableDamping",!1),i(this,"dampingFactor",.05),i(this,"enableZoom",!0),i(this,"zoomSpeed",1),i(this,"enableRotate",!0),i(this,"rotateSpeed",1),i(this,"enablePan",!0),i(this,"panSpeed",1),i(this,"screenSpacePanning",!0),i(this,"keyPanSpeed",7),i(this,"autoRotate",!1),i(this,"autoRotateSpeed",2),i(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),i(this,"mouseButtons",{LEFT:o.MOUSE.ROTATE,MIDDLE:o.MOUSE.DOLLY,RIGHT:o.MOUSE.PAN}),i(this,"touches",{ONE:o.TOUCH.ROTATE,TWO:o.TOUCH.DOLLY_PAN}),i(this,"target0",void 0),i(this,"position0",void 0),i(this,"zoom0",void 0),i(this,"_domElementKeyEvents",null),i(this,"getPolarAngle",void 0),i(this,"getAzimuthalAngle",void 0),i(this,"setPolarAngle",void 0),i(this,"setAzimuthalAngle",void 0),i(this,"listenToKeyEvents",void 0),i(this,"saveState",void 0),i(this,"reset",void 0),i(this,"update",void 0),i(this,"connect",void 0),i(this,"dispose",void 0),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object instanceof o.PerspectiveCamera?this.object.zoom:1,this.getPolarAngle=()=>C.phi,this.getAzimuthalAngle=()=>C.theta,this.setPolarAngle=e=>{let t=r(e,2*Math.PI),i=C.phi;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let o=Math.abs(t-i);2*Math.PI-o<o&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.phi=t-i,n.update()},this.setAzimuthalAngle=e=>{let t=r(e,2*Math.PI),i=C.theta;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let o=Math.abs(t-i);2*Math.PI-o<o&&(t<i?t+=2*Math.PI:i+=2*Math.PI),u.theta=t-i,n.update()},this.listenToKeyEvents=e=>{e.addEventListener("keydown",J),this._domElementKeyEvents=e},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object instanceof o.PerspectiveCamera?n.object.zoom:1},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object instanceof o.PerspectiveCamera&&(n.object.zoom=n.zoom0,n.object.updateProjectionMatrix()),n.dispatchEvent(a),n.update(),c=l.NONE},this.update=(()=>{const t=new o.Vector3,i=(new o.Quaternion).setFromUnitVectors(e.up,new o.Vector3(0,1,0)),r=i.clone().invert(),g=new o.Vector3,s=new o.Quaternion,p=2*Math.PI;return function(){const e=n.object.position;t.copy(e).sub(n.target),t.applyQuaternion(i),C.setFromVector3(t),n.autoRotate&&c===l.NONE&&W(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(C.theta+=u.theta*n.dampingFactor,C.phi+=u.phi*n.dampingFactor):(C.theta+=u.theta,C.phi+=u.phi);let o=n.minAzimuthAngle,m=n.maxAzimuthAngle;return isFinite(o)&&isFinite(m)&&(o<-Math.PI?o+=p:o>Math.PI&&(o-=p),m<-Math.PI?m+=p:m>Math.PI&&(m-=p),C.theta=o<=m?Math.max(o,Math.min(m,C.theta)):C.theta>(o+m)/2?Math.max(o,C.theta):Math.min(m,C.theta)),C.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,C.phi)),C.makeSafe(),C.radius*=d,C.radius=Math.max(n.minDistance,Math.min(n.maxDistance,C.radius)),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),t.setFromSpherical(C),t.applyQuaternion(r),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),h.set(0,0,0)),d=1,!!(A||g.distanceToSquared(n.object.position)>I||8*(1-s.dot(n.object.quaternion))>I)&&(n.dispatchEvent(a),g.copy(n.object.position),s.copy(n.object.quaternion),A=!1,!0)}})(),this.connect=e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),n.domElement=e,n.domElement.addEventListener("contextmenu",O),n.domElement.addEventListener("pointerdown",E),n.domElement.addEventListener("wheel",_),n.domElement.addEventListener("touchstart",D),n.domElement.addEventListener("touchend",Q),n.domElement.addEventListener("touchmove",P)},this.dispose=()=>{var e,t,i,o,r,a,g,s;null===(e=n.domElement)||void 0===e||e.removeEventListener("contextmenu",O),null===(t=n.domElement)||void 0===t||t.removeEventListener("pointerdown",E),null===(i=n.domElement)||void 0===i||i.removeEventListener("wheel",_),null===(o=n.domElement)||void 0===o||o.removeEventListener("touchstart",D),null===(r=n.domElement)||void 0===r||r.removeEventListener("touchend",Q),null===(a=n.domElement)||void 0===a||a.removeEventListener("touchmove",P),null===(g=n.domElement)||void 0===g||g.ownerDocument.removeEventListener("pointermove",T),null===(s=n.domElement)||void 0===s||s.ownerDocument.removeEventListener("pointerup",U),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",J)};const n=this,a={type:"change"},g={type:"start"},s={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=l.NONE;const I=1e-6,C=new o.Spherical,u=new o.Spherical;let d=1;const h=new o.Vector3;let A=!1;const p=new o.Vector2,m=new o.Vector2,b=new o.Vector2,f=new o.Vector2,y=new o.Vector2,G=new o.Vector2,v=new o.Vector2,B=new o.Vector2,Z=new o.Vector2;function w(){return Math.pow(.95,n.zoomSpeed)}function W(e){u.theta-=e}function S(e){u.phi-=e}const R=(()=>{const e=new o.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}})(),V=(()=>{const e=new o.Vector3;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),h.add(e)}})(),x=(()=>{const e=new o.Vector3;return function(t,i){const r=n.domElement;if(r&&n.object instanceof o.PerspectiveCamera&&n.object.isPerspectiveCamera){const o=n.object.position;e.copy(o).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),R(2*t*a/r.clientHeight,n.object.matrix),V(2*i*a/r.clientHeight,n.object.matrix)}else r&&n.object instanceof o.OrthographicCamera&&n.object.isOrthographicCamera?(R(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),V(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function X(e){n.object instanceof o.PerspectiveCamera&&n.object.isPerspectiveCamera?d/=e:n.object instanceof o.OrthographicCamera&&n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function H(e){n.object instanceof o.PerspectiveCamera&&n.object.isPerspectiveCamera?d*=e:n.object instanceof o.OrthographicCamera&&n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Y(e){p.set(e.clientX,e.clientY)}function K(e){f.set(e.clientX,e.clientY)}function N(e){if(1==e.touches.length)p.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);p.set(t,n)}}function M(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,n)}}function F(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);v.set(0,i)}function z(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,n)}b.subVectors(m,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(W(2*Math.PI*b.x/t.clientHeight),S(2*Math.PI*b.y/t.clientHeight)),p.copy(m)}function L(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,n)}G.subVectors(y,f).multiplyScalar(n.panSpeed),x(G.x,G.y),f.copy(y)}function k(e){const t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+i*i);B.set(0,o),Z.set(0,Math.pow(B.y/v.y,n.zoomSpeed)),X(Z.y),v.copy(B)}function E(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case o.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(e),c=l.DOLLY;break;case o.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;K(e),c=l.PAN}else{if(!1===n.enableRotate)return;Y(e),c=l.ROTATE}break;case o.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;Y(e),c=l.ROTATE}else{if(!1===n.enablePan)return;K(e),c=l.PAN}break;default:c=l.NONE}if(c!==l.NONE){var i,r;null===(i=n.domElement)||void 0===i||i.ownerDocument.addEventListener("pointermove",T),null===(r=n.domElement)||void 0===r||r.ownerDocument.addEventListener("pointerup",U),n.dispatchEvent(g)}}(e)}}function T(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===n.enabled)return;switch(c){case l.ROTATE:if(!1===n.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),b.subVectors(m,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(W(2*Math.PI*b.x/t.clientHeight),S(2*Math.PI*b.y/t.clientHeight)),p.copy(m),n.update()}(e);break;case l.DOLLY:if(!1===n.enableZoom)return;!function(e){B.set(e.clientX,e.clientY),Z.subVectors(B,v),Z.y>0?X(w()):Z.y<0&&H(w()),v.copy(B),n.update()}(e);break;case l.PAN:if(!1===n.enablePan)return;!function(e){y.set(e.clientX,e.clientY),G.subVectors(y,f).multiplyScalar(n.panSpeed),x(G.x,G.y),f.copy(y),n.update()}(e)}}(e)}}function U(e){switch(e.pointerType){case"mouse":case"pen":!function(){var e,t;if(null===(e=n.domElement)||void 0===e||e.ownerDocument.removeEventListener("pointermove",T),null===(t=n.domElement)||void 0===t||t.ownerDocument.removeEventListener("pointerup",U),!1===n.enabled)return;n.dispatchEvent(s),c=l.NONE}()}}function _(e){!1===n.enabled||!1===n.enableZoom||c!==l.NONE&&c!==l.ROTATE||(e.preventDefault(),n.dispatchEvent(g),function(e){e.deltaY<0?H(w()):e.deltaY>0&&X(w()),n.update()}(e),n.dispatchEvent(s))}function J(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:x(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:x(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:x(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:x(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function D(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(n.touches.ONE){case o.TOUCH.ROTATE:if(!1===n.enableRotate)return;N(e),c=l.TOUCH_ROTATE;break;case o.TOUCH.PAN:if(!1===n.enablePan)return;M(e),c=l.TOUCH_PAN;break;default:c=l.NONE}break;case 2:switch(n.touches.TWO){case o.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&F(e),n.enablePan&&M(e)}(e),c=l.TOUCH_DOLLY_PAN;break;case o.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&F(e),n.enableRotate&&N(e)}(e),c=l.TOUCH_DOLLY_ROTATE;break;default:c=l.NONE}break;default:c=l.NONE}c!==l.NONE&&n.dispatchEvent(g)}}function P(e){if(!1!==n.enabled)switch(e.preventDefault(),c){case l.TOUCH_ROTATE:if(!1===n.enableRotate)return;z(e),n.update();break;case l.TOUCH_PAN:if(!1===n.enablePan)return;L(e),n.update();break;case l.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&k(e),n.enablePan&&L(e)}(e),n.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&k(e),n.enableRotate&&z(e)}(e),n.update();break;default:c=l.NONE}}function Q(){!1!==n.enabled&&(n.dispatchEvent(s),c=l.NONE)}function O(e){!1!==n.enabled&&e.preventDefault()}void 0!==t&&this.connect(t),this.update()}}class g extends a{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=o.MOUSE.PAN,this.mouseButtons.RIGHT=o.MOUSE.ROTATE,this.touches.ONE=o.TOUCH.PAN,this.touches.TWO=o.TOUCH.DOLLY_ROTATE}}},2955:function(e,t,n){"use strict";n.r(t),n.d(t,{ACESFilmicToneMapping:function(){return ne},AddEquation:function(){return Z},AddOperation:function(){return j},AdditiveAnimationBlendMode:function(){return Jt},AdditiveBlending:function(){return y},AlphaFormat:function(){return Ne},AlwaysDepth:function(){return E},AlwaysStencilFunc:function(){return Bn},AmbientLight:function(){return XI},AmbientLightProbe:function(){return eC},AnimationClip:function(){return Hc},AnimationLoader:function(){return kc},AnimationMixer:function(){return XC},AnimationObjectGroup:function(){return VC},AnimationUtils:function(){return fc},ArcCurve:function(){return Qc},ArrayCamera:function(){return Dg},ArrowHelper:function(){return Gu},Audio:function(){return IC},AudioAnalyser:function(){return pC},AudioContext:function(){return jI},AudioListener:function(){return cC},AudioLoader:function(){return qI},AxesHelper:function(){return vu},AxisHelper:function(){return vd},BackSide:function(){return h},BasicDepthPacking:function(){return rn},BasicShadowMap:function(){return c},BinaryTextureLoader:function(){return Sd},Bone:function(){return Xs},BooleanKeyframeTrack:function(){return wc},BoundingBoxHelper:function(){return Bd},Box2:function(){return EC},Box3:function(){return li},Box3Helper:function(){return pu},BoxBufferGeometry:function(){return Br},BoxGeometry:function(){return Br},BoxHelper:function(){return Au},BufferAttribute:function(){return Mo},BufferGeometry:function(){return or},BufferGeometryLoader:function(){return LI},ByteType:function(){return Ze},Cache:function(){return Kc},Camera:function(){return Rr},CameraHelper:function(){return uu},CanvasRenderer:function(){return Vd},CanvasTexture:function(){return gl},CatmullRomCurve3:function(){return tI},CineonToneMapping:function(){return te},CircleBufferGeometry:function(){return ll},CircleGeometry:function(){return ll},ClampToEdgeWrapping:function(){return Ce},Clock:function(){return oC},Color:function(){return Ho},ColorKeyframeTrack:function(){return Wc},CompressedTexture:function(){return al},CompressedTextureLoader:function(){return Ec},ConeBufferGeometry:function(){return Il},ConeGeometry:function(){return Il},CubeCamera:function(){return Xr},CubeReflectionMapping:function(){return re},CubeRefractionMapping:function(){return ae},CubeTexture:function(){return Hr},CubeTextureLoader:function(){return Uc},CubeUVReflectionMapping:function(){return le},CubeUVRefractionMapping:function(){return ce},CubicBezierCurve:function(){return rI},CubicBezierCurve3:function(){return aI},CubicInterpolant:function(){return Gc},CullFaceBack:function(){return g},CullFaceFront:function(){return s},CullFaceFrontBack:function(){return l},CullFaceNone:function(){return a},Curve:function(){return Dc},CurvePath:function(){return uI},CustomBlending:function(){return B},CustomToneMapping:function(){return ie},CylinderBufferGeometry:function(){return cl},CylinderGeometry:function(){return cl},Cylindrical:function(){return LC},DataTexture:function(){return Kr},DataTexture2DArray:function(){return ra},DataTexture3D:function(){return aa},DataTextureLoader:function(){return _c},DataUtils:function(){return wu},DecrementStencilOp:function(){return un},DecrementWrapStencilOp:function(){return hn},DefaultLoadingManager:function(){return Mc},DepthFormat:function(){return Ee},DepthStencilFormat:function(){return Te},DepthTexture:function(){return sl},DirectionalLight:function(){return xI},DirectionalLightHelper:function(){return cu},DiscreteInterpolant:function(){return Bc},DodecahedronBufferGeometry:function(){return ul},DodecahedronGeometry:function(){return ul},DoubleSide:function(){return A},DstAlphaFactor:function(){return N},DstColorFactor:function(){return F},DynamicBufferAttribute:function(){return ud},DynamicCopyUsage:function(){return Xn},DynamicDrawUsage:function(){return wn},DynamicReadUsage:function(){return Rn},EdgesGeometry:function(){return ml},EdgesHelper:function(){return Zd},EllipseCurve:function(){return Pc},EqualDepth:function(){return _},EqualStencilFunc:function(){return bn},EquirectangularReflectionMapping:function(){return ge},EquirectangularRefractionMapping:function(){return se},Euler:function(){return Di},EventDispatcher:function(){return Nn},ExtrudeBufferGeometry:function(){return Dl},ExtrudeGeometry:function(){return Dl},FaceColors:function(){return nd},FileLoader:function(){return Lc},FlatShading:function(){return p},Float16BufferAttribute:function(){return _o},Float32Attribute:function(){return yd},Float32BufferAttribute:function(){return Jo},Float64Attribute:function(){return Gd},Float64BufferAttribute:function(){return Do},FloatType:function(){return Ve},Fog:function(){return ns},FogExp2:function(){return ts},Font:function(){return DI},FontLoader:function(){return QI},FrontSide:function(){return d},Frustum:function(){return Fr},GLBufferAttribute:function(){return KC},GLSL1:function(){return Yn},GLSL3:function(){return Kn},GammaEncoding:function(){return qt},GreaterDepth:function(){return D},GreaterEqualDepth:function(){return J},GreaterEqualStencilFunc:function(){return vn},GreaterStencilFunc:function(){return yn},GridHelper:function(){return ru},Group:function(){return Pg},HalfFloatType:function(){return xe},HemisphereLight:function(){return pI},HemisphereLightHelper:function(){return ou},HemisphereLightProbe:function(){return $I},IcosahedronBufferGeometry:function(){return Ql},IcosahedronGeometry:function(){return Ql},ImageBitmapLoader:function(){return _I},ImageLoader:function(){return Tc},ImageUtils:function(){return qn},ImmediateRenderObject:function(){return JC},IncrementStencilOp:function(){return Cn},IncrementWrapStencilOp:function(){return dn},InstancedBufferAttribute:function(){return zI},InstancedBufferGeometry:function(){return FI},InstancedInterleavedBuffer:function(){return YC},InstancedMesh:function(){return Ls},Int16Attribute:function(){return pd},Int16BufferAttribute:function(){return ko},Int32Attribute:function(){return bd},Int32BufferAttribute:function(){return To},Int8Attribute:function(){return dd},Int8BufferAttribute:function(){return Fo},IntType:function(){return Se},InterleavedBuffer:function(){return os},InterleavedBufferAttribute:function(){return as},Interpolant:function(){return yc},InterpolateDiscrete:function(){return zt},InterpolateLinear:function(){return Lt},InterpolateSmooth:function(){return kt},InvertStencilOp:function(){return An},JSONLoader:function(){return xd},KeepStencilOp:function(){return cn},KeyframeTrack:function(){return Zc},LOD:function(){return Zs},LatheBufferGeometry:function(){return Ol},LatheGeometry:function(){return Ol},Layers:function(){return Pi},LensFlare:function(){return Hd},LessDepth:function(){return T},LessEqualDepth:function(){return U},LessEqualStencilFunc:function(){return fn},LessStencilFunc:function(){return mn},Light:function(){return AI},LightProbe:function(){return KI},Line:function(){return Ds},Line3:function(){return _C},LineBasicMaterial:function(){return ks},LineCurve:function(){return gI},LineCurve3:function(){return sI},LineDashedMaterial:function(){return mc},LineLoop:function(){return js},LinePieces:function(){return ed},LineSegments:function(){return Os},LineStrip:function(){return $u},LinearEncoding:function(){return Ot},LinearFilter:function(){return be},LinearInterpolant:function(){return vc},LinearMipMapLinearFilter:function(){return ve},LinearMipMapNearestFilter:function(){return ye},LinearMipmapLinearFilter:function(){return Ge},LinearMipmapNearestFilter:function(){return fe},LinearToneMapping:function(){return $},Loader:function(){return Fc},LoaderUtils:function(){return MI},LoadingManager:function(){return Nc},LogLuvEncoding:function(){return en},LoopOnce:function(){return Nt},LoopPingPong:function(){return Ft},LoopRepeat:function(){return Mt},LuminanceAlphaFormat:function(){return Le},LuminanceFormat:function(){return ze},MOUSE:function(){return o},Material:function(){return wo},MaterialLoader:function(){return NI},Math:function(){return Pn},MathUtils:function(){return Pn},Matrix3:function(){return On},Matrix4:function(){return Mi},MaxEquation:function(){return R},Mesh:function(){return Gr},MeshBasicMaterial:function(){return Yo},MeshDepthMaterial:function(){return kg},MeshDistanceMaterial:function(){return Eg},MeshFaceMaterial:function(){return od},MeshLambertMaterial:function(){return Ac},MeshMatcapMaterial:function(){return pc},MeshNormalMaterial:function(){return hc},MeshPhongMaterial:function(){return uc},MeshPhysicalMaterial:function(){return Cc},MeshStandardMaterial:function(){return Ic},MeshToonMaterial:function(){return dc},MinEquation:function(){return S},MirroredRepeatWrapping:function(){return ue},MixOperation:function(){return O},MultiMaterial:function(){return rd},MultiplyBlending:function(){return v},MultiplyOperation:function(){return Q},NearestFilter:function(){return de},NearestMipMapLinearFilter:function(){return me},NearestMipMapNearestFilter:function(){return Ae},NearestMipmapLinearFilter:function(){return pe},NearestMipmapNearestFilter:function(){return he},NeverDepth:function(){return k},NeverStencilFunc:function(){return pn},NoBlending:function(){return b},NoColors:function(){return td},NoToneMapping:function(){return q},NormalAnimationBlendMode:function(){return _t},NormalBlending:function(){return f},NotEqualDepth:function(){return P},NotEqualStencilFunc:function(){return Gn},NumberKeyframeTrack:function(){return Sc},Object3D:function(){return so},ObjectLoader:function(){return kI},ObjectSpaceNormalMap:function(){return sn},OctahedronBufferGeometry:function(){return jl},OctahedronGeometry:function(){return jl},OneFactor:function(){return x},OneMinusDstAlphaFactor:function(){return M},OneMinusDstColorFactor:function(){return z},OneMinusSrcAlphaFactor:function(){return K},OneMinusSrcColorFactor:function(){return H},OrthographicCamera:function(){return RI},PCFShadowMap:function(){return I},PCFSoftShadowMap:function(){return C},PMREMGenerator:function(){return Uu},ParametricBufferGeometry:function(){return ql},ParametricGeometry:function(){return ql},Particle:function(){return gd},ParticleBasicMaterial:function(){return cd},ParticleSystem:function(){return sd},ParticleSystemMaterial:function(){return Id},Path:function(){return dI},PerspectiveCamera:function(){return Vr},Plane:function(){return Co},PlaneBufferGeometry:function(){return kr},PlaneGeometry:function(){return kr},PlaneHelper:function(){return mu},PointCloud:function(){return ad},PointCloudMaterial:function(){return ld},PointLight:function(){return SI},PointLightHelper:function(){return eu},Points:function(){return il},PointsMaterial:function(){return qs},PolarGridHelper:function(){return au},PolyhedronBufferGeometry:function(){return Cl},PolyhedronGeometry:function(){return Cl},PositionalAudio:function(){return AC},PropertyBinding:function(){return RC},PropertyMixer:function(){return mC},QuadraticBezierCurve:function(){return lI},QuadraticBezierCurve3:function(){return cI},Quaternion:function(){return ri},QuaternionKeyframeTrack:function(){return Vc},QuaternionLinearInterpolant:function(){return Rc},REVISION:function(){return i},RGBADepthPacking:function(){return an},RGBAFormat:function(){return Fe},RGBAIntegerFormat:function(){return Qe},RGBA_ASTC_10x10_Format:function(){return mt},RGBA_ASTC_10x5_Format:function(){return ht},RGBA_ASTC_10x6_Format:function(){return At},RGBA_ASTC_10x8_Format:function(){return pt},RGBA_ASTC_12x10_Format:function(){return bt},RGBA_ASTC_12x12_Format:function(){return ft},RGBA_ASTC_4x4_Format:function(){return gt},RGBA_ASTC_5x4_Format:function(){return st},RGBA_ASTC_5x5_Format:function(){return lt},RGBA_ASTC_6x5_Format:function(){return ct},RGBA_ASTC_6x6_Format:function(){return It},RGBA_ASTC_8x5_Format:function(){return Ct},RGBA_ASTC_8x6_Format:function(){return ut},RGBA_ASTC_8x8_Format:function(){return dt},RGBA_BPTC_Format:function(){return yt},RGBA_ETC2_EAC_Format:function(){return at},RGBA_PVRTC_2BPPV1_Format:function(){return it},RGBA_PVRTC_4BPPV1_Format:function(){return nt},RGBA_S3TC_DXT1_Format:function(){return je},RGBA_S3TC_DXT3_Format:function(){return qe},RGBA_S3TC_DXT5_Format:function(){return $e},RGBDEncoding:function(){return on},RGBEEncoding:function(){return $t},RGBEFormat:function(){return ke},RGBFormat:function(){return Me},RGBIntegerFormat:function(){return Pe},RGBM16Encoding:function(){return nn},RGBM7Encoding:function(){return tn},RGB_ETC1_Format:function(){return ot},RGB_ETC2_Format:function(){return rt},RGB_PVRTC_2BPPV1_Format:function(){return tt},RGB_PVRTC_4BPPV1_Format:function(){return et},RGB_S3TC_DXT1_Format:function(){return Oe},RGFormat:function(){return Je},RGIntegerFormat:function(){return De},RawShaderMaterial:function(){return cc},Ray:function(){return Ni},Raycaster:function(){return NC},RectAreaLight:function(){return HI},RedFormat:function(){return Ue},RedIntegerFormat:function(){return _e},ReinhardToneMapping:function(){return ee},RepeatWrapping:function(){return Ie},ReplaceStencilOp:function(){return In},ReverseSubtractEquation:function(){return W},RingBufferGeometry:function(){return $l},RingGeometry:function(){return $l},SRGB8_ALPHA8_ASTC_10x10_Format:function(){return Ht},SRGB8_ALPHA8_ASTC_10x5_Format:function(){return Vt},SRGB8_ALPHA8_ASTC_10x6_Format:function(){return xt},SRGB8_ALPHA8_ASTC_10x8_Format:function(){return Xt},SRGB8_ALPHA8_ASTC_12x10_Format:function(){return Yt},SRGB8_ALPHA8_ASTC_12x12_Format:function(){return Kt},SRGB8_ALPHA8_ASTC_4x4_Format:function(){return Gt},SRGB8_ALPHA8_ASTC_5x4_Format:function(){return vt},SRGB8_ALPHA8_ASTC_5x5_Format:function(){return Bt},SRGB8_ALPHA8_ASTC_6x5_Format:function(){return Zt},SRGB8_ALPHA8_ASTC_6x6_Format:function(){return wt},SRGB8_ALPHA8_ASTC_8x5_Format:function(){return Wt},SRGB8_ALPHA8_ASTC_8x6_Format:function(){return St},SRGB8_ALPHA8_ASTC_8x8_Format:function(){return Rt},Scene:function(){return is},SceneUtils:function(){return Xd},ShaderChunk:function(){return Er},ShaderLib:function(){return Ur},ShaderMaterial:function(){return Sr},ShadowMaterial:function(){return lc},Shape:function(){return hI},ShapeBufferGeometry:function(){return ec},ShapeGeometry:function(){return ec},ShapePath:function(){return JI},ShapeUtils:function(){return Ul},ShortType:function(){return we},Skeleton:function(){return Ks},SkeletonHelper:function(){return qC},SkinnedMesh:function(){return xs},SmoothShading:function(){return m},Sphere:function(){return Si},SphereBufferGeometry:function(){return tc},SphereGeometry:function(){return tc},Spherical:function(){return zC},SphericalHarmonics3:function(){return YI},SplineCurve:function(){return II},SpotLight:function(){return vI},SpotLightHelper:function(){return PC},Sprite:function(){return ys},SpriteMaterial:function(){return gs},SrcAlphaFactor:function(){return Y},SrcAlphaSaturateFactor:function(){return L},SrcColorFactor:function(){return X},StaticCopyUsage:function(){return xn},StaticDrawUsage:function(){return Zn},StaticReadUsage:function(){return Sn},StereoCamera:function(){return iC},StreamCopyUsage:function(){return Hn},StreamDrawUsage:function(){return Wn},StreamReadUsage:function(){return Vn},StringKeyframeTrack:function(){return xc},SubtractEquation:function(){return w},SubtractiveBlending:function(){return G},TOUCH:function(){return r},TangentSpaceNormalMap:function(){return gn},TetrahedronBufferGeometry:function(){return nc},TetrahedronGeometry:function(){return nc},TextBufferGeometry:function(){return ic},TextGeometry:function(){return ic},Texture:function(){return ei},TextureLoader:function(){return Jc},TorusBufferGeometry:function(){return oc},TorusGeometry:function(){return oc},TorusKnotBufferGeometry:function(){return rc},TorusKnotGeometry:function(){return rc},Triangle:function(){return Bo},TriangleFanDrawMode:function(){return Qt},TriangleStripDrawMode:function(){return Pt},TrianglesDrawMode:function(){return Dt},TubeBufferGeometry:function(){return ac},TubeGeometry:function(){return ac},UVMapping:function(){return oe},Uint16Attribute:function(){return md},Uint16BufferAttribute:function(){return Eo},Uint32Attribute:function(){return fd},Uint32BufferAttribute:function(){return Uo},Uint8Attribute:function(){return hd},Uint8BufferAttribute:function(){return zo},Uint8ClampedAttribute:function(){return Ad},Uint8ClampedBufferAttribute:function(){return Lo},Uniform:function(){return HC},UniformsLib:function(){return Tr},UniformsUtils:function(){return Wr},UnsignedByteType:function(){return Be},UnsignedInt248Type:function(){return Ke},UnsignedIntType:function(){return Re},UnsignedShort4444Type:function(){return Xe},UnsignedShort5551Type:function(){return He},UnsignedShort565Type:function(){return Ye},UnsignedShortType:function(){return We},VSMShadowMap:function(){return u},Vector2:function(){return Qn},Vector3:function(){return ai},Vector4:function(){return ni},VectorKeyframeTrack:function(){return Xc},Vertex:function(){return Cd},VertexColors:function(){return id},VideoTexture:function(){return rl},WebGL1Renderer:function(){return es},WebGLCubeRenderTarget:function(){return Yr},WebGLMultisampleRenderTarget:function(){return oi},WebGLRenderTarget:function(){return ii},WebGLRenderTargetCube:function(){return Rd},WebGLRenderer:function(){return $g},WebGLUtils:function(){return Jg},WireframeGeometry:function(){return gc},WireframeHelper:function(){return wd},WrapAroundEnding:function(){return Ut},XHRLoader:function(){return Wd},ZeroCurvatureEnding:function(){return Et},ZeroFactor:function(){return V},ZeroSlopeEnding:function(){return Tt},ZeroStencilOp:function(){return ln},sRGBEncoding:function(){return jt}});const i="128",o={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,g=1,s=2,l=3,c=0,I=1,C=2,u=3,d=0,h=1,A=2,p=1,m=2,b=0,f=1,y=2,G=3,v=4,B=5,Z=100,w=101,W=102,S=103,R=104,V=200,x=201,X=202,H=203,Y=204,K=205,N=206,M=207,F=208,z=209,L=210,k=0,E=1,T=2,U=3,_=4,J=5,D=6,P=7,Q=0,O=1,j=2,q=0,$=1,ee=2,te=3,ne=4,ie=5,oe=300,re=301,ae=302,ge=303,se=304,le=306,ce=307,Ie=1e3,Ce=1001,ue=1002,de=1003,he=1004,Ae=1004,pe=1005,me=1005,be=1006,fe=1007,ye=1007,Ge=1008,ve=1008,Be=1009,Ze=1010,we=1011,We=1012,Se=1013,Re=1014,Ve=1015,xe=1016,Xe=1017,He=1018,Ye=1019,Ke=1020,Ne=1021,Me=1022,Fe=1023,ze=1024,Le=1025,ke=Fe,Ee=1026,Te=1027,Ue=1028,_e=1029,Je=1030,De=1031,Pe=1032,Qe=1033,Oe=33776,je=33777,qe=33778,$e=33779,et=35840,tt=35841,nt=35842,it=35843,ot=36196,rt=37492,at=37496,gt=37808,st=37809,lt=37810,ct=37811,It=37812,Ct=37813,ut=37814,dt=37815,ht=37816,At=37817,pt=37818,mt=37819,bt=37820,ft=37821,yt=36492,Gt=37840,vt=37841,Bt=37842,Zt=37843,wt=37844,Wt=37845,St=37846,Rt=37847,Vt=37848,xt=37849,Xt=37850,Ht=37851,Yt=37852,Kt=37853,Nt=2200,Mt=2201,Ft=2202,zt=2300,Lt=2301,kt=2302,Et=2400,Tt=2401,Ut=2402,_t=2500,Jt=2501,Dt=0,Pt=1,Qt=2,Ot=3e3,jt=3001,qt=3007,$t=3002,en=3003,tn=3004,nn=3005,on=3006,rn=3200,an=3201,gn=0,sn=1,ln=0,cn=7680,In=7681,Cn=7682,un=7683,dn=34055,hn=34056,An=5386,pn=512,mn=513,bn=514,fn=515,yn=516,Gn=517,vn=518,Bn=519,Zn=35044,wn=35048,Wn=35040,Sn=35045,Rn=35049,Vn=35041,xn=35046,Xn=35050,Hn=35042,Yn="100",Kn="300 es";class Nn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const Mn=[];for(let Yd=0;Yd<256;Yd++)Mn[Yd]=(Yd<16?"0":"")+Yd.toString(16);let Fn=1234567;const zn=Math.PI/180,Ln=180/Math.PI;function kn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Mn[255&e]+Mn[e>>8&255]+Mn[e>>16&255]+Mn[e>>24&255]+"-"+Mn[255&t]+Mn[t>>8&255]+"-"+Mn[t>>16&15|64]+Mn[t>>24&255]+"-"+Mn[63&n|128]+Mn[n>>8&255]+"-"+Mn[n>>16&255]+Mn[n>>24&255]+Mn[255&i]+Mn[i>>8&255]+Mn[i>>16&255]+Mn[i>>24&255]).toUpperCase()}function En(e,t,n){return Math.max(t,Math.min(n,e))}function Tn(e,t){return(e%t+t)%t}function Un(e,t,n){return(1-n)*e+n*t}function _n(e){return 0==(e&e-1)&&0!==e}function Jn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Dn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Pn=Object.freeze({__proto__:null,DEG2RAD:zn,RAD2DEG:Ln,generateUUID:kn,clamp:En,euclideanModulo:Tn,mapLinear:function(e,t,n,i,o){return i+(e-t)*(o-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Un,damp:function(e,t,n,i){return Un(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Tn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Fn=e%2147483647),Fn=16807*Fn%2147483647,(Fn-1)/2147483646},degToRad:function(e){return e*zn},radToDeg:function(e){return e*Ln},isPowerOfTwo:_n,ceilPowerOfTwo:Jn,floorPowerOfTwo:Dn,setQuaternionFromProperEuler:function(e,t,n,i,o){const r=Math.cos,a=Math.sin,g=r(n/2),s=a(n/2),l=r((t+i)/2),c=a((t+i)/2),I=r((t-i)/2),C=a((t-i)/2),u=r((i-t)/2),d=a((i-t)/2);switch(o){case"XYX":e.set(g*c,s*I,s*C,g*l);break;case"YZY":e.set(s*C,g*c,s*I,g*l);break;case"ZXZ":e.set(s*I,s*C,g*c,g*l);break;case"XZX":e.set(g*c,s*d,s*u,g*l);break;case"YXY":e.set(s*u,g*c,s*d,g*l);break;case"ZYZ":e.set(s*d,s*u,g*c,g*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}});class Qn{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),o=this.x-e.x,r=this.y-e.y;return this.x=o*n-r*i+e.x,this.y=o*i+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Qn.prototype.isVector2=!0;class On{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,o,r,a,g,s){const l=this.elements;return l[0]=e,l[1]=i,l[2]=a,l[3]=t,l[4]=o,l[5]=g,l[6]=n,l[7]=r,l[8]=s,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,r=n[0],a=n[3],g=n[6],s=n[1],l=n[4],c=n[7],I=n[2],C=n[5],u=n[8],d=i[0],h=i[3],A=i[6],p=i[1],m=i[4],b=i[7],f=i[2],y=i[5],G=i[8];return o[0]=r*d+a*p+g*f,o[3]=r*h+a*m+g*y,o[6]=r*A+a*b+g*G,o[1]=s*d+l*p+c*f,o[4]=s*h+l*m+c*y,o[7]=s*A+l*b+c*G,o[2]=I*d+C*p+u*f,o[5]=I*h+C*m+u*y,o[8]=I*A+C*b+u*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],g=e[6],s=e[7],l=e[8];return t*r*l-t*a*s-n*o*l+n*a*g+i*o*s-i*r*g}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],g=e[6],s=e[7],l=e[8],c=l*r-a*s,I=a*g-l*o,C=s*o-r*g,u=t*c+n*I+i*C;if(0===u)return this.set(0,0,0,0,0,0,0,0,0);const d=1/u;return e[0]=c*d,e[1]=(i*s-l*n)*d,e[2]=(a*n-i*r)*d,e[3]=I*d,e[4]=(l*t-i*g)*d,e[5]=(i*o-a*t)*d,e[6]=C*d,e[7]=(n*g-s*t)*d,e[8]=(r*t-n*o)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,o,r,a){const g=Math.cos(o),s=Math.sin(o);return this.set(n*g,n*s,-n*(g*r+s*a)+r+e,-i*s,i*g,-i*(-s*r+g*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,o=i[0],r=i[3],a=i[6],g=i[1],s=i[4],l=i[7];return i[0]=t*o+n*g,i[3]=t*r+n*s,i[6]=t*a+n*l,i[1]=-n*o+t*g,i[4]=-n*r+t*s,i[7]=-n*a+t*l,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let jn;On.prototype.isMatrix3=!0;class qn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===jn&&(jn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),jn.width=e.width,jn.height=e.height;const n=jn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=jn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let $n=0;class ei extends Nn{constructor(e=ei.DEFAULT_IMAGE,t=ei.DEFAULT_MAPPING,n=Ce,i=Ce,o=be,r=Ge,a=Fe,g=Be,s=1,l=Ot){super(),Object.defineProperty(this,"id",{value:$n++}),this.uuid=kn(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=o,this.minFilter=r,this.anisotropy=s,this.format=a,this.internalFormat=null,this.type=g,this.offset=new Qn(0,0),this.repeat=new Qn(1,1),this.center=new Qn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new On,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=kn()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(ti(i[e].image)):t.push(ti(i[e]))}else t=ti(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==oe)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ie:e.x=e.x-Math.floor(e.x);break;case Ce:e.x=e.x<0?0:1;break;case ue:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ie:e.y=e.y-Math.floor(e.y);break;case Ce:e.y=e.y<0?0:1;break;case ue:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function ti(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?qn.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}ei.DEFAULT_IMAGE=void 0,ei.DEFAULT_MAPPING=oe,ei.prototype.isTexture=!0;class ni{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=this.w,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12]*o,this.y=r[1]*t+r[5]*n+r[9]*i+r[13]*o,this.z=r[2]*t+r[6]*n+r[10]*i+r[14]*o,this.w=r[3]*t+r[7]*n+r[11]*i+r[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,o;const r=.01,a=.1,g=e.elements,s=g[0],l=g[4],c=g[8],I=g[1],C=g[5],u=g[9],d=g[2],h=g[6],A=g[10];if(Math.abs(l-I)<r&&Math.abs(c-d)<r&&Math.abs(u-h)<r){if(Math.abs(l+I)<a&&Math.abs(c+d)<a&&Math.abs(u+h)<a&&Math.abs(s+C+A-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(s+1)/2,g=(C+1)/2,p=(A+1)/2,m=(l+I)/4,b=(c+d)/4,f=(u+h)/4;return e>g&&e>p?e<r?(n=0,i=.707106781,o=.707106781):(n=Math.sqrt(e),i=m/n,o=b/n):g>p?g<r?(n=.707106781,i=0,o=.707106781):(i=Math.sqrt(g),n=m/i,o=f/i):p<r?(n=.707106781,i=.707106781,o=0):(o=Math.sqrt(p),n=b/o,i=f/o),this.set(n,i,o,t),this}let p=Math.sqrt((h-u)*(h-u)+(c-d)*(c-d)+(I-l)*(I-l));return Math.abs(p)<.001&&(p=1),this.x=(h-u)/p,this.y=(c-d)/p,this.z=(I-l)/p,this.w=Math.acos((s+C+A-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}ni.prototype.isVector4=!0;class ii extends Nn{constructor(e,t,n){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new ni(0,0,e,t),this.scissorTest=!1,this.viewport=new ni(0,0,e,t),n=n||{},this.texture=new ei(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:be,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}ii.prototype.isWebGLRenderTarget=!0;class oi extends ii{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}oi.prototype.isWebGLMultisampleRenderTarget=!0;class ri{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,o,r,a){let g=n[i+0],s=n[i+1],l=n[i+2],c=n[i+3];const I=o[r+0],C=o[r+1],u=o[r+2],d=o[r+3];if(0===a)return e[t+0]=g,e[t+1]=s,e[t+2]=l,void(e[t+3]=c);if(1===a)return e[t+0]=I,e[t+1]=C,e[t+2]=u,void(e[t+3]=d);if(c!==d||g!==I||s!==C||l!==u){let e=1-a;const t=g*I+s*C+l*u+c*d,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const o=Math.sqrt(i),r=Math.atan2(o,t*n);e=Math.sin(e*r)/o,a=Math.sin(a*r)/o}const o=a*n;if(g=g*e+I*o,s=s*e+C*o,l=l*e+u*o,c=c*e+d*o,e===1-a){const e=1/Math.sqrt(g*g+s*s+l*l+c*c);g*=e,s*=e,l*=e,c*=e}}e[t]=g,e[t+1]=s,e[t+2]=l,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,i,o,r){const a=n[i],g=n[i+1],s=n[i+2],l=n[i+3],c=o[r],I=o[r+1],C=o[r+2],u=o[r+3];return e[t]=a*u+l*c+g*C-s*I,e[t+1]=g*u+l*I+s*c-a*C,e[t+2]=s*u+l*C+a*I-g*c,e[t+3]=l*u-a*c-g*I-s*C,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,o=e._z,r=e._order,a=Math.cos,g=Math.sin,s=a(n/2),l=a(i/2),c=a(o/2),I=g(n/2),C=g(i/2),u=g(o/2);switch(r){case"XYZ":this._x=I*l*c+s*C*u,this._y=s*C*c-I*l*u,this._z=s*l*u+I*C*c,this._w=s*l*c-I*C*u;break;case"YXZ":this._x=I*l*c+s*C*u,this._y=s*C*c-I*l*u,this._z=s*l*u-I*C*c,this._w=s*l*c+I*C*u;break;case"ZXY":this._x=I*l*c-s*C*u,this._y=s*C*c+I*l*u,this._z=s*l*u+I*C*c,this._w=s*l*c-I*C*u;break;case"ZYX":this._x=I*l*c-s*C*u,this._y=s*C*c+I*l*u,this._z=s*l*u-I*C*c,this._w=s*l*c+I*C*u;break;case"YZX":this._x=I*l*c+s*C*u,this._y=s*C*c+I*l*u,this._z=s*l*u-I*C*c,this._w=s*l*c-I*C*u;break;case"XZY":this._x=I*l*c-s*C*u,this._y=s*C*c-I*l*u,this._z=s*l*u+I*C*c,this._w=s*l*c+I*C*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],o=t[8],r=t[1],a=t[5],g=t[9],s=t[2],l=t[6],c=t[10],I=n+a+c;if(I>0){const e=.5/Math.sqrt(I+1);this._w=.25/e,this._x=(l-g)*e,this._y=(o-s)*e,this._z=(r-i)*e}else if(n>a&&n>c){const e=2*Math.sqrt(1+n-a-c);this._w=(l-g)/e,this._x=.25*e,this._y=(i+r)/e,this._z=(o+s)/e}else if(a>c){const e=2*Math.sqrt(1+a-n-c);this._w=(o-s)/e,this._x=(i+r)/e,this._y=.25*e,this._z=(g+l)/e}else{const e=2*Math.sqrt(1+c-n-a);this._w=(r-i)/e,this._x=(o+s)/e,this._y=(g+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(En(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,o=e._z,r=e._w,a=t._x,g=t._y,s=t._z,l=t._w;return this._x=n*l+r*a+i*s-o*g,this._y=i*l+r*g+o*a-n*s,this._z=o*l+r*s+n*g-i*a,this._w=r*l-n*a-i*g-o*s,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,o=this._z,r=this._w;let a=r*e._w+n*e._x+i*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=r,this._x=n,this._y=i,this._z=o,this;const g=1-a*a;if(g<=Number.EPSILON){const e=1-t;return this._w=e*r+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const s=Math.sqrt(g),l=Math.atan2(s,a),c=Math.sin((1-t)*l)/s,I=Math.sin(t*l)/s;return this._w=r*c+this._w*I,this._x=n*c+this._x*I,this._y=i*c+this._y*I,this._z=o*c+this._z*I,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ri.prototype.isQuaternion=!0;class ai{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(si.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(si.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*i,this.y=o[1]*t+o[4]*n+o[7]*i,this.z=o[2]*t+o[5]*n+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=e.elements,r=1/(o[3]*t+o[7]*n+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*i+o[12])*r,this.y=(o[1]*t+o[5]*n+o[9]*i+o[13])*r,this.z=(o[2]*t+o[6]*n+o[10]*i+o[14])*r,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z,g=e.w,s=g*t+r*i-a*n,l=g*n+a*t-o*i,c=g*i+o*n-r*t,I=-o*t-r*n-a*i;return this.x=s*g+I*-o+l*-a-c*-r,this.y=l*g+I*-r+c*-o-s*-a,this.z=c*g+I*-a+s*-r-l*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i,this.y=o[1]*t+o[5]*n+o[9]*i,this.z=o[2]*t+o[6]*n+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,o=e.z,r=t.x,a=t.y,g=t.z;return this.x=i*g-o*a,this.y=o*r-n*g,this.z=n*a-i*r,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return gi.copy(this).projectOnVector(e),this.sub(gi)}reflect(e){return this.sub(gi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(En(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ai.prototype.isVector3=!0;const gi=new ai,si=new ri;class li{constructor(e=new ai(1/0,1/0,1/0),t=new ai(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,o=-1/0,r=-1/0,a=-1/0;for(let g=0,s=e.length;g<s;g+=3){const s=e[g],l=e[g+1],c=e[g+2];s<t&&(t=s),l<n&&(n=l),c<i&&(i=c),s>o&&(o=s),l>r&&(r=l),c>a&&(a=c)}return this.min.set(t,n,i),this.max.set(o,r,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,o=-1/0,r=-1/0,a=-1/0;for(let g=0,s=e.count;g<s;g++){const s=e.getX(g),l=e.getY(g),c=e.getZ(g);s<t&&(t=s),l<n&&(n=l),c<i&&(i=c),s>o&&(o=s),l>r&&(r=l),c>a&&(a=c)}return this.min.set(t,n,i),this.max.set(o,r,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ii.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new ai),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new ai),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Ci.copy(t.boundingBox),Ci.applyMatrix4(e.matrixWorld),this.union(Ci));const n=e.children;for(let i=0,o=n.length;i<o;i++)this.expandByObject(n[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new ai),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ii),Ii.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(bi),fi.subVectors(this.max,bi),ui.subVectors(e.a,bi),di.subVectors(e.b,bi),hi.subVectors(e.c,bi),Ai.subVectors(di,ui),pi.subVectors(hi,di),mi.subVectors(ui,hi);let t=[0,-Ai.z,Ai.y,0,-pi.z,pi.y,0,-mi.z,mi.y,Ai.z,0,-Ai.x,pi.z,0,-pi.x,mi.z,0,-mi.x,-Ai.y,Ai.x,0,-pi.y,pi.x,0,-mi.y,mi.x,0];return!!vi(t,ui,di,hi,fi)&&(t=[1,0,0,0,1,0,0,0,1],!!vi(t,ui,di,hi,fi)&&(yi.crossVectors(Ai,pi),t=[yi.x,yi.y,yi.z],vi(t,ui,di,hi,fi)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new ai),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ii.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Ii).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ci[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ci[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ci[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ci[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ci[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ci[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ci[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ci[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ci)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}li.prototype.isBox3=!0;const ci=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai],Ii=new ai,Ci=new li,ui=new ai,di=new ai,hi=new ai,Ai=new ai,pi=new ai,mi=new ai,bi=new ai,fi=new ai,yi=new ai,Gi=new ai;function vi(e,t,n,i,o){for(let r=0,a=e.length-3;r<=a;r+=3){Gi.fromArray(e,r);const a=o.x*Math.abs(Gi.x)+o.y*Math.abs(Gi.y)+o.z*Math.abs(Gi.z),g=t.dot(Gi),s=n.dot(Gi),l=i.dot(Gi);if(Math.max(-Math.max(g,s,l),Math.min(g,s,l))>a)return!1}return!0}const Bi=new li,Zi=new ai,wi=new ai,Wi=new ai;class Si{constructor(e=new ai,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Bi.setFromPoints(e).getCenter(n);let i=0;for(let o=0,r=e.length;o<r;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new ai),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new li),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Wi.subVectors(e,this.center);const t=Wi.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Wi.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return wi.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Zi.copy(e.center).add(wi)),this.expandByPoint(Zi.copy(e.center).sub(wi)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ri=new ai,Vi=new ai,xi=new ai,Xi=new ai,Hi=new ai,Yi=new ai,Ki=new ai;class Ni{constructor(e=new ai,t=new ai(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new ai),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ri)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new ai),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ri.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ri.copy(this.direction).multiplyScalar(t).add(this.origin),Ri.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Vi.copy(e).add(t).multiplyScalar(.5),xi.copy(t).sub(e).normalize(),Xi.copy(this.origin).sub(Vi);const o=.5*e.distanceTo(t),r=-this.direction.dot(xi),a=Xi.dot(this.direction),g=-Xi.dot(xi),s=Xi.lengthSq(),l=Math.abs(1-r*r);let c,I,C,u;if(l>0)if(c=r*g-a,I=r*a-g,u=o*l,c>=0)if(I>=-u)if(I<=u){const e=1/l;c*=e,I*=e,C=c*(c+r*I+2*a)+I*(r*c+I+2*g)+s}else I=o,c=Math.max(0,-(r*I+a)),C=-c*c+I*(I+2*g)+s;else I=-o,c=Math.max(0,-(r*I+a)),C=-c*c+I*(I+2*g)+s;else I<=-u?(c=Math.max(0,-(-r*o+a)),I=c>0?-o:Math.min(Math.max(-o,-g),o),C=-c*c+I*(I+2*g)+s):I<=u?(c=0,I=Math.min(Math.max(-o,-g),o),C=I*(I+2*g)+s):(c=Math.max(0,-(r*o+a)),I=c>0?o:Math.min(Math.max(-o,-g),o),C=-c*c+I*(I+2*g)+s);else I=r>0?-o:o,c=Math.max(0,-(r*I+a)),C=-c*c+I*(I+2*g)+s;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),i&&i.copy(xi).multiplyScalar(I).add(Vi),C}intersectSphere(e,t){Ri.subVectors(e.center,this.origin);const n=Ri.dot(this.direction),i=Ri.dot(Ri)-n*n,o=e.radius*e.radius;if(i>o)return null;const r=Math.sqrt(o-i),a=n-r,g=n+r;return a<0&&g<0?null:a<0?this.at(g,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,o,r,a,g;const s=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,I=this.origin;return s>=0?(n=(e.min.x-I.x)*s,i=(e.max.x-I.x)*s):(n=(e.max.x-I.x)*s,i=(e.min.x-I.x)*s),l>=0?(o=(e.min.y-I.y)*l,r=(e.max.y-I.y)*l):(o=(e.max.y-I.y)*l,r=(e.min.y-I.y)*l),n>r||o>i?null:((o>n||n!=n)&&(n=o),(r<i||i!=i)&&(i=r),c>=0?(a=(e.min.z-I.z)*c,g=(e.max.z-I.z)*c):(a=(e.max.z-I.z)*c,g=(e.min.z-I.z)*c),n>g||a>i?null:((a>n||n!=n)&&(n=a),(g<i||i!=i)&&(i=g),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Ri)}intersectTriangle(e,t,n,i,o){Hi.subVectors(t,e),Yi.subVectors(n,e),Ki.crossVectors(Hi,Yi);let r,a=this.direction.dot(Ki);if(a>0){if(i)return null;r=1}else{if(!(a<0))return null;r=-1,a=-a}Xi.subVectors(this.origin,e);const g=r*this.direction.dot(Yi.crossVectors(Xi,Yi));if(g<0)return null;const s=r*this.direction.dot(Hi.cross(Xi));if(s<0)return null;if(g+s>a)return null;const l=-r*Xi.dot(Ki);return l<0?null:this.at(l/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Mi{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,o,r,a,g,s,l,c,I,C,u,d,h){const A=this.elements;return A[0]=e,A[4]=t,A[8]=n,A[12]=i,A[1]=o,A[5]=r,A[9]=a,A[13]=g,A[2]=s,A[6]=l,A[10]=c,A[14]=I,A[3]=C,A[7]=u,A[11]=d,A[15]=h,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Mi).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Fi.setFromMatrixColumn(e,0).length(),o=1/Fi.setFromMatrixColumn(e,1).length(),r=1/Fi.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,o=e.z,r=Math.cos(n),a=Math.sin(n),g=Math.cos(i),s=Math.sin(i),l=Math.cos(o),c=Math.sin(o);if("XYZ"===e.order){const e=r*l,n=r*c,i=a*l,o=a*c;t[0]=g*l,t[4]=-g*c,t[8]=s,t[1]=n+i*s,t[5]=e-o*s,t[9]=-a*g,t[2]=o-e*s,t[6]=i+n*s,t[10]=r*g}else if("YXZ"===e.order){const e=g*l,n=g*c,i=s*l,o=s*c;t[0]=e+o*a,t[4]=i*a-n,t[8]=r*s,t[1]=r*c,t[5]=r*l,t[9]=-a,t[2]=n*a-i,t[6]=o+e*a,t[10]=r*g}else if("ZXY"===e.order){const e=g*l,n=g*c,i=s*l,o=s*c;t[0]=e-o*a,t[4]=-r*c,t[8]=i+n*a,t[1]=n+i*a,t[5]=r*l,t[9]=o-e*a,t[2]=-r*s,t[6]=a,t[10]=r*g}else if("ZYX"===e.order){const e=r*l,n=r*c,i=a*l,o=a*c;t[0]=g*l,t[4]=i*s-n,t[8]=e*s+o,t[1]=g*c,t[5]=o*s+e,t[9]=n*s-i,t[2]=-s,t[6]=a*g,t[10]=r*g}else if("YZX"===e.order){const e=r*g,n=r*s,i=a*g,o=a*s;t[0]=g*l,t[4]=o-e*c,t[8]=i*c+n,t[1]=c,t[5]=r*l,t[9]=-a*l,t[2]=-s*l,t[6]=n*c+i,t[10]=e-o*c}else if("XZY"===e.order){const e=r*g,n=r*s,i=a*g,o=a*s;t[0]=g*l,t[4]=-c,t[8]=s*l,t[1]=e*c+o,t[5]=r*l,t[9]=n*c-i,t[2]=i*c-n,t[6]=a*l,t[10]=o*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Li,e,ki)}lookAt(e,t,n){const i=this.elements;return Ui.subVectors(e,t),0===Ui.lengthSq()&&(Ui.z=1),Ui.normalize(),Ei.crossVectors(n,Ui),0===Ei.lengthSq()&&(1===Math.abs(n.z)?Ui.x+=1e-4:Ui.z+=1e-4,Ui.normalize(),Ei.crossVectors(n,Ui)),Ei.normalize(),Ti.crossVectors(Ui,Ei),i[0]=Ei.x,i[4]=Ti.x,i[8]=Ui.x,i[1]=Ei.y,i[5]=Ti.y,i[9]=Ui.y,i[2]=Ei.z,i[6]=Ti.z,i[10]=Ui.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,r=n[0],a=n[4],g=n[8],s=n[12],l=n[1],c=n[5],I=n[9],C=n[13],u=n[2],d=n[6],h=n[10],A=n[14],p=n[3],m=n[7],b=n[11],f=n[15],y=i[0],G=i[4],v=i[8],B=i[12],Z=i[1],w=i[5],W=i[9],S=i[13],R=i[2],V=i[6],x=i[10],X=i[14],H=i[3],Y=i[7],K=i[11],N=i[15];return o[0]=r*y+a*Z+g*R+s*H,o[4]=r*G+a*w+g*V+s*Y,o[8]=r*v+a*W+g*x+s*K,o[12]=r*B+a*S+g*X+s*N,o[1]=l*y+c*Z+I*R+C*H,o[5]=l*G+c*w+I*V+C*Y,o[9]=l*v+c*W+I*x+C*K,o[13]=l*B+c*S+I*X+C*N,o[2]=u*y+d*Z+h*R+A*H,o[6]=u*G+d*w+h*V+A*Y,o[10]=u*v+d*W+h*x+A*K,o[14]=u*B+d*S+h*X+A*N,o[3]=p*y+m*Z+b*R+f*H,o[7]=p*G+m*w+b*V+f*Y,o[11]=p*v+m*W+b*x+f*K,o[15]=p*B+m*S+b*X+f*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],o=e[12],r=e[1],a=e[5],g=e[9],s=e[13],l=e[2],c=e[6],I=e[10],C=e[14];return e[3]*(+o*g*c-i*s*c-o*a*I+n*s*I+i*a*C-n*g*C)+e[7]*(+t*g*C-t*s*I+o*r*I-i*r*C+i*s*l-o*g*l)+e[11]*(+t*s*c-t*a*C-o*r*c+n*r*C+o*a*l-n*s*l)+e[15]*(-i*a*l-t*g*c+t*a*I+i*r*c-n*r*I+n*g*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],g=e[6],s=e[7],l=e[8],c=e[9],I=e[10],C=e[11],u=e[12],d=e[13],h=e[14],A=e[15],p=c*h*s-d*I*s+d*g*C-a*h*C-c*g*A+a*I*A,m=u*I*s-l*h*s-u*g*C+r*h*C+l*g*A-r*I*A,b=l*d*s-u*c*s+u*a*C-r*d*C-l*a*A+r*c*A,f=u*c*g-l*d*g-u*a*I+r*d*I+l*a*h-r*c*h,y=t*p+n*m+i*b+o*f;if(0===y)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const G=1/y;return e[0]=p*G,e[1]=(d*I*o-c*h*o-d*i*C+n*h*C+c*i*A-n*I*A)*G,e[2]=(a*h*o-d*g*o+d*i*s-n*h*s-a*i*A+n*g*A)*G,e[3]=(c*g*o-a*I*o-c*i*s+n*I*s+a*i*C-n*g*C)*G,e[4]=m*G,e[5]=(l*h*o-u*I*o+u*i*C-t*h*C-l*i*A+t*I*A)*G,e[6]=(u*g*o-r*h*o-u*i*s+t*h*s+r*i*A-t*g*A)*G,e[7]=(r*I*o-l*g*o+l*i*s-t*I*s-r*i*C+t*g*C)*G,e[8]=b*G,e[9]=(u*c*o-l*d*o-u*n*C+t*d*C+l*n*A-t*c*A)*G,e[10]=(r*d*o-u*a*o+u*n*s-t*d*s-r*n*A+t*a*A)*G,e[11]=(l*a*o-r*c*o-l*n*s+t*c*s+r*n*C-t*a*C)*G,e[12]=f*G,e[13]=(l*d*i-u*c*i+u*n*I-t*d*I-l*n*h+t*c*h)*G,e[14]=(u*a*i-r*d*i-u*n*g+t*d*g+r*n*h-t*a*h)*G,e[15]=(r*c*i-l*a*i+l*n*g-t*c*g-r*n*I+t*a*I)*G,this}scale(e){const t=this.elements,n=e.x,i=e.y,o=e.z;return t[0]*=n,t[4]*=i,t[8]*=o,t[1]*=n,t[5]*=i,t[9]*=o,t[2]*=n,t[6]*=i,t[10]*=o,t[3]*=n,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),o=1-n,r=e.x,a=e.y,g=e.z,s=o*r,l=o*a;return this.set(s*r+n,s*a-i*g,s*g+i*a,0,s*a+i*g,l*a+n,l*g-i*r,0,s*g-i*a,l*g+i*r,o*g*g+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,o=t._x,r=t._y,a=t._z,g=t._w,s=o+o,l=r+r,c=a+a,I=o*s,C=o*l,u=o*c,d=r*l,h=r*c,A=a*c,p=g*s,m=g*l,b=g*c,f=n.x,y=n.y,G=n.z;return i[0]=(1-(d+A))*f,i[1]=(C+b)*f,i[2]=(u-m)*f,i[3]=0,i[4]=(C-b)*y,i[5]=(1-(I+A))*y,i[6]=(h+p)*y,i[7]=0,i[8]=(u+m)*G,i[9]=(h-p)*G,i[10]=(1-(I+d))*G,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let o=Fi.set(i[0],i[1],i[2]).length();const r=Fi.set(i[4],i[5],i[6]).length(),a=Fi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],zi.copy(this);const g=1/o,s=1/r,l=1/a;return zi.elements[0]*=g,zi.elements[1]*=g,zi.elements[2]*=g,zi.elements[4]*=s,zi.elements[5]*=s,zi.elements[6]*=s,zi.elements[8]*=l,zi.elements[9]*=l,zi.elements[10]*=l,t.setFromRotationMatrix(zi),n.x=o,n.y=r,n.z=a,this}makePerspective(e,t,n,i,o,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,g=2*o/(t-e),s=2*o/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),I=-(r+o)/(r-o),C=-2*r*o/(r-o);return a[0]=g,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=s,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=I,a[14]=C,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,o,r){const a=this.elements,g=1/(t-e),s=1/(n-i),l=1/(r-o),c=(t+e)*g,I=(n+i)*s,C=(r+o)*l;return a[0]=2*g,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*s,a[9]=0,a[13]=-I,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-C,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Mi.prototype.isMatrix4=!0;const Fi=new ai,zi=new Mi,Li=new ai(0,0,0),ki=new ai(1,1,1),Ei=new ai,Ti=new ai,Ui=new ai,_i=new Mi,Ji=new ri;class Di{constructor(e=0,t=0,n=0,i=Di.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const i=e.elements,o=i[0],r=i[4],a=i[8],g=i[1],s=i[5],l=i[9],c=i[2],I=i[6],C=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(En(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,C),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(I,s),this._z=0);break;case"YXZ":this._x=Math.asin(-En(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,C),this._z=Math.atan2(g,s)):(this._y=Math.atan2(-c,o),this._z=0);break;case"ZXY":this._x=Math.asin(En(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(-c,C),this._z=Math.atan2(-r,s)):(this._y=0,this._z=Math.atan2(g,o));break;case"ZYX":this._y=Math.asin(-En(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(I,C),this._z=Math.atan2(g,o)):(this._x=0,this._z=Math.atan2(-r,s));break;case"YZX":this._z=Math.asin(En(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-l,s),this._y=Math.atan2(-c,o)):(this._x=0,this._y=Math.atan2(a,C));break;case"XZY":this._z=Math.asin(-En(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(I,s),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-l,C),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return _i.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_i,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return Ji.setFromEuler(this),this.setFromQuaternion(Ji,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new ai(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Di.prototype.isEuler=!0,Di.DefaultOrder="XYZ",Di.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Pi{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Qi=0;const Oi=new ai,ji=new ri,qi=new Mi,$i=new ai,eo=new ai,to=new ai,no=new ri,io=new ai(1,0,0),oo=new ai(0,1,0),ro=new ai(0,0,1),ao={type:"added"},go={type:"removed"};class so extends Nn{constructor(){super(),Object.defineProperty(this,"id",{value:Qi++}),this.uuid=kn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=so.DefaultUp.clone();const e=new ai,t=new Di,n=new ri,i=new ai(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Mi},normalMatrix:{value:new On}}),this.matrix=new Mi,this.matrixWorld=new Mi,this.matrixAutoUpdate=so.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Pi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ji.setFromAxisAngle(e,t),this.quaternion.multiply(ji),this}rotateOnWorldAxis(e,t){return ji.setFromAxisAngle(e,t),this.quaternion.premultiply(ji),this}rotateX(e){return this.rotateOnAxis(io,e)}rotateY(e){return this.rotateOnAxis(oo,e)}rotateZ(e){return this.rotateOnAxis(ro,e)}translateOnAxis(e,t){return Oi.copy(e).applyQuaternion(this.quaternion),this.position.add(Oi.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(io,e)}translateY(e){return this.translateOnAxis(oo,e)}translateZ(e){return this.translateOnAxis(ro,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(qi.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?$i.copy(e):$i.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),eo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qi.lookAt(eo,$i,this.up):qi.lookAt($i,eo,this.up),this.quaternion.setFromRotationMatrix(qi),i&&(qi.extractRotation(i.matrixWorld),ji.setFromRotationMatrix(qi),this.quaternion.premultiply(ji.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ao)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(go)),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(go)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),qi.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),qi.multiply(e.parent.matrixWorld)),e.applyMatrix4(qi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new ai),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new ri),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(eo,e,to),e}getWorldScale(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new ai),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(eo,no,e),e}getWorldDirection(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new ai),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function o(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];o(e.shapes,i)}else o(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(o(e.materials,this.material[n]));i.material=t}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(o(e.animations,n))}}if(t){const t=r(e.geometries),i=r(e.materials),o=r(e.textures),a=r(e.images),g=r(e.shapes),s=r(e.skeletons),l=r(e.animations);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),o.length>0&&(n.textures=o),a.length>0&&(n.images=a),g.length>0&&(n.shapes=g),s.length>0&&(n.skeletons=s),l.length>0&&(n.animations=l)}return n.object=i,n;function r(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}so.DefaultUp=new ai(0,1,0),so.DefaultMatrixAutoUpdate=!0,so.prototype.isObject3D=!0;const lo=new ai,co=new ai,Io=new On;class Co{constructor(e=new ai(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=lo.subVectors(n,t).cross(co.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new ai),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new ai);const n=e.delta(lo),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(n).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new ai),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Io.getNormalMatrix(e),i=this.coplanarPoint(lo).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Co.prototype.isPlane=!0;const uo=new ai,ho=new ai,Ao=new ai,po=new ai,mo=new ai,bo=new ai,fo=new ai,yo=new ai,Go=new ai,vo=new ai;class Bo{constructor(e=new ai,t=new ai,n=new ai){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new ai),i.subVectors(n,t),uo.subVectors(e,t),i.cross(uo);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,n,i,o){uo.subVectors(i,t),ho.subVectors(n,t),Ao.subVectors(e,t);const r=uo.dot(uo),a=uo.dot(ho),g=uo.dot(Ao),s=ho.dot(ho),l=ho.dot(Ao),c=r*s-a*a;if(void 0===o&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),o=new ai),0===c)return o.set(-2,-1,-1);const I=1/c,C=(s*g-a*l)*I,u=(r*l-a*g)*I;return o.set(1-C-u,u,C)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,po),po.x>=0&&po.y>=0&&po.x+po.y<=1}static getUV(e,t,n,i,o,r,a,g){return this.getBarycoord(e,t,n,i,po),g.set(0,0),g.addScaledVector(o,po.x),g.addScaledVector(r,po.y),g.addScaledVector(a,po.z),g}static isFrontFacing(e,t,n,i){return uo.subVectors(n,t),ho.subVectors(e,t),uo.cross(ho).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return uo.subVectors(this.c,this.b),ho.subVectors(this.a,this.b),.5*uo.cross(ho).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new ai),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Bo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Co),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Bo.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,o){return Bo.getUV(e,this.a,this.b,this.c,t,n,i,o)}containsPoint(e){return Bo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Bo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new ai);const n=this.a,i=this.b,o=this.c;let r,a;mo.subVectors(i,n),bo.subVectors(o,n),yo.subVectors(e,n);const g=mo.dot(yo),s=bo.dot(yo);if(g<=0&&s<=0)return t.copy(n);Go.subVectors(e,i);const l=mo.dot(Go),c=bo.dot(Go);if(l>=0&&c<=l)return t.copy(i);const I=g*c-l*s;if(I<=0&&g>=0&&l<=0)return r=g/(g-l),t.copy(n).addScaledVector(mo,r);vo.subVectors(e,o);const C=mo.dot(vo),u=bo.dot(vo);if(u>=0&&C<=u)return t.copy(o);const d=C*s-g*u;if(d<=0&&s>=0&&u<=0)return a=s/(s-u),t.copy(n).addScaledVector(bo,a);const h=l*u-C*c;if(h<=0&&c-l>=0&&C-u>=0)return fo.subVectors(o,i),a=(c-l)/(c-l+(C-u)),t.copy(i).addScaledVector(fo,a);const A=1/(h+d+I);return r=d*A,a=I*A,t.copy(n).addScaledVector(mo,r).addScaledVector(bo,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Zo=0;function wo(){Object.defineProperty(this,"id",{value:Zo++}),this.uuid=kn(),this.name="",this.type="Material",this.fog=!0,this.blending=f,this.side=d,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Y,this.blendDst=K,this.blendEquation=Z,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=U,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Bn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=cn,this.stencilZFail=cn,this.stencilZPass=cn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}wo.prototype=Object.assign(Object.create(Nn.prototype),{constructor:wo,isMaterial:!0,onBuild:function(){},onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===p;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==f&&(n.blending=this.blending),this.side!==d&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),o=i(e.images);t.length>0&&(n.textures=t),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(wo.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});const Wo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},So={h:0,s:0,l:0},Ro={h:0,s:0,l:0};function Vo(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function xo(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Xo(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Ho{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Tn(e,1),t=En(t,0,1),n=En(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,o=2*n-i;this.r=Vo(o,i,e+1/3),this.g=Vo(o,i,e),this.b=Vo(o,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,o=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,o)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Wo[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=xo(e.r),this.g=xo(e.g),this.b=xo(e.b),this}copyLinearToSRGB(e){return this.r=Xo(e.r),this.g=Xo(e.g),this.b=Xo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,i=this.b,o=Math.max(t,n,i),r=Math.min(t,n,i);let a,g;const s=(r+o)/2;if(r===o)a=0,g=0;else{const e=o-r;switch(g=s<=.5?e/(o+r):e/(2-o-r),o){case t:a=(n-i)/e+(n<i?6:0);break;case n:a=(i-t)/e+2;break;case i:a=(t-n)/e+4}a/=6}return e.h=a,e.s=g,e.l=s,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(So),So.h+=e,So.s+=t,So.l+=n,this.setHSL(So.h,So.s,So.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(So),e.getHSL(Ro);const n=Un(So.h,Ro.h,t),i=Un(So.s,Ro.s,t),o=Un(So.l,Ro.l,t);return this.setHSL(n,i,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ho.NAMES=Wo,Ho.prototype.isColor=!0,Ho.prototype.r=1,Ho.prototype.g=1,Ho.prototype.b=1;class Yo extends wo{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ho(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}Yo.prototype.isMeshBasicMaterial=!0;const Ko=new ai,No=new Qn;class Mo{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=Zn,this.updateRange={offset:0,count:-1},this.version=0,this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new Ho),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new Qn),t[n++]=o.x,t[n++]=o.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new ai),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new ni),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)No.fromBufferAttribute(this,t),No.applyMatrix3(e),this.setXY(t,No.x,No.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ko.fromBufferAttribute(this,t),Ko.applyMatrix3(e),this.setXYZ(t,Ko.x,Ko.y,Ko.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ko.x=this.getX(t),Ko.y=this.getY(t),Ko.z=this.getZ(t),Ko.applyMatrix4(e),this.setXYZ(t,Ko.x,Ko.y,Ko.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ko.x=this.getX(t),Ko.y=this.getY(t),Ko.z=this.getZ(t),Ko.applyNormalMatrix(e),this.setXYZ(t,Ko.x,Ko.y,Ko.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ko.x=this.getX(t),Ko.y=this.getY(t),Ko.z=this.getZ(t),Ko.transformDirection(e),this.setXYZ(t,Ko.x,Ko.y,Ko.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Zn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Mo.prototype.isBufferAttribute=!0;class Fo extends Mo{constructor(e,t,n){super(new Int8Array(e),t,n)}}class zo extends Mo{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Lo extends Mo{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class ko extends Mo{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Eo extends Mo{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class To extends Mo{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Uo extends Mo{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class _o extends Mo{constructor(e,t,n){super(new Uint16Array(e),t,n)}}_o.prototype.isFloat16BufferAttribute=!0;class Jo extends Mo{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Do extends Mo{constructor(e,t,n){super(new Float64Array(e),t,n)}}function Po(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}const Qo={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Oo(e,t){return new Qo[e](t)}let jo=0;const qo=new Mi,$o=new so,er=new ai,tr=new li,nr=new li,ir=new ai;class or extends Nn{constructor(){super(),Object.defineProperty(this,"id",{value:jo++}),this.uuid=kn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Po(e)>65535?Uo:Eo)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new On).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}rotateX(e){return qo.makeRotationX(e),this.applyMatrix4(qo),this}rotateY(e){return qo.makeRotationY(e),this.applyMatrix4(qo),this}rotateZ(e){return qo.makeRotationZ(e),this.applyMatrix4(qo),this}translate(e,t,n){return qo.makeTranslation(e,t,n),this.applyMatrix4(qo),this}scale(e,t,n){return qo.makeScale(e,t,n),this.applyMatrix4(qo),this}lookAt(e){return $o.lookAt(e),$o.updateMatrix(),this.applyMatrix4($o.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(er).negate(),this.translate(er.x,er.y,er.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Jo(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new li);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ai(-1/0,-1/0,-1/0),new ai(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];tr.setFromBufferAttribute(e),this.morphTargetsRelative?(ir.addVectors(this.boundingBox.min,tr.min),this.boundingBox.expandByPoint(ir),ir.addVectors(this.boundingBox.max,tr.max),this.boundingBox.expandByPoint(ir)):(this.boundingBox.expandByPoint(tr.min),this.boundingBox.expandByPoint(tr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Si);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ai,1/0);if(e){const n=this.boundingSphere.center;if(tr.setFromBufferAttribute(e),t)for(let e=0,o=t.length;e<o;e++){const n=t[e];nr.setFromBufferAttribute(n),this.morphTargetsRelative?(ir.addVectors(tr.min,nr.min),tr.expandByPoint(ir),ir.addVectors(tr.max,nr.max),tr.expandByPoint(ir)):(tr.expandByPoint(nr.min),tr.expandByPoint(nr.max))}tr.getCenter(n);let i=0;for(let t=0,o=e.count;t<o;t++)ir.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(ir));if(t)for(let o=0,r=t.length;o<r;o++){const r=t[o],a=this.morphTargetsRelative;for(let t=0,o=r.count;t<o;t++)ir.fromBufferAttribute(r,t),a&&(er.fromBufferAttribute(e,t),ir.add(er)),i=Math.max(i,n.distanceToSquared(ir))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,o=t.normal.array,r=t.uv.array,a=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Mo(new Float32Array(4*a),4));const g=t.tangent.array,s=[],l=[];for(let Z=0;Z<a;Z++)s[Z]=new ai,l[Z]=new ai;const c=new ai,I=new ai,C=new ai,u=new Qn,d=new Qn,h=new Qn,A=new ai,p=new ai;function m(e,t,n){c.fromArray(i,3*e),I.fromArray(i,3*t),C.fromArray(i,3*n),u.fromArray(r,2*e),d.fromArray(r,2*t),h.fromArray(r,2*n),I.sub(c),C.sub(c),d.sub(u),h.sub(u);const o=1/(d.x*h.y-h.x*d.y);isFinite(o)&&(A.copy(I).multiplyScalar(h.y).addScaledVector(C,-d.y).multiplyScalar(o),p.copy(C).multiplyScalar(d.x).addScaledVector(I,-h.x).multiplyScalar(o),s[e].add(A),s[t].add(A),s[n].add(A),l[e].add(p),l[t].add(p),l[n].add(p))}let b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(let Z=0,w=b.length;Z<w;++Z){const e=b[Z],t=e.start;for(let i=t,o=t+e.count;i<o;i+=3)m(n[i+0],n[i+1],n[i+2])}const f=new ai,y=new ai,G=new ai,v=new ai;function B(e){G.fromArray(o,3*e),v.copy(G);const t=s[e];f.copy(t),f.sub(G.multiplyScalar(G.dot(t))).normalize(),y.crossVectors(v,t);const n=y.dot(l[e])<0?-1:1;g[4*e]=f.x,g[4*e+1]=f.y,g[4*e+2]=f.z,g[4*e+3]=n}for(let Z=0,w=b.length;Z<w;++Z){const e=b[Z],t=e.start;for(let i=t,o=t+e.count;i<o;i+=3)B(n[i+0]),B(n[i+1]),B(n[i+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Mo(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new ai,o=new ai,r=new ai,a=new ai,g=new ai,s=new ai,l=new ai,c=new ai;if(e)for(let I=0,C=e.count;I<C;I+=3){const C=e.getX(I+0),u=e.getX(I+1),d=e.getX(I+2);i.fromBufferAttribute(t,C),o.fromBufferAttribute(t,u),r.fromBufferAttribute(t,d),l.subVectors(r,o),c.subVectors(i,o),l.cross(c),a.fromBufferAttribute(n,C),g.fromBufferAttribute(n,u),s.fromBufferAttribute(n,d),a.add(l),g.add(l),s.add(l),n.setXYZ(C,a.x,a.y,a.z),n.setXYZ(u,g.x,g.y,g.z),n.setXYZ(d,s.x,s.y,s.z)}else for(let e=0,I=t.count;e<I;e+=3)i.fromBufferAttribute(t,e+0),o.fromBufferAttribute(t,e+1),r.fromBufferAttribute(t,e+2),l.subVectors(r,o),c.subVectors(i,o),l.cross(c),n.setXYZ(e+0,l.x,l.y,l.z),n.setXYZ(e+1,l.x,l.y,l.z),n.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const o=n[i].array,r=e.attributes[i],a=r.array,g=r.itemSize*t,s=Math.min(a.length,o.length-g);for(let e=0,t=g;e<s;e++,t++)o[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ir.fromBufferAttribute(e,t),ir.normalize(),e.setXYZ(t,ir.x,ir.y,ir.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,o=e.normalized,r=new n.constructor(t.length*i);let a=0,g=0;for(let s=0,l=t.length;s<l;s++){a=t[s]*i;for(let e=0;e<i;e++)r[g++]=n[a++]}return new Mo(r,i,o)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new or,n=this.index.array,i=this.attributes;for(const a in i){const o=e(i[a],n);t.setAttribute(a,o)}const o=this.morphAttributes;for(const a in o){const i=[],r=o[a];for(let t=0,o=r.length;t<o;t++){const o=e(r[t],n);i.push(o)}t.morphAttributes[a]=i}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let a=0,g=r.length;a<g;a++){const e=r[a];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const g in n){const t=n[g];e.data.attributes[g]=t.toJSON(e.data)}const i={};let o=!1;for(const g in this.morphAttributes){const t=this.morphAttributes[g],n=[];for(let i=0,o=t.length;i<o;i++){const o=t[i];n.push(o.toJSON(e.data))}n.length>0&&(i[g]=n,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new or).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const s in i){const e=i[s];this.setAttribute(s,e.clone(t))}const o=e.morphAttributes;for(const s in o){const e=[],n=o[s];for(let i=0,o=n.length;i<o;i++)e.push(n[i].clone(t));this.morphAttributes[s]=e}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let s=0,l=r.length;s<l;s++){const e=r[s];this.addGroup(e.start,e.count,e.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}or.prototype.isBufferGeometry=!0;const rr=new Mi,ar=new Ni,gr=new Si,sr=new ai,lr=new ai,cr=new ai,Ir=new ai,Cr=new ai,ur=new ai,dr=new ai,hr=new ai,Ar=new ai,pr=new Qn,mr=new Qn,br=new Qn,fr=new ai,yr=new ai;class Gr extends so{constructor(e=new or,t=new Yo){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,i=this.material,o=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),gr.copy(n.boundingSphere),gr.applyMatrix4(o),!1===e.ray.intersectsSphere(gr))return;if(rr.copy(o).invert(),ar.copy(e.ray).applyMatrix4(rr),null!==n.boundingBox&&!1===ar.intersectsBox(n.boundingBox))return;let r;if(n.isBufferGeometry){const o=n.index,a=n.attributes.position,g=n.morphAttributes.position,s=n.morphTargetsRelative,l=n.attributes.uv,c=n.attributes.uv2,I=n.groups,C=n.drawRange;if(null!==o)if(Array.isArray(i))for(let n=0,u=I.length;n<u;n++){const u=I[n],d=i[u.materialIndex];for(let n=Math.max(u.start,C.start),i=Math.min(u.start+u.count,C.start+C.count);n<i;n+=3){const i=o.getX(n),I=o.getX(n+1),C=o.getX(n+2);r=vr(this,d,e,ar,a,g,s,l,c,i,I,C),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=u.materialIndex,t.push(r))}}else{for(let n=Math.max(0,C.start),I=Math.min(o.count,C.start+C.count);n<I;n+=3){const I=o.getX(n),C=o.getX(n+1),u=o.getX(n+2);r=vr(this,i,e,ar,a,g,s,l,c,I,C,u),r&&(r.faceIndex=Math.floor(n/3),t.push(r))}}else if(void 0!==a)if(Array.isArray(i))for(let n=0,u=I.length;n<u;n++){const o=I[n],u=i[o.materialIndex];for(let n=Math.max(o.start,C.start),i=Math.min(o.start+o.count,C.start+C.count);n<i;n+=3){r=vr(this,u,e,ar,a,g,s,l,c,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=o.materialIndex,t.push(r))}}else{for(let n=Math.max(0,C.start),o=Math.min(a.count,C.start+C.count);n<o;n+=3){r=vr(this,i,e,ar,a,g,s,l,c,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),t.push(r))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function vr(e,t,n,i,o,r,a,g,s,l,c,I){sr.fromBufferAttribute(o,l),lr.fromBufferAttribute(o,c),cr.fromBufferAttribute(o,I);const C=e.morphTargetInfluences;if(t.morphTargets&&r&&C){dr.set(0,0,0),hr.set(0,0,0),Ar.set(0,0,0);for(let e=0,t=r.length;e<t;e++){const t=C[e],n=r[e];0!==t&&(Ir.fromBufferAttribute(n,l),Cr.fromBufferAttribute(n,c),ur.fromBufferAttribute(n,I),a?(dr.addScaledVector(Ir,t),hr.addScaledVector(Cr,t),Ar.addScaledVector(ur,t)):(dr.addScaledVector(Ir.sub(sr),t),hr.addScaledVector(Cr.sub(lr),t),Ar.addScaledVector(ur.sub(cr),t)))}sr.add(dr),lr.add(hr),cr.add(Ar)}e.isSkinnedMesh&&t.skinning&&(e.boneTransform(l,sr),e.boneTransform(c,lr),e.boneTransform(I,cr));const u=function(e,t,n,i,o,r,a,g){let s;if(s=t.side===h?i.intersectTriangle(a,r,o,!0,g):i.intersectTriangle(o,r,a,t.side!==A,g),null===s)return null;yr.copy(g),yr.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(yr);return l<n.near||l>n.far?null:{distance:l,point:yr.clone(),object:e}}(e,t,n,i,sr,lr,cr,fr);if(u){g&&(pr.fromBufferAttribute(g,l),mr.fromBufferAttribute(g,c),br.fromBufferAttribute(g,I),u.uv=Bo.getUV(fr,sr,lr,cr,pr,mr,br,new Qn)),s&&(pr.fromBufferAttribute(s,l),mr.fromBufferAttribute(s,c),br.fromBufferAttribute(s,I),u.uv2=Bo.getUV(fr,sr,lr,cr,pr,mr,br,new Qn));const e={a:l,b:c,c:I,normal:new ai,materialIndex:0};Bo.getNormal(sr,lr,cr,e.normal),u.face=e}return u}Gr.prototype.isMesh=!0;class Br extends or{constructor(e=1,t=1,n=1,i=1,o=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:o,depthSegments:r};const a=this;i=Math.floor(i),o=Math.floor(o),r=Math.floor(r);const g=[],s=[],l=[],c=[];let I=0,C=0;function u(e,t,n,i,o,r,u,d,h,A,p){const m=r/h,b=u/A,f=r/2,y=u/2,G=d/2,v=h+1,B=A+1;let Z=0,w=0;const W=new ai;for(let a=0;a<B;a++){const r=a*b-y;for(let g=0;g<v;g++){const I=g*m-f;W[e]=I*i,W[t]=r*o,W[n]=G,s.push(W.x,W.y,W.z),W[e]=0,W[t]=0,W[n]=d>0?1:-1,l.push(W.x,W.y,W.z),c.push(g/h),c.push(1-a/A),Z+=1}}for(let a=0;a<A;a++)for(let e=0;e<h;e++){const t=I+e+v*a,n=I+e+v*(a+1),i=I+(e+1)+v*(a+1),o=I+(e+1)+v*a;g.push(t,n,o),g.push(n,i,o),w+=6}a.addGroup(C,w,p),C+=w,I+=Z}u("z","y","x",-1,-1,n,t,e,r,o,0),u("z","y","x",1,-1,n,t,-e,r,o,1),u("x","z","y",1,1,e,n,t,i,r,2),u("x","z","y",1,-1,e,n,-t,i,r,3),u("x","y","z",1,-1,e,t,n,i,o,4),u("x","y","z",-1,-1,e,t,-n,i,o,5),this.setIndex(g),this.setAttribute("position",new Jo(s,3)),this.setAttribute("normal",new Jo(l,3)),this.setAttribute("uv",new Jo(c,2))}}function Zr(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const o=e[n][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?t[n][i]=o.clone():Array.isArray(o)?t[n][i]=o.slice():t[n][i]=o}}return t}function wr(e){const t={};for(let n=0;n<e.length;n++){const i=Zr(e[n]);for(const e in i)t[e]=i[e]}return t}const Wr={clone:Zr,merge:wr};class Sr extends wo{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Zr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Sr.prototype.isShaderMaterial=!0;class Rr extends so{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Mi,this.projectionMatrix=new Mi,this.projectionMatrixInverse=new Mi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new ai),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Rr.prototype.isCamera=!0;class Vr extends Rr{constructor(e=50,t=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ln*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*zn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ln*Math.atan(Math.tan(.5*zn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,o,r){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*zn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,o=-.5*i;const r=this.view;if(null!==this.view&&this.view.enabled){const e=r.fullWidth,a=r.fullHeight;o+=r.offsetX*i/e,t-=r.offsetY*n/a,i*=r.width/e,n*=r.height/a}const a=this.filmOffset;0!==a&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Vr.prototype.isPerspectiveCamera=!0;const xr=90;class Xr extends so{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Vr(xr,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new ai(1,0,0)),this.add(i);const o=new Vr(xr,1,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new ai(-1,0,0)),this.add(o);const r=new Vr(xr,1,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new ai(0,1,0)),this.add(r);const a=new Vr(xr,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new ai(0,-1,0)),this.add(a);const g=new Vr(xr,1,e,t);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new ai(0,0,1)),this.add(g);const s=new Vr(xr,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new ai(0,0,-1)),this.add(s)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,o,r,a,g,s]=this.children,l=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;const I=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,r),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,g),n.texture.generateMipmaps=I,e.setRenderTarget(n,5),e.render(t,s),e.setRenderTarget(c),e.xr.enabled=l}}class Hr extends ei{constructor(e,t,n,i,o,r,a,g,s,l){super(e=void 0!==e?e:[],t=void 0!==t?t:re,n,i,o,r,a=void 0!==a?a:Me,g,s,l),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Hr.prototype.isCubeTexture=!0;class Yr extends ii{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new Hr(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:be,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Fe,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Br(5,5,5),o=new Sr({name:"CubemapFromEquirect",uniforms:Zr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:h,blending:b});o.uniforms.tEquirect.value=t;const r=new Gr(i,o),a=t.minFilter;t.minFilter===Ge&&(t.minFilter=be);return new Xr(1,10,this).update(e,r),t.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,n,i){const o=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(o)}}Yr.prototype.isWebGLCubeRenderTarget=!0;class Kr extends ei{constructor(e,t,n,i,o,r,a,g,s,l,c,I){super(null,r,a,g,s,l,i,o,c,I),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==s?s:de,this.minFilter=void 0!==l?l:de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Kr.prototype.isDataTexture=!0;const Nr=new Si,Mr=new ai;class Fr{constructor(e=new Co,t=new Co,n=new Co,i=new Co,o=new Co,r=new Co){this.planes=[e,t,n,i,o,r]}set(e,t,n,i,o,r){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(o),a[5].copy(r),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],o=n[1],r=n[2],a=n[3],g=n[4],s=n[5],l=n[6],c=n[7],I=n[8],C=n[9],u=n[10],d=n[11],h=n[12],A=n[13],p=n[14],m=n[15];return t[0].setComponents(a-i,c-g,d-I,m-h).normalize(),t[1].setComponents(a+i,c+g,d+I,m+h).normalize(),t[2].setComponents(a+o,c+s,d+C,m+A).normalize(),t[3].setComponents(a-o,c-s,d-C,m-A).normalize(),t[4].setComponents(a-r,c-l,d-u,m-p).normalize(),t[5].setComponents(a+r,c+l,d+u,m+p).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Nr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Nr)}intersectsSprite(e){return Nr.center.set(0,0,0),Nr.radius=.7071067811865476,Nr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Nr)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let o=0;o<6;o++){if(t[o].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Mr.x=i.normal.x>0?e.max.x:e.min.x,Mr.y=i.normal.y>0?e.max.y:e.min.y,Mr.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Mr)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function zr(){let e=null,t=!1,n=null,i=null;function o(t,r){n(t,r),i=e.requestAnimationFrame(o)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(o),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Lr(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,o){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const r=i.get(t);void 0===r?i.set(t,function(t,i){const o=t.array,r=t.usage,a=e.createBuffer();e.bindBuffer(i,a),e.bufferData(i,o,r),t.onUploadCallback();let g=5126;return o instanceof Float32Array?g=5126:o instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):o instanceof Uint16Array?t.isFloat16BufferAttribute?n?g=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):g=5123:o instanceof Int16Array?g=5122:o instanceof Uint32Array?g=5125:o instanceof Int32Array?g=5124:o instanceof Int8Array?g=5120:o instanceof Uint8Array&&(g=5121),{buffer:a,type:g,bytesPerElement:o.BYTES_PER_ELEMENT,version:t.version}}(t,o)):r.version<t.version&&(!function(t,i,o){const r=i.array,a=i.updateRange;e.bindBuffer(o,t),-1===a.count?e.bufferSubData(o,0,r):(n?e.bufferSubData(o,a.offset*r.BYTES_PER_ELEMENT,r,a.offset,a.count):e.bufferSubData(o,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}(r.buffer,t,o),r.version=t.version)}}}class kr extends or{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const o=e/2,r=t/2,a=Math.floor(n),g=Math.floor(i),s=a+1,l=g+1,c=e/a,I=t/g,C=[],u=[],d=[],h=[];for(let A=0;A<l;A++){const e=A*I-r;for(let t=0;t<s;t++){const n=t*c-o;u.push(n,-e,0),d.push(0,0,1),h.push(t/a),h.push(1-A/g)}}for(let A=0;A<g;A++)for(let e=0;e<a;e++){const t=e+s*A,n=e+s*(A+1),i=e+1+s*(A+1),o=e+1+s*A;C.push(t,n,o),C.push(n,i,o)}this.setIndex(C),this.setAttribute("position",new Jo(u,3)),this.setAttribute("normal",new Jo(d,3)),this.setAttribute("uv",new Jo(h,2))}}const Er={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Tr={common:{diffuse:{value:new Ho(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new On},uv2Transform:{value:new On},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Qn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ho(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ho(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new On}},sprite:{diffuse:{value:new Ho(15658734)},opacity:{value:1},center:{value:new Qn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new On}}},Ur={basic:{uniforms:wr([Tr.common,Tr.specularmap,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.fog]),vertexShader:Er.meshbasic_vert,fragmentShader:Er.meshbasic_frag},lambert:{uniforms:wr([Tr.common,Tr.specularmap,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.fog,Tr.lights,{emissive:{value:new Ho(0)}}]),vertexShader:Er.meshlambert_vert,fragmentShader:Er.meshlambert_frag},phong:{uniforms:wr([Tr.common,Tr.specularmap,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.fog,Tr.lights,{emissive:{value:new Ho(0)},specular:{value:new Ho(1118481)},shininess:{value:30}}]),vertexShader:Er.meshphong_vert,fragmentShader:Er.meshphong_frag},standard:{uniforms:wr([Tr.common,Tr.envmap,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.roughnessmap,Tr.metalnessmap,Tr.fog,Tr.lights,{emissive:{value:new Ho(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Er.meshphysical_vert,fragmentShader:Er.meshphysical_frag},toon:{uniforms:wr([Tr.common,Tr.aomap,Tr.lightmap,Tr.emissivemap,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.gradientmap,Tr.fog,Tr.lights,{emissive:{value:new Ho(0)}}]),vertexShader:Er.meshtoon_vert,fragmentShader:Er.meshtoon_frag},matcap:{uniforms:wr([Tr.common,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,Tr.fog,{matcap:{value:null}}]),vertexShader:Er.meshmatcap_vert,fragmentShader:Er.meshmatcap_frag},points:{uniforms:wr([Tr.points,Tr.fog]),vertexShader:Er.points_vert,fragmentShader:Er.points_frag},dashed:{uniforms:wr([Tr.common,Tr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Er.linedashed_vert,fragmentShader:Er.linedashed_frag},depth:{uniforms:wr([Tr.common,Tr.displacementmap]),vertexShader:Er.depth_vert,fragmentShader:Er.depth_frag},normal:{uniforms:wr([Tr.common,Tr.bumpmap,Tr.normalmap,Tr.displacementmap,{opacity:{value:1}}]),vertexShader:Er.normal_vert,fragmentShader:Er.normal_frag},sprite:{uniforms:wr([Tr.sprite,Tr.fog]),vertexShader:Er.sprite_vert,fragmentShader:Er.sprite_frag},background:{uniforms:{uvTransform:{value:new On},t2D:{value:null}},vertexShader:Er.background_vert,fragmentShader:Er.background_frag},cube:{uniforms:wr([Tr.envmap,{opacity:{value:1}}]),vertexShader:Er.cube_vert,fragmentShader:Er.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Er.equirect_vert,fragmentShader:Er.equirect_frag},distanceRGBA:{uniforms:wr([Tr.common,Tr.displacementmap,{referencePosition:{value:new ai},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Er.distanceRGBA_vert,fragmentShader:Er.distanceRGBA_frag},shadow:{uniforms:wr([Tr.lights,Tr.fog,{color:{value:new Ho(0)},opacity:{value:1}}]),vertexShader:Er.shadow_vert,fragmentShader:Er.shadow_frag}};function _r(e,t,n,i,o){const r=new Ho(0);let a,g,s=0,l=null,c=0,I=null;function C(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,o)}return{getClearColor:function(){return r},setClearColor:function(e,t=1){r.set(e),s=t,C(r,s)},getClearAlpha:function(){return s},setClearAlpha:function(e){s=e,C(r,s)},render:function(n,o,u,A){let p=!0===o.isScene?o.background:null;p&&p.isTexture&&(p=t.get(p));const m=e.xr,b=m.getSession&&m.getSession();b&&"additive"===b.environmentBlendMode&&(p=null),null===p?C(r,s):p&&p.isColor&&(C(p,1),A=!0),(e.autoClear||A)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.mapping===le)?(void 0===g&&(g=new Gr(new Br(1,1,1),new Sr({name:"BackgroundCubeMaterial",uniforms:Zr(Ur.cube.uniforms),vertexShader:Ur.cube.vertexShader,fragmentShader:Ur.cube.fragmentShader,side:h,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),g.geometry.deleteAttribute("uv"),g.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(g.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(g)),g.material.uniforms.envMap.value=p,g.material.uniforms.flipEnvMap.value=p.isCubeTexture&&p._needsFlipEnvMap?-1:1,l===p&&c===p.version&&I===e.toneMapping||(g.material.needsUpdate=!0,l=p,c=p.version,I=e.toneMapping),n.unshift(g,g.geometry,g.material,0,0,null)):p&&p.isTexture&&(void 0===a&&(a=new Gr(new kr(2,2),new Sr({name:"BackgroundMaterial",uniforms:Zr(Ur.background.uniforms),vertexShader:Ur.background.vertexShader,fragmentShader:Ur.background.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),a.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&c===p.version&&I===e.toneMapping||(a.material.needsUpdate=!0,l=p,c=p.version,I=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Jr(e,t,n,i){const o=e.getParameter(34921),r=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==r,g={},s=C(null);let l=s;function c(t){return i.isWebGL2?e.bindVertexArray(t):r.bindVertexArrayOES(t)}function I(t){return i.isWebGL2?e.deleteVertexArray(t):r.deleteVertexArrayOES(t)}function C(e){const t=[],n=[],i=[];for(let r=0;r<o;r++)t[r]=0,n[r]=0,i[r]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){const e=l.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){h(e,0)}function h(n,o){const r=l.newAttributes,a=l.enabledAttributes,g=l.attributeDivisors;if(r[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),g[n]!==o){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,o),g[n]=o}}function A(){const t=l.newAttributes,n=l.enabledAttributes;for(let i=0,o=n.length;i<o;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function p(t,n,o,r,a,g){!0!==i.isWebGL2||5124!==o&&5125!==o?e.vertexAttribPointer(t,n,o,r,a,g):e.vertexAttribIPointer(t,n,o,a,g)}function m(){b(),l!==s&&(l=s,c(l.object))}function b(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:function(o,s,I,m,b){let f=!1;if(a){const t=function(t,n,o){const a=!0===o.wireframe;let s=g[t.id];void 0===s&&(s={},g[t.id]=s);let l=s[n.id];void 0===l&&(l={},s[n.id]=l);let c=l[a];void 0===c&&(c=C(i.isWebGL2?e.createVertexArray():r.createVertexArrayOES()),l[a]=c);return c}(m,I,s);l!==t&&(l=t,c(l.object)),f=function(e,t){const n=l.attributes,i=e.attributes;let o=0;for(const r in i){const e=n[r],t=i[r];if(void 0===e)return!0;if(e.attribute!==t)return!0;if(e.data!==t.data)return!0;o++}return l.attributesNum!==o||l.index!==t}(m,b),f&&function(e,t){const n={},i=e.attributes;let o=0;for(const r in i){const e=i[r],t={};t.attribute=e,e.data&&(t.data=e.data),n[r]=t,o++}l.attributes=n,l.attributesNum=o,l.index=t}(m,b)}else{const e=!0===s.wireframe;l.geometry===m.id&&l.program===I.id&&l.wireframe===e||(l.geometry=m.id,l.program=I.id,l.wireframe=e,f=!0)}!0===o.isInstancedMesh&&(f=!0),null!==b&&n.update(b,34963),f&&(!function(o,r,a,g){if(!1===i.isWebGL2&&(o.isInstancedMesh||g.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;u();const s=g.attributes,l=a.getAttributes(),c=r.defaultAttributeValues;for(const t in l){const i=l[t];if(i>=0){const r=s[t];if(void 0!==r){const t=r.normalized,o=r.itemSize,a=n.get(r);if(void 0===a)continue;const s=a.buffer,l=a.type,c=a.bytesPerElement;if(r.isInterleavedBufferAttribute){const n=r.data,a=n.stride,I=r.offset;n&&n.isInstancedInterleavedBuffer?(h(i,n.meshPerAttribute),void 0===g._maxInstanceCount&&(g._maxInstanceCount=n.meshPerAttribute*n.count)):d(i),e.bindBuffer(34962,s),p(i,o,l,t,a*c,I*c)}else r.isInstancedBufferAttribute?(h(i,r.meshPerAttribute),void 0===g._maxInstanceCount&&(g._maxInstanceCount=r.meshPerAttribute*r.count)):d(i),e.bindBuffer(34962,s),p(i,o,l,t,0,0)}else if("instanceMatrix"===t){const t=n.get(o.instanceMatrix);if(void 0===t)continue;const r=t.buffer,a=t.type;h(i+0,1),h(i+1,1),h(i+2,1),h(i+3,1),e.bindBuffer(34962,r),e.vertexAttribPointer(i+0,4,a,!1,64,0),e.vertexAttribPointer(i+1,4,a,!1,64,16),e.vertexAttribPointer(i+2,4,a,!1,64,32),e.vertexAttribPointer(i+3,4,a,!1,64,48)}else if("instanceColor"===t){const t=n.get(o.instanceColor);if(void 0===t)continue;const r=t.buffer,a=t.type;h(i,1),e.bindBuffer(34962,r),e.vertexAttribPointer(i,3,a,!1,12,0)}else if(void 0!==c){const n=c[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i,n);break;case 3:e.vertexAttrib3fv(i,n);break;case 4:e.vertexAttrib4fv(i,n);break;default:e.vertexAttrib1fv(i,n)}}}}A()}(o,s,I,m),null!==b&&e.bindBuffer(34963,n.get(b).buffer))},reset:m,resetDefaultState:b,dispose:function(){m();for(const e in g){const t=g[e];for(const e in t){const n=t[e];for(const e in n)I(n[e].object),delete n[e];delete t[e]}delete g[e]}},releaseStatesOfGeometry:function(e){if(void 0===g[e.id])return;const t=g[e.id];for(const n in t){const e=t[n];for(const t in e)I(e[t].object),delete e[t];delete t[n]}delete g[e.id]},releaseStatesOfProgram:function(e){for(const t in g){const n=g[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)I(i[e].object),delete i[e];delete n[e.id]}},initAttributes:u,enableAttribute:d,disableUnusedAttributes:A}}function Dr(e,t,n,i){const o=i.isWebGL2;let r;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,a,g){if(0===g)return;let s,l;if(o)s=e,l="drawArraysInstanced";else if(s=t.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===s)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");s[l](r,i,a,g),n.update(a,r,g)}}function Pr(e,t,n){let i;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const g=o(a);g!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",g,"instead."),a=g);const s=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),c=e.getParameter(35660),I=e.getParameter(3379),C=e.getParameter(34076),u=e.getParameter(34921),d=e.getParameter(36347),h=e.getParameter(36348),A=e.getParameter(36349),p=c>0,m=r||t.has("OES_texture_float");return{isWebGL2:r,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:o,precision:a,logarithmicDepthBuffer:s,maxTextures:l,maxVertexTextures:c,maxTextureSize:I,maxCubemapSize:C,maxAttributes:u,maxVertexUniforms:d,maxVaryings:h,maxFragmentUniforms:A,vertexTextures:p,floatFragmentTextures:m,floatVertexTextures:p&&m,maxSamples:r?e.getParameter(36183):0}}function Qr(e){const t=this;let n=null,i=0,o=!1,r=!1;const a=new Co,g=new On,s={value:null,needsUpdate:!1};function l(){s.value!==n&&(s.value=n,s.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(e,n,i,o){const r=null!==e?e.length:0;let l=null;if(0!==r){if(l=s.value,!0!==o||null===l){const t=i+4*r,o=n.matrixWorldInverse;g.getNormalMatrix(o),(null===l||l.length<t)&&(l=new Float32Array(t));for(let n=0,s=i;n!==r;++n,s+=4)a.copy(e[n]).applyMatrix4(o,g),a.normal.toArray(l,s),l[s+3]=a.constant}s.value=l,s.needsUpdate=!0}return t.numPlanes=r,t.numIntersection=0,l}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){const a=0!==e.length||t||0!==i||o;return o=t,n=c(e,r,0),i=e.length,a},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(t,a,g){const I=t.clippingPlanes,C=t.clipIntersection,u=t.clipShadows,d=e.get(t);if(!o||null===I||0===I.length||r&&!u)r?c(null):l();else{const e=r?0:i,t=4*e;let o=d.clippingState||null;s.value=o,o=c(I,a,t,g);for(let i=0;i!==t;++i)o[i]=n[i];d.clippingState=o,this.numIntersection=C?this.numPlanes:0,this.numPlanes+=e}}}function Or(e){let t=new WeakMap;function n(e,t){return t===ge?e.mapping=re:t===se&&(e.mapping=ae),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const o=t.get(n);void 0!==o&&(t.delete(n),o.dispose())}return{get:function(o){if(o&&o.isTexture){const r=o.mapping;if(r===ge||r===se){if(t.has(o)){return n(t.get(o).texture,o.mapping)}{const r=o.image;if(r&&r.height>0){const a=e.getRenderTarget(),g=new Yr(r.height/2);return g.fromEquirectangularTexture(e,o),t.set(o,g),e.setRenderTarget(a),o.addEventListener("dispose",i),n(g.texture,o.mapping)}return null}}}return o},dispose:function(){t=new WeakMap}}}function jr(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function qr(e,t,n,i){const o={},r=new WeakMap;function a(e){const g=e.target;null!==g.index&&t.remove(g.index);for(const n in g.attributes)t.remove(g.attributes[n]);g.removeEventListener("dispose",a),delete o[g.id];const s=r.get(g);s&&(t.remove(s),r.delete(g)),i.releaseStatesOfGeometry(g),!0===g.isInstancedBufferGeometry&&delete g._maxInstanceCount,n.memory.geometries--}function g(e){const n=[],i=e.index,o=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],o=e[t+1],r=e[t+2];n.push(i,o,o,r,r,i)}}else{const e=o.array;a=o.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,o=t+2;n.push(e,i,i,o,o,e)}}const g=new(Po(n)>65535?Uo:Eo)(n,1);g.version=a;const s=r.get(e);s&&t.remove(s),r.set(e,g)}return{get:function(e,t){return!0===o[t.id]||(t.addEventListener("dispose",a),o[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const o in n)t.update(n[o],34962);const i=e.morphAttributes;for(const o in i){const e=i[o];for(let n=0,i=e.length;n<i;n++)t.update(e[n],34962)}},getWireframeAttribute:function(e){const t=r.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&g(e)}else g(e);return r.get(e)}}}function $r(e,t,n,i){const o=i.isWebGL2;let r,a,g;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,g=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*g),n.update(i,r,1)},this.renderInstances=function(i,s,l){if(0===l)return;let c,I;if(o)c=e,I="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),I="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[I](r,s,a,i*g,l),n.update(s,r,l)}}function ea(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function ta(e,t){return e[0]-t[0]}function na(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ia(e){const t={},n=new Float32Array(8),i=[];for(let o=0;o<8;o++)i[o]=[o,0];return{update:function(o,r,a,g){const s=o.morphTargetInfluences,l=void 0===s?0:s.length;let c=t[r.id];if(void 0===c){c=[];for(let e=0;e<l;e++)c[e]=[e,0];t[r.id]=c}for(let e=0;e<l;e++){const t=c[e];t[0]=e,t[1]=s[e]}c.sort(na);for(let e=0;e<8;e++)e<l&&c[e][1]?(i[e][0]=c[e][0],i[e][1]=c[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(ta);const I=a.morphTargets&&r.morphAttributes.position,C=a.morphNormals&&r.morphAttributes.normal;let u=0;for(let e=0;e<8;e++){const t=i[e],o=t[0],a=t[1];o!==Number.MAX_SAFE_INTEGER&&a?(I&&r.getAttribute("morphTarget"+e)!==I[o]&&r.setAttribute("morphTarget"+e,I[o]),C&&r.getAttribute("morphNormal"+e)!==C[o]&&r.setAttribute("morphNormal"+e,C[o]),n[e]=a,u+=a):(I&&!0===r.hasAttribute("morphTarget"+e)&&r.deleteAttribute("morphTarget"+e),C&&!0===r.hasAttribute("morphNormal"+e)&&r.deleteAttribute("morphNormal"+e),n[e]=0)}const d=r.morphTargetsRelative?1:1-u;g.getUniforms().setValue(e,"morphTargetBaseInfluence",d),g.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function oa(e,t,n,i){let o=new WeakMap;function r(e){const t=e.target;t.removeEventListener("dispose",r),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const a=i.render.frame,g=e.geometry,s=t.get(e,g);return o.get(s)!==a&&(t.update(s),o.set(s,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",r)&&e.addEventListener("dispose",r),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),s},dispose:function(){o=new WeakMap}}}Ur.physical={uniforms:wr([Ur.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Qn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ho(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Er.meshphysical_vert,fragmentShader:Er.meshphysical_frag};class ra extends ei{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=de,this.minFilter=de,this.wrapR=Ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ra.prototype.isDataTexture2DArray=!0;class aa extends ei{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=de,this.minFilter=de,this.wrapR=Ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}aa.prototype.isDataTexture3D=!0;const ga=new ei,sa=new ra,la=new aa,ca=new Hr,Ia=[],Ca=[],ua=new Float32Array(16),da=new Float32Array(9),ha=new Float32Array(4);function Aa(e,t,n){const i=e[0];if(i<=0||i>0)return e;const o=t*n;let r=Ia[o];if(void 0===r&&(r=new Float32Array(o),Ia[o]=r),0!==t){i.toArray(r,0);for(let i=1,o=0;i!==t;++i)o+=n,e[i].toArray(r,o)}return r}function pa(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function ma(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function ba(e,t){let n=Ca[t];void 0===n&&(n=new Int32Array(t),Ca[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function fa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function ya(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(pa(n,t))return;e.uniform2fv(this.addr,t),ma(n,t)}}function Ga(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(pa(n,t))return;e.uniform3fv(this.addr,t),ma(n,t)}}function va(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(pa(n,t))return;e.uniform4fv(this.addr,t),ma(n,t)}}function Ba(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(pa(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ma(n,t)}else{if(pa(n,i))return;ha.set(i),e.uniformMatrix2fv(this.addr,!1,ha),ma(n,i)}}function Za(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(pa(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ma(n,t)}else{if(pa(n,i))return;da.set(i),e.uniformMatrix3fv(this.addr,!1,da),ma(n,i)}}function wa(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(pa(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ma(n,t)}else{if(pa(n,i))return;ua.set(i),e.uniformMatrix4fv(this.addr,!1,ua),ma(n,i)}}function Wa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Sa(e,t){const n=this.cache;pa(n,t)||(e.uniform2iv(this.addr,t),ma(n,t))}function Ra(e,t){const n=this.cache;pa(n,t)||(e.uniform3iv(this.addr,t),ma(n,t))}function Va(e,t){const n=this.cache;pa(n,t)||(e.uniform4iv(this.addr,t),ma(n,t))}function xa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Xa(e,t){const n=this.cache;pa(n,t)||(e.uniform2uiv(this.addr,t),ma(n,t))}function Ha(e,t){const n=this.cache;pa(n,t)||(e.uniform3uiv(this.addr,t),ma(n,t))}function Ya(e,t){const n=this.cache;pa(n,t)||(e.uniform4uiv(this.addr,t),ma(n,t))}function Ka(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.safeSetTexture2D(t||ga,o)}function Na(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.setTexture3D(t||la,o)}function Ma(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.safeSetTextureCube(t||ca,o)}function Fa(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.setTexture2DArray(t||sa,o)}function za(e,t){e.uniform1fv(this.addr,t)}function La(e,t){const n=Aa(t,this.size,2);e.uniform2fv(this.addr,n)}function ka(e,t){const n=Aa(t,this.size,3);e.uniform3fv(this.addr,n)}function Ea(e,t){const n=Aa(t,this.size,4);e.uniform4fv(this.addr,n)}function Ta(e,t){const n=Aa(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ua(e,t){const n=Aa(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function _a(e,t){const n=Aa(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ja(e,t){e.uniform1iv(this.addr,t)}function Da(e,t){e.uniform2iv(this.addr,t)}function Pa(e,t){e.uniform3iv(this.addr,t)}function Qa(e,t){e.uniform4iv(this.addr,t)}function Oa(e,t){e.uniform1uiv(this.addr,t)}function ja(e,t){e.uniform2uiv(this.addr,t)}function qa(e,t){e.uniform3uiv(this.addr,t)}function $a(e,t){e.uniform4uiv(this.addr,t)}function eg(e,t,n){const i=t.length,o=ba(n,i);e.uniform1iv(this.addr,o);for(let r=0;r!==i;++r)n.safeSetTexture2D(t[r]||ga,o[r])}function tg(e,t,n){const i=t.length,o=ba(n,i);e.uniform1iv(this.addr,o);for(let r=0;r!==i;++r)n.safeSetTextureCube(t[r]||ca,o[r])}function ng(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return fa;case 35664:return ya;case 35665:return Ga;case 35666:return va;case 35674:return Ba;case 35675:return Za;case 35676:return wa;case 5124:case 35670:return Wa;case 35667:case 35671:return Sa;case 35668:case 35672:return Ra;case 35669:case 35673:return Va;case 5125:return xa;case 36294:return Xa;case 36295:return Ha;case 36296:return Ya;case 35678:case 36198:case 36298:case 36306:case 35682:return Ka;case 35679:case 36299:case 36307:return Na;case 35680:case 36300:case 36308:case 36293:return Ma;case 36289:case 36303:case 36311:case 36292:return Fa}}(t.type)}function ig(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return za;case 35664:return La;case 35665:return ka;case 35666:return Ea;case 35674:return Ta;case 35675:return Ua;case 35676:return _a;case 5124:case 35670:return Ja;case 35667:case 35671:return Da;case 35668:case 35672:return Pa;case 35669:case 35673:return Qa;case 5125:return Oa;case 36294:return ja;case 36295:return qa;case 36296:return $a;case 35678:case 36198:case 36298:case 36306:case 35682:return eg;case 35680:case 36300:case 36308:case 36293:return tg}}(t.type)}function og(e){this.id=e,this.seq=[],this.map={}}ig.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ma(t,e)},og.prototype.setValue=function(e,t,n){const i=this.seq;for(let o=0,r=i.length;o!==r;++o){const r=i[o];r.setValue(e,t[r.id],n)}};const rg=/(\w+)(\])?(\[|\.)?/g;function ag(e,t){e.seq.push(t),e.map[t.id]=t}function gg(e,t,n){const i=e.name,o=i.length;for(rg.lastIndex=0;;){const r=rg.exec(i),a=rg.lastIndex;let g=r[1];const s="]"===r[2],l=r[3];if(s&&(g|=0),void 0===l||"["===l&&a+2===o){ag(n,void 0===l?new ng(g,e,t):new ig(g,e,t));break}{let e=n.map[g];void 0===e&&(e=new og(g),ag(n,e)),n=e}}}function sg(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);gg(n,e.getUniformLocation(t,n.name),this)}}function lg(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}sg.prototype.setValue=function(e,t,n,i){const o=this.map[t];void 0!==o&&o.setValue(e,n,i)},sg.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},sg.upload=function(e,t,n,i){for(let o=0,r=t.length;o!==r;++o){const r=t[o],a=n[r.id];!1!==a.needsUpdate&&r.setValue(e,a.value,i)}},sg.seqWithValue=function(e,t){const n=[];for(let i=0,o=e.length;i!==o;++i){const o=e[i];o.id in t&&n.push(o)}return n};let cg=0;function Ig(e){switch(e){case Ot:return["Linear","( value )"];case jt:return["sRGB","( value )"];case $t:return["RGBE","( value )"];case tn:return["RGBM","( value, 7.0 )"];case nn:return["RGBM","( value, 16.0 )"];case on:return["RGBD","( value, 256.0 )"];case qt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case en:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Cg(e,t,n){const i=e.getShaderParameter(t,35713),o=e.getShaderInfoLog(t).trim();if(i&&""===o)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+o+function(e){const t=e.split("\n");for(let n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function ug(e,t){const n=Ig(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function dg(e,t){const n=Ig(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function hg(e,t){let n;switch(t){case $:n="Linear";break;case ee:n="Reinhard";break;case te:n="OptimizedCineon";break;case ne:n="ACESFilmic";break;case ie:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Ag(e){return""!==e}function pg(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function mg(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const bg=/^[ \t]*#include +<([\w\d./]+)>/gm;function fg(e){return e.replace(bg,yg)}function yg(e,t){const n=Er[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return fg(n)}const Gg=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,vg=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Bg(e){return e.replace(vg,wg).replace(Gg,Zg)}function Zg(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),wg(e,t,n,i)}function wg(e,t,n,i){let o="";for(let r=parseInt(t);r<parseInt(n);r++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return o}function Wg(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Sg(e,t,n,i){const o=e.getContext(),r=n.defines;let a=n.vertexShader,g=n.fragmentShader;const s=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===I?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===C?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===u&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case re:case ae:t="ENVMAP_TYPE_CUBE";break;case le:case ce:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),c=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ae:case ce:t="ENVMAP_MODE_REFRACTION"}return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Q:t="ENVMAP_BLENDING_MULTIPLY";break;case O:t="ENVMAP_BLENDING_MIX";break;case j:t="ENVMAP_BLENDING_ADD"}return t}(n),h=e.gammaFactor>0?e.gammaFactor:1,A=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ag).join("\n")}(n),p=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(r),m=o.createProgram();let b,f,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(b=[p].filter(Ag).join("\n"),b.length>0&&(b+="\n"),f=[A,p].filter(Ag).join("\n"),f.length>0&&(f+="\n")):(b=[Wg(n),"#define SHADER_NAME "+n.shaderName,p,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+s:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ag).join("\n"),f=[A,Wg(n),"#define SHADER_NAME "+n.shaderName,p,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+c:"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+s:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==q?"#define TONE_MAPPING":"",n.toneMapping!==q?Er.tonemapping_pars_fragment:"",n.toneMapping!==q?hg("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Er.encodings_pars_fragment,n.map?ug("mapTexelToLinear",n.mapEncoding):"",n.matcap?ug("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?ug("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?ug("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?ug("lightMapTexelToLinear",n.lightMapEncoding):"",dg("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ag).join("\n")),a=fg(a),a=pg(a,n),a=mg(a,n),g=fg(g),g=pg(g,n),g=mg(g,n),a=Bg(a),g=Bg(g),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",b=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,f=["#define varying in",n.glslVersion===Kn?"":"out highp vec4 pc_fragColor;",n.glslVersion===Kn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+f);const G=y+f+g,v=lg(o,35633,y+b+a),B=lg(o,35632,G);if(o.attachShader(m,v),o.attachShader(m,B),void 0!==n.index0AttributeName?o.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(m,0,"position"),o.linkProgram(m),e.debug.checkShaderErrors){const e=o.getProgramInfoLog(m).trim(),t=o.getShaderInfoLog(v).trim(),n=o.getShaderInfoLog(B).trim();let i=!0,r=!0;if(!1===o.getProgramParameter(m,35714)){i=!1;const t=Cg(o,v,"vertex"),n=Cg(o,B,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(m,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(r=!1);r&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:b},fragmentShader:{log:n,prefix:f}})}let Z,w;return o.deleteShader(v),o.deleteShader(B),this.getUniforms=function(){return void 0===Z&&(Z=new sg(o,m)),Z},this.getAttributes=function(){return void 0===w&&(w=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let o=0;o<i;o++){const i=e.getActiveAttrib(t,o).name;n[i]=e.getAttribLocation(t,i)}return n}(o,m)),w},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=cg++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=v,this.fragmentShader=B,this}function Rg(e,t,n,i,o,r){const a=[],g=i.isWebGL2,s=i.logarithmicDepthBuffer,l=i.floatVertexTextures,c=i.maxVertexUniforms,I=i.vertexTextures;let C=i.precision;const u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function p(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Ot,t}return{getParameters:function(o,a,d,m,b){const f=m.fog,y=o.isMeshStandardMaterial?m.environment:null,G=t.get(o.envMap||y),v=u[o.type],B=b.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(l)return 1024;{const e=c,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}}(b):0;let Z,w;if(null!==o.precision&&(C=i.getMaxPrecision(o.precision),C!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",C,"instead.")),v){const e=Ur[v];Z=e.vertexShader,w=e.fragmentShader}else Z=o.vertexShader,w=o.fragmentShader;const W=e.getRenderTarget();return{isWebGL2:g,shaderID:v,shaderName:o.type,vertexShader:Z,fragmentShader:w,defines:o.defines,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:C,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:I,outputEncoding:null!==W?p(W.texture):e.outputEncoding,map:!!o.map,mapEncoding:p(o.map),matcap:!!o.matcap,matcapEncoding:p(o.matcap),envMap:!!G,envMapMode:G&&G.mapping,envMapEncoding:p(G),envMapCubeUV:!!G&&(G.mapping===le||G.mapping===ce),lightMap:!!o.lightMap,lightMapEncoding:p(o.lightMap),aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,emissiveMapEncoding:p(o.emissiveMap),bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:o.normalMapType===sn,tangentSpaceNormalMap:o.normalMapType===gn,clearcoatMap:!!o.clearcoatMap,clearcoatRoughnessMap:!!o.clearcoatRoughnessMap,clearcoatNormalMap:!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,alphaMap:!!o.alphaMap,gradientMap:!!o.gradientMap,sheen:!!o.sheen,transmissionMap:!!o.transmissionMap,combine:o.combine,vertexTangents:o.normalMap&&o.vertexTangents,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&b.geometry&&b.geometry.attributes.color&&4===b.geometry.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmissionMap||!o.displacementMap),fog:!!f,useFog:o.fog,fogExp2:f&&f.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:s,skinning:o.skinning&&B>0,maxBones:B,useVertexTexture:l,morphTargets:o.morphTargets,morphNormals:o.morphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&d.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:q,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,alphaTest:o.alphaTest,doubleSided:o.side===A,flipSided:o.side===h,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||n.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<d.length;e++)n.push(t[d[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=u[e.type];let n;if(t){const e=Ur[t];n=Wr.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,o=a.length;e<o;e++){const t=a[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Sg(e,n,t,o),a.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function Vg(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function xg(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Xg(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Hg(e){const t=[];let n=0;const i=[],o=[],r={id:-1};function a(i,o,a,g,s,l){let c=t[n];const I=e.get(a);return void 0===c?(c={id:i.id,object:i,geometry:o,material:a,program:I.program||r,groupOrder:g,renderOrder:i.renderOrder,z:s,group:l},t[n]=c):(c.id=i.id,c.object=i,c.geometry=o,c.material=a,c.program=I.program||r,c.groupOrder=g,c.renderOrder=i.renderOrder,c.z=s,c.group=l),n++,c}return{opaque:i,transparent:o,init:function(){n=0,i.length=0,o.length=0},push:function(e,t,n,r,g,s){const l=a(e,t,n,r,g,s);(!0===n.transparent?o:i).push(l)},unshift:function(e,t,n,r,g,s){const l=a(e,t,n,r,g,s);(!0===n.transparent?o:i).unshift(l)},finish:function(){for(let e=n,i=t.length;e<i;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){i.length>1&&i.sort(e||xg),o.length>1&&o.sort(t||Xg)}}}function Yg(e){let t=new WeakMap;return{get:function(n,i){let o;return!1===t.has(n)?(o=new Hg(e),t.set(n,[o])):i>=t.get(n).length?(o=new Hg(e),t.get(n).push(o)):o=t.get(n)[i],o},dispose:function(){t=new WeakMap}}}function Kg(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new ai,color:new Ho};break;case"SpotLight":n={position:new ai,direction:new ai,color:new Ho,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ai,color:new Ho,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ai,skyColor:new Ho,groundColor:new Ho};break;case"RectAreaLight":n={color:new Ho,position:new ai,halfWidth:new ai,halfHeight:new ai}}return e[t.id]=n,n}}}let Ng=0;function Mg(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Fg(e,t){const n=new Kg,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let s=0;s<9;s++)o.probe.push(new ai);const r=new ai,a=new Mi,g=new Mi;return{setup:function(r){let a=0,g=0,s=0;for(let e=0;e<9;e++)o.probe[e].set(0,0,0);let l=0,c=0,I=0,C=0,u=0,d=0,h=0,A=0;r.sort(Mg);for(let e=0,t=r.length;e<t;e++){const t=r[e],p=t.color,m=t.intensity,b=t.distance,f=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=p.r*m,g+=p.g*m,s+=p.b*m;else if(t.isLightProbe)for(let e=0;e<9;e++)o.probe[e].addScaledVector(t.sh.coefficients[e],m);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,o.directionalShadow[l]=n,o.directionalShadowMap[l]=f,o.directionalShadowMatrix[l]=t.shadow.matrix,d++}o.directional[l]=e,l++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(p).multiplyScalar(m),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,o.spotShadow[I]=n,o.spotShadowMap[I]=f,o.spotShadowMatrix[I]=t.shadow.matrix,A++}o.spot[I]=e,I++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(p).multiplyScalar(m),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),o.rectArea[C]=e,C++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,o.pointShadow[c]=n,o.pointShadowMap[c]=f,o.pointShadowMatrix[c]=t.shadow.matrix,h++}o.point[c]=e,c++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(m),e.groundColor.copy(t.groundColor).multiplyScalar(m),o.hemi[u]=e,u++}}C>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(o.rectAreaLTC1=Tr.LTC_FLOAT_1,o.rectAreaLTC2=Tr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(o.rectAreaLTC1=Tr.LTC_HALF_1,o.rectAreaLTC2=Tr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=a,o.ambient[1]=g,o.ambient[2]=s;const p=o.hash;p.directionalLength===l&&p.pointLength===c&&p.spotLength===I&&p.rectAreaLength===C&&p.hemiLength===u&&p.numDirectionalShadows===d&&p.numPointShadows===h&&p.numSpotShadows===A||(o.directional.length=l,o.spot.length=I,o.rectArea.length=C,o.point.length=c,o.hemi.length=u,o.directionalShadow.length=d,o.directionalShadowMap.length=d,o.pointShadow.length=h,o.pointShadowMap.length=h,o.spotShadow.length=A,o.spotShadowMap.length=A,o.directionalShadowMatrix.length=d,o.pointShadowMatrix.length=h,o.spotShadowMatrix.length=A,p.directionalLength=l,p.pointLength=c,p.spotLength=I,p.rectAreaLength=C,p.hemiLength=u,p.numDirectionalShadows=d,p.numPointShadows=h,p.numSpotShadows=A,o.version=Ng++)},setupView:function(e,t){let n=0,i=0,s=0,l=0,c=0;const I=t.matrixWorldInverse;for(let C=0,u=e.length;C<u;C++){const t=e[C];if(t.isDirectionalLight){const e=o.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(I),n++}else if(t.isSpotLight){const e=o.spot[s];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(I),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(I),s++}else if(t.isRectAreaLight){const e=o.rectArea[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(I),g.identity(),a.copy(t.matrixWorld),a.premultiply(I),g.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(g),e.halfHeight.applyMatrix4(g),l++}else if(t.isPointLight){const e=o.point[i];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(I),i++}else if(t.isHemisphereLight){const e=o.hemi[c];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(I),e.direction.normalize(),c++}}},state:o}}function zg(e,t){const n=new Fg(e,t),i=[],o=[];return{init:function(){i.length=0,o.length=0},state:{lightsArray:i,shadowsArray:o,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){o.push(e)}}}function Lg(e,t){let n=new WeakMap;return{get:function(i,o=0){let r;return!1===n.has(i)?(r=new zg(e,t),n.set(i,[r])):o>=n.get(i).length?(r=new zg(e,t),n.get(i).push(r)):r=n.get(i)[o],r},dispose:function(){n=new WeakMap}}}class kg extends wo{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=rn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}kg.prototype.isMeshDepthMaterial=!0;class Eg extends wo{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ai,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Eg.prototype.isMeshDistanceMaterial=!0;function Tg(e,t,n){let i=new Fr;const o=new Qn,r=new Qn,a=new ni,g=[],s=[],l={},c=n.maxTextureSize,C={0:h,1:d,2:A},p=new Sr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Qn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const f=new or;f.setAttribute("position",new Mo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new Gr(f,p),G=this;function v(n,i){const o=t.update(y);p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,p,y,null),m.uniforms.shadow_pass.value=n.mapPass.texture,m.uniforms.resolution.value=n.mapSize,m.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,m,y,null)}function B(e,t,n){const i=e<<0|t<<1|n<<2;let o=g[i];return void 0===o&&(o=new kg({depthPacking:an,morphTargets:e,skinning:t}),g[i]=o),o}function Z(e,t,n){const i=e<<0|t<<1|n<<2;let o=s[i];return void 0===o&&(o=new Eg({morphTargets:e,skinning:t}),s[i]=o),o}function w(t,n,i,o,r,a,g){let s=null,c=B,I=t.customDepthMaterial;if(!0===o.isPointLight&&(c=Z,I=t.customDistanceMaterial),void 0===I){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let o=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?o=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t));s=c(e,o,!0===t.isInstancedMesh)}else s=I;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const e=s.uuid,t=i.uuid;let n=l[e];void 0===n&&(n={},l[e]=n);let o=n[t];void 0===o&&(o=s.clone(),n[t]=o),s=o}return s.visible=i.visible,s.wireframe=i.wireframe,s.side=g===u?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:C[i.side],s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.clipIntersection=i.clipIntersection,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,!0===o.isPointLight&&!0===s.isMeshDistanceMaterial&&(s.referencePosition.setFromMatrixPosition(o.matrixWorld),s.nearDistance=r,s.farDistance=a),s}function W(n,o,r,a,g){if(!1===n.visible)return;if(n.layers.test(o.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&g===u)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld);const i=t.update(n),o=n.material;if(Array.isArray(o)){const t=i.groups;for(let s=0,l=t.length;s<l;s++){const l=t[s],c=o[l.materialIndex];if(c&&c.visible){const t=w(n,i,c,a,r.near,r.far,g);e.renderBufferDirect(r,null,i,t,n,l)}}}else if(o.visible){const t=w(n,i,o,a,r.near,r.far,g);e.renderBufferDirect(r,null,i,t,n,null)}}const s=n.children;for(let e=0,t=s.length;e<t;e++)W(s[e],o,r,a,g)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=I,this.render=function(t,n,g){if(!1===G.enabled)return;if(!1===G.autoUpdate&&!1===G.needsUpdate)return;if(0===t.length)return;const s=e.getRenderTarget(),l=e.getActiveCubeFace(),I=e.getActiveMipmapLevel(),C=e.state;C.setBlending(b),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let d=0,h=t.length;d<h;d++){const s=t[d],l=s.shadow;if(void 0===l){console.warn("THREE.WebGLShadowMap:",s,"has no shadow.");continue}if(!1===l.autoUpdate&&!1===l.needsUpdate)continue;o.copy(l.mapSize);const I=l.getFrameExtents();if(o.multiply(I),r.copy(l.mapSize),(o.x>c||o.y>c)&&(o.x>c&&(r.x=Math.floor(c/I.x),o.x=r.x*I.x,l.mapSize.x=r.x),o.y>c&&(r.y=Math.floor(c/I.y),o.y=r.y*I.y,l.mapSize.y=r.y)),null===l.map&&!l.isPointLightShadow&&this.type===u){const e={minFilter:be,magFilter:be,format:Fe};l.map=new ii(o.x,o.y,e),l.map.texture.name=s.name+".shadowMap",l.mapPass=new ii(o.x,o.y,e),l.camera.updateProjectionMatrix()}if(null===l.map){const e={minFilter:de,magFilter:de,format:Fe};l.map=new ii(o.x,o.y,e),l.map.texture.name=s.name+".shadowMap",l.camera.updateProjectionMatrix()}e.setRenderTarget(l.map),e.clear();const h=l.getViewportCount();for(let e=0;e<h;e++){const t=l.getViewport(e);a.set(r.x*t.x,r.y*t.y,r.x*t.z,r.y*t.w),C.viewport(a),l.updateMatrices(s,e),i=l.getFrustum(),W(n,g,l.camera,s,this.type)}l.isPointLightShadow||this.type!==u||v(l,g),l.needsUpdate=!1}G.needsUpdate=!1,e.setRenderTarget(s,l,I)}}function Ug(e,t,n){const i=n.isWebGL2;const o=new function(){let t=!1;const n=new ni;let i=null;const o=new ni(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,r,a,g){!0===g&&(t*=a,i*=a,r*=a),n.set(t,i,r,a),!1===o.equals(n)&&(e.clearColor(t,i,r,a),o.copy(n))},reset:function(){t=!1,i=null,o.set(-1,0,0,0)}}},r=new function(){let t=!1,n=null,i=null,o=null;return{setTest:function(e){e?Ae(2929):pe(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case k:e.depthFunc(512);break;case E:e.depthFunc(519);break;case T:e.depthFunc(513);break;case U:e.depthFunc(515);break;case _:e.depthFunc(514);break;case J:e.depthFunc(518);break;case D:e.depthFunc(516);break;case P:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){o!==t&&(e.clearDepth(t),o=t)},reset:function(){t=!1,n=null,i=null,o=null}}},l=new function(){let t=!1,n=null,i=null,o=null,r=null,a=null,g=null,s=null,l=null;return{setTest:function(e){t||(e?Ae(2960):pe(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&o===n&&r===a||(e.stencilFunc(t,n,a),i=t,o=n,r=a)},setOp:function(t,n,i){a===t&&g===n&&s===i||(e.stencilOp(t,n,i),a=t,g=n,s=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,o=null,r=null,a=null,g=null,s=null,l=null}}};let c={},I=null,C={},u=null,d=!1,p=null,m=null,Q=null,O=null,j=null,q=null,$=null,ee=!1,te=null,ne=null,ie=null,oe=null,re=null;const ae=e.getParameter(35661);let ge=!1,se=0;const le=e.getParameter(7938);-1!==le.indexOf("WebGL")?(se=parseFloat(/^WebGL (\d)/.exec(le)[1]),ge=se>=1):-1!==le.indexOf("OpenGL ES")&&(se=parseFloat(/^OpenGL ES (\d)/.exec(le)[1]),ge=se>=2);let ce=null,Ie={};const Ce=new ni(0,0,e.canvas.width,e.canvas.height),ue=new ni(0,0,e.canvas.width,e.canvas.height);function de(t,n,i){const o=new Uint8Array(4),r=e.createTexture();e.bindTexture(t,r),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let a=0;a<i;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,o);return r}const he={};function Ae(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function pe(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}he[3553]=de(3553,3553,1),he[34067]=de(34067,34069,6),o.setClear(0,0,0,1),r.setClear(1),l.setClear(0),Ae(2929),r.setFunc(U),ye(!1),Ge(g),Ae(2884),fe(b);const me={[Z]:32774,[w]:32778,[W]:32779};if(i)me[S]=32775,me[R]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(me[S]=e.MIN_EXT,me[R]=e.MAX_EXT)}const be={[V]:0,[x]:1,[X]:768,[Y]:770,[L]:776,[F]:774,[N]:772,[H]:769,[K]:771,[z]:775,[M]:773};function fe(t,n,i,o,r,a,g,s){if(t!==b){if(!1===d&&(Ae(3042),d=!0),t===B)r=r||n,a=a||i,g=g||o,n===m&&r===j||(e.blendEquationSeparate(me[n],me[r]),m=n,j=r),i===Q&&o===O&&a===q&&g===$||(e.blendFuncSeparate(be[i],be[o],be[a],be[g]),Q=i,O=o,q=a,$=g),p=t,ee=null;else if(t!==p||s!==ee){if(m===Z&&j===Z||(e.blendEquation(32774),m=Z,j=Z),s)switch(t){case f:e.blendFuncSeparate(1,771,1,771);break;case y:e.blendFunc(1,1);break;case G:e.blendFuncSeparate(0,0,769,771);break;case v:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case f:e.blendFuncSeparate(770,771,1,771);break;case y:e.blendFunc(770,1);break;case G:e.blendFunc(0,769);break;case v:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Q=null,O=null,q=null,$=null,p=t,ee=s}}else!0===d&&(pe(3042),d=!1)}function ye(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Ge(t){t!==a?(Ae(2884),t!==ne&&(t===g?e.cullFace(1029):t===s?e.cullFace(1028):e.cullFace(1032))):pe(2884),ne=t}function ve(t,n,i){t?(Ae(32823),oe===n&&re===i||(e.polygonOffset(n,i),oe=n,re=i)):pe(32823)}function Be(t){void 0===t&&(t=33984+ae-1),ce!==t&&(e.activeTexture(t),ce=t)}return{buffers:{color:o,depth:r,stencil:l},enable:Ae,disable:pe,bindFramebuffer:function(t,n){null===n&&null!==I&&(n=I),C[t]!==n&&(e.bindFramebuffer(t,n),C[t]=n,i&&(36009===t&&(C[36160]=n),36160===t&&(C[36009]=n)))},bindXRFramebuffer:function(t){t!==I&&(e.bindFramebuffer(36160,t),I=t)},useProgram:function(t){return u!==t&&(e.useProgram(t),u=t,!0)},setBlending:fe,setMaterial:function(e,t){e.side===A?pe(2884):Ae(2884);let n=e.side===h;t&&(n=!n),ye(n),e.blending===f&&!1===e.transparent?fe(b):fe(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),o.setMask(e.colorWrite);const i=e.stencilWrite;l.setTest(i),i&&(l.setMask(e.stencilWriteMask),l.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),l.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),ve(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?Ae(32926):pe(32926)},setFlipSided:ye,setCullFace:Ge,setLineWidth:function(t){t!==ie&&(ge&&e.lineWidth(t),ie=t)},setPolygonOffset:ve,setScissorTest:function(e){e?Ae(3089):pe(3089)},activeTexture:Be,bindTexture:function(t,n){null===ce&&Be();let i=Ie[ce];void 0===i&&(i={type:void 0,texture:void 0},Ie[ce]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||he[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=Ie[ce];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===Ce.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),Ce.copy(t))},viewport:function(t){!1===ue.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ue.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},ce=null,Ie={},I=null,C={},u=null,d=!1,p=null,m=null,Q=null,O=null,j=null,q=null,$=null,ee=!1,te=null,ne=null,ie=null,oe=null,re=null,Ce.set(0,0,e.canvas.width,e.canvas.height),ue.set(0,0,e.canvas.width,e.canvas.height),o.reset(),r.reset(),l.reset()}}}function _g(e,t,n,i,o,r,a){const g=o.isWebGL2,s=o.maxTextures,l=o.maxCubemapSize,c=o.maxTextureSize,I=o.maxSamples,C=new WeakMap;let u,d=!1;try{d="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(F){}function h(e,t){return d?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function A(e,t,n,i){let o=1;if((e.width>i||e.height>i)&&(o=i/Math.max(e.width,e.height)),o<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Dn:Math.floor,r=i(o*e.width),a=i(o*e.height);void 0===u&&(u=h(r,a));const g=n?h(r,a):u;g.width=r,g.height=a;return g.getContext("2d").drawImage(e,0,0,r,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+a+")."),g}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function p(e){return _n(e.width)&&_n(e.height)}function m(e,t){return e.generateMipmaps&&t&&e.minFilter!==de&&e.minFilter!==be}function b(t,n,o,r){e.generateMipmap(t);i.get(n).__maxMipLevel=Math.log2(Math.max(o,r))}function f(n,i,o){if(!1===g)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let r=i;return 6403===i&&(5126===o&&(r=33326),5131===o&&(r=33325),5121===o&&(r=33321)),6407===i&&(5126===o&&(r=34837),5131===o&&(r=34843),5121===o&&(r=32849)),6408===i&&(5126===o&&(r=34836),5131===o&&(r=34842),5121===o&&(r=32856)),33325!==r&&33326!==r&&34842!==r&&34836!==r||t.get("EXT_color_buffer_float"),r}function y(e){return e===de||e===he||e===pe?9728:9729}function G(t){const n=t.target;n.removeEventListener("dispose",G),function(t){const n=i.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),i.remove(t)}(n),n.isVideoTexture&&C.delete(n),a.memory.textures--}function v(t){const n=t.target;n.removeEventListener("dispose",v),function(t){const n=t.texture,o=i.get(t),r=i.get(n);if(!t)return;void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)e.deleteFramebuffer(o.__webglFramebuffer[i]),o.__webglDepthbuffer&&e.deleteRenderbuffer(o.__webglDepthbuffer[i]);else e.deleteFramebuffer(o.__webglFramebuffer),o.__webglDepthbuffer&&e.deleteRenderbuffer(o.__webglDepthbuffer),o.__webglMultisampledFramebuffer&&e.deleteFramebuffer(o.__webglMultisampledFramebuffer),o.__webglColorRenderbuffer&&e.deleteRenderbuffer(o.__webglColorRenderbuffer),o.__webglDepthRenderbuffer&&e.deleteRenderbuffer(o.__webglDepthRenderbuffer);i.remove(n),i.remove(t)}(n),a.memory.textures--}let B=0;function Z(e,t){const o=i.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;C.get(e)!==t&&(C.set(e,t),e.update())}(e),e.version>0&&o.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void x(o,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,o.__webglTexture)}function w(t,o){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,i,o){if(6!==i.image.length)return;V(t,i),n.activeTexture(33984+o),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const a=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),s=i.image[0]&&i.image[0].isDataTexture,c=[];for(let e=0;e<6;e++)c[e]=a||s?s?i.image[e].image:i.image[e]:A(i.image[e],!1,!0,l);const I=c[0],C=p(I)||g,u=r.convert(i.format),d=r.convert(i.type),h=f(i.internalFormat,u,d);let y;if(R(34067,i,C),a){for(let e=0;e<6;e++){y=c[e].mipmaps;for(let t=0;t<y.length;t++){const o=y[t];i.format!==Fe&&i.format!==Me?null!==u?n.compressedTexImage2D(34069+e,t,h,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,h,o.width,o.height,0,u,d,o.data)}}t.__maxMipLevel=y.length-1}else{y=i.mipmaps;for(let e=0;e<6;e++)if(s){n.texImage2D(34069+e,0,h,c[e].width,c[e].height,0,u,d,c[e].data);for(let t=0;t<y.length;t++){const i=y[t].image[e].image;n.texImage2D(34069+e,t+1,h,i.width,i.height,0,u,d,i.data)}}else{n.texImage2D(34069+e,0,h,u,d,c[e]);for(let t=0;t<y.length;t++){const i=y[t];n.texImage2D(34069+e,t+1,h,u,d,i.image[e])}}t.__maxMipLevel=y.length}m(i,C)&&b(34067,i,I.width,I.height);t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(a,t,o):(n.activeTexture(33984+o),n.bindTexture(34067,a.__webglTexture))}const W={[Ie]:10497,[Ce]:33071,[ue]:33648},S={[de]:9728,[he]:9984,[pe]:9986,[be]:9729,[fe]:9985,[Ge]:9987};function R(n,r,a){if(a?(e.texParameteri(n,10242,W[r.wrapS]),e.texParameteri(n,10243,W[r.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,W[r.wrapR]),e.texParameteri(n,10240,S[r.magFilter]),e.texParameteri(n,10241,S[r.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),r.wrapS===Ce&&r.wrapT===Ce||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,y(r.magFilter)),e.texParameteri(n,10241,y(r.minFilter)),r.minFilter!==de&&r.minFilter!==be&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(r.type===Ve&&!1===t.has("OES_texture_float_linear"))return;if(!1===g&&r.type===xe&&!1===t.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||i.get(r).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,o.getMaxAnisotropy())),i.get(r).__currentAnisotropy=r.anisotropy)}}function V(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",G),t.__webglTexture=e.createTexture(),a.memory.textures++)}function x(t,i,o){let a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),V(t,i),n.activeTexture(33984+o),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const s=function(e){return!g&&(e.wrapS!==Ce||e.wrapT!==Ce||e.minFilter!==de&&e.minFilter!==be)}(i)&&!1===p(i.image),l=A(i.image,s,!1,c),I=p(l)||g,C=r.convert(i.format);let u,d=r.convert(i.type),h=f(i.internalFormat,C,d);R(a,i,I);const y=i.mipmaps;if(i.isDepthTexture)h=6402,g?h=i.type===Ve?36012:i.type===Re?33190:i.type===Ke?35056:33189:i.type===Ve&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Ee&&6402===h&&i.type!==We&&i.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=We,d=r.convert(i.type)),i.format===Te&&6402===h&&(h=34041,i.type!==Ke&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Ke,d=r.convert(i.type))),n.texImage2D(3553,0,h,l.width,l.height,0,C,d,null);else if(i.isDataTexture)if(y.length>0&&I){for(let e=0,t=y.length;e<t;e++)u=y[e],n.texImage2D(3553,e,h,u.width,u.height,0,C,d,u.data);i.generateMipmaps=!1,t.__maxMipLevel=y.length-1}else n.texImage2D(3553,0,h,l.width,l.height,0,C,d,l.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let e=0,t=y.length;e<t;e++)u=y[e],i.format!==Fe&&i.format!==Me?null!==C?n.compressedTexImage2D(3553,e,h,u.width,u.height,0,u.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,h,u.width,u.height,0,C,d,u.data);t.__maxMipLevel=y.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,h,l.width,l.height,l.depth,0,C,d,l.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,h,l.width,l.height,l.depth,0,C,d,l.data),t.__maxMipLevel=0;else if(y.length>0&&I){for(let e=0,t=y.length;e<t;e++)u=y[e],n.texImage2D(3553,e,h,C,d,u);i.generateMipmaps=!1,t.__maxMipLevel=y.length-1}else n.texImage2D(3553,0,h,C,d,l),t.__maxMipLevel=0;m(i,I)&&b(a,i,l.width,l.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function X(t,o,a,g){const s=o.texture,l=r.convert(s.format),c=r.convert(s.type),I=f(s.internalFormat,l,c);32879===g||35866===g?n.texImage3D(g,0,I,o.width,o.height,o.depth,0,l,c,null):n.texImage2D(g,0,I,o.width,o.height,0,l,c,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,g,i.get(s).__webglTexture,0),n.bindFramebuffer(36160,null)}function H(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let o=33189;if(i){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Ve?o=36012:t.type===Re&&(o=33190));const i=K(n);e.renderbufferStorageMultisample(36161,i,o,n.width,n.height)}else e.renderbufferStorage(36161,o,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const t=K(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=n.texture,o=r.convert(t.format),a=r.convert(t.type),g=f(t.internalFormat,o,a);if(i){const t=K(n);e.renderbufferStorageMultisample(36161,t,g,n.width,n.height)}else e.renderbufferStorage(36161,g,n.width,n.height)}e.bindRenderbuffer(36161,null)}function Y(t){const o=i.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,o){if(o&&o.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!o.depthTexture||!o.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(o.depthTexture).__webglTexture&&o.depthTexture.image.width===o.width&&o.depthTexture.image.height===o.height||(o.depthTexture.image.width=o.width,o.depthTexture.image.height=o.height,o.depthTexture.needsUpdate=!0),Z(o.depthTexture,0);const r=i.get(o.depthTexture).__webglTexture;if(o.depthTexture.format===Ee)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(o.depthTexture.format!==Te)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(o.__webglFramebuffer,t)}else if(r){o.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,o.__webglFramebuffer[i]),o.__webglDepthbuffer[i]=e.createRenderbuffer(),H(o.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,o.__webglFramebuffer),o.__webglDepthbuffer=e.createRenderbuffer(),H(o.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function K(e){return g&&e.isWebGLMultisampleRenderTarget?Math.min(I,e.samples):0}let N=!1,M=!1;this.allocateTextureUnit=function(){const e=B;return e>=s&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+s),B+=1,e},this.resetTextureUnits=function(){B=0},this.setTexture2D=Z,this.setTexture2DArray=function(e,t){const o=i.get(e);e.version>0&&o.__version!==e.version?x(o,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,o.__webglTexture))},this.setTexture3D=function(e,t){const o=i.get(e);e.version>0&&o.__version!==e.version?x(o,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,o.__webglTexture))},this.setTextureCube=w,this.setupRenderTarget=function(t){const o=t.texture,s=i.get(t),l=i.get(o);t.addEventListener("dispose",v),l.__webglTexture=e.createTexture(),l.__version=o.version,a.memory.textures++;const c=!0===t.isWebGLCubeRenderTarget,I=!0===t.isWebGLMultisampleRenderTarget,C=o.isDataTexture3D||o.isDataTexture2DArray,u=p(t)||g;if(!g||o.format!==Me||o.type!==Ve&&o.type!==xe||(o.format=Fe,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){s.__webglFramebuffer=[];for(let t=0;t<6;t++)s.__webglFramebuffer[t]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),I)if(g){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);const i=r.convert(o.format),a=r.convert(o.type),g=f(o.internalFormat,i,a),l=K(t);e.renderbufferStorageMultisample(36161,l,g,t.width,t.height),n.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),H(s.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),R(34067,o,u);for(let e=0;e<6;e++)X(s.__webglFramebuffer[e],t,36064,34069+e);m(o,u)&&b(34067,o,t.width,t.height),n.bindTexture(34067,null)}else{let e=3553;if(C)if(g){e=o.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(e,l.__webglTexture),R(e,o,u),X(s.__webglFramebuffer,t,36064,e),m(o,u)&&b(3553,o,t.width,t.height),n.bindTexture(3553,null)}t.depthBuffer&&Y(t)},this.updateRenderTargetMipmap=function(e){const t=e.texture;if(m(t,p(e)||g)){const o=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(t).__webglTexture;n.bindTexture(o,r),b(o,t,e.width,e.height),n.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(g){const o=t.width,r=t.height;let a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024);const g=i.get(t);n.bindFramebuffer(36008,g.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,g.__webglFramebuffer),e.blitFramebuffer(0,0,o,r,0,0,o,r,a,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,g.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),Z(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===M&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),M=!0),e=e.texture),w(e,t)}}function Jg(e,t,n){const i=n.isWebGL2;return{convert:function(e){let n;if(e===Be)return 5121;if(e===Xe)return 32819;if(e===He)return 32820;if(e===Ye)return 33635;if(e===Ze)return 5120;if(e===we)return 5122;if(e===We)return 5123;if(e===Se)return 5124;if(e===Re)return 5125;if(e===Ve)return 5126;if(e===xe)return i?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===Ne)return 6406;if(e===Me)return 6407;if(e===Fe)return 6408;if(e===ze)return 6409;if(e===Le)return 6410;if(e===Ee)return 6402;if(e===Te)return 34041;if(e===Ue)return 6403;if(e===_e)return 36244;if(e===Je)return 33319;if(e===De)return 33320;if(e===Pe)return 36248;if(e===Qe)return 36249;if(e===Oe||e===je||e===qe||e===$e){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===Oe)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===je)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===qe)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===$e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===nt||e===it){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===et)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===it)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===ot)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===rt||e===at)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(e===rt)return n.COMPRESSED_RGB8_ETC2;if(e===at)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===gt||e===st||e===lt||e===ct||e===It||e===Ct||e===ut||e===dt||e===ht||e===At||e===pt||e===mt||e===bt||e===ft||e===Gt||e===vt||e===Bt||e===Zt||e===wt||e===Wt||e===St||e===Rt||e===Vt||e===xt||e===Xt||e===Ht||e===Yt||e===Kt?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):e===yt?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===Ke?i?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Dg extends Vr{constructor(e=[]){super(),this.cameras=e}}Dg.prototype.isArrayCamera=!0;class Pg extends so{constructor(){super(),this.type="Group"}}Pg.prototype.isGroup=!0;const Qg={type:"move"};class Og{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Pg,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Pg,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ai,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ai),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Pg,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ai,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ai),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,o=null,r=null;const a=this._targetRay,g=this._grip,s=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Qg))),s&&e.hand){r=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===s.joints[r.jointName]){const e=new Pg;e.matrixAutoUpdate=!1,e.visible=!1,s.joints[r.jointName]=e,s.add(e)}const i=s.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const i=s.joints["index-finger-tip"],o=s.joints["thumb-tip"],a=i.position.distanceTo(o.position),g=.02,l=.005;s.inputState.pinching&&a>g+l?(s.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!s.inputState.pinching&&a<=g-l&&(s.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==g&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),null!==o&&(g.matrix.fromArray(o.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),o.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(o.linearVelocity)):g.hasLinearVelocity=!1,o.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(o.angularVelocity)):g.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==i),null!==g&&(g.visible=null!==o),null!==s&&(s.visible=null!==r),this}}class jg extends Nn{constructor(e,t){super();const n=this,i=e.state;let o=null,r=1,a=null,g="local-floor",s=null;const l=[],c=new Map,I=new Vr;I.layers.enable(1),I.viewport=new ni;const C=new Vr;C.layers.enable(2),C.viewport=new ni;const u=[I,C],d=new Dg;d.layers.enable(1),d.layers.enable(2);let h=null,A=null;function p(e){const t=c.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function m(){c.forEach((function(e,t){e.disconnect(t)})),c.clear(),h=null,A=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),B.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function b(e){const t=o.inputSources;for(let n=0;n<l.length;n++)c.set(t[n],l[n]);for(let n=0;n<e.removed.length;n++){const t=e.removed[n],i=c.get(t);i&&(i.dispatchEvent({type:"disconnected",data:t}),c.delete(t))}for(let n=0;n<e.added.length;n++){const t=e.added[n],i=c.get(t);i&&i.dispatchEvent({type:"connected",data:t})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=l[e];return void 0===t&&(t=new Og,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=l[e];return void 0===t&&(t=new Og,l[e]=t),t.getGripSpace()},this.getHand=function(e){let t=l[e];return void 0===t&&(t=new Og,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){g=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return o},this.setSession=async function(e){if(o=e,null!==o){o.addEventListener("select",p),o.addEventListener("selectstart",p),o.addEventListener("selectend",p),o.addEventListener("squeeze",p),o.addEventListener("squeezestart",p),o.addEventListener("squeezeend",p),o.addEventListener("end",m),o.addEventListener("inputsourceschange",b);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r},s=new XRWebGLLayer(o,t,i);o.updateRenderState({baseLayer:s}),a=await o.requestReferenceSpace(g),B.setContext(o),B.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const f=new ai,y=new ai;function G(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){d.near=C.near=I.near=e.near,d.far=C.far=I.far=e.far,h===d.near&&A===d.far||(o.updateRenderState({depthNear:d.near,depthFar:d.far}),h=d.near,A=d.far);const t=e.parent,n=d.cameras;G(d,t);for(let o=0;o<n.length;o++)G(n[o],t);e.matrixWorld.copy(d.matrixWorld),e.matrix.copy(d.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const i=e.children;for(let o=0,r=i.length;o<r;o++)i[o].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){f.setFromMatrixPosition(t.matrixWorld),y.setFromMatrixPosition(n.matrixWorld);const i=f.distanceTo(y),o=t.projectionMatrix.elements,r=n.projectionMatrix.elements,a=o[14]/(o[10]-1),g=o[14]/(o[10]+1),s=(o[9]+1)/o[5],l=(o[9]-1)/o[5],c=(o[8]-1)/o[0],I=(r[8]+1)/r[0],C=a*c,u=a*I,d=i/(-c+I),h=d*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(h),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const A=a+d,p=g+d,m=C-h,b=u+(i-h),G=s*g/p*A,v=l*g/p*A;e.projectionMatrix.makePerspective(m,b,G,v,A,p)}(d,I,C):d.projectionMatrix.copy(I.projectionMatrix),d};let v=null;const B=new zr;B.setAnimationLoop((function(e,t){if(s=t.getViewerPose(a),null!==s){const e=s.views,t=o.renderState.baseLayer;i.bindXRFramebuffer(t.framebuffer);let n=!1;e.length!==d.cameras.length&&(d.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const o=e[i],r=t.getViewport(o),a=u[i];a.matrix.fromArray(o.transform.matrix),a.projectionMatrix.fromArray(o.projectionMatrix),a.viewport.set(r.x,r.y,r.width,r.height),0===i&&d.matrix.copy(a.matrix),!0===n&&d.cameras.push(a)}}const n=o.inputSources;for(let i=0;i<l.length;i++){const e=l[i],o=n[i];e.update(o,t,a)}v&&v(e,t)})),this.setAnimationLoop=function(e){v=e},this.dispose=function(){}}}function qg(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const i=e.get(n).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const o=e.get(i).__maxMipLevel;void 0!==o&&(t.maxMipLevel.value=o)}let o,r;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.roughnessMap?o=n.roughnessMap:n.metalnessMap?o=n.metalnessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap?o=n.emissiveMap:n.clearcoatMap?o=n.clearcoatMap:n.clearcoatNormalMap?o=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(o=n.clearcoatRoughnessMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uvTransform.value.copy(o.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===h&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===h&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,o,r){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===h&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,i):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let o;t.map?o=t.map:t.alphaMap&&(o=t.alphaMap);void 0!==o&&(!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uvTransform.value.copy(o.matrix))}(e,i,o,r):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function $g(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,o=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,g=void 0===e.premultipliedAlpha||e.premultipliedAlpha,s=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let I=null,C=null;const u=[],d=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ot,this.physicallyCorrectLights=!1,this.toneMapping=q,this.toneMappingExposure=1;const h=this;let A=!1,p=0,m=0,b=null,f=-1,y=null;const G=new ni,v=new ni;let B=null,Z=t.width,w=t.height,W=1,S=null,R=null;const V=new ni(0,0,Z,w),x=new ni(0,0,Z,w);let X=!1;const H=new Fr;let Y=!1,K=!1;const N=new Mi,M=new ai,F={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===b?W:1}let L,k,E,T,U,_,J,D,P,Q,O,j,$,ee,te,ne,ie,oe,re,ae,ge,se,le=n;function ce(e,n){for(let i=0;i<e.length;i++){const o=e[i],r=t.getContext(o,n);if(null!==r)return r}return null}try{const e={alpha:i,depth:o,stencil:r,antialias:a,premultipliedAlpha:g,preserveDrawingBuffer:s,powerPreference:l,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",ue,!1),t.addEventListener("webglcontextrestored",de,!1),null===le){const t=["webgl2","webgl","experimental-webgl"];if(!0===h.isWebGL1Renderer&&t.shift(),le=ce(t,e),null===le)throw ce(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===le.getShaderPrecisionFormat&&(le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(We){throw console.error("THREE.WebGLRenderer: "+We.message),We}function Ie(){L=new jr(le),k=new Pr(le,L,e),L.init(k),ge=new Jg(le,L,k),E=new Ug(le,L,k),T=new ea(le),U=new Vg,_=new _g(le,L,E,U,k,ge,T),J=new Or(h),D=new Lr(le,k),se=new Jr(le,L,D,k),P=new qr(le,D,T,se),Q=new oa(le,P,D,T),oe=new ia(le),te=new Qr(U),O=new Rg(h,J,L,k,se,te),j=new qg(U),$=new Yg(U),ee=new Lg(L,k),ie=new _r(h,J,E,Q,g),ne=new Tg(h,Q,k),re=new Dr(le,L,T,k),ae=new $r(le,L,T,k),T.programs=O.programs,h.capabilities=k,h.extensions=L,h.properties=U,h.renderLists=$,h.shadowMap=ne,h.state=E,h.info=T}Ie();const Ce=new jg(h,le);function ue(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function de(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const e=T.autoReset,t=ne.enabled,n=ne.autoUpdate,i=ne.needsUpdate,o=ne.type;Ie(),T.autoReset=e,ne.enabled=t,ne.autoUpdate=n,ne.needsUpdate=i,ne.type=o}function he(e){const t=e.target;t.removeEventListener("dispose",he),function(e){(function(e){const t=U.get(e).programs;void 0!==t&&t.forEach((function(e){O.releaseProgram(e)}))})(e),U.remove(e)}(t)}this.xr=Ce,this.getContext=function(){return le},this.getContextAttributes=function(){return le.getContextAttributes()},this.forceContextLoss=function(){const e=L.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=L.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(e){void 0!==e&&(W=e,this.setSize(Z,w,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Qn),e.set(Z,w)},this.setSize=function(e,n,i){Ce.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Z=e,w=n,t.width=Math.floor(e*W),t.height=Math.floor(n*W),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Qn),e.set(Z*W,w*W).floor()},this.setDrawingBufferSize=function(e,n,i){Z=e,w=n,W=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new ni),e.copy(G)},this.getViewport=function(e){return e.copy(V)},this.setViewport=function(e,t,n,i){e.isVector4?V.set(e.x,e.y,e.z,e.w):V.set(e,t,n,i),E.viewport(G.copy(V).multiplyScalar(W).floor())},this.getScissor=function(e){return e.copy(x)},this.setScissor=function(e,t,n,i){e.isVector4?x.set(e.x,e.y,e.z,e.w):x.set(e,t,n,i),E.scissor(v.copy(x).multiplyScalar(W).floor())},this.getScissorTest=function(){return X},this.setScissorTest=function(e){E.setScissorTest(X=e)},this.setOpaqueSort=function(e){S=e},this.setTransparentSort=function(e){R=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Ho),e.copy(ie.getClearColor())},this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),le.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ue,!1),t.removeEventListener("webglcontextrestored",de,!1),$.dispose(),ee.dispose(),U.dispose(),J.dispose(),Q.dispose(),se.dispose(),Ce.dispose(),Ce.removeEventListener("sessionstart",pe),Ce.removeEventListener("sessionend",me),be.stop()},this.renderBufferImmediate=function(e,t){se.initAttributes();const n=U.get(e);e.hasPositions&&!n.position&&(n.position=le.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=le.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=le.createBuffer()),e.hasColors&&!n.color&&(n.color=le.createBuffer());const i=t.getAttributes();e.hasPositions&&(le.bindBuffer(34962,n.position),le.bufferData(34962,e.positionArray,35048),se.enableAttribute(i.position),le.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(le.bindBuffer(34962,n.normal),le.bufferData(34962,e.normalArray,35048),se.enableAttribute(i.normal),le.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(le.bindBuffer(34962,n.uv),le.bufferData(34962,e.uvArray,35048),se.enableAttribute(i.uv),le.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(le.bindBuffer(34962,n.color),le.bufferData(34962,e.colorArray,35048),se.enableAttribute(i.color),le.vertexAttribPointer(i.color,3,5126,!1,0,0)),se.disableUnusedAttributes(),le.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,o,r){null===t&&(t=F);const a=o.isMesh&&o.matrixWorld.determinant()<0,g=we(e,t,i,o);E.setMaterial(i,a);let s=n.index;const l=n.attributes.position;if(null===s){if(void 0===l||0===l.count)return}else if(0===s.count)return;let c,I=1;!0===i.wireframe&&(s=P.getWireframeAttribute(n),I=2),(i.morphTargets||i.morphNormals)&&oe.update(o,n,i,g),se.setup(o,i,g,n,s);let C=re;null!==s&&(c=D.get(s),C=ae,C.setIndex(c));const u=null!==s?s.count:l.count,d=n.drawRange.start*I,h=n.drawRange.count*I,A=null!==r?r.start*I:0,p=null!==r?r.count*I:1/0,m=Math.max(d,A),b=Math.min(u,d+h,A+p)-1,f=Math.max(0,b-m+1);if(0!==f){if(o.isMesh)!0===i.wireframe?(E.setLineWidth(i.wireframeLinewidth*z()),C.setMode(1)):C.setMode(4);else if(o.isLine){let e=i.linewidth;void 0===e&&(e=1),E.setLineWidth(e*z()),o.isLineSegments?C.setMode(1):o.isLineLoop?C.setMode(2):C.setMode(3)}else o.isPoints?C.setMode(0):o.isSprite&&C.setMode(4);if(o.isInstancedMesh)C.renderInstances(m,f,o.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);C.renderInstances(m,f,e)}else C.render(m,f)}},this.compile=function(e,t){C=ee.get(e),C.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(C.pushLight(e),e.castShadow&&C.pushShadow(e))})),C.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++){ve(n[i],e,t)}else ve(n,e,t)}))};let Ae=null;function pe(){be.stop()}function me(){be.start()}const be=new zr;function fe(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)C.pushLight(e),e.castShadow&&C.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||H.intersectsSprite(e)){i&&M.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);const t=Q.update(e),o=e.material;o.visible&&I.push(e,t,o,n,M.z,null)}}else if(e.isImmediateRenderObject)i&&M.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N),I.push(e,null,e.material,n,M.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==T.render.frame&&(e.skeleton.update(),e.skeleton.frame=T.render.frame),!e.frustumCulled||H.intersectsObject(e))){i&&M.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);const t=Q.update(e),o=e.material;if(Array.isArray(o)){const i=t.groups;for(let r=0,a=i.length;r<a;r++){const a=i[r],g=o[a.materialIndex];g&&g.visible&&I.push(e,t,g,n,M.z,a)}}else o.visible&&I.push(e,t,o,n,M.z,null)}const o=e.children;for(let r=0,a=o.length;r<a;r++)fe(o[r],t,n,i)}function ye(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let o=0,r=e.length;o<r;o++){const r=e[o],a=r.object,g=r.geometry,s=null===i?r.material:i,l=r.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,i=e.length;n<i;n++){const i=e[n];a.layers.test(i.layers)&&(E.viewport(G.copy(i.viewport)),C.setupLightsView(i),Ge(a,t,i,g,s,l))}}else Ge(a,t,n,g,s,l)}}function Ge(e,t,n,i,o,r){if(e.onBeforeRender(h,t,n,i,o,r),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const i=we(n,t,o,e);E.setMaterial(o),se.reset(),function(e,t){e.render((function(e){h.renderBufferImmediate(e,t)}))}(e,i)}else h.renderBufferDirect(n,t,i,o,e,r);e.onAfterRender(h,t,n,i,o,r)}function ve(e,t,n){!0!==t.isScene&&(t=F);const i=U.get(e),o=C.state.lights,r=C.state.shadowsArray,a=o.state.version,g=O.getParameters(e,o.state,r,t,n),s=O.getProgramCacheKey(g);let l=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=J.get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",he),l=new Map,i.programs=l);let c=l.get(s);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===a)return Ze(e,g),c}else g.uniforms=O.getUniforms(e),e.onBuild(g,h),e.onBeforeCompile(g,h),c=O.acquireProgram(g,s),l.set(s,c),i.uniforms=g.uniforms;const I=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(I.clippingPlanes=te.uniform),Ze(e,g),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(I.ambientLightColor.value=o.state.ambient,I.lightProbe.value=o.state.probe,I.directionalLights.value=o.state.directional,I.directionalLightShadows.value=o.state.directionalShadow,I.spotLights.value=o.state.spot,I.spotLightShadows.value=o.state.spotShadow,I.rectAreaLights.value=o.state.rectArea,I.ltc_1.value=o.state.rectAreaLTC1,I.ltc_2.value=o.state.rectAreaLTC2,I.pointLights.value=o.state.point,I.pointLightShadows.value=o.state.pointShadow,I.hemisphereLights.value=o.state.hemi,I.directionalShadowMap.value=o.state.directionalShadowMap,I.directionalShadowMatrix.value=o.state.directionalShadowMatrix,I.spotShadowMap.value=o.state.spotShadowMap,I.spotShadowMatrix.value=o.state.spotShadowMatrix,I.pointShadowMap.value=o.state.pointShadowMap,I.pointShadowMatrix.value=o.state.pointShadowMatrix);const u=c.getUniforms(),d=sg.seqWithValue(u.seq,I);return i.currentProgram=c,i.uniformsList=d,c}function Ze(e,t){const n=U.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function we(e,t,n,i){!0!==t.isScene&&(t=F),_.resetTextureUnits();const o=t.fog,r=n.isMeshStandardMaterial?t.environment:null,a=null===b?h.outputEncoding:b.texture.encoding,g=J.get(n.envMap||r),s=!0===n.vertexColors&&i.geometry&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,l=U.get(n),c=C.state.lights;if(!0===Y&&(!0===K||e!==y)){const t=e===y&&n.id===f;te.setState(n,e,t)}let I=!1;n.version===l.__version?l.needsLights&&l.lightsStateVersion!==c.state.version||l.outputEncoding!==a||i.isInstancedMesh&&!1===l.instancing?I=!0:i.isInstancedMesh||!0!==l.instancing?l.envMap!==g||n.fog&&l.fog!==o?I=!0:void 0===l.numClippingPlanes||l.numClippingPlanes===te.numPlanes&&l.numIntersection===te.numIntersection?l.vertexAlphas!==s&&(I=!0):I=!0:I=!0:(I=!0,l.__version=n.version);let u=l.currentProgram;!0===I&&(u=ve(n,t,i));let d=!1,A=!1,p=!1;const m=u.getUniforms(),G=l.uniforms;if(E.useProgram(u.program)&&(d=!0,A=!0,p=!0),n.id!==f&&(f=n.id,A=!0),d||y!==e){if(m.setValue(le,"projectionMatrix",e.projectionMatrix),k.logarithmicDepthBuffer&&m.setValue(le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),y!==e&&(y=e,A=!0,p=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=m.map.cameraPosition;void 0!==t&&t.setValue(le,M.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&m.setValue(le,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&m.setValue(le,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){m.setOptional(le,i,"bindMatrix"),m.setOptional(le,i,"bindMatrixInverse");const e=i.skeleton;if(e){const t=e.bones;if(k.floatVertexTextures){if(null===e.boneTexture){let n=Math.sqrt(4*t.length);n=Jn(n),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(e.boneMatrices);const o=new Kr(i,n,n,Fe,Ve);e.boneMatrices=i,e.boneTexture=o,e.boneTextureSize=n}m.setValue(le,"boneTexture",e.boneTexture,_),m.setValue(le,"boneTextureSize",e.boneTextureSize)}else m.setOptional(le,e,"boneMatrices")}}var v,B;return(A||l.receiveShadow!==i.receiveShadow)&&(l.receiveShadow=i.receiveShadow,m.setValue(le,"receiveShadow",i.receiveShadow)),A&&(m.setValue(le,"toneMappingExposure",h.toneMappingExposure),l.needsLights&&(B=p,(v=G).ambientLightColor.needsUpdate=B,v.lightProbe.needsUpdate=B,v.directionalLights.needsUpdate=B,v.directionalLightShadows.needsUpdate=B,v.pointLights.needsUpdate=B,v.pointLightShadows.needsUpdate=B,v.spotLights.needsUpdate=B,v.spotLightShadows.needsUpdate=B,v.rectAreaLights.needsUpdate=B,v.hemisphereLights.needsUpdate=B),o&&n.fog&&j.refreshFogUniforms(G,o),j.refreshMaterialUniforms(G,n,W,w),sg.upload(le,l.uniformsList,G,_)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(sg.upload(le,l.uniformsList,G,_),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&m.setValue(le,"center",i.center),m.setValue(le,"modelViewMatrix",i.modelViewMatrix),m.setValue(le,"normalMatrix",i.normalMatrix),m.setValue(le,"modelMatrix",i.matrixWorld),u}be.setAnimationLoop((function(e){Ae&&Ae(e)})),"undefined"!=typeof window&&be.setContext(window),this.setAnimationLoop=function(e){Ae=e,Ce.setAnimationLoop(e),null===e?be.stop():be.start()},Ce.addEventListener("sessionstart",pe),Ce.addEventListener("sessionend",me),this.render=function(e,t){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===A)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===Ce.enabled&&!0===Ce.isPresenting&&(t=Ce.getCamera(t)),!0===e.isScene&&e.onBeforeRender(h,e,t,n||b),C=ee.get(e,d.length),C.init(),d.push(C),N.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),H.setFromProjectionMatrix(N),K=this.localClippingEnabled,Y=te.init(this.clippingPlanes,K,t),I=$.get(e,u.length),I.init(),u.push(I),fe(e,t,0,h.sortObjects),I.finish(),!0===h.sortObjects&&I.sort(S,R),!0===Y&&te.beginShadows();const o=C.state.shadowsArray;ne.render(o,e,t),C.setupLights(),C.setupLightsView(t),!0===Y&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ie.render(I,e,t,i);const r=I.opaque,a=I.transparent;r.length>0&&ye(r,e,t),a.length>0&&ye(a,e,t),null!==b&&(_.updateRenderTargetMipmap(b),_.updateMultisampleRenderTarget(b)),!0===e.isScene&&e.onAfterRender(h,e,t),E.buffers.depth.setTest(!0),E.buffers.depth.setMask(!0),E.buffers.color.setMask(!0),E.setPolygonOffset(!1),se.resetDefaultState(),f=-1,y=null,d.pop(),C=d.length>0?d[d.length-1]:null,u.pop(),I=u.length>0?u[u.length-1]:null},this.getActiveCubeFace=function(){return p},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e,t=0,n=0){b=e,p=t,m=n,e&&void 0===U.get(e).__webglFramebuffer&&_.setupRenderTarget(e);let i=null,o=!1,r=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(r=!0);const a=U.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=a[t],o=!0):i=e.isWebGLMultisampleRenderTarget?U.get(e).__webglMultisampledFramebuffer:a,G.copy(e.viewport),v.copy(e.scissor),B=e.scissorTest}else G.copy(V).multiplyScalar(W).floor(),v.copy(x).multiplyScalar(W).floor(),B=X;if(E.bindFramebuffer(36160,i),E.viewport(G),E.scissor(v),E.setScissorTest(B),o){const i=U.get(e.texture);le.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(r){const i=U.get(e.texture),o=t||0;le.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,o)}},this.readRenderTargetPixels=function(e,t,n,i,o,r,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let g=U.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(g=g[a]),g){E.bindFramebuffer(36160,g);try{const a=e.texture,g=a.format,s=a.type;if(g!==Fe&&ge.convert(g)!==le.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=s===xe&&(L.has("EXT_color_buffer_half_float")||k.isWebGL2&&L.has("EXT_color_buffer_float"));if(!(s===Be||ge.convert(s)===le.getParameter(35738)||s===Ve&&(k.isWebGL2||L.has("OES_texture_float")||L.has("WEBGL_color_buffer_float"))||l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===le.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-o&&le.readPixels(t,n,i,o,ge.convert(g),ge.convert(s),r):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==b?U.get(b).__webglFramebuffer:null;E.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),o=Math.floor(t.image.width*i),r=Math.floor(t.image.height*i),a=ge.convert(t.format);_.setTexture2D(t,0),le.copyTexImage2D(3553,n,a,e.x,e.y,o,r,0),E.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const o=t.image.width,r=t.image.height,a=ge.convert(n.format),g=ge.convert(n.type);_.setTexture2D(n,0),le.pixelStorei(37440,n.flipY),le.pixelStorei(37441,n.premultiplyAlpha),le.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?le.texSubImage2D(3553,i,e.x,e.y,o,r,a,g,t.image.data):t.isCompressedTexture?le.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):le.texSubImage2D(3553,i,e.x,e.y,a,g,t.image),0===i&&n.generateMipmaps&&le.generateMipmap(3553),E.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,o=0){if(h.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:r,height:a,data:g}=n.image,s=ge.convert(i.format),l=ge.convert(i.type);let c;if(i.isDataTexture3D)_.setTexture3D(i,0),c=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");_.setTexture2DArray(i,0),c=35866}le.pixelStorei(37440,i.flipY),le.pixelStorei(37441,i.premultiplyAlpha),le.pixelStorei(3317,i.unpackAlignment);const I=le.getParameter(3314),C=le.getParameter(32878),u=le.getParameter(3316),d=le.getParameter(3315),A=le.getParameter(32877);le.pixelStorei(3314,r),le.pixelStorei(32878,a),le.pixelStorei(3316,e.min.x),le.pixelStorei(3315,e.min.y),le.pixelStorei(32877,e.min.z),le.texSubImage3D(c,o,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,s,l,g),le.pixelStorei(3314,I),le.pixelStorei(32878,C),le.pixelStorei(3316,u),le.pixelStorei(3315,d),le.pixelStorei(32877,A),0===o&&i.generateMipmaps&&le.generateMipmap(c),E.unbindTexture()},this.initTexture=function(e){_.setTexture2D(e,0),E.unbindTexture()},this.resetState=function(){p=0,m=0,b=null,E.reset(),se.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class es extends $g{}es.prototype.isWebGL1Renderer=!0;class ts{constructor(e,t=25e-5){this.name="",this.color=new Ho(e),this.density=t}clone(){return new ts(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}ts.prototype.isFogExp2=!0;class ns{constructor(e,t=1,n=1e3){this.name="",this.color=new Ho(e),this.near=t,this.far=n}clone(){return new ns(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}ns.prototype.isFog=!0;class is extends so{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}is.prototype.isScene=!0;class os{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Zn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=kn(),this.onUploadCallback=function(){}}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,o=this.stride;i<o;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new os(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=kn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}os.prototype.isInterleavedBuffer=!0;const rs=new ai;class as{constructor(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)rs.x=this.getX(t),rs.y=this.getY(t),rs.z=this.getZ(t),rs.applyMatrix4(e),this.setXYZ(t,rs.x,rs.y,rs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)rs.x=this.getX(t),rs.y=this.getY(t),rs.z=this.getZ(t),rs.applyNormalMatrix(e),this.setXYZ(t,rs.x,rs.y,rs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)rs.x=this.getX(t),rs.y=this.getY(t),rs.z=this.getZ(t),rs.transformDirection(e),this.setXYZ(t,rs.x,rs.y,rs.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=o,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Mo(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new as(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}as.prototype.isInterleavedBufferAttribute=!0;class gs extends wo{constructor(e){super(),this.type="SpriteMaterial",this.color=new Ho(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let ss;gs.prototype.isSpriteMaterial=!0;const ls=new ai,cs=new ai,Is=new ai,Cs=new Qn,us=new Qn,ds=new Mi,hs=new ai,As=new ai,ps=new ai,ms=new Qn,bs=new Qn,fs=new Qn;class ys extends so{constructor(e){if(super(),this.type="Sprite",void 0===ss){ss=new or;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new os(e,5);ss.setIndex([0,1,2,0,2,3]),ss.setAttribute("position",new as(t,3,0,!1)),ss.setAttribute("uv",new as(t,2,3,!1))}this.geometry=ss,this.material=void 0!==e?e:new gs,this.center=new Qn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),cs.setFromMatrixScale(this.matrixWorld),ds.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Is.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&cs.multiplyScalar(-Is.z);const n=this.material.rotation;let i,o;0!==n&&(o=Math.cos(n),i=Math.sin(n));const r=this.center;Gs(hs.set(-.5,-.5,0),Is,r,cs,i,o),Gs(As.set(.5,-.5,0),Is,r,cs,i,o),Gs(ps.set(.5,.5,0),Is,r,cs,i,o),ms.set(0,0),bs.set(1,0),fs.set(1,1);let a=e.ray.intersectTriangle(hs,As,ps,!1,ls);if(null===a&&(Gs(As.set(-.5,.5,0),Is,r,cs,i,o),bs.set(0,1),a=e.ray.intersectTriangle(hs,ps,As,!1,ls),null===a))return;const g=e.ray.origin.distanceTo(ls);g<e.near||g>e.far||t.push({distance:g,point:ls.clone(),uv:Bo.getUV(ls,hs,As,ps,ms,bs,fs,new Qn),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Gs(e,t,n,i,o,r){Cs.subVectors(e,n).addScalar(.5).multiply(i),void 0!==o?(us.x=r*Cs.x-o*Cs.y,us.y=o*Cs.x+r*Cs.y):us.copy(Cs),e.copy(t),e.x+=us.x,e.y+=us.y,e.applyMatrix4(ds)}ys.prototype.isSprite=!0;const vs=new ai,Bs=new ai;class Zs extends so{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){vs.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(vs);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){vs.setFromMatrixPosition(e.matrixWorld),Bs.setFromMatrixPosition(this.matrixWorld);const n=vs.distanceTo(Bs)/e.zoom;let i,o;for(t[0].object.visible=!0,i=1,o=t.length;i<o&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<o;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,o=n.length;i<o;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance})}return t}}const ws=new ai,Ws=new ni,Ss=new ni,Rs=new ai,Vs=new Mi;class xs extends Gr{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Mi,this.bindMatrixInverse=new Mi}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ni,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;Ws.fromBufferAttribute(i.attributes.skinIndex,e),Ss.fromBufferAttribute(i.attributes.skinWeight,e),ws.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const e=Ss.getComponent(o);if(0!==e){const i=Ws.getComponent(o);Vs.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Rs.copy(ws).applyMatrix4(Vs),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}xs.prototype.isSkinnedMesh=!0;class Xs extends so{constructor(){super(),this.type="Bone"}}Xs.prototype.isBone=!0;const Hs=new Mi,Ys=new Mi;class Ks{constructor(e=[],t=[]){this.uuid=kn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Mi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Mi;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let o=0,r=e.length;o<r;o++){const i=e[o]?e[o].matrixWorld:Ys;Hs.multiplyMatrices(i,t[o]),Hs.toArray(n,16*o)}null!==i&&(i.needsUpdate=!0)}clone(){return new Ks(this.bones,this.boneInverses)}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let o=t[i];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),o=new Xs),this.bones.push(o),this.boneInverses.push((new Mi).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,o=t.length;i<o;i++){const o=t[i];e.bones.push(o.uuid);const r=n[i];e.boneInverses.push(r.toArray())}return e}}const Ns=new Mi,Ms=new Mi,Fs=[],zs=new Gr;class Ls extends Gr{constructor(e,t,n){super(e,t),this.instanceMatrix=new Mo(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(zs.geometry=this.geometry,zs.material=this.material,void 0!==zs.material)for(let o=0;o<i;o++){this.getMatrixAt(o,Ns),Ms.multiplyMatrices(n,Ns),zs.matrixWorld=Ms,zs.raycast(e,Fs);for(let e=0,n=Fs.length;e<n;e++){const n=Fs[e];n.instanceId=o,n.object=this,t.push(n)}Fs.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Mo(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Ls.prototype.isInstancedMesh=!0;class ks extends wo{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ho(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}ks.prototype.isLineBasicMaterial=!0;const Es=new ai,Ts=new ai,Us=new Mi,_s=new Ni,Js=new Si;class Ds extends so{constructor(e=new or,t=new ks){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Es.fromBufferAttribute(t,e-1),Ts.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Es.distanceTo(Ts);e.setAttribute("lineDistance",new Jo(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,o=e.params.Line.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Js.copy(n.boundingSphere),Js.applyMatrix4(i),Js.radius+=o,!1===e.ray.intersectsSphere(Js))return;Us.copy(i).invert(),_s.copy(e.ray).applyMatrix4(Us);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),g=a*a,s=new ai,l=new ai,c=new ai,I=new ai,C=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i){for(let n=Math.max(0,r.start),a=Math.min(i.count,r.start+r.count)-1;n<a;n+=C){const r=i.getX(n),a=i.getX(n+1);s.fromBufferAttribute(o,r),l.fromBufferAttribute(o,a);if(_s.distanceSqToSegment(s,l,I,c)>g)continue;I.applyMatrix4(this.matrixWorld);const C=e.ray.origin.distanceTo(I);C<e.near||C>e.far||t.push({distance:C,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,r.start),i=Math.min(o.count,r.start+r.count)-1;n<i;n+=C){s.fromBufferAttribute(o,n),l.fromBufferAttribute(o,n+1);if(_s.distanceSqToSegment(s,l,I,c)>g)continue;I.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(I);i<e.near||i>e.far||t.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ds.prototype.isLine=!0;const Ps=new ai,Qs=new ai;class Os extends Ds{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Ps.fromBufferAttribute(t,e),Qs.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Ps.distanceTo(Qs);e.setAttribute("lineDistance",new Jo(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Os.prototype.isLineSegments=!0;class js extends Ds{constructor(e,t){super(e,t),this.type="LineLoop"}}js.prototype.isLineLoop=!0;class qs extends wo{constructor(e){super(),this.type="PointsMaterial",this.color=new Ho(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}qs.prototype.isPointsMaterial=!0;const $s=new Mi,el=new Ni,tl=new Si,nl=new ai;class il extends so{constructor(e=new or,t=new qs){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,o=e.params.Points.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),tl.copy(n.boundingSphere),tl.applyMatrix4(i),tl.radius+=o,!1===e.ray.intersectsSphere(tl))return;$s.copy(i).invert(),el.copy(e.ray).applyMatrix4($s);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),g=a*a;if(n.isBufferGeometry){const o=n.index,a=n.attributes.position;if(null!==o){for(let n=Math.max(0,r.start),s=Math.min(o.count,r.start+r.count);n<s;n++){const r=o.getX(n);nl.fromBufferAttribute(a,r),ol(nl,r,g,i,e,t,this)}}else{for(let n=Math.max(0,r.start),o=Math.min(a.count,r.start+r.count);n<o;n++)nl.fromBufferAttribute(a,n),ol(nl,n,g,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ol(e,t,n,i,o,r,a){const g=el.distanceSqToPoint(e);if(g<n){const n=new ai;el.closestPointToPoint(e,n),n.applyMatrix4(i);const s=o.ray.origin.distanceTo(n);if(s<o.near||s>o.far)return;r.push({distance:s,distanceToRay:Math.sqrt(g),point:n,index:t,face:null,object:a})}}il.prototype.isPoints=!0;class rl extends ei{constructor(e,t,n,i,o,r,a,g,s){super(e,t,n,i,o,r,a,g,s),this.format=void 0!==a?a:Me,this.minFilter=void 0!==r?r:be,this.magFilter=void 0!==o?o:be,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){l.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}rl.prototype.isVideoTexture=!0;class al extends ei{constructor(e,t,n,i,o,r,a,g,s,l,c,I){super(null,r,a,g,s,l,i,o,c,I),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}al.prototype.isCompressedTexture=!0;class gl extends ei{constructor(e,t,n,i,o,r,a,g,s){super(e,t,n,i,o,r,a,g,s),this.needsUpdate=!0}}gl.prototype.isCanvasTexture=!0;class sl extends ei{constructor(e,t,n,i,o,r,a,g,s,l){if((l=void 0!==l?l:Ee)!==Ee&&l!==Te)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===Ee&&(n=We),void 0===n&&l===Te&&(n=Ke),super(null,i,o,r,a,g,l,n,s),this.image={width:e,height:t},this.magFilter=void 0!==a?a:de,this.minFilter=void 0!==g?g:de,this.flipY=!1,this.generateMipmaps=!1}}sl.prototype.isDepthTexture=!0;class ll extends or{constructor(e=1,t=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const o=[],r=[],a=[],g=[],s=new ai,l=new Qn;r.push(0,0,0),a.push(0,0,1),g.push(.5,.5);for(let c=0,I=3;c<=t;c++,I+=3){const o=n+c/t*i;s.x=e*Math.cos(o),s.y=e*Math.sin(o),r.push(s.x,s.y,s.z),a.push(0,0,1),l.x=(r[I]/e+1)/2,l.y=(r[I+1]/e+1)/2,g.push(l.x,l.y)}for(let c=1;c<=t;c++)o.push(c,c+1,0);this.setIndex(o),this.setAttribute("position",new Jo(r,3)),this.setAttribute("normal",new Jo(a,3)),this.setAttribute("uv",new Jo(g,2))}}class cl extends or{constructor(e=1,t=1,n=1,i=8,o=1,r=!1,a=0,g=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:o,openEnded:r,thetaStart:a,thetaLength:g};const s=this;i=Math.floor(i),o=Math.floor(o);const l=[],c=[],I=[],C=[];let u=0;const d=[],h=n/2;let A=0;function p(n){const o=u,r=new Qn,d=new ai;let p=0;const m=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=i;e++)c.push(0,h*b,0),I.push(0,b,0),C.push(.5,.5),u++;const f=u;for(let e=0;e<=i;e++){const t=e/i*g+a,n=Math.cos(t),o=Math.sin(t);d.x=m*o,d.y=h*b,d.z=m*n,c.push(d.x,d.y,d.z),I.push(0,b,0),r.x=.5*n+.5,r.y=.5*o*b+.5,C.push(r.x,r.y),u++}for(let e=0;e<i;e++){const t=o+e,i=f+e;!0===n?l.push(i,i+1,t):l.push(i+1,i,t),p+=3}s.addGroup(A,p,!0===n?1:2),A+=p}!function(){const r=new ai,p=new ai;let m=0;const b=(t-e)/n;for(let s=0;s<=o;s++){const l=[],A=s/o,m=A*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,o=t*g+a,s=Math.sin(o),d=Math.cos(o);p.x=m*s,p.y=-A*n+h,p.z=m*d,c.push(p.x,p.y,p.z),r.set(s,b,d).normalize(),I.push(r.x,r.y,r.z),C.push(t,1-A),l.push(u++)}d.push(l)}for(let e=0;e<i;e++)for(let t=0;t<o;t++){const n=d[t][e],i=d[t+1][e],o=d[t+1][e+1],r=d[t][e+1];l.push(n,i,r),l.push(i,o,r),m+=6}s.addGroup(A,m,0),A+=m}(),!1===r&&(e>0&&p(!0),t>0&&p(!1)),this.setIndex(l),this.setAttribute("position",new Jo(c,3)),this.setAttribute("normal",new Jo(I,3)),this.setAttribute("uv",new Jo(C,2))}}class Il extends cl{constructor(e=1,t=1,n=8,i=1,o=!1,r=0,a=2*Math.PI){super(0,e,t,n,i,o,r,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:r,thetaLength:a}}}class Cl extends or{constructor(e,t,n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const o=[],r=[];function a(e,t,n,i){const o=i+1,r=[];for(let a=0;a<=o;a++){r[a]=[];const i=e.clone().lerp(n,a/o),g=t.clone().lerp(n,a/o),s=o-a;for(let e=0;e<=s;e++)r[a][e]=0===e&&a===o?i:i.clone().lerp(g,e/s)}for(let a=0;a<o;a++)for(let e=0;e<2*(o-a)-1;e++){const t=Math.floor(e/2);e%2==0?(g(r[a][t+1]),g(r[a+1][t]),g(r[a][t])):(g(r[a][t+1]),g(r[a+1][t+1]),g(r[a+1][t]))}}function g(e){o.push(e.x,e.y,e.z)}function s(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function l(e,t,n,i){i<0&&1===e.x&&(r[t]=e.x-1),0===n.x&&0===n.z&&(r[t]=i/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new ai,i=new ai,o=new ai;for(let r=0;r<t.length;r+=3)s(t[r+0],n),s(t[r+1],i),s(t[r+2],o),a(n,i,o,e)}(i),function(e){const t=new ai;for(let n=0;n<o.length;n+=3)t.x=o[n+0],t.y=o[n+1],t.z=o[n+2],t.normalize().multiplyScalar(e),o[n+0]=t.x,o[n+1]=t.y,o[n+2]=t.z}(n),function(){const e=new ai;for(let n=0;n<o.length;n+=3){e.x=o[n+0],e.y=o[n+1],e.z=o[n+2];const i=c(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);r.push(i,1-a)}var t;(function(){const e=new ai,t=new ai,n=new ai,i=new ai,a=new Qn,g=new Qn,s=new Qn;for(let I=0,C=0;I<o.length;I+=9,C+=6){e.set(o[I+0],o[I+1],o[I+2]),t.set(o[I+3],o[I+4],o[I+5]),n.set(o[I+6],o[I+7],o[I+8]),a.set(r[C+0],r[C+1]),g.set(r[C+2],r[C+3]),s.set(r[C+4],r[C+5]),i.copy(e).add(t).add(n).divideScalar(3);const u=c(i);l(a,C+0,e,u),l(g,C+2,t,u),l(s,C+4,n,u)}})(),function(){for(let e=0;e<r.length;e+=6){const t=r[e+0],n=r[e+2],i=r[e+4],o=Math.max(t,n,i),a=Math.min(t,n,i);o>.9&&a<.1&&(t<.2&&(r[e+0]+=1),n<.2&&(r[e+2]+=1),i<.2&&(r[e+4]+=1))}}()}(),this.setAttribute("position",new Jo(o,3)),this.setAttribute("normal",new Jo(o.slice(),3)),this.setAttribute("uv",new Jo(r,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}}class ul extends Cl{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const dl=new ai,hl=new ai,Al=new ai,pl=new Bo;class ml extends or{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=Math.pow(10,4),i=Math.cos(zn*t),o=e.getIndex(),r=e.getAttribute("position"),a=o?o.count:r.count,g=[0,0,0],s=["a","b","c"],l=new Array(3),c={},I=[];for(let C=0;C<a;C+=3){o?(g[0]=o.getX(C),g[1]=o.getX(C+1),g[2]=o.getX(C+2)):(g[0]=C,g[1]=C+1,g[2]=C+2);const{a:e,b:t,c:a}=pl;if(e.fromBufferAttribute(r,g[0]),t.fromBufferAttribute(r,g[1]),a.fromBufferAttribute(r,g[2]),pl.getNormal(Al),l[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,l[1]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,l[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let n=0;n<3;n++){const e=(n+1)%3,t=l[n],o=l[e],r=pl[s[n]],a=pl[s[e]],C=`${t}_${o}`,u=`${o}_${t}`;u in c&&c[u]?(Al.dot(c[u].normal)<=i&&(I.push(r.x,r.y,r.z),I.push(a.x,a.y,a.z)),c[u]=null):C in c||(c[C]={index0:g[n],index1:g[e],normal:Al.clone()})}}for(const C in c)if(c[C]){const{index0:e,index1:t}=c[C];dl.fromBufferAttribute(r,e),hl.fromBufferAttribute(r,t),I.push(dl.x,dl.y,dl.z),I.push(hl.x,hl.y,hl.z)}this.setAttribute("position",new Jo(I,3))}}const bl=function(e,t,n){n=n||2;const i=t&&t.length,o=i?t[0]*n:e.length;let r=fl(e,0,o,n,!0);const a=[];if(!r||r.next===r.prev)return a;let g,s,l,c,I,C,u;if(i&&(r=function(e,t,n,i){const o=[];let r,a,g,s,l;for(r=0,a=t.length;r<a;r++)g=t[r]*i,s=r<a-1?t[r+1]*i:e.length,l=fl(e,g,s,i,!1),l===l.next&&(l.steiner=!0),o.push(xl(l));for(o.sort(Wl),r=0;r<o.length;r++)Sl(o[r],n),n=yl(n,n.next);return n}(e,t,r,n)),e.length>80*n){g=l=e[0],s=c=e[1];for(let t=n;t<o;t+=n)I=e[t],C=e[t+1],I<g&&(g=I),C<s&&(s=C),I>l&&(l=I),C>c&&(c=C);u=Math.max(l-g,c-s),u=0!==u?1/u:0}return Gl(r,a,n,g,s,u),a};function fl(e,t,n,i,o){let r,a;if(o===function(e,t,n,i){let o=0;for(let r=t,a=n-i;r<n;r+=i)o+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return o}(e,t,n,i)>0)for(r=t;r<n;r+=i)a=kl(r,e[r],e[r+1],a);else for(r=n-i;r>=t;r-=i)a=kl(r,e[r],e[r+1],a);return a&&Kl(a,a.next)&&(El(a),a=a.next),a}function yl(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Kl(i,i.next)&&0!==Yl(i.prev,i,i.next))i=i.next;else{if(El(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Gl(e,t,n,i,o,r,a){if(!e)return;!a&&r&&function(e,t,n,i){let o=e;do{null===o.z&&(o.z=Vl(o.x,o.y,t,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){let t,n,i,o,r,a,g,s,l=1;do{for(n=e,e=null,r=null,a=0;n;){for(a++,i=n,g=0,t=0;t<l&&(g++,i=i.nextZ,i);t++);for(s=l;g>0||s>0&&i;)0!==g&&(0===s||!i||n.z<=i.z)?(o=n,n=n.nextZ,g--):(o=i,i=i.nextZ,s--),r?r.nextZ=o:e=o,o.prevZ=r,r=o;n=i}r.nextZ=null,l*=2}while(a>1)}(o)}(e,i,o,r);let g,s,l=e;for(;e.prev!==e.next;)if(g=e.prev,s=e.next,r?Bl(e,i,o,r):vl(e))t.push(g.i/n),t.push(e.i/n),t.push(s.i/n),El(e),e=s.next,l=s.next;else if((e=s)===l){a?1===a?Gl(e=Zl(yl(e),t,n),t,n,i,o,r,2):2===a&&wl(e,t,n,i,o,r):Gl(yl(e),t,n,i,o,r,1);break}}function vl(e){const t=e.prev,n=e,i=e.next;if(Yl(t,n,i)>=0)return!1;let o=e.next.next;for(;o!==e.prev;){if(Xl(t.x,t.y,n.x,n.y,i.x,i.y,o.x,o.y)&&Yl(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function Bl(e,t,n,i){const o=e.prev,r=e,a=e.next;if(Yl(o,r,a)>=0)return!1;const g=o.x<r.x?o.x<a.x?o.x:a.x:r.x<a.x?r.x:a.x,s=o.y<r.y?o.y<a.y?o.y:a.y:r.y<a.y?r.y:a.y,l=o.x>r.x?o.x>a.x?o.x:a.x:r.x>a.x?r.x:a.x,c=o.y>r.y?o.y>a.y?o.y:a.y:r.y>a.y?r.y:a.y,I=Vl(g,s,t,n,i),C=Vl(l,c,t,n,i);let u=e.prevZ,d=e.nextZ;for(;u&&u.z>=I&&d&&d.z<=C;){if(u!==e.prev&&u!==e.next&&Xl(o.x,o.y,r.x,r.y,a.x,a.y,u.x,u.y)&&Yl(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,d!==e.prev&&d!==e.next&&Xl(o.x,o.y,r.x,r.y,a.x,a.y,d.x,d.y)&&Yl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;u&&u.z>=I;){if(u!==e.prev&&u!==e.next&&Xl(o.x,o.y,r.x,r.y,a.x,a.y,u.x,u.y)&&Yl(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;d&&d.z<=C;){if(d!==e.prev&&d!==e.next&&Xl(o.x,o.y,r.x,r.y,a.x,a.y,d.x,d.y)&&Yl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Zl(e,t,n){let i=e;do{const o=i.prev,r=i.next.next;!Kl(o,r)&&Nl(o,i,i.next,r)&&zl(o,r)&&zl(r,o)&&(t.push(o.i/n),t.push(i.i/n),t.push(r.i/n),El(i),El(i.next),i=e=r),i=i.next}while(i!==e);return yl(i)}function wl(e,t,n,i,o,r){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Hl(a,e)){let g=Ll(a,e);return a=yl(a,a.next),g=yl(g,g.next),Gl(a,t,n,i,o,r),void Gl(g,t,n,i,o,r)}e=e.next}a=a.next}while(a!==e)}function Wl(e,t){return e.x-t.x}function Sl(e,t){if(t=function(e,t){let n=t;const i=e.x,o=e.y;let r,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a){if(a=e,e===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;const g=r,s=r.x,l=r.y;let c,I=1/0;n=r;do{i>=n.x&&n.x>=s&&i!==n.x&&Xl(o<l?i:a,o,s,l,o<l?a:i,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(i-n.x),zl(n,e)&&(c<I||c===I&&(n.x>r.x||n.x===r.x&&Rl(r,n)))&&(r=n,I=c)),n=n.next}while(n!==g);return r}(e,t)){const n=Ll(t,e);yl(t,t.next),yl(n,n.next)}}function Rl(e,t){return Yl(e.prev,e,t.prev)<0&&Yl(t.next,e,e.next)<0}function Vl(e,t,n,i,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xl(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Xl(e,t,n,i,o,r,a,g){return(o-a)*(t-g)-(e-a)*(r-g)>=0&&(e-a)*(i-g)-(n-a)*(t-g)>=0&&(n-a)*(r-g)-(o-a)*(i-g)>=0}function Hl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Nl(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(zl(e,t)&&zl(t,e)&&function(e,t){let n=e,i=!1;const o=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Yl(e.prev,e,t.prev)||Yl(e,t.prev,t))||Kl(e,t)&&Yl(e.prev,e,e.next)>0&&Yl(t.prev,t,t.next)>0)}function Yl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Kl(e,t){return e.x===t.x&&e.y===t.y}function Nl(e,t,n,i){const o=Fl(Yl(e,t,n)),r=Fl(Yl(e,t,i)),a=Fl(Yl(n,i,e)),g=Fl(Yl(n,i,t));return o!==r&&a!==g||(!(0!==o||!Ml(e,n,t))||(!(0!==r||!Ml(e,i,t))||(!(0!==a||!Ml(n,e,i))||!(0!==g||!Ml(n,t,i)))))}function Ml(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Fl(e){return e>0?1:e<0?-1:0}function zl(e,t){return Yl(e.prev,e,e.next)<0?Yl(e,t,e.next)>=0&&Yl(e,e.prev,t)>=0:Yl(e,t,e.prev)<0||Yl(e,e.next,t)<0}function Ll(e,t){const n=new Tl(e.i,e.x,e.y),i=new Tl(t.i,t.x,t.y),o=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function kl(e,t,n,i){const o=new Tl(e,t,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function El(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Tl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Ul{static area(e){const t=e.length;let n=0;for(let i=t-1,o=0;o<t;i=o++)n+=e[i].x*e[o].y-e[o].x*e[i].y;return.5*n}static isClockWise(e){return Ul.area(e)<0}static triangulateShape(e,t){const n=[],i=[],o=[];_l(e),Jl(n,e);let r=e.length;t.forEach(_l);for(let g=0;g<t.length;g++)i.push(r),r+=t[g].length,Jl(n,t[g]);const a=bl(n,i);for(let g=0;g<a.length;g+=3)o.push(a.slice(g,g+3));return o}}function _l(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Jl(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Dl extends or{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],o=[];for(let a=0,g=e.length;a<g;a++){r(e[a])}function r(e){const r=[],a=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1;let s=void 0!==t.depth?t.depth:100,l=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,I=void 0!==t.bevelSize?t.bevelSize:c-2,C=void 0!==t.bevelOffset?t.bevelOffset:0,u=void 0!==t.bevelSegments?t.bevelSegments:3;const d=t.extrudePath,h=void 0!==t.UVGenerator?t.UVGenerator:Pl;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),s=t.amount);let A,p,m,b,f,y=!1;d&&(A=d.getSpacedPoints(g),y=!0,l=!1,p=d.computeFrenetFrames(g,!1),m=new ai,b=new ai,f=new ai),l||(u=0,c=0,I=0,C=0);const G=e.extractPoints(a);let v=G.shape;const B=G.holes;if(!Ul.isClockWise(v)){v=v.reverse();for(let e=0,t=B.length;e<t;e++){const t=B[e];Ul.isClockWise(t)&&(B[e]=t.reverse())}}const Z=Ul.triangulateShape(v,B),w=v;for(let t=0,n=B.length;t<n;t++){const e=B[t];v=v.concat(e)}function W(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const S=v.length,R=Z.length;function V(e,t,n){let i,o,r;const a=e.x-t.x,g=e.y-t.y,s=n.x-e.x,l=n.y-e.y,c=a*a+g*g,I=a*l-g*s;if(Math.abs(I)>Number.EPSILON){const I=Math.sqrt(c),C=Math.sqrt(s*s+l*l),u=t.x-g/I,d=t.y+a/I,h=((n.x-l/C-u)*l-(n.y+s/C-d)*s)/(a*l-g*s);i=u+a*h-e.x,o=d+g*h-e.y;const A=i*i+o*o;if(A<=2)return new Qn(i,o);r=Math.sqrt(A/2)}else{let e=!1;a>Number.EPSILON?s>Number.EPSILON&&(e=!0):a<-Number.EPSILON?s<-Number.EPSILON&&(e=!0):Math.sign(g)===Math.sign(l)&&(e=!0),e?(i=-g,o=a,r=Math.sqrt(c)):(i=a,o=g,r=Math.sqrt(c/2))}return new Qn(i/r,o/r)}const x=[];for(let t=0,n=w.length,i=n-1,o=t+1;t<n;t++,i++,o++)i===n&&(i=0),o===n&&(o=0),x[t]=V(w[t],w[i],w[o]);const X=[];let H,Y=x.concat();for(let t=0,n=B.length;t<n;t++){const e=B[t];H=[];for(let t=0,n=e.length,i=n-1,o=t+1;t<n;t++,i++,o++)i===n&&(i=0),o===n&&(o=0),H[t]=V(e[t],e[i],e[o]);X.push(H),Y=Y.concat(H)}for(let t=0;t<u;t++){const e=t/u,n=c*Math.cos(e*Math.PI/2),i=I*Math.sin(e*Math.PI/2)+C;for(let t=0,o=w.length;t<o;t++){const e=W(w[t],x[t],i);M(e.x,e.y,-n)}for(let t=0,o=B.length;t<o;t++){const e=B[t];H=X[t];for(let t=0,o=e.length;t<o;t++){const o=W(e[t],H[t],i);M(o.x,o.y,-n)}}}const K=I+C;for(let t=0;t<S;t++){const e=l?W(v[t],Y[t],K):v[t];y?(b.copy(p.normals[0]).multiplyScalar(e.x),m.copy(p.binormals[0]).multiplyScalar(e.y),f.copy(A[0]).add(b).add(m),M(f.x,f.y,f.z)):M(e.x,e.y,0)}for(let t=1;t<=g;t++)for(let e=0;e<S;e++){const n=l?W(v[e],Y[e],K):v[e];y?(b.copy(p.normals[t]).multiplyScalar(n.x),m.copy(p.binormals[t]).multiplyScalar(n.y),f.copy(A[t]).add(b).add(m),M(f.x,f.y,f.z)):M(n.x,n.y,s/g*t)}for(let t=u-1;t>=0;t--){const e=t/u,n=c*Math.cos(e*Math.PI/2),i=I*Math.sin(e*Math.PI/2)+C;for(let t=0,o=w.length;t<o;t++){const e=W(w[t],x[t],i);M(e.x,e.y,s+n)}for(let t=0,o=B.length;t<o;t++){const e=B[t];H=X[t];for(let t=0,o=e.length;t<o;t++){const o=W(e[t],H[t],i);y?M(o.x,o.y+A[g-1].y,A[g-1].x+n):M(o.x,o.y,s+n)}}}function N(e,t){let n=e.length;for(;--n>=0;){const i=n;let o=n-1;o<0&&(o=e.length-1);for(let e=0,n=g+2*u;e<n;e++){const n=S*e,r=S*(e+1);z(t+i+n,t+o+n,t+o+r,t+i+r)}}}function M(e,t,n){r.push(e),r.push(t),r.push(n)}function F(e,t,o){L(e),L(t),L(o);const r=i.length/3,a=h.generateTopUV(n,i,r-3,r-2,r-1);k(a[0]),k(a[1]),k(a[2])}function z(e,t,o,r){L(e),L(t),L(r),L(t),L(o),L(r);const a=i.length/3,g=h.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);k(g[0]),k(g[1]),k(g[3]),k(g[1]),k(g[2]),k(g[3])}function L(e){i.push(r[3*e+0]),i.push(r[3*e+1]),i.push(r[3*e+2])}function k(e){o.push(e.x),o.push(e.y)}!function(){const e=i.length/3;if(l){let e=0,t=S*e;for(let n=0;n<R;n++){const e=Z[n];F(e[2]+t,e[1]+t,e[0]+t)}e=g+2*u,t=S*e;for(let n=0;n<R;n++){const e=Z[n];F(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<R;e++){const t=Z[e];F(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=Z[e];F(t[0]+S*g,t[1]+S*g,t[2]+S*g)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;N(w,t),t+=w.length;for(let n=0,i=B.length;n<i;n++){const e=B[n];N(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new Jo(i,3)),this.setAttribute("uv",new Jo(o,2)),this.computeVertexNormals()}toJSON(){const e=or.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,o=e.length;i<o;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}const Pl={generateTopUV:function(e,t,n,i,o){const r=t[3*n],a=t[3*n+1],g=t[3*i],s=t[3*i+1],l=t[3*o],c=t[3*o+1];return[new Qn(r,a),new Qn(g,s),new Qn(l,c)]},generateSideWallUV:function(e,t,n,i,o,r){const a=t[3*n],g=t[3*n+1],s=t[3*n+2],l=t[3*i],c=t[3*i+1],I=t[3*i+2],C=t[3*o],u=t[3*o+1],d=t[3*o+2],h=t[3*r],A=t[3*r+1],p=t[3*r+2];return Math.abs(g-c)<.01?[new Qn(a,1-s),new Qn(l,1-I),new Qn(C,1-d),new Qn(h,1-p)]:[new Qn(g,1-s),new Qn(c,1-I),new Qn(u,1-d),new Qn(A,1-p)]}};class Ql extends Cl{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class Ol extends or{constructor(e,t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=En(i,0,2*Math.PI);const o=[],r=[],a=[],g=1/t,s=new ai,l=new Qn;for(let c=0;c<=t;c++){const o=n+c*g*i,I=Math.sin(o),C=Math.cos(o);for(let n=0;n<=e.length-1;n++)s.x=e[n].x*I,s.y=e[n].y,s.z=e[n].x*C,r.push(s.x,s.y,s.z),l.x=c/t,l.y=n/(e.length-1),a.push(l.x,l.y)}for(let c=0;c<t;c++)for(let t=0;t<e.length-1;t++){const n=t+c*e.length,i=n,r=n+e.length,a=n+e.length+1,g=n+1;o.push(i,r,g),o.push(r,a,g)}if(this.setIndex(o),this.setAttribute("position",new Jo(r,3)),this.setAttribute("uv",new Jo(a,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new ai,o=new ai,r=new ai,a=t*e.length*3;for(let t=0,g=0;t<e.length;t++,g+=3)i.x=n[g+0],i.y=n[g+1],i.z=n[g+2],o.x=n[a+g+0],o.y=n[a+g+1],o.z=n[a+g+2],r.addVectors(i,o).normalize(),n[g+0]=n[a+g+0]=r.x,n[g+1]=n[a+g+1]=r.y,n[g+2]=n[a+g+2]=r.z}}}class jl extends Cl{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class ql extends or{constructor(e,t,n){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const i=[],o=[],r=[],a=[],g=1e-5,s=new ai,l=new ai,c=new ai,I=new ai,C=new ai;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const u=t+1;for(let d=0;d<=n;d++){const i=d/n;for(let n=0;n<=t;n++){const u=n/t;e(u,i,l),o.push(l.x,l.y,l.z),u-g>=0?(e(u-g,i,c),I.subVectors(l,c)):(e(u+g,i,c),I.subVectors(c,l)),i-g>=0?(e(u,i-g,c),C.subVectors(l,c)):(e(u,i+g,c),C.subVectors(c,l)),s.crossVectors(I,C).normalize(),r.push(s.x,s.y,s.z),a.push(u,i)}}for(let d=0;d<n;d++)for(let e=0;e<t;e++){const t=d*u+e,n=d*u+e+1,o=(d+1)*u+e+1,r=(d+1)*u+e;i.push(t,n,r),i.push(n,o,r)}this.setIndex(i),this.setAttribute("position",new Jo(o,3)),this.setAttribute("normal",new Jo(r,3)),this.setAttribute("uv",new Jo(a,2))}}class $l extends or{constructor(e=.5,t=1,n=8,i=1,o=0,r=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:o,thetaLength:r},n=Math.max(3,n);const a=[],g=[],s=[],l=[];let c=e;const I=(t-e)/(i=Math.max(1,i)),C=new ai,u=new Qn;for(let d=0;d<=i;d++){for(let e=0;e<=n;e++){const i=o+e/n*r;C.x=c*Math.cos(i),C.y=c*Math.sin(i),g.push(C.x,C.y,C.z),s.push(0,0,1),u.x=(C.x/t+1)/2,u.y=(C.y/t+1)/2,l.push(u.x,u.y)}c+=I}for(let d=0;d<i;d++){const e=d*(n+1);for(let t=0;t<n;t++){const i=t+e,o=i,r=i+n+1,g=i+n+2,s=i+1;a.push(o,r,s),a.push(r,g,s)}}this.setIndex(a),this.setAttribute("position",new Jo(g,3)),this.setAttribute("normal",new Jo(s,3)),this.setAttribute("uv",new Jo(l,2))}}class ec extends or{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],o=[],r=[];let a=0,g=0;if(!1===Array.isArray(e))s(e);else for(let l=0;l<e.length;l++)s(e[l]),this.addGroup(a,g,l),a+=g,g=0;function s(e){const a=i.length/3,s=e.extractPoints(t);let l=s.shape;const c=s.holes;!1===Ul.isClockWise(l)&&(l=l.reverse());for(let t=0,n=c.length;t<n;t++){const e=c[t];!0===Ul.isClockWise(e)&&(c[t]=e.reverse())}const I=Ul.triangulateShape(l,c);for(let t=0,n=c.length;t<n;t++){const e=c[t];l=l.concat(e)}for(let t=0,n=l.length;t<n;t++){const e=l[t];i.push(e.x,e.y,0),o.push(0,0,1),r.push(e.x,e.y)}for(let t=0,i=I.length;t<i;t++){const e=I[t],i=e[0]+a,o=e[1]+a,r=e[2]+a;n.push(i,o,r),g+=3}}this.setIndex(n),this.setAttribute("position",new Jo(i,3)),this.setAttribute("normal",new Jo(o,3)),this.setAttribute("uv",new Jo(r,2))}toJSON(){const e=or.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class tc extends or{constructor(e=1,t=8,n=6,i=0,o=2*Math.PI,r=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:o,thetaStart:r,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const g=Math.min(r+a,Math.PI);let s=0;const l=[],c=new ai,I=new ai,C=[],u=[],d=[],h=[];for(let A=0;A<=n;A++){const C=[],p=A/n;let m=0;0==A&&0==r?m=.5/t:A==n&&g==Math.PI&&(m=-.5/t);for(let n=0;n<=t;n++){const g=n/t;c.x=-e*Math.cos(i+g*o)*Math.sin(r+p*a),c.y=e*Math.cos(r+p*a),c.z=e*Math.sin(i+g*o)*Math.sin(r+p*a),u.push(c.x,c.y,c.z),I.copy(c).normalize(),d.push(I.x,I.y,I.z),h.push(g+m,1-p),C.push(s++)}l.push(C)}for(let A=0;A<n;A++)for(let e=0;e<t;e++){const t=l[A][e+1],i=l[A][e],o=l[A+1][e],a=l[A+1][e+1];(0!==A||r>0)&&C.push(t,i,a),(A!==n-1||g<Math.PI)&&C.push(i,o,a)}this.setIndex(C),this.setAttribute("position",new Jo(u,3)),this.setAttribute("normal",new Jo(d,3)),this.setAttribute("uv",new Jo(h,2))}}class nc extends Cl{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class ic extends Dl{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new or;const i=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(i,t),this.type="TextGeometry"}}class oc extends or{constructor(e=1,t=.4,n=8,i=6,o=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:o},n=Math.floor(n),i=Math.floor(i);const r=[],a=[],g=[],s=[],l=new ai,c=new ai,I=new ai;for(let C=0;C<=n;C++)for(let r=0;r<=i;r++){const u=r/i*o,d=C/n*Math.PI*2;c.x=(e+t*Math.cos(d))*Math.cos(u),c.y=(e+t*Math.cos(d))*Math.sin(u),c.z=t*Math.sin(d),a.push(c.x,c.y,c.z),l.x=e*Math.cos(u),l.y=e*Math.sin(u),I.subVectors(c,l).normalize(),g.push(I.x,I.y,I.z),s.push(r/i),s.push(C/n)}for(let C=1;C<=n;C++)for(let e=1;e<=i;e++){const t=(i+1)*C+e-1,n=(i+1)*(C-1)+e-1,o=(i+1)*(C-1)+e,a=(i+1)*C+e;r.push(t,n,a),r.push(n,o,a)}this.setIndex(r),this.setAttribute("position",new Jo(a,3)),this.setAttribute("normal",new Jo(g,3)),this.setAttribute("uv",new Jo(s,2))}}class rc extends or{constructor(e=1,t=.4,n=64,i=8,o=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:o,q:r},n=Math.floor(n),i=Math.floor(i);const a=[],g=[],s=[],l=[],c=new ai,I=new ai,C=new ai,u=new ai,d=new ai,h=new ai,A=new ai;for(let m=0;m<=n;++m){const a=m/n*o*Math.PI*2;p(a,o,r,e,C),p(a+.01,o,r,e,u),h.subVectors(u,C),A.addVectors(u,C),d.crossVectors(h,A),A.crossVectors(d,h),d.normalize(),A.normalize();for(let e=0;e<=i;++e){const o=e/i*Math.PI*2,r=-t*Math.cos(o),a=t*Math.sin(o);c.x=C.x+(r*A.x+a*d.x),c.y=C.y+(r*A.y+a*d.y),c.z=C.z+(r*A.z+a*d.z),g.push(c.x,c.y,c.z),I.subVectors(c,C).normalize(),s.push(I.x,I.y,I.z),l.push(m/n),l.push(e/i)}}for(let m=1;m<=n;m++)for(let e=1;e<=i;e++){const t=(i+1)*(m-1)+(e-1),n=(i+1)*m+(e-1),o=(i+1)*m+e,r=(i+1)*(m-1)+e;a.push(t,n,r),a.push(n,o,r)}function p(e,t,n,i,o){const r=Math.cos(e),a=Math.sin(e),g=n/t*e,s=Math.cos(g);o.x=i*(2+s)*.5*r,o.y=i*(2+s)*a*.5,o.z=i*Math.sin(g)*.5}this.setIndex(a),this.setAttribute("position",new Jo(g,3)),this.setAttribute("normal",new Jo(s,3)),this.setAttribute("uv",new Jo(l,2))}}class ac extends or{constructor(e,t=64,n=1,i=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:o};const r=e.computeFrenetFrames(t,o);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new ai,g=new ai,s=new Qn;let l=new ai;const c=[],I=[],C=[],u=[];function d(o){l=e.getPointAt(o/t,l);const s=r.normals[o],C=r.binormals[o];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,o=Math.sin(t),r=-Math.cos(t);g.x=r*s.x+o*C.x,g.y=r*s.y+o*C.y,g.z=r*s.z+o*C.z,g.normalize(),I.push(g.x,g.y,g.z),a.x=l.x+n*g.x,a.y=l.y+n*g.y,a.z=l.z+n*g.z,c.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)d(e);d(!1===o?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)s.x=e/t,s.y=n/i,C.push(s.x,s.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),o=(i+1)*e+(t-1),r=(i+1)*e+t,a=(i+1)*(e-1)+t;u.push(n,o,a),u.push(o,r,a)}}()}(),this.setIndex(u),this.setAttribute("position",new Jo(c,3)),this.setAttribute("normal",new Jo(I,3)),this.setAttribute("uv",new Jo(C,2))}toJSON(){const e=or.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}class gc extends or{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],n=[0,0],i={},o=new ai;if(null!==e.index){const r=e.attributes.position,a=e.index;let g=e.groups;0===g.length&&(g=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,t=g.length;e<t;++e){const t=g[e],o=t.start;for(let e=o,r=o+t.count;e<r;e+=3)for(let t=0;t<3;t++){const o=a.getX(e+t),r=a.getX(e+(t+1)%3);n[0]=Math.min(o,r),n[1]=Math.max(o,r);const g=n[0]+","+n[1];void 0===i[g]&&(i[g]={index1:n[0],index2:n[1]})}}for(const e in i){const n=i[e];o.fromBufferAttribute(r,n.index1),t.push(o.x,o.y,o.z),o.fromBufferAttribute(r,n.index2),t.push(o.x,o.y,o.z)}}else{const n=e.attributes.position;for(let e=0,i=n.count/3;e<i;e++)for(let r=0;r<3;r++){const i=3*e+r;o.fromBufferAttribute(n,i),t.push(o.x,o.y,o.z);const a=3*e+(r+1)%3;o.fromBufferAttribute(n,a),t.push(o.x,o.y,o.z)}}this.setAttribute("position",new Jo(t,3))}}var sc=Object.freeze({__proto__:null,BoxGeometry:Br,BoxBufferGeometry:Br,CircleGeometry:ll,CircleBufferGeometry:ll,ConeGeometry:Il,ConeBufferGeometry:Il,CylinderGeometry:cl,CylinderBufferGeometry:cl,DodecahedronGeometry:ul,DodecahedronBufferGeometry:ul,EdgesGeometry:ml,ExtrudeGeometry:Dl,ExtrudeBufferGeometry:Dl,IcosahedronGeometry:Ql,IcosahedronBufferGeometry:Ql,LatheGeometry:Ol,LatheBufferGeometry:Ol,OctahedronGeometry:jl,OctahedronBufferGeometry:jl,ParametricGeometry:ql,ParametricBufferGeometry:ql,PlaneGeometry:kr,PlaneBufferGeometry:kr,PolyhedronGeometry:Cl,PolyhedronBufferGeometry:Cl,RingGeometry:$l,RingBufferGeometry:$l,ShapeGeometry:ec,ShapeBufferGeometry:ec,SphereGeometry:tc,SphereBufferGeometry:tc,TetrahedronGeometry:nc,TetrahedronBufferGeometry:nc,TextGeometry:ic,TextBufferGeometry:ic,TorusGeometry:oc,TorusBufferGeometry:oc,TorusKnotGeometry:rc,TorusKnotBufferGeometry:rc,TubeGeometry:ac,TubeBufferGeometry:ac,WireframeGeometry:gc});class lc extends wo{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ho(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}lc.prototype.isShadowMaterial=!0;class cc extends Sr{constructor(e){super(e),this.type="RawShaderMaterial"}}cc.prototype.isRawShaderMaterial=!0;class Ic extends wo{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ho(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ho(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}Ic.prototype.isMeshStandardMaterial=!0;class Cc extends Ic{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Qn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=En(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ho).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this}}Cc.prototype.isMeshPhysicalMaterial=!0;class uc extends wo{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ho(16777215),this.specular=new Ho(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ho(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}uc.prototype.isMeshPhongMaterial=!0;class dc extends wo{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ho(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ho(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}dc.prototype.isMeshToonMaterial=!0;class hc extends wo{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}hc.prototype.isMeshNormalMaterial=!0;class Ac extends wo{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Ho(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ho(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}Ac.prototype.isMeshLambertMaterial=!0;class pc extends wo{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ho(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Qn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}pc.prototype.isMeshMatcapMaterial=!0;class mc extends ks{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}mc.prototype.isLineDashedMaterial=!0;var bc=Object.freeze({__proto__:null,ShadowMaterial:lc,SpriteMaterial:gs,RawShaderMaterial:cc,ShaderMaterial:Sr,PointsMaterial:qs,MeshPhysicalMaterial:Cc,MeshStandardMaterial:Ic,MeshPhongMaterial:uc,MeshToonMaterial:dc,MeshNormalMaterial:hc,MeshLambertMaterial:Ac,MeshDepthMaterial:kg,MeshDistanceMaterial:Eg,MeshBasicMaterial:Yo,MeshMatcapMaterial:pc,LineDashedMaterial:mc,LineBasicMaterial:ks,Material:wo});const fc={arraySlice:function(e,t,n){return fc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,o=new e.constructor(i);for(let r=0,a=0;a!==i;++r){const i=n[r]*t;for(let n=0;n!==t;++n)o[a++]=e[i+n]}return o},flattenJSON:function(e,t,n,i){let o=1,r=e[0];for(;void 0!==r&&void 0===r[i];)r=e[o++];if(void 0===r)return;let a=r[i];if(void 0!==a)if(Array.isArray(a))do{a=r[i],void 0!==a&&(t.push(r.time),n.push.apply(n,a)),r=e[o++]}while(void 0!==r);else if(void 0!==a.toArray)do{a=r[i],void 0!==a&&(t.push(r.time),a.toArray(n,n.length)),r=e[o++]}while(void 0!==r);else do{a=r[i],void 0!==a&&(t.push(r.time),n.push(a)),r=e[o++]}while(void 0!==r)},subclip:function(e,t,n,i,o=30){const r=e.clone();r.name=t;const a=[];for(let s=0;s<r.tracks.length;++s){const e=r.tracks[s],t=e.getValueSize(),g=[],l=[];for(let r=0;r<e.times.length;++r){const a=e.times[r]*o;if(!(a<n||a>=i)){g.push(e.times[r]);for(let n=0;n<t;++n)l.push(e.values[r*t+n])}}0!==g.length&&(e.times=fc.convertArray(g,e.times.constructor),e.values=fc.convertArray(l,e.values.constructor),a.push(e))}r.tracks=a;let g=1/0;for(let s=0;s<r.tracks.length;++s)g>r.tracks[s].times[0]&&(g=r.tracks[s].times[0]);for(let s=0;s<r.tracks.length;++s)r.tracks[s].shift(-1*g);return r.resetDuration(),r},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const o=n.tracks.length,r=t/i;for(let a=0;a<o;++a){const t=n.tracks[a],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const o=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===i}));if(void 0===o)continue;let g=0;const s=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=s/3);let l=0;const c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);const I=t.times.length-1;let C;if(r<=t.times[0]){const e=g,n=s-g;C=fc.arraySlice(t.values,e,n)}else if(r>=t.times[I]){const e=I*s+g,n=e+s-g;C=fc.arraySlice(t.values,e,n)}else{const e=t.createInterpolant(),n=g,i=s-g;e.evaluate(r),C=fc.arraySlice(e.resultBuffer,n,i)}if("quaternion"===i){(new ri).fromArray(C).normalize().conjugate().toArray(C)}const u=o.times.length;for(let e=0;e<u;++e){const t=e*c+l;if("quaternion"===i)ri.multiplyQuaternionsFlat(o.values,t,C,0,o.values,t);else{const e=c-2*l;for(let n=0;n<e;++n)o.values[t+n]-=C[n]}}}return e.blendMode=Jt,e}};class yc{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],o=t[n-1];e:{t:{let r;n:{i:if(!(e<i)){for(let r=n+2;;){if(void 0===i){if(e<o)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,o)}if(n===r)break;if(o=i,i=t[++n],e<i)break t}r=t.length;break n}if(e>=o)break e;{const a=t[1];e<a&&(n=2,o=a);for(let r=n-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===r)break;if(i=o,o=t[--n-1],e>=o)break t}r=n,n=0}}for(;n<r;){const i=n+r>>>1;e<t[i]?r=i:n=i+1}if(i=t[n],o=t[n-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,o,e)}this._cachedIndex=n,this.intervalChanged_(n,o,i)}return this.interpolate_(n,o,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i;for(let r=0;r!==i;++r)t[r]=n[o+r];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}yc.prototype.beforeStart_=yc.prototype.copySampleValue_,yc.prototype.afterEnd_=yc.prototype.copySampleValue_;class Gc extends yc{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Et,endingEnd:Et}}intervalChanged_(e,t,n){const i=this.parameterPositions;let o=e-2,r=e+1,a=i[o],g=i[r];if(void 0===a)switch(this.getSettings_().endingStart){case Tt:o=e,a=2*t-n;break;case Ut:o=i.length-2,a=t+i[o]-i[o+1];break;default:o=e,a=n}if(void 0===g)switch(this.getSettings_().endingEnd){case Tt:r=e,g=2*n-t;break;case Ut:r=1,g=n+i[1]-i[0];break;default:r=e-1,g=t}const s=.5*(n-t),l=this.valueSize;this._weightPrev=s/(t-a),this._weightNext=s/(g-n),this._offsetPrev=o*l,this._offsetNext=r*l}interpolate_(e,t,n,i){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,g=e*a,s=g-a,l=this._offsetPrev,c=this._offsetNext,I=this._weightPrev,C=this._weightNext,u=(n-t)/(i-t),d=u*u,h=d*u,A=-I*h+2*I*d-I*u,p=(1+I)*h+(-1.5-2*I)*d+(-.5+I)*u+1,m=(-1-C)*h+(1.5+C)*d+.5*u,b=C*h-C*d;for(let f=0;f!==a;++f)o[f]=A*r[l+f]+p*r[s+f]+m*r[g+f]+b*r[c+f];return o}}class vc extends yc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,g=e*a,s=g-a,l=(n-t)/(i-t),c=1-l;for(let I=0;I!==a;++I)o[I]=r[s+I]*c+r[g+I]*l;return o}}class Bc extends yc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Zc{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=fc.convertArray(t,this.TimeBufferType),this.values=fc.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:fc.convertArray(e.times,Array),values:fc.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Bc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new vc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Gc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case zt:t=this.InterpolantFactoryMethodDiscrete;break;case Lt:t=this.InterpolantFactoryMethodLinear;break;case kt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return zt;case this.InterpolantFactoryMethodLinear:return Lt;case this.InterpolantFactoryMethodSmooth:return kt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let o=0,r=i-1;for(;o!==i&&n[o]<e;)++o;for(;-1!==r&&n[r]>t;)--r;if(++r,0!==o||r!==i){o>=r&&(r=Math.max(r,1),o=r-1);const e=this.getValueSize();this.times=fc.arraySlice(n,o,r),this.values=fc.arraySlice(this.values,o*e,r*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,o=n.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let a=0;a!==o;a++){const t=n[a];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,t),e=!1;break}if(null!==r&&r>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,t,r),e=!1;break}r=t}if(void 0!==i&&fc.isTypedArray(i))for(let a=0,g=i.length;a!==g;++a){const t=i[a];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,t),e=!1;break}}return e}optimize(){const e=fc.arraySlice(this.times),t=fc.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===kt,o=e.length-1;let r=1;for(let a=1;a<o;++a){let o=!1;const g=e[a];if(g!==e[a+1]&&(1!==a||g!==e[0]))if(i)o=!0;else{const e=a*n,i=e-n,r=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[r+a]){o=!0;break}}}if(o){if(a!==r){e[r]=e[a];const i=a*n,o=r*n;for(let e=0;e!==n;++e)t[o+e]=t[i+e]}++r}}if(o>0){e[r]=e[o];for(let e=o*n,i=r*n,a=0;a!==n;++a)t[i+a]=t[e+a];++r}return r!==e.length?(this.times=fc.arraySlice(e,0,r),this.values=fc.arraySlice(t,0,r*n)):(this.times=e,this.values=t),this}clone(){const e=fc.arraySlice(this.times,0),t=fc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Zc.prototype.TimeBufferType=Float32Array,Zc.prototype.ValueBufferType=Float32Array,Zc.prototype.DefaultInterpolation=Lt;class wc extends Zc{}wc.prototype.ValueTypeName="bool",wc.prototype.ValueBufferType=Array,wc.prototype.DefaultInterpolation=zt,wc.prototype.InterpolantFactoryMethodLinear=void 0,wc.prototype.InterpolantFactoryMethodSmooth=void 0;class Wc extends Zc{}Wc.prototype.ValueTypeName="color";class Sc extends Zc{}Sc.prototype.ValueTypeName="number";class Rc extends yc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,g=(n-t)/(i-t);let s=e*a;for(let l=s+a;s!==l;s+=4)ri.slerpFlat(o,0,r,s-a,r,s,g);return o}}class Vc extends Zc{InterpolantFactoryMethodLinear(e){return new Rc(this.times,this.values,this.getValueSize(),e)}}Vc.prototype.ValueTypeName="quaternion",Vc.prototype.DefaultInterpolation=Lt,Vc.prototype.InterpolantFactoryMethodSmooth=void 0;class xc extends Zc{}xc.prototype.ValueTypeName="string",xc.prototype.ValueBufferType=Array,xc.prototype.DefaultInterpolation=zt,xc.prototype.InterpolantFactoryMethodLinear=void 0,xc.prototype.InterpolantFactoryMethodSmooth=void 0;class Xc extends Zc{}Xc.prototype.ValueTypeName="vector";class Hc{constructor(e,t=-1,n,i=_t){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=kn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let r=0,a=n.length;r!==a;++r)t.push(Yc(n[r]).scale(i));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,r=n.length;o!==r;++o)t.push(Zc.toJSON(n[o]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const o=t.length,r=[];for(let a=0;a<o;a++){let e=[],g=[];e.push((a+o-1)%o,a,(a+1)%o),g.push(0,1,0);const s=fc.getKeyframeOrder(e);e=fc.sortedArray(e,1,s),g=fc.sortedArray(g,1,s),i||0!==e[0]||(e.push(o),g.push(g[0])),r.push(new Sc(".morphTargetInfluences["+t[a].name+"]",e,g).scale(1/n))}return new this(e,-1,r)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},o=/^([\w-]*?)([\d]+)$/;for(let a=0,g=e.length;a<g;a++){const t=e[a],n=t.name.match(o);if(n&&n.length>1){const e=n[1];let o=i[e];o||(i[e]=o=[]),o.push(t)}}const r=[];for(const a in i)r.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,o){if(0!==n.length){const r=[],a=[];fc.flattenJSON(n,r,a,i),0!==r.length&&o.push(new e(t,r,a))}},i=[],o=e.name||"default",r=e.fps||30,a=e.blendMode;let g=e.length||-1;const s=e.hierarchy||[];for(let l=0;l<s.length;l++){const e=s[l].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const o in t){const t=[],r=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),r.push(i.morphTarget===o?1:0)}i.push(new Sc(".morphTargetInfluence["+o+"]",t,r))}g=t.length*(r||1)}else{const o=".bones["+t[l].name+"]";n(Xc,o+".position",e,"pos",i),n(Vc,o+".quaternion",e,"rot",i),n(Xc,o+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(o,g,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Yc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Sc;case"vector":case"vector2":case"vector3":case"vector4":return Xc;case"color":return Wc;case"quaternion":return Vc;case"bool":case"boolean":return wc;case"string":return xc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];fc.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Kc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Nc{constructor(e,t,n){const i=this;let o,r=!1,a=0,g=0;const s=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){g++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,g),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,g),a===g&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return s.push(e,t),this},this.removeHandler=function(e){const t=s.indexOf(e);return-1!==t&&s.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=s.length;t<n;t+=2){const n=s[t],i=s[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const Mc=new Nc;class Fc{constructor(e){this.manager=void 0!==e?e:Mc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,o){n.load(e,i,t,o)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const zc={};class Lc extends Fc{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=Kc.get(e);if(void 0!==r)return o.manager.itemStart(e),setTimeout((function(){t&&t(r),o.manager.itemEnd(e)}),0),r;if(void 0!==zc[e])return void zc[e].push({onLoad:t,onProgress:n,onError:i});const a=e.match(/^data:(.*?)(;base64)?,(.*)$/);let g;if(a){const n=a[1],r=!!a[2];let g=a[3];g=decodeURIComponent(g),r&&(g=atob(g));try{let i;const r=(this.responseType||"").toLowerCase();switch(r){case"arraybuffer":case"blob":const e=new Uint8Array(g.length);for(let n=0;n<g.length;n++)e[n]=g.charCodeAt(n);i="blob"===r?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;i=t.parseFromString(g,n);break;case"json":i=JSON.parse(g);break;default:i=g}setTimeout((function(){t&&t(i),o.manager.itemEnd(e)}),0)}catch(s){setTimeout((function(){i&&i(s),o.manager.itemError(e),o.manager.itemEnd(e)}),0)}}else{zc[e]=[],zc[e].push({onLoad:t,onProgress:n,onError:i}),g=new XMLHttpRequest,g.open("GET",e,!0),g.addEventListener("load",(function(t){const n=this.response,i=zc[e];if(delete zc[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Kc.add(e,n);for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onLoad&&t.onLoad(n)}o.manager.itemEnd(e)}else{for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)}}),!1),g.addEventListener("progress",(function(t){const n=zc[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onProgress&&i.onProgress(t)}}),!1),g.addEventListener("error",(function(t){const n=zc[e];delete zc[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)}),!1),g.addEventListener("abort",(function(t){const n=zc[e];delete zc[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)g.setRequestHeader(e,this.requestHeader[e]);g.send(null)}return o.manager.itemStart(e),g}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class kc extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new Lc(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=Hc.parse(e[n]);t.push(i)}return t}}class Ec extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=this,r=[],a=new al,g=new Lc(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(o.withCredentials);let s=0;function l(l){g.load(e[l],(function(e){const n=o.parse(e,!0);r[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},s+=1,6===s&&(1===n.mipmapCount&&(a.minFilter=be),a.image=r,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,i)}if(Array.isArray(e))for(let c=0,I=e.length;c<I;++c)l(c);else g.load(e,(function(e){const n=o.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){r[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)r[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),r[t].format=n.format,r[t].width=n.width,r[t].height=n.height}a.image=r}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=be),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,i);return a}}class Tc extends Fc{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=Kc.get(e);if(void 0!==r)return o.manager.itemStart(e),setTimeout((function(){t&&t(r),o.manager.itemEnd(e)}),0),r;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function g(){a.removeEventListener("load",g,!1),a.removeEventListener("error",s,!1),Kc.add(e,this),t&&t(this),o.manager.itemEnd(e)}function s(t){a.removeEventListener("load",g,!1),a.removeEventListener("error",s,!1),i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)}return a.addEventListener("load",g,!1),a.addEventListener("error",s,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(e),a.src=e,a}}class Uc extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=new Hr,r=new Tc(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let a=0;function g(n){r.load(e[n],(function(e){o.images[n]=e,a++,6===a&&(o.needsUpdate=!0,t&&t(o))}),void 0,i)}for(let s=0;s<e.length;++s)g(s);return o}}class _c extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new Kr,a=new Lc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(o.withCredentials),a.load(e,(function(e){const n=o.parse(e);n&&(void 0!==n.image?r.image=n.image:void 0!==n.data&&(r.image.width=n.width,r.image.height=n.height,r.image.data=n.data),r.wrapS=void 0!==n.wrapS?n.wrapS:Ce,r.wrapT=void 0!==n.wrapT?n.wrapT:Ce,r.magFilter=void 0!==n.magFilter?n.magFilter:be,r.minFilter=void 0!==n.minFilter?n.minFilter:be,r.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(r.encoding=n.encoding),void 0!==n.flipY&&(r.flipY=n.flipY),void 0!==n.format&&(r.format=n.format),void 0!==n.type&&(r.type=n.type),void 0!==n.mipmaps&&(r.mipmaps=n.mipmaps,r.minFilter=Ge),1===n.mipmapCount&&(r.minFilter=be),void 0!==n.generateMipmaps&&(r.generateMipmaps=n.generateMipmaps),r.needsUpdate=!0,t&&t(r,n))}),n,i),r}}class Jc extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=new ei,r=new Tc(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,(function(n){o.image=n;const i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);o.format=i?Me:Fe,o.needsUpdate=!0,void 0!==t&&t(o)}),n,i),o}}class Dc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),o=0;t.push(0);for(let r=1;r<=e;r++)n=this.getPoint(r/e),o+=n.distanceTo(i),t.push(o),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const o=n.length;let r;r=t||e*n[o-1];let a,g=0,s=o-1;for(;g<=s;)if(i=Math.floor(g+(s-g)/2),a=n[i]-r,a<0)g=i+1;else{if(!(a>0)){s=i;break}s=i-1}if(i=s,n[i]===r)return i/(o-1);const l=n[i];return(i+(r-l)/(n[i+1]-l))/(o-1)}getTangent(e,t){const n=1e-4;let i=e-n,o=e+n;i<0&&(i=0),o>1&&(o=1);const r=this.getPoint(i),a=this.getPoint(o),g=t||(r.isVector2?new Qn:new ai);return g.copy(a).sub(r).normalize(),g}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new ai,i=[],o=[],r=[],a=new ai,g=new Mi;for(let C=0;C<=e;C++){const t=C/e;i[C]=this.getTangentAt(t,new ai),i[C].normalize()}o[0]=new ai,r[0]=new ai;let s=Number.MAX_VALUE;const l=Math.abs(i[0].x),c=Math.abs(i[0].y),I=Math.abs(i[0].z);l<=s&&(s=l,n.set(1,0,0)),c<=s&&(s=c,n.set(0,1,0)),I<=s&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),o[0].crossVectors(i[0],a),r[0].crossVectors(i[0],o[0]);for(let C=1;C<=e;C++){if(o[C]=o[C-1].clone(),r[C]=r[C-1].clone(),a.crossVectors(i[C-1],i[C]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(En(i[C-1].dot(i[C]),-1,1));o[C].applyMatrix4(g.makeRotationAxis(a,e))}r[C].crossVectors(i[C],o[C])}if(!0===t){let t=Math.acos(En(o[0].dot(o[e]),-1,1));t/=e,i[0].dot(a.crossVectors(o[0],o[e]))>0&&(t=-t);for(let n=1;n<=e;n++)o[n].applyMatrix4(g.makeRotationAxis(i[n],t*n)),r[n].crossVectors(i[n],o[n])}return{tangents:i,normals:o,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Pc extends Dc{constructor(e=0,t=0,n=1,i=1,o=0,r=2*Math.PI,a=!1,g=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=r,this.aClockwise=a,this.aRotation=g}getPoint(e,t){const n=t||new Qn,i=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const r=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=i;for(;o>i;)o-=i;o<Number.EPSILON&&(o=r?0:i),!0!==this.aClockwise||r||(o===i?o=-i:o-=i);const a=this.aStartAngle+e*o;let g=this.aX+this.xRadius*Math.cos(a),s=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=g-this.aX,i=s-this.aY;g=n*e-i*t+this.aX,s=n*t+i*e+this.aY}return n.set(g,s)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Pc.prototype.isEllipseCurve=!0;class Qc extends Pc{constructor(e,t,n,i,o,r){super(e,t,n,n,i,o,r),this.type="ArcCurve"}}function Oc(){let e=0,t=0,n=0,i=0;function o(o,r,a,g){e=o,t=a,n=-3*o+3*r-2*a-g,i=2*o-2*r+a+g}return{initCatmullRom:function(e,t,n,i,r){o(t,n,r*(n-e),r*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,r,a,g){let s=(t-e)/r-(n-e)/(r+a)+(n-t)/a,l=(n-t)/a-(i-t)/(a+g)+(i-n)/g;s*=a,l*=a,o(t,n,s,l)},calc:function(o){const r=o*o;return e+t*o+n*r+i*(r*o)}}}Qc.prototype.isArcCurve=!0;const jc=new ai,qc=new Oc,$c=new Oc,eI=new Oc;class tI extends Dc{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ai){const n=t,i=this.points,o=i.length,r=(o-(this.closed?0:1))*e;let a,g,s=Math.floor(r),l=r-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/o)+1)*o:0===l&&s===o-1&&(s=o-2,l=1),this.closed||s>0?a=i[(s-1)%o]:(jc.subVectors(i[0],i[1]).add(i[0]),a=jc);const c=i[s%o],I=i[(s+1)%o];if(this.closed||s+2<o?g=i[(s+2)%o]:(jc.subVectors(i[o-1],i[o-2]).add(i[o-1]),g=jc),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(I),e),i=Math.pow(I.distanceToSquared(g),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),qc.initNonuniformCatmullRom(a.x,c.x,I.x,g.x,t,n,i),$c.initNonuniformCatmullRom(a.y,c.y,I.y,g.y,t,n,i),eI.initNonuniformCatmullRom(a.z,c.z,I.z,g.z,t,n,i)}else"catmullrom"===this.curveType&&(qc.initCatmullRom(a.x,c.x,I.x,g.x,this.tension),$c.initCatmullRom(a.y,c.y,I.y,g.y,this.tension),eI.initCatmullRom(a.z,c.z,I.z,g.z,this.tension));return n.set(qc.calc(l),$c.calc(l),eI.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ai).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function nI(e,t,n,i,o){const r=.5*(i-t),a=.5*(o-n),g=e*e;return(2*n-2*i+r+a)*(e*g)+(-3*n+3*i-2*r-a)*g+r*e+n}function iI(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function oI(e,t,n,i,o){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,o)}tI.prototype.isCatmullRomCurve3=!0;class rI extends Dc{constructor(e=new Qn,t=new Qn,n=new Qn,i=new Qn){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Qn){const n=t,i=this.v0,o=this.v1,r=this.v2,a=this.v3;return n.set(oI(e,i.x,o.x,r.x,a.x),oI(e,i.y,o.y,r.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}rI.prototype.isCubicBezierCurve=!0;class aI extends Dc{constructor(e=new ai,t=new ai,n=new ai,i=new ai){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ai){const n=t,i=this.v0,o=this.v1,r=this.v2,a=this.v3;return n.set(oI(e,i.x,o.x,r.x,a.x),oI(e,i.y,o.y,r.y,a.y),oI(e,i.z,o.z,r.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}aI.prototype.isCubicBezierCurve3=!0;class gI extends Dc{constructor(e=new Qn,t=new Qn){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Qn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Qn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}gI.prototype.isLineCurve=!0;class sI extends Dc{constructor(e=new ai,t=new ai){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new ai){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lI extends Dc{constructor(e=new Qn,t=new Qn,n=new Qn){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Qn){const n=t,i=this.v0,o=this.v1,r=this.v2;return n.set(iI(e,i.x,o.x,r.x),iI(e,i.y,o.y,r.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}lI.prototype.isQuadraticBezierCurve=!0;class cI extends Dc{constructor(e=new ai,t=new ai,n=new ai){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ai){const n=t,i=this.v0,o=this.v1,r=this.v2;return n.set(iI(e,i.x,o.x,r.x),iI(e,i.y,o.y,r.y),iI(e,i.z,o.z,r.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cI.prototype.isQuadraticBezierCurve3=!0;class II extends Dc{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Qn){const n=t,i=this.points,o=(i.length-1)*e,r=Math.floor(o),a=o-r,g=i[0===r?r:r-1],s=i[r],l=i[r>i.length-2?i.length-1:r+1],c=i[r>i.length-3?i.length-1:r+2];return n.set(nI(a,g.x,s.x,l.x,c.x),nI(a,g.y,s.y,l.y,c.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Qn).fromArray(n))}return this}}II.prototype.isSplineCurve=!0;var CI=Object.freeze({__proto__:null,ArcCurve:Qc,CatmullRomCurve3:tI,CubicBezierCurve:rI,CubicBezierCurve3:aI,EllipseCurve:Pc,LineCurve:gI,LineCurve3:sI,QuadraticBezierCurve:lI,QuadraticBezierCurve3:cI,SplineCurve:II});class uI extends Dc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new gI(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const e=n[i]-t,o=this.curves[i],r=o.getLength(),a=0===r?0:1-e/r;return o.getPointAt(a)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,o=this.curves;i<o.length;i++){const r=o[i],a=r&&r.isEllipseCurve?2*e:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?e*r.points.length:e,g=r.getPoints(a);for(let e=0;e<g.length;e++){const i=g[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new CI[n.type]).fromJSON(n))}return this}}class dI extends uI{constructor(e){super(),this.type="Path",this.currentPoint=new Qn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new gI(this.currentPoint.clone(),new Qn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const o=new lI(this.currentPoint.clone(),new Qn(e,t),new Qn(n,i));return this.curves.push(o),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,o,r){const a=new rI(this.currentPoint.clone(),new Qn(e,t),new Qn(n,i),new Qn(o,r));return this.curves.push(a),this.currentPoint.set(o,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new II(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,o,r){const a=this.currentPoint.x,g=this.currentPoint.y;return this.absarc(e+a,t+g,n,i,o,r),this}absarc(e,t,n,i,o,r){return this.absellipse(e,t,n,n,i,o,r),this}ellipse(e,t,n,i,o,r,a,g){const s=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+s,t+l,n,i,o,r,a,g),this}absellipse(e,t,n,i,o,r,a,g){const s=new Pc(e,t,n,i,o,r,a,g);if(this.curves.length>0){const e=s.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(s);const l=s.getPoint(1);return this.currentPoint.copy(l),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class hI extends dI{constructor(e){super(e),this.uuid=kn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new dI).fromJSON(n))}return this}}class AI extends so{constructor(e,t=1){super(),this.type="Light",this.color=new Ho(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}AI.prototype.isLight=!0;class pI extends AI{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(so.DefaultUp),this.updateMatrix(),this.groundColor=new Ho(t)}copy(e){return AI.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}pI.prototype.isHemisphereLight=!0;const mI=new Mi,bI=new ai,fI=new ai;class yI{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Qn(512,512),this.map=null,this.mapPass=null,this.matrix=new Mi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Fr,this._frameExtents=new Qn(1,1),this._viewportCount=1,this._viewports=[new ni(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;bI.setFromMatrixPosition(e.matrixWorld),t.position.copy(bI),fI.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(fI),t.updateMatrixWorld(),mI.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mI),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class GI extends yI{constructor(){super(new Vr(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Ln*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;n===t.fov&&i===t.aspect&&o===t.far||(t.fov=n,t.aspect=i,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}GI.prototype.isSpotLightShadow=!0;class vI extends AI{constructor(e,t,n=0,i=Math.PI/3,o=0,r=1){super(e,t),this.type="SpotLight",this.position.copy(so.DefaultUp),this.updateMatrix(),this.target=new so,this.distance=n,this.angle=i,this.penumbra=o,this.decay=r,this.shadow=new GI}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}vI.prototype.isSpotLight=!0;const BI=new Mi,ZI=new ai,wI=new ai;class WI extends yI{constructor(){super(new Vr(90,1,.5,500)),this._frameExtents=new Qn(4,2),this._viewportCount=6,this._viewports=[new ni(2,1,1,1),new ni(0,1,1,1),new ni(3,1,1,1),new ni(1,1,1,1),new ni(3,0,1,1),new ni(1,0,1,1)],this._cubeDirections=[new ai(1,0,0),new ai(-1,0,0),new ai(0,0,1),new ai(0,0,-1),new ai(0,1,0),new ai(0,-1,0)],this._cubeUps=[new ai(0,1,0),new ai(0,1,0),new ai(0,1,0),new ai(0,1,0),new ai(0,0,1),new ai(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),ZI.setFromMatrixPosition(e.matrixWorld),n.position.copy(ZI),wI.copy(n.position),wI.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(wI),n.updateMatrixWorld(),i.makeTranslation(-ZI.x,-ZI.y,-ZI.z),BI.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(BI)}}WI.prototype.isPointLightShadow=!0;class SI extends AI{constructor(e,t,n=0,i=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new WI}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}SI.prototype.isPointLight=!0;class RI extends Rr{constructor(e=-1,t=1,n=1,i=-1,o=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=o,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,o,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=n-e,r=n+e,a=i+t,g=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=e*this.view.offsetX,r=o+e*this.view.width,a-=t*this.view.offsetY,g=a-t*this.view.height}this.projectionMatrix.makeOrthographic(o,r,a,g,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}RI.prototype.isOrthographicCamera=!0;class VI extends yI{constructor(){super(new RI(-5,5,5,-5,.5,500))}}VI.prototype.isDirectionalLightShadow=!0;class xI extends AI{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(so.DefaultUp),this.updateMatrix(),this.target=new so,this.shadow=new VI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}xI.prototype.isDirectionalLight=!0;class XI extends AI{constructor(e,t){super(e,t),this.type="AmbientLight"}}XI.prototype.isAmbientLight=!0;class HI extends AI{constructor(e,t,n=10,i=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}HI.prototype.isRectAreaLight=!0;class YI{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ai)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*i),t.addScaledVector(r[2],.488603*o),t.addScaledVector(r[3],.488603*n),t.addScaledVector(r[4],n*i*1.092548),t.addScaledVector(r[5],i*o*1.092548),t.addScaledVector(r[6],.315392*(3*o*o-1)),t.addScaledVector(r[7],n*o*1.092548),t.addScaledVector(r[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],1.023328*i),t.addScaledVector(r[2],1.023328*o),t.addScaledVector(r[3],1.023328*n),t.addScaledVector(r[4],.858086*n*i),t.addScaledVector(r[5],.858086*i*o),t.addScaledVector(r[6],.743125*o*o-.247708),t.addScaledVector(r[7],.858086*n*o),t.addScaledVector(r[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,o=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-i*i)}}YI.prototype.isSphericalHarmonics3=!0;class KI extends AI{constructor(e=new YI,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}KI.prototype.isLightProbe=!0;class NI extends Fc{constructor(e){super(e),this.textures={}}load(e,t,n,i){const o=this,r=new Lc(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=new bc[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new Ho).setHex(e.sheen)),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.vertexTangents&&(i.vertexTangents=e.vertexTangents),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const o in e.uniforms){const t=e.uniforms[o];switch(i.uniforms[o]={},t.type){case"t":i.uniforms[o].value=n(t.value);break;case"c":i.uniforms[o].value=(new Ho).setHex(t.value);break;case"v2":i.uniforms[o].value=(new Qn).fromArray(t.value);break;case"v3":i.uniforms[o].value=(new ai).fromArray(t.value);break;case"v4":i.uniforms[o].value=(new ni).fromArray(t.value);break;case"m3":i.uniforms[o].value=(new On).fromArray(t.value);break;case"m4":i.uniforms[o].value=(new Mi).fromArray(t.value);break;default:i.uniforms[o].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const o in e.extensions)i.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Qn).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Qn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),i}setTextures(e){return this.textures=e,this}}class MI{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,o=e.length;i<o;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class FI extends or{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}FI.prototype.isInstancedBufferGeometry=!0;class zI extends Mo{constructor(e,t,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=i||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}zI.prototype.isInstancedBufferAttribute=!0;class LI extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new Lc(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const o=e.interleavedBuffers[i],r=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers[t],o=new Uint32Array(i).buffer;return n[t]=o,o}(e,o.buffer),a=Oo(o.type,r),g=new os(a,o.stride);return g.uuid=o.uuid,t[i]=g,g}const o=e.isInstancedBufferGeometry?new FI:new or,r=e.data.index;if(void 0!==r){const e=Oo(r.type,r.array);o.setIndex(new Mo(e,1))}const a=e.data.attributes;for(const c in a){const t=a[c];let n;if(t.isInterleavedBufferAttribute){const o=i(e.data,t.data);n=new as(o,t.itemSize,t.offset,t.normalized)}else{const e=Oo(t.type,t.array);n=new(t.isInstancedBufferAttribute?zI:Mo)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),void 0!==t.updateRange&&(n.updateRange.offset=t.updateRange.offset,n.updateRange.count=t.updateRange.count),o.setAttribute(c,n)}const g=e.data.morphAttributes;if(g)for(const c in g){const t=g[c],n=[];for(let o=0,r=t.length;o<r;o++){const r=t[o];let a;if(r.isInterleavedBufferAttribute){const t=i(e.data,r.data);a=new as(t,r.itemSize,r.offset,r.normalized)}else{const e=Oo(r.type,r.array);a=new Mo(e,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),n.push(a)}o.morphAttributes[c]=n}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(let c=0,I=s.length;c!==I;++c){const e=s[c];o.addGroup(e.start,e.count,e.materialIndex)}const l=e.data.boundingSphere;if(void 0!==l){const e=new ai;void 0!==l.center&&e.fromArray(l.center),o.boundingSphere=new Si(e,l.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class kI extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=this,r=""===this.path?MI.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const a=new Lc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let r=null;try{r=JSON.parse(n)}catch(g){return void 0!==i&&i(g),void console.error("THREE:ObjectLoader: Can't parse "+e+".",g.message)}const a=r.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?o.parse(r,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,i)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,i),r=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),a=this.parseTextures(e.textures,r),g=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,o,g,n),l=this.parseSkeletons(e.skeletons,s);if(this.bindSkeletons(s,l),void 0!==t){let e=!1;for(const t in r)if(r[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(s)}return s}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new hI).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let o=0,r=e.length;o<r;o++){const t=(new Ks).fromJSON(e[o],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};let i;if(void 0!==e){const o=new LI;for(let r=0,a=e.length;r<a;r++){let a;const g=e[r];switch(g.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new sc[g.type](g.width,g.height,g.widthSegments,g.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":a=new sc[g.type](g.width,g.height,g.depth,g.widthSegments,g.heightSegments,g.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new sc[g.type](g.radius,g.segments,g.thetaStart,g.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new sc[g.type](g.radiusTop,g.radiusBottom,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new sc[g.type](g.radius,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new sc[g.type](g.radius,g.widthSegments,g.heightSegments,g.phiStart,g.phiLength,g.thetaStart,g.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new sc[g.type](g.radius,g.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new sc[g.type](g.innerRadius,g.outerRadius,g.thetaSegments,g.phiSegments,g.thetaStart,g.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new sc[g.type](g.radius,g.tube,g.radialSegments,g.tubularSegments,g.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new sc[g.type](g.radius,g.tube,g.tubularSegments,g.radialSegments,g.p,g.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new sc[g.type]((new CI[g.path.type]).fromJSON(g.path),g.tubularSegments,g.radius,g.radialSegments,g.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new sc[g.type](g.points,g.segments,g.phiStart,g.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new sc[g.type](g.vertices,g.indices,g.radius,g.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(let n=0,o=g.shapes.length;n<o;n++){const e=t[g.shapes[n]];i.push(e)}a=new sc[g.type](i,g.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(let n=0,o=g.shapes.length;n<o;n++){const e=t[g.shapes[n]];i.push(e)}const e=g.options.extrudePath;void 0!==e&&(g.options.extrudePath=(new CI[e.type]).fromJSON(e)),a=new sc[g.type](i,g.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=o.parse(g);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+g.type+'"');continue}a.uuid=g.uuid,void 0!==g.name&&(a.name=g.name),!0===a.isBufferGeometry&&void 0!==g.userData&&(a.userData=g.userData),n[g.uuid]=a}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const o=new NI;o.setTextures(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];if("MultiMaterial"===r.type){const e=[];for(let t=0;t<r.materials.length;t++){const i=r.materials[t];void 0===n[i.uuid]&&(n[i.uuid]=o.parse(i)),e.push(n[i.uuid])}i[r.uuid]=e}else void 0===n[r.uuid]&&(n[r.uuid]=o.parse(r)),i[r.uuid]=n[r.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],o=Hc.parse(i);t[o.uuid]=o}return t}parseImages(e,t){const n=this,i={};let o;function r(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Oo(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Nc(t);o=new Tc(n),o.setCrossOrigin(this.crossOrigin);for(let t=0,o=e.length;t<o;t++){const n=e[t],o=n.url;if(Array.isArray(o)){i[n.uuid]=[];for(let e=0,t=o.length;e<t;e++){const t=r(o[e]);null!==t&&(t instanceof HTMLImageElement?i[n.uuid].push(t):i[n.uuid].push(new Kr(t.data,t.width,t.height)))}}else{const e=r(n.url);null!==e&&(i[n.uuid]=e)}}}return i}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let o=0,r=e.length;o<r;o++){const r=e[o];let a;void 0===r.image&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),void 0===t[r.image]&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const g=t[r.image];Array.isArray(g)?(a=new Hr(g),6===g.length&&(a.needsUpdate=!0)):(a=g&&g.data?new Kr(g.data,g.width,g.height):new ei(g),g&&(a.needsUpdate=!0)),a.uuid=r.uuid,void 0!==r.name&&(a.name=r.name),void 0!==r.mapping&&(a.mapping=n(r.mapping,EI)),void 0!==r.offset&&a.offset.fromArray(r.offset),void 0!==r.repeat&&a.repeat.fromArray(r.repeat),void 0!==r.center&&a.center.fromArray(r.center),void 0!==r.rotation&&(a.rotation=r.rotation),void 0!==r.wrap&&(a.wrapS=n(r.wrap[0],TI),a.wrapT=n(r.wrap[1],TI)),void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.encoding&&(a.encoding=r.encoding),void 0!==r.minFilter&&(a.minFilter=n(r.minFilter,UI)),void 0!==r.magFilter&&(a.magFilter=n(r.magFilter,UI)),void 0!==r.anisotropy&&(a.anisotropy=r.anisotropy),void 0!==r.flipY&&(a.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(a.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(a.unpackAlignment=r.unpackAlignment),i[r.uuid]=a}return i}parseObject(e,t,n,i){let o,r,a;function g(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function s(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,o=e.length;i<o;i++){const o=e[i];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":o=new is,void 0!==e.background&&Number.isInteger(e.background)&&(o.background=new Ho(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new ns(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new ts(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new Vr(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new RI(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new XI(e.color,e.intensity);break;case"DirectionalLight":o=new xI(e.color,e.intensity);break;case"PointLight":o=new SI(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new HI(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new vI(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new pI(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new KI).fromJSON(e);break;case"SkinnedMesh":r=g(e.geometry),a=s(e.material),o=new xs(r,a),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":r=g(e.geometry),a=s(e.material),o=new Gr(r,a);break;case"InstancedMesh":r=g(e.geometry),a=s(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;o=new Ls(r,a,t),o.instanceMatrix=new Mo(new Float32Array(n.array),16),void 0!==i&&(o.instanceColor=new Mo(new Float32Array(i.array),i.itemSize));break;case"LOD":o=new Zs;break;case"Line":o=new Ds(g(e.geometry),s(e.material));break;case"LineLoop":o=new js(g(e.geometry),s(e.material));break;case"LineSegments":o=new Os(g(e.geometry),s(e.material));break;case"PointCloud":case"Points":o=new il(g(e.geometry),s(e.material));break;case"Sprite":o=new ys(s(e.material));break;case"Group":o=new Pg;break;case"Bone":o=new Xs;break;default:o=new so}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const r=e.children;for(let e=0;e<r.length;e++)o.add(this.parseObject(r[e],t,n,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=o.getObjectByProperty("uuid",n.object);void 0!==i&&o.addLevel(i,n.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const EI={UVMapping:oe,CubeReflectionMapping:re,CubeRefractionMapping:ae,EquirectangularReflectionMapping:ge,EquirectangularRefractionMapping:se,CubeUVReflectionMapping:le,CubeUVRefractionMapping:ce},TI={RepeatWrapping:Ie,ClampToEdgeWrapping:Ce,MirroredRepeatWrapping:ue},UI={NearestFilter:de,NearestMipmapNearestFilter:he,NearestMipmapLinearFilter:pe,LinearFilter:be,LinearMipmapNearestFilter:fe,LinearMipmapLinearFilter:Ge};class _I extends Fc{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=Kc.get(e);if(void 0!==r)return o.manager.itemStart(e),setTimeout((function(){t&&t(r),o.manager.itemEnd(e)}),0),r;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(o.options,{colorSpaceConversion:"none"}))})).then((function(n){Kc.add(e,n),t&&t(n),o.manager.itemEnd(e)})).catch((function(t){i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)})),o.manager.itemStart(e)}}_I.prototype.isImageBitmapLoader=!0;class JI{constructor(){this.type="ShapePath",this.color=new Ho,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new dI,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,o,r){return this.currentPath.bezierCurveTo(e,t,n,i,o,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],o=new hI;o.curves=i.curves,t.push(o)}return t}function i(e,t){const n=t.length;let i=!1;for(let o=n-1,r=0;r<n;o=r++){let n=t[o],a=t[r],g=a.x-n.x,s=a.y-n.y;if(Math.abs(s)>Number.EPSILON){if(s<0&&(n=t[r],g=-g,a=t[o],s=-s),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=s*(e.x-n.x)-g*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const o=Ul.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===t)return n(r);let a,g,s;const l=[];if(1===r.length)return g=r[0],s=new hI,s.curves=g.curves,l.push(s),l;let c=!o(r[0].getPoints());c=e?!c:c;const I=[],C=[];let u,d,h=[],A=0;C[A]=void 0,h[A]=[];for(let p=0,m=r.length;p<m;p++)g=r[p],u=g.getPoints(),a=o(u),a=e?!a:a,a?(!c&&C[A]&&A++,C[A]={s:new hI,p:u},C[A].s.curves=g.curves,c&&A++,h[A]=[]):h[A].push({h:g,p:u[0]});if(!C[0])return n(r);if(C.length>1){let e=!1;const t=[];for(let n=0,i=C.length;n<i;n++)I[n]=[];for(let n=0,o=C.length;n<o;n++){const o=h[n];for(let r=0;r<o.length;r++){const a=o[r];let g=!0;for(let o=0;o<C.length;o++)i(a.p,C[o].p)&&(n!==o&&t.push({froms:n,tos:o,hole:r}),g?(g=!1,I[o].push(a)):e=!0);g&&I[n].push(a)}}t.length>0&&(e||(h=I))}for(let p=0,m=C.length;p<m;p++){s=C[p].s,l.push(s),d=h[p];for(let e=0,t=d.length;e<t;e++)s.holes.push(d[e].h)}return l}}class DI{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],i=function(e,t,n){const i=Array.from(e),o=t/n.resolution,r=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=[];let g=0,s=0;for(let l=0;l<i.length;l++){const e=i[l];if("\n"===e)g=0,s-=r;else{const t=PI(e,o,g,s,n);g+=t.offsetX,a.push(t.path)}}return a}(e,t,this.data);for(let o=0,r=i.length;o<r;o++)Array.prototype.push.apply(n,i[o].toShapes());return n}}function PI(e,t,n,i,o){const r=o.glyphs[e]||o.glyphs["?"];if(!r)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+o.familyName+".");const a=new JI;let g,s,l,c,I,C,u,d;if(r.o){const e=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let o=0,r=e.length;o<r;){switch(e[o++]){case"m":g=e[o++]*t+n,s=e[o++]*t+i,a.moveTo(g,s);break;case"l":g=e[o++]*t+n,s=e[o++]*t+i,a.lineTo(g,s);break;case"q":l=e[o++]*t+n,c=e[o++]*t+i,I=e[o++]*t+n,C=e[o++]*t+i,a.quadraticCurveTo(I,C,l,c);break;case"b":l=e[o++]*t+n,c=e[o++]*t+i,I=e[o++]*t+n,C=e[o++]*t+i,u=e[o++]*t+n,d=e[o++]*t+i,a.bezierCurveTo(I,C,u,d,l,c)}}}return{offsetX:r.ha*t,path:a}}DI.prototype.isFont=!0;class QI extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new Lc(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(r){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const i=o.parse(n);t&&t(i)}),n,i)}parse(e){return new DI(e)}}let OI;const jI={getContext:function(){return void 0===OI&&(OI=new(window.AudioContext||window.webkitAudioContext)),OI},setContext:function(e){OI=e}};class qI extends Fc{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new Lc(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){try{const e=n.slice(0);jI.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}}class $I extends KI{constructor(e,t,n=1){super(void 0,n);const i=(new Ho).set(e),o=(new Ho).set(t),r=new ai(i.r,i.g,i.b),a=new ai(o.r,o.g,o.b),g=Math.sqrt(Math.PI),s=g*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(a).multiplyScalar(g),this.sh.coefficients[1].copy(r).sub(a).multiplyScalar(s)}}$I.prototype.isHemisphereLightProbe=!0;class eC extends KI{constructor(e,t=1){super(void 0,t);const n=(new Ho).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}eC.prototype.isAmbientLightProbe=!0;const tC=new Mi,nC=new Mi;class iC{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Vr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Vr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),i=t.eyeSep/2,o=i*t.near/t.focus,r=t.near*Math.tan(zn*t.fov*.5)/t.zoom;let a,g;nC.elements[12]=-i,tC.elements[12]=i,a=-r*t.aspect+o,g=r*t.aspect+o,n.elements[0]=2*t.near/(g-a),n.elements[8]=(g+a)/(g-a),this.cameraL.projectionMatrix.copy(n),a=-r*t.aspect-o,g=r*t.aspect-o,n.elements[0]=2*t.near/(g-a),n.elements[8]=(g+a)/(g-a),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(nC),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(tC)}}class oC{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=rC(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=rC();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function rC(){return("undefined"==typeof performance?Date:performance).now()}const aC=new ai,gC=new ri,sC=new ai,lC=new ai;class cC extends so{constructor(){super(),this.type="AudioListener",this.context=jI.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new oC}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(aC,gC,sC),lC.set(0,0,-1).applyQuaternion(gC),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(aC.x,e),t.positionY.linearRampToValueAtTime(aC.y,e),t.positionZ.linearRampToValueAtTime(aC.z,e),t.forwardX.linearRampToValueAtTime(lC.x,e),t.forwardY.linearRampToValueAtTime(lC.y,e),t.forwardZ.linearRampToValueAtTime(lC.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(aC.x,aC.y,aC.z),t.setOrientation(lC.x,lC.y,lC.z,n.x,n.y,n.z)}}class IC extends so{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const CC=new ai,uC=new ri,dC=new ai,hC=new ai;class AC extends IC{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(CC,uC,dC),hC.set(0,0,1).applyQuaternion(uC);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(CC.x,e),t.positionY.linearRampToValueAtTime(CC.y,e),t.positionZ.linearRampToValueAtTime(CC.z,e),t.orientationX.linearRampToValueAtTime(hC.x,e),t.orientationY.linearRampToValueAtTime(hC.y,e),t.orientationZ.linearRampToValueAtTime(hC.z,e)}else t.setPosition(CC.x,CC.y,CC.z),t.setOrientation(hC.x,hC.y,hC.z)}}class pC{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class mC{constructor(e,t,n){let i,o,r;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,o=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,o=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,o=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=o,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,o=e*i+i;let r=this.cumulativeWeight;if(0===r){for(let e=0;e!==i;++e)n[o+e]=n[e];r=t}else{r+=t;const e=t/r;this._mixBufferRegion(n,o,0,e,i)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,o=this.cumulativeWeight,r=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-o,t)}r>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let g=t,s=t+t;g!==s;++g)if(n[g]!==n[g+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let o=n,r=i;o!==r;++o)t[o]=t[i+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,o){if(i>=.5)for(let r=0;r!==o;++r)e[t+r]=e[n+r]}_slerp(e,t,n,i){ri.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,o){const r=this._workIndex*o;ri.multiplyQuaternionsFlat(e,r,e,t,e,n),ri.slerpFlat(e,t,e,t,e,r,i)}_lerp(e,t,n,i,o){const r=1-i;for(let a=0;a!==o;++a){const o=t+a;e[o]=e[o]*r+e[n+a]*i}}_lerpAdditive(e,t,n,i,o){for(let r=0;r!==o;++r){const o=t+r;e[o]=e[o]+e[n+r]*i}}}const bC="\\[\\]\\.:\\/",fC=new RegExp("[\\[\\]\\.:\\/]","g"),yC="[^\\[\\]\\.:\\/]",GC="[^"+bC.replace("\\.","")+"]",vC=/((?:WC+[\/:])*)/.source.replace("WC",yC),BC=/(WCOD+)?/.source.replace("WCOD",GC),ZC=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",yC),wC=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",yC),WC=new RegExp("^"+vC+BC+ZC+wC+"$"),SC=["material","materials","bones"];class RC{constructor(e,t,n){this.path=t,this.parsedPath=n||RC.parseTrackName(t),this.node=RC.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new RC.Composite(e,t,n):new RC(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(fC,"")}static parseTrackName(e){const t=WC.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==SC.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const o=e[i];if(o.name===t||o.uuid===t)return o;const r=n(o.children);if(r)return r}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let o=t.propertyIndex;if(e||(e=RC.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const r=e[i];if(void 0===r){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let g=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[o]&&(o=e.morphTargetDictionary[o])}g=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=o}else void 0!==r.fromArray&&void 0!==r.toArray?(g=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(g=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[g],this.setValue=this.SetterByBindingTypeAndVersioning[g][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}RC.Composite=class{constructor(e,t,n){const i=n||RC.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=n.length;i!==o;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},RC.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},RC.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},RC.prototype.GetterByBindingType=[RC.prototype._getValue_direct,RC.prototype._getValue_array,RC.prototype._getValue_arrayElement,RC.prototype._getValue_toArray],RC.prototype.SetterByBindingTypeAndVersioning=[[RC.prototype._setValue_direct,RC.prototype._setValue_direct_setNeedsUpdate,RC.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[RC.prototype._setValue_array,RC.prototype._setValue_array_setNeedsUpdate,RC.prototype._setValue_array_setMatrixWorldNeedsUpdate],[RC.prototype._setValue_arrayElement,RC.prototype._setValue_arrayElement_setNeedsUpdate,RC.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[RC.prototype._setValue_fromArray,RC.prototype._setValue_fromArray_setNeedsUpdate,RC.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class VC{constructor(){this.uuid=kn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,o=this._bindings,r=o.length;let a,g=e.length,s=this.nCachedObjects_;for(let l=0,c=arguments.length;l!==c;++l){const c=arguments[l],I=c.uuid;let C=t[I];if(void 0===C){C=g++,t[I]=C,e.push(c);for(let e=0,t=r;e!==t;++e)o[e].push(new RC(c,n[e],i[e]))}else if(C<s){a=e[C];const g=--s,l=e[g];t[l.uuid]=C,e[C]=l,t[I]=g,e[g]=c;for(let e=0,t=r;e!==t;++e){const t=o[e],r=t[g];let a=t[C];t[C]=r,void 0===a&&(a=new RC(c,n[e],i[e])),t[g]=a}}else e[C]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=s}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let o=this.nCachedObjects_;for(let r=0,a=arguments.length;r!==a;++r){const a=arguments[r],g=a.uuid,s=t[g];if(void 0!==s&&s>=o){const r=o++,l=e[r];t[l.uuid]=s,e[s]=l,t[g]=r,e[r]=a;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[r],o=t[s];t[s]=i,t[r]=o}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let o=this.nCachedObjects_,r=e.length;for(let a=0,g=arguments.length;a!==g;++a){const g=arguments[a].uuid,s=t[g];if(void 0!==s)if(delete t[g],s<o){const a=--o,g=e[a],l=--r,c=e[l];t[g.uuid]=s,e[s]=g,t[c.uuid]=a,e[a]=c,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],o=t[l];t[s]=i,t[a]=o,t.pop()}}else{const o=--r,a=e[o];o>0&&(t[a.uuid]=s),e[s]=a,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[s]=t[o],t.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const o=this._bindings;if(void 0!==i)return o[i];const r=this._paths,a=this._parsedPaths,g=this._objects,s=g.length,l=this.nCachedObjects_,c=new Array(s);i=o.length,n[e]=i,r.push(e),a.push(t),o.push(c);for(let I=l,C=g.length;I!==C;++I){const n=g[I];c[I]=new RC(n,e,t)}return c}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,o=this._parsedPaths,r=this._bindings,a=r.length-1,g=r[a];t[e[a]]=n,r[n]=g,r.pop(),o[n]=o[a],o.pop(),i[n]=i[a],i.pop()}}}VC.prototype.isAnimationObjectGroup=!0;class xC{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const o=t.tracks,r=o.length,a=new Array(r),g={endingStart:Et,endingEnd:Et};for(let s=0;s!==r;++s){const e=o[s].createInterpolant(null);a[s]=e,e.settings=g}this._interpolantSettings=g,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Mt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,o=i/n,r=n/i;e.warp(1,o,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,o=i.time,r=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const g=a.parameterPositions,s=a.sampleValues;return g[0]=o,g[1]=o+n,s[0]=e/r,s[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const o=this._startTime;if(null!==o){const i=(e-o)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const r=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case Jt:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(r),t[n].accumulateAdditive(a);break;case _t:default:for(let n=0,o=e.length;n!==o;++n)e[n].evaluate(r),t[n].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,o=this._loopCount;const r=n===Ft;if(0===e)return-1===o?i:r&&1==(1&o)?t-i:i;if(n===Nt){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===o&&(e>=0?(o=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,o+=Math.abs(n);const a=this.repetitions-o;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,r)}else this._setEndings(!1,!1,r);this._loopCount=o,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(r&&1==(1&o))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Tt,i.endingEnd=Tt):(i.endingStart=e?this.zeroSlopeAtStart?Tt:Et:Ut,i.endingEnd=t?this.zeroSlopeAtEnd?Tt:Et:Ut)}_scheduleFading(e,t,n){const i=this._mixer,o=i.time;let r=this._weightInterpolant;null===r&&(r=i._lendControlInterpolant(),this._weightInterpolant=r);const a=r.parameterPositions,g=r.sampleValues;return a[0]=o,g[0]=t,a[1]=o+e,g[1]=n,this}}class XC extends Nn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,o=i.length,r=e._propertyBindings,a=e._interpolants,g=n.uuid,s=this._bindingsByRootAndName;let l=s[g];void 0===l&&(l={},s[g]=l);for(let c=0;c!==o;++c){const e=i[c],o=e.name;let s=l[o];if(void 0!==s)r[c]=s;else{if(s=r[c],void 0!==s){null===s._cacheIndex&&(++s.referenceCount,this._addInactiveBinding(s,g,o));continue}const i=t&&t._propertyBindings[c].binding.parsedPath;s=new mC(RC.create(n,o,i),e.ValueTypeName,e.getValueSize()),++s.referenceCount,this._addInactiveBinding(s,g,o),r[c]=s}a[c].resultBuffer=s.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,o=this._actionsByClip;let r=o[t];if(void 0===r)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=r;else{const t=r.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),r.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,r=this._actionsByClip,a=r[o],g=a.knownActions,s=g[g.length-1],l=e._byClipCacheIndex;s._byClipCacheIndex=l,g[l]=s,g.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===g.length&&delete r[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0==--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,o=this._bindings;let r=i[t];void 0===r&&(r={},i[t]=r),r[n]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,o=n.path,r=this._bindingsByRootAndName,a=r[i],g=t[t.length-1],s=e._cacheIndex;g._cacheIndex=s,t[s]=g,t.pop(),delete a[o],0===Object.keys(a).length&&delete r[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new vc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,o=t[i];e.__cacheIndex=i,t[i]=e,o.__cacheIndex=n,t[n]=o}clipAction(e,t,n){const i=t||this._root,o=i.uuid;let r="string"==typeof e?Hc.findByName(i,e):e;const a=null!==r?r.uuid:e,g=this._actionsByClip[a];let s=null;if(void 0===n&&(n=null!==r?r.blendMode:_t),void 0!==g){const e=g.actionByRoot[o];if(void 0!==e&&e.blendMode===n)return e;s=g.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;const l=new xC(this,r,t,n);return this._bindAction(l,s),this._addInactiveAction(l,a,o),l}existingAction(e,t){const n=t||this._root,i=n.uuid,o="string"==typeof e?Hc.findByName(n,e):e,r=o?o.uuid:e,a=this._actionsByClip[r];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,o=Math.sign(e),r=this._accuIndex^=1;for(let s=0;s!==n;++s){t[s]._update(i,e,o,r)}const a=this._bindings,g=this._nActiveBindings;for(let s=0;s!==g;++s)a[s].apply(r);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,o=i[n];if(void 0!==o){const e=o.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const o=i._cacheIndex,r=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,r._cacheIndex=o,t[o]=r,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const e=n[o].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const o in i){const e=i[o];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}XC.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class HC{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new HC(void 0===this.value.clone?this.value:this.value.clone())}}class YC extends os{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n||1}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}YC.prototype.isInstancedInterleavedBuffer=!0;class KC{constructor(e,t,n,i,o){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=o,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}KC.prototype.isGLBufferAttribute=!0;class NC{constructor(e,t,n=0,i=1/0){this.ray=new Ni(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Pi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,n=[]){return FC(e,this,n,t),n.sort(MC),n}intersectObjects(e,t=!1,n=[]){for(let i=0,o=e.length;i<o;i++)FC(e[i],this,n,t);return n.sort(MC),n}}function MC(e,t){return e.distance-t.distance}function FC(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,o=i.length;e<o;e++)FC(i[e],t,n,!0)}}class zC{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(En(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class LC{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const kC=new Qn;class EC{constructor(e=new Qn(1/0,1/0),t=new Qn(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=kC.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Qn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Qn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Qn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Qn),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return kC.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}EC.prototype.isBox2=!0;const TC=new ai,UC=new ai;class _C{constructor(e=new ai,t=new ai){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new ai),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new ai),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new ai),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){TC.subVectors(e,this.start),UC.subVectors(this.end,this.start);const n=UC.dot(UC);let i=UC.dot(TC)/n;return t&&(i=En(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new ai),this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class JC extends so{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}JC.prototype.isImmediateRenderObject=!0;const DC=new ai;class PC extends so{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new or,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,a=1,g=32;r<g;r++,a++){const e=r/g*Math.PI*2,t=a/g*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Jo(i,3));const o=new ks({fog:!1,toneMapped:!1});this.cone=new Os(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),DC.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(DC),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const QC=new ai,OC=new Mi,jC=new Mi;class qC extends Os{constructor(e){const t=$C(e),n=new or,i=[],o=[],r=new Ho(0,0,1),a=new Ho(0,1,0);for(let g=0;g<t.length;g++){const e=t[g];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),o.push(r.r,r.g,r.b),o.push(a.r,a.g,a.b))}n.setAttribute("position",new Jo(i,3)),n.setAttribute("color",new Jo(o,3));super(n,new ks({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");jC.copy(this.root.matrixWorld).invert();for(let o=0,r=0;o<t.length;o++){const e=t[o];e.parent&&e.parent.isBone&&(OC.multiplyMatrices(jC,e.matrixWorld),QC.setFromMatrixPosition(OC),i.setXYZ(r,QC.x,QC.y,QC.z),OC.multiplyMatrices(jC,e.parent.matrixWorld),QC.setFromMatrixPosition(OC),i.setXYZ(r+1,QC.x,QC.y,QC.z),r+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function $C(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,$C(e.children[n]));return t}class eu extends Gr{constructor(e,t,n){super(new tc(t,4,2),new Yo({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const tu=new ai,nu=new Ho,iu=new Ho;class ou extends so{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new jl(t);i.rotateY(.5*Math.PI),this.material=new Yo({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const o=i.getAttribute("position"),r=new Float32Array(3*o.count);i.setAttribute("color",new Mo(r,3)),this.add(new Gr(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");nu.copy(this.light.color),iu.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?nu:iu;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(tu.setFromMatrixPosition(this.light.matrixWorld).negate())}}class ru extends Os{constructor(e=10,t=10,n=4473924,i=8947848){n=new Ho(n),i=new Ho(i);const o=t/2,r=e/t,a=e/2,g=[],s=[];for(let c=0,I=0,C=-a;c<=t;c++,C+=r){g.push(-a,0,C,a,0,C),g.push(C,0,-a,C,0,a);const e=c===o?n:i;e.toArray(s,I),I+=3,e.toArray(s,I),I+=3,e.toArray(s,I),I+=3,e.toArray(s,I),I+=3}const l=new or;l.setAttribute("position",new Jo(g,3)),l.setAttribute("color",new Jo(s,3));super(l,new ks({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class au extends Os{constructor(e=10,t=16,n=8,i=64,o=4473924,r=8947848){o=new Ho(o),r=new Ho(r);const a=[],g=[];for(let l=0;l<=t;l++){const n=l/t*(2*Math.PI),i=Math.sin(n)*e,s=Math.cos(n)*e;a.push(0,0,0),a.push(i,0,s);const c=1&l?o:r;g.push(c.r,c.g,c.b),g.push(c.r,c.g,c.b)}for(let l=0;l<=n;l++){const t=1&l?o:r,s=e-e/n*l;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),o=Math.sin(n)*s,r=Math.cos(n)*s;a.push(o,0,r),g.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),o=Math.sin(n)*s,r=Math.cos(n)*s,a.push(o,0,r),g.push(t.r,t.g,t.b)}}const s=new or;s.setAttribute("position",new Jo(a,3)),s.setAttribute("color",new Jo(g,3));super(s,new ks({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const gu=new ai,su=new ai,lu=new ai;class cu extends so{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let i=new or;i.setAttribute("position",new Jo([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new ks({fog:!1,toneMapped:!1});this.lightPlane=new Ds(i,o),this.add(this.lightPlane),i=new or,i.setAttribute("position",new Jo([0,0,0,0,0,1],3)),this.targetLine=new Ds(i,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){gu.setFromMatrixPosition(this.light.matrixWorld),su.setFromMatrixPosition(this.light.target.matrixWorld),lu.subVectors(su,gu),this.lightPlane.lookAt(su),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(su),this.targetLine.scale.z=lu.length()}}const Iu=new ai,Cu=new Rr;class uu extends Os{constructor(e){const t=new or,n=new ks({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],o=[],r={},a=new Ho(16755200),g=new Ho(16711680),s=new Ho(43775),l=new Ho(16777215),c=new Ho(3355443);function I(e,t,n){C(e,n),C(t,n)}function C(e,t){i.push(0,0,0),o.push(t.r,t.g,t.b),void 0===r[e]&&(r[e]=[]),r[e].push(i.length/3-1)}I("n1","n2",a),I("n2","n4",a),I("n4","n3",a),I("n3","n1",a),I("f1","f2",a),I("f2","f4",a),I("f4","f3",a),I("f3","f1",a),I("n1","f1",a),I("n2","f2",a),I("n3","f3",a),I("n4","f4",a),I("p","n1",g),I("p","n2",g),I("p","n3",g),I("p","n4",g),I("u1","u2",s),I("u2","u3",s),I("u3","u1",s),I("c","t",l),I("p","c",c),I("cn1","cn2",c),I("cn3","cn4",c),I("cf1","cf2",c),I("cf3","cf4",c),t.setAttribute("position",new Jo(i,3)),t.setAttribute("color",new Jo(o,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()}update(){const e=this.geometry,t=this.pointMap;Cu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),du("c",t,e,Cu,0,0,-1),du("t",t,e,Cu,0,0,1),du("n1",t,e,Cu,-1,-1,-1),du("n2",t,e,Cu,1,-1,-1),du("n3",t,e,Cu,-1,1,-1),du("n4",t,e,Cu,1,1,-1),du("f1",t,e,Cu,-1,-1,1),du("f2",t,e,Cu,1,-1,1),du("f3",t,e,Cu,-1,1,1),du("f4",t,e,Cu,1,1,1),du("u1",t,e,Cu,.7,1.1,-1),du("u2",t,e,Cu,-.7,1.1,-1),du("u3",t,e,Cu,0,2,-1),du("cf1",t,e,Cu,-1,0,1),du("cf2",t,e,Cu,1,0,1),du("cf3",t,e,Cu,0,-1,1),du("cf4",t,e,Cu,0,1,1),du("cn1",t,e,Cu,-1,0,-1),du("cn2",t,e,Cu,1,0,-1),du("cn3",t,e,Cu,0,-1,-1),du("cn4",t,e,Cu,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function du(e,t,n,i,o,r,a){Iu.set(o,r,a).unproject(i);const g=t[e];if(void 0!==g){const e=n.getAttribute("position");for(let t=0,n=g.length;t<n;t++)e.setXYZ(g[t],Iu.x,Iu.y,Iu.z)}}const hu=new li;class Au extends Os{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),o=new or;o.setIndex(new Mo(n,1)),o.setAttribute("position",new Mo(i,3)),super(o,new ks({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&hu.setFromObject(this.object),hu.isEmpty())return;const t=hu.min,n=hu.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Os.prototype.copy.call(this,e),this.object=e.object,this}}class pu extends Os{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new or;i.setIndex(new Mo(n,1)),i.setAttribute("position",new Jo([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new ks({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class mu extends Ds{constructor(e,t=1,n=16776960){const i=n,o=new or;o.setAttribute("position",new Jo([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),super(o,new ks({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=new or;r.setAttribute("position",new Jo([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),r.computeBoundingSphere(),this.add(new Gr(r,new Yo({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?h:d,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const bu=new ai;let fu,yu;class Gu extends so{constructor(e=new ai(0,0,1),t=new ai(0,0,0),n=1,i=16776960,o=.2*n,r=.2*o){super(),this.type="ArrowHelper",void 0===fu&&(fu=new or,fu.setAttribute("position",new Jo([0,0,0,0,1,0],3)),yu=new cl(0,.5,1,5,1),yu.translate(0,-.5,0)),this.position.copy(t),this.line=new Ds(fu,new ks({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Gr(yu,new Yo({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{bu.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(bu,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class vu extends Os{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new or;n.setAttribute("position",new Jo(t,3)),n.setAttribute("color",new Jo([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new ks({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Bu=new Float32Array(1),Zu=new Int32Array(Bu.buffer);class wu{static toHalfFloat(e){Bu[0]=e;const t=Zu[0];let n=t>>16&32768,i=t>>12&2047;const o=t>>23&255;return o<103?n:o>142?(n|=31744,n|=(255==o?0:1)&&8388607&t,n):o<113?(i|=2048,n|=(i>>114-o)+(i>>113-o&1),n):(n|=o-112<<10|i>>1,n+=1&i,n)}}const Wu=Math.pow(2,8),Su=[.125,.215,.35,.446,.526,.582],Ru=5+Su.length,Vu=20,xu={[Ot]:0,[jt]:1,[$t]:2,[tn]:3,[nn]:4,[on]:5,[qt]:6},Xu=new Yo({side:h,depthWrite:!1,depthTest:!1}),Hu=new Gr(new Br,Xu),Yu=new RI,{_lodPlanes:Ku,_sizeLods:Nu,_sigmas:Mu}=Ju(),Fu=new Ho;let zu=null;const Lu=(1+Math.sqrt(5))/2,ku=1/Lu,Eu=[new ai(1,1,1),new ai(-1,1,1),new ai(1,1,-1),new ai(-1,1,-1),new ai(0,Lu,ku),new ai(0,Lu,-ku),new ai(ku,0,Lu),new ai(-ku,0,Lu),new ai(Lu,ku,0),new ai(-Lu,ku,0)];function Tu(e){const t=Math.max(e.r,e.g,e.b),n=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);e.multiplyScalar(Math.pow(2,-n));return(n+128)/255}class Uu{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),n=new ai(0,1,0);return new cc({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:xu[Ot]},outputEncoding:{value:xu[Ot]}},vertexShader:ju(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${qu()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}(Vu),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){zu=this._renderer.getRenderTarget();const o=this._allocateTargets();return this._sceneToCubeUV(e,n,i,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Ou(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Qu(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Ku.length;e++)Ku[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(zu),e.scissorTest=!1,Pu(e,0,0,e.width,e.height)}_fromTexture(e){zu=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:de,minFilter:de,generateMipmaps:!1,type:Be,format:ke,encoding:_u(e)?e.encoding:$t,depthBuffer:!1},n=Du(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Du(t),n}_compileMaterial(e){const t=new Gr(Ku[0],e);this._renderer.compile(t,Yu)}_sceneToCubeUV(e,t,n,i){const o=new Vr(90,1,t,n),r=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],g=this._renderer,s=g.autoClear,l=g.outputEncoding,c=g.toneMapping;g.getClearColor(Fu),g.toneMapping=q,g.outputEncoding=Ot,g.autoClear=!1;let I=!1;const C=e.background;if(C){if(C.isColor){Xu.color.copy(C).convertSRGBToLinear(),e.background=null;const t=Tu(Xu.color);Xu.opacity=t,I=!0}}else{Xu.color.copy(Fu).convertSRGBToLinear();const e=Tu(Xu.color);Xu.opacity=e,I=!0}for(let u=0;u<6;u++){const t=u%3;0==t?(o.up.set(0,r[u],0),o.lookAt(a[u],0,0)):1==t?(o.up.set(0,0,r[u]),o.lookAt(0,a[u],0)):(o.up.set(0,r[u],0),o.lookAt(0,0,a[u])),Pu(i,t*Wu,u>2?Wu:0,Wu,Wu),g.setRenderTarget(i),I&&g.render(Hu,o),g.render(e,o)}g.toneMapping=c,g.outputEncoding=l,g.autoClear=s}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Ou()):null==this._equirectShader&&(this._equirectShader=Qu());const i=e.isCubeTexture?this._cubemapShader:this._equirectShader,o=new Gr(Ku[0],i),r=i.uniforms;r.envMap.value=e,e.isCubeTexture||r.texelSize.value.set(1/e.image.width,1/e.image.height),r.inputEncoding.value=xu[e.encoding],r.outputEncoding.value=xu[t.texture.encoding],Pu(t,0,0,3*Wu,2*Wu),n.setRenderTarget(t),n.render(o,Yu)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<Ru;i++){const t=Math.sqrt(Mu[i]*Mu[i]-Mu[i-1]*Mu[i-1]),n=Eu[(i-1)%Eu.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,i,o){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,n,i,"latitudinal",o),this._halfBlur(r,e,n,n,i,"longitudinal",o)}_halfBlur(e,t,n,i,o,r,a){const g=this._renderer,s=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new Gr(Ku[i],s),c=s.uniforms,I=Nu[n]-1,C=isFinite(o)?Math.PI/(2*I):2*Math.PI/39,u=o/C,d=isFinite(o)?1+Math.floor(3*u):Vu;d>Vu&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`);const h=[];let A=0;for(let m=0;m<Vu;++m){const e=m/u,t=Math.exp(-e*e/2);h.push(t),0==m?A+=t:m<d&&(A+=2*t)}for(let m=0;m<h.length;m++)h[m]=h[m]/A;c.envMap.value=e.texture,c.samples.value=d,c.weights.value=h,c.latitudinal.value="latitudinal"===r,a&&(c.poleAxis.value=a),c.dTheta.value=C,c.mipInt.value=8-n,c.inputEncoding.value=xu[e.texture.encoding],c.outputEncoding.value=xu[e.texture.encoding];const p=Nu[i];Pu(t,3*Math.max(0,Wu-2*p),(0===i?0:2*Wu)+2*p*(i>4?i-8+4:0),3*p,2*p),g.setRenderTarget(t),g.render(l,Yu)}}function _u(e){return void 0!==e&&e.type===Be&&(e.encoding===Ot||e.encoding===jt||e.encoding===qt)}function Ju(){const e=[],t=[],n=[];let i=8;for(let o=0;o<Ru;o++){const r=Math.pow(2,i);t.push(r);let a=1/r;o>4?a=Su[o-8+4-1]:0==o&&(a=0),n.push(a);const g=1/(r-1),s=-g/2,l=1+g/2,c=[s,s,l,s,l,l,s,s,l,l,s,l],I=6,C=6,u=3,d=2,h=1,A=new Float32Array(u*C*I),p=new Float32Array(d*C*I),m=new Float32Array(h*C*I);for(let e=0;e<I;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];A.set(i,u*C*e),p.set(c,d*C*e);const o=[e,e,e,e,e,e];m.set(o,h*C*e)}const b=new or;b.setAttribute("position",new Mo(A,u)),b.setAttribute("uv",new Mo(p,d)),b.setAttribute("faceIndex",new Mo(m,h)),e.push(b),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Du(e){const t=new ii(3*Wu,3*Wu,e);return t.texture.mapping=le,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Pu(e,t,n,i,o){e.viewport.set(t,n,i,o),e.scissor.set(t,n,i,o)}function Qu(){const e=new Qn(1,1);return new cc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:xu[Ot]},outputEncoding:{value:xu[Ot]}},vertexShader:ju(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${qu()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function Ou(){return new cc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:xu[Ot]},outputEncoding:{value:xu[Ot]}},vertexShader:ju(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${qu()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function ju(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function qu(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}const $u=0,ed=1,td=0,nd=1,id=2;function od(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function rd(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function ad(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new il(e,t)}function gd(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new ys(e)}function sd(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new il(e,t)}function ld(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new qs(e)}function cd(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new qs(e)}function Id(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new qs(e)}function Cd(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new ai(e,t,n)}function ud(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Mo(e,t).setUsage(wn)}function dd(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Fo(e,t)}function hd(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new zo(e,t)}function Ad(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Lo(e,t)}function pd(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new ko(e,t)}function md(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Eo(e,t)}function bd(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new To(e,t)}function fd(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uo(e,t)}function yd(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Jo(e,t)}function Gd(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Do(e,t)}function vd(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new vu(e)}function Bd(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Au(e,t)}function Zd(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Os(new ml(e.geometry),new ks({color:void 0!==t?t:16777215}))}function wd(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Os(new gc(e.geometry),new ks({color:void 0!==t?t:16777215}))}function Wd(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Lc(e)}function Sd(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new _c(e)}function Rd(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Yr(e,n)}function Vd(){console.error("THREE.CanvasRenderer has been removed")}function xd(){console.error("THREE.JSONLoader has been removed.")}Dc.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Dc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},dI.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},ru.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},qC.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Fc.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),MI.extractUrlBase(e)},Fc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},EC.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},EC.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},EC.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},EC.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},li.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},li.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},li.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},li.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},li.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Si.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Fr.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},_C.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},On.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},On.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},On.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},On.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},On.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},On.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Mi.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Mi.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Mi.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new ai).setFromMatrixColumn(this,3)},Mi.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Mi.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Mi.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mi.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Mi.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Mi.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mi.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Mi.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Mi.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Mi.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Mi.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Mi.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Mi.prototype.makeFrustum=function(e,t,n,i,o,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,o,r)},Mi.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Co.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},ri.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},ri.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ni.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ni.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Ni.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Bo.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Bo.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Bo.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Bo.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Bo.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Bo.barycoordFromPoint=function(e,t,n,i,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Bo.getBarycoord(e,t,n,i,o)},Bo.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Bo.getNormal(e,t,n,i)},hI.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},hI.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Dl(this,e)},hI.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ec(this,e)},Qn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Qn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Qn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ai.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},ai.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},ai.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},ai.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},ai.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},ai.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},ai.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},ai.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},ai.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ni.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},ni.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},so.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},so.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},so.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},so.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},so.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(so.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Gr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Gr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Dt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),xs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Vr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(AI.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Mo.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===wn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(wn)}}}),Mo.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?wn:Zn),this},Mo.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Mo.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},or.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},or.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Mo(arguments[1],arguments[2])))},or.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},or.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},or.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},or.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},or.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(or.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),os.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?wn:Zn),this},os.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Dl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Dl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Dl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},is.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},HC.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(wo.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ho}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===p}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Sr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),$g.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},$g.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},$g.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},$g.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},$g.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},$g.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},$g.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},$g.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},$g.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},$g.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},$g.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},$g.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},$g.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},$g.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},$g.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},$g.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},$g.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},$g.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},$g.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},$g.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},$g.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},$g.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},$g.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},$g.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},$g.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties($g.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?jt:Ot}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Tg.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ii.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),IC.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new qI).load(e,(function(e){t.setBuffer(e)})),this},pC.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Xr.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Xr.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},qn.crossOrigin=void 0,qn.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const o=new Jc;o.setCrossOrigin(this.crossOrigin);const r=o.load(e,n,void 0,i);return t&&(r.mapping=t),r},qn.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const o=new Uc;o.setCrossOrigin(this.crossOrigin);const r=o.load(e,n,void 0,i);return t&&(r.mapping=t),r},qn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},qn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Xd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Hd(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},3460:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var i=n(2955);class o{static computeTangents(e){e.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use BufferGeometry.computeTangents() instead.")}static mergeBufferGeometries(e,t=!1){const n=null!==e[0].index,o=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),a={},g={},s=e[0].morphTargetsRelative,l=new i.BufferGeometry;let c=0;for(let i=0;i<e.length;++i){const I=e[i];let C=0;if(n!==(null!==I.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in I.attributes){if(!o.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(I.attributes[e]),C++}if(C!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". Make sure all geometries have the same number of attributes."),null;if(s!==I.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in I.morphAttributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===g[e]&&(g[e]=[]),g[e].push(I.morphAttributes[e])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(I.userData),t){let e;if(n)e=I.index.count;else{if(void 0===I.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". The geometry must have either an index or a position attribute"),null;e=I.attributes.position.count}l.addGroup(c,e,i),c+=e}}if(n){let t=0;const n=[];for(let i=0;i<e.length;++i){const o=e[i].index;for(let e=0;e<o.count;++e)n.push(o.getX(e)+t);t+=e[i].attributes.position.count}l.setIndex(n)}for(const i in a){const e=this.mergeBufferAttributes(a[i]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+i+" attribute."),null;l.setAttribute(i,e)}for(const i in g){const e=g[i][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[i]=[];for(let t=0;t<e;++t){const e=[];for(let o=0;o<g[i].length;++o)e.push(g[i][o][t]);const n=this.mergeBufferAttributes(e);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+i+" morphAttribute."),null;l.morphAttributes[i].push(n)}}return l}static mergeBufferAttributes(e){let t,n,o,r=0;for(let i=0;i<e.length;++i){const a=e[i];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=a.itemSize),n!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===o&&(o=a.normalized),o!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=a.array.length}const a=new t(r);let g=0;for(let i=0;i<e.length;++i)a.set(e[i].array,g),g+=e[i].array.length;return new i.BufferAttribute(a,n,o)}static interleaveAttributes(e){let t,n=0,o=0;for(let i=0,c=e.length;i<c;++i){const r=e[i];if(void 0===t&&(t=r.array.constructor),t!==r.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=r.array.length,o+=r.itemSize}const r=new i.InterleavedBuffer(new t(n),o);let a=0;const g=[],s=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let c=0,I=e.length;c<I;c++){const t=e[c],n=t.itemSize,o=t.count,I=new i.InterleavedBufferAttribute(r,n,a,t.normalized);g.push(I),a+=n;for(let e=0;e<o;e++)for(let i=0;i<n;i++)I[l[i]](e,t[s[i]](e))}return g}static estimateBytesUsed(e){let t=0;for(const i in e.attributes){const n=e.getAttribute(i);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}static mergeVertices(e,t=1e-4){t=Math.max(t,Number.EPSILON);const n={},o=e.getIndex(),r=e.getAttribute("position"),a=o?o.count:r.count;let g=0;const s=Object.keys(e.attributes),l={},c={},I=[],C=["getX","getY","getZ","getW"];for(let i=0,A=s.length;i<A;i++){const t=s[i];l[t]=[];const n=e.morphAttributes[t];n&&(c[t]=new Array(n.length).fill().map((()=>[])))}const u=Math.log10(1/t),d=Math.pow(10,u);for(let i=0;i<a;i++){const t=o?o.getX(i):i;let r="";for(let n=0,i=s.length;n<i;n++){const i=s[n],o=e.getAttribute(i),a=o.itemSize;for(let e=0;e<a;e++)r+=~~(o[C[e]](t)*d)+","}if(r in n)I.push(n[r]);else{for(let n=0,i=s.length;n<i;n++){const i=s[n],o=e.getAttribute(i),r=e.morphAttributes[i],a=o.itemSize,g=l[i],I=c[i];for(let e=0;e<a;e++){const n=C[e];if(g.push(o[n](t)),r)for(let e=0,i=r.length;e<i;e++)I[e].push(r[e][n](t))}}n[r]=g,I.push(g),g++}}const h=e.clone();for(let A=0,p=s.length;A<p;A++){const t=s[A],n=e.getAttribute(t),o=new n.array.constructor(l[t]),r=new i.BufferAttribute(o,n.itemSize,n.normalized);if(h.setAttribute(t,r),t in c)for(let a=0;a<c[t].length;a++){const n=e.morphAttributes[t][a],o=new n.array.constructor(c[t][a]),r=new i.BufferAttribute(o,n.itemSize,n.normalized);h.morphAttributes[t][a]=r}}return h.setIndex(I),h}static toTrianglesDrawMode(e,t){if(t===i.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===i.TriangleFanDrawMode||t===i.TriangleStripDrawMode){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const o=n.count-2,r=[];if(t===i.TriangleFanDrawMode)for(let e=1;e<=o;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<o;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(r),a.clearGroups(),a}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}static computeMorphedAttributes(e){if(!0!==e.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const t=new i.Vector3,n=new i.Vector3,o=new i.Vector3,r=new i.Vector3,a=new i.Vector3,g=new i.Vector3,s=new i.Vector3,l=new i.Vector3,c=new i.Vector3;function I(e,i,I,C,u,d,h,A,p){t.fromBufferAttribute(I,d),n.fromBufferAttribute(I,h),o.fromBufferAttribute(I,A);const m=e.morphTargetInfluences;if(i.morphTargets&&C&&m){s.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(let e=0,i=C.length;e<i;e++){const i=m[e],I=C[e];0!==i&&(r.fromBufferAttribute(I,d),a.fromBufferAttribute(I,h),g.fromBufferAttribute(I,A),u?(s.addScaledVector(r,i),l.addScaledVector(a,i),c.addScaledVector(g,i)):(s.addScaledVector(r.sub(t),i),l.addScaledVector(a.sub(n),i),c.addScaledVector(g.sub(o),i)))}t.add(s),n.add(l),o.add(c)}e.isSkinnedMesh&&(e.boneTransform(d,t),e.boneTransform(h,n),e.boneTransform(A,o)),p[3*d+0]=t.x,p[3*d+1]=t.y,p[3*d+2]=t.z,p[3*h+0]=n.x,p[3*h+1]=n.y,p[3*h+2]=n.z,p[3*A+0]=o.x,p[3*A+1]=o.y,p[3*A+2]=o.z}const C=e.geometry,u=e.material;let d,h,A;const p=C.index,m=C.attributes.position,b=C.morphAttributes.position,f=C.morphTargetsRelative,y=C.attributes.normal,G=C.morphAttributes.position,v=C.groups,B=C.drawRange;let Z,w,W,S,R,V,x,X;const H=new Float32Array(m.count*m.itemSize),Y=new Float32Array(y.count*y.itemSize);if(null!==p)if(Array.isArray(u))for(Z=0,W=v.length;Z<W;Z++)for(R=v[Z],V=u[R.materialIndex],x=Math.max(R.start,B.start),X=Math.min(R.start+R.count,B.start+B.count),w=x,S=X;w<S;w+=3)d=p.getX(w),h=p.getX(w+1),A=p.getX(w+2),I(e,V,m,b,f,d,h,A,H),I(e,V,y,G,f,d,h,A,Y);else for(x=Math.max(0,B.start),X=Math.min(p.count,B.start+B.count),Z=x,W=X;Z<W;Z+=3)d=p.getX(Z),h=p.getX(Z+1),A=p.getX(Z+2),I(e,u,m,b,f,d,h,A,H),I(e,u,y,G,f,d,h,A,Y);else if(void 0!==m)if(Array.isArray(u))for(Z=0,W=v.length;Z<W;Z++)for(R=v[Z],V=u[R.materialIndex],x=Math.max(R.start,B.start),X=Math.min(R.start+R.count,B.start+B.count),w=x,S=X;w<S;w+=3)d=w,h=w+1,A=w+2,I(e,V,m,b,f,d,h,A,H),I(e,V,y,G,f,d,h,A,Y);else for(x=Math.max(0,B.start),X=Math.min(m.count,B.start+B.count),Z=x,W=X;Z<W;Z+=3)d=Z,h=Z+1,A=Z+2,I(e,u,m,b,f,d,h,A,H),I(e,u,y,G,f,d,h,A,Y);return{positionAttribute:m,normalAttribute:y,morphedPositionAttribute:new i.Float32BufferAttribute(H,3),morphedNormalAttribute:new i.Float32BufferAttribute(Y,3)}}}},8621:function(e,t,n){var i;!function(o){var r=/^\s+/,a=/\s+$/,g=0,s=o.round,l=o.min,c=o.max,I=o.random;function C(e,t){if(t=t||{},(e=e||"")instanceof C)return e;if(!(this instanceof C))return new C(e,t);var n=function(e){var t={r:0,g:0,b:0},n=1,i=null,g=null,s=null,I=!1,C=!1;"string"==typeof e&&(e=function(e){e=e.replace(r,"").replace(a,"").toLowerCase();var t,n=!1;if(V[e])e=V[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=T.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=T.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=T.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=T.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=T.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=T.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=T.hex8.exec(e))return{r:K(t[1]),g:K(t[2]),b:K(t[3]),a:z(t[4]),format:n?"name":"hex8"};if(t=T.hex6.exec(e))return{r:K(t[1]),g:K(t[2]),b:K(t[3]),format:n?"name":"hex"};if(t=T.hex4.exec(e))return{r:K(t[1]+""+t[1]),g:K(t[2]+""+t[2]),b:K(t[3]+""+t[3]),a:z(t[4]+""+t[4]),format:n?"name":"hex8"};if(t=T.hex3.exec(e))return{r:K(t[1]+""+t[1]),g:K(t[2]+""+t[2]),b:K(t[3]+""+t[3]),format:n?"name":"hex"};return!1}(e));"object"==typeof e&&(U(e.r)&&U(e.g)&&U(e.b)?(t=function(e,t,n){return{r:255*H(e,255),g:255*H(t,255),b:255*H(n,255)}}(e.r,e.g,e.b),I=!0,C="%"===String(e.r).substr(-1)?"prgb":"rgb"):U(e.h)&&U(e.s)&&U(e.v)?(i=M(e.s),g=M(e.v),t=function(e,t,n){e=6*H(e,360),t=H(t,100),n=H(n,100);var i=o.floor(e),r=e-i,a=n*(1-t),g=n*(1-r*t),s=n*(1-(1-r)*t),l=i%6;return{r:255*[n,g,a,a,s,n][l],g:255*[s,n,n,g,a,a][l],b:255*[a,a,s,n,n,g][l]}}(e.h,i,g),I=!0,C="hsv"):U(e.h)&&U(e.s)&&U(e.l)&&(i=M(e.s),s=M(e.l),t=function(e,t,n){var i,o,r;function a(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=H(e,360),t=H(t,100),n=H(n,100),0===t)i=o=r=n;else{var g=n<.5?n*(1+t):n+t-n*t,s=2*n-g;i=a(s,g,e+1/3),o=a(s,g,e),r=a(s,g,e-1/3)}return{r:255*i,g:255*o,b:255*r}}(e.h,i,s),I=!0,C="hsl"),e.hasOwnProperty("a")&&(n=e.a));return n=X(n),{ok:I,format:e.format||C,r:l(255,c(t.r,0)),g:l(255,c(t.g,0)),b:l(255,c(t.b,0)),a:n}}(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=s(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=s(this._r)),this._g<1&&(this._g=s(this._g)),this._b<1&&(this._b=s(this._b)),this._ok=n.ok,this._tc_id=g++}function u(e,t,n){e=H(e,255),t=H(t,255),n=H(n,255);var i,o,r=c(e,t,n),a=l(e,t,n),g=(r+a)/2;if(r==a)i=o=0;else{var s=r-a;switch(o=g>.5?s/(2-r-a):s/(r+a),r){case e:i=(t-n)/s+(t<n?6:0);break;case t:i=(n-e)/s+2;break;case n:i=(e-t)/s+4}i/=6}return{h:i,s:o,l:g}}function d(e,t,n){e=H(e,255),t=H(t,255),n=H(n,255);var i,o,r=c(e,t,n),a=l(e,t,n),g=r,s=r-a;if(o=0===r?0:s/r,r==a)i=0;else{switch(r){case e:i=(t-n)/s+(t<n?6:0);break;case t:i=(n-e)/s+2;break;case n:i=(e-t)/s+4}i/=6}return{h:i,s:o,v:g}}function h(e,t,n,i){var o=[N(s(e).toString(16)),N(s(t).toString(16)),N(s(n).toString(16))];return i&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function A(e,t,n,i){return[N(F(i)),N(s(e).toString(16)),N(s(t).toString(16)),N(s(n).toString(16))].join("")}function p(e,t){t=0===t?0:t||10;var n=C(e).toHsl();return n.s-=t/100,n.s=Y(n.s),C(n)}function m(e,t){t=0===t?0:t||10;var n=C(e).toHsl();return n.s+=t/100,n.s=Y(n.s),C(n)}function b(e){return C(e).desaturate(100)}function f(e,t){t=0===t?0:t||10;var n=C(e).toHsl();return n.l+=t/100,n.l=Y(n.l),C(n)}function y(e,t){t=0===t?0:t||10;var n=C(e).toRgb();return n.r=c(0,l(255,n.r-s(-t/100*255))),n.g=c(0,l(255,n.g-s(-t/100*255))),n.b=c(0,l(255,n.b-s(-t/100*255))),C(n)}function G(e,t){t=0===t?0:t||10;var n=C(e).toHsl();return n.l-=t/100,n.l=Y(n.l),C(n)}function v(e,t){var n=C(e).toHsl(),i=(n.h+t)%360;return n.h=i<0?360+i:i,C(n)}function B(e){var t=C(e).toHsl();return t.h=(t.h+180)%360,C(t)}function Z(e){var t=C(e).toHsl(),n=t.h;return[C(e),C({h:(n+120)%360,s:t.s,l:t.l}),C({h:(n+240)%360,s:t.s,l:t.l})]}function w(e){var t=C(e).toHsl(),n=t.h;return[C(e),C({h:(n+90)%360,s:t.s,l:t.l}),C({h:(n+180)%360,s:t.s,l:t.l}),C({h:(n+270)%360,s:t.s,l:t.l})]}function W(e){var t=C(e).toHsl(),n=t.h;return[C(e),C({h:(n+72)%360,s:t.s,l:t.l}),C({h:(n+216)%360,s:t.s,l:t.l})]}function S(e,t,n){t=t||6,n=n||30;var i=C(e).toHsl(),o=360/n,r=[C(e)];for(i.h=(i.h-(o*t>>1)+720)%360;--t;)i.h=(i.h+o)%360,r.push(C(i));return r}function R(e,t){t=t||6;for(var n=C(e).toHsv(),i=n.h,o=n.s,r=n.v,a=[],g=1/t;t--;)a.push(C({h:i,s:o,v:r})),r=(r+g)%1;return a}C.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,i=this.toRgb();return e=i.r/255,t=i.g/255,n=i.b/255,.2126*(e<=.03928?e/12.92:o.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:o.pow((t+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:o.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=X(e),this._roundA=s(100*this._a)/100,this},toHsv:function(){var e=d(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=d(this._r,this._g,this._b),t=s(360*e.h),n=s(100*e.s),i=s(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+i+"%)":"hsva("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=u(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=u(this._r,this._g,this._b),t=s(360*e.h),n=s(100*e.s),i=s(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+i+"%)":"hsla("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return h(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,n,i,o){var r=[N(s(e).toString(16)),N(s(t).toString(16)),N(s(n).toString(16)),N(F(i))];if(o&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)&&r[3].charAt(0)==r[3].charAt(1))return r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0)+r[3].charAt(0);return r.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:s(this._r),g:s(this._g),b:s(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+s(this._r)+", "+s(this._g)+", "+s(this._b)+")":"rgba("+s(this._r)+", "+s(this._g)+", "+s(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:s(100*H(this._r,255))+"%",g:s(100*H(this._g,255))+"%",b:s(100*H(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+s(100*H(this._r,255))+"%, "+s(100*H(this._g,255))+"%, "+s(100*H(this._b,255))+"%)":"rgba("+s(100*H(this._r,255))+"%, "+s(100*H(this._g,255))+"%, "+s(100*H(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(x[h(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+A(this._r,this._g,this._b,this._a),n=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var o=C(e);n="#"+A(o._r,o._g,o._b,o._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,i=this._a<1&&this._a>=0;return t||!i||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return C(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(f,arguments)},brighten:function(){return this._applyModification(y,arguments)},darken:function(){return this._applyModification(G,arguments)},desaturate:function(){return this._applyModification(p,arguments)},saturate:function(){return this._applyModification(m,arguments)},greyscale:function(){return this._applyModification(b,arguments)},spin:function(){return this._applyModification(v,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(S,arguments)},complement:function(){return this._applyCombination(B,arguments)},monochromatic:function(){return this._applyCombination(R,arguments)},splitcomplement:function(){return this._applyCombination(W,arguments)},triad:function(){return this._applyCombination(Z,arguments)},tetrad:function(){return this._applyCombination(w,arguments)}},C.fromRatio=function(e,t){if("object"==typeof e){var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]="a"===i?e[i]:M(e[i]));e=n}return C(e,t)},C.equals=function(e,t){return!(!e||!t)&&C(e).toRgbString()==C(t).toRgbString()},C.random=function(){return C.fromRatio({r:I(),g:I(),b:I()})},C.mix=function(e,t,n){n=0===n?0:n||50;var i=C(e).toRgb(),o=C(t).toRgb(),r=n/100;return C({r:(o.r-i.r)*r+i.r,g:(o.g-i.g)*r+i.g,b:(o.b-i.b)*r+i.b,a:(o.a-i.a)*r+i.a})},C.readability=function(e,t){var n=C(e),i=C(t);return(o.max(n.getLuminance(),i.getLuminance())+.05)/(o.min(n.getLuminance(),i.getLuminance())+.05)},C.isReadable=function(e,t,n){var i,o,r=C.readability(e,t);switch(o=!1,(i=function(e){var t,n;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==n&&"large"!==n&&(n="small");return{level:t,size:n}}(n)).level+i.size){case"AAsmall":case"AAAlarge":o=r>=4.5;break;case"AAlarge":o=r>=3;break;case"AAAsmall":o=r>=7}return o},C.mostReadable=function(e,t,n){var i,o,r,a,g=null,s=0;o=(n=n||{}).includeFallbackColors,r=n.level,a=n.size;for(var l=0;l<t.length;l++)(i=C.readability(e,t[l]))>s&&(s=i,g=C(t[l]));return C.isReadable(e,g,{level:r,size:a})||!o?g:(n.includeFallbackColors=!1,C.mostReadable(e,["#fff","#000"],n))};var V=C.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},x=C.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(V);function X(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function H(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(e);return e=l(t,c(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),o.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function Y(e){return l(1,c(0,e))}function K(e){return parseInt(e,16)}function N(e){return 1==e.length?"0"+e:""+e}function M(e){return e<=1&&(e=100*e+"%"),e}function F(e){return o.round(255*parseFloat(e)).toString(16)}function z(e){return K(e)/255}var L,k,E,T=(k="[\\s|\\(]+("+(L="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+L+")[,|\\s]+("+L+")\\s*\\)?",E="[\\s|\\(]+("+L+")[,|\\s]+("+L+")[,|\\s]+("+L+")[,|\\s]+("+L+")\\s*\\)?",{CSS_UNIT:new RegExp(L),rgb:new RegExp("rgb"+k),rgba:new RegExp("rgba"+E),hsl:new RegExp("hsl"+k),hsla:new RegExp("hsla"+E),hsv:new RegExp("hsv"+k),hsva:new RegExp("hsva"+E),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function U(e){return!!T.CSS_UNIT.exec(e)}e.exports?e.exports=C:void 0===(i=function(){return C}.call(t,n,t,e))||(e.exports=i)}(Math)},2467:function(e,t,n){"use strict";var i=n(2784);function o(e){let t;const n=new Set,i=(e,i)=>{const o="function"==typeof e?e(t):e;if(o!==t){const e=t;t=i?o:Object.assign({},t,o),n.forEach((n=>n(t,e)))}},o=()=>t,r={setState:i,getState:o,subscribe:(e,i,r)=>i||r?((e,i=o,r=Object.is)=>{let a=i(t);function g(){const n=i(t);if(!r(a,n)){const t=a;e(a=n,t)}}return n.add(g),()=>n.delete(g)})(e,i,r):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(i,o,r),r}const r="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;t.Z=function(e){const t="function"==typeof e?o(e):e,n=(e=t.getState,n=Object.is)=>{const[,o]=(0,i.useReducer)((e=>e+1),0),a=t.getState(),g=(0,i.useRef)(a),s=(0,i.useRef)(e),l=(0,i.useRef)(n),c=(0,i.useRef)(!1),I=(0,i.useRef)();let C;void 0===I.current&&(I.current=e(a));let u=!1;(g.current!==a||s.current!==e||l.current!==n||c.current)&&(C=e(a),u=!n(I.current,C)),r((()=>{u&&(I.current=C),g.current=a,s.current=e,l.current=n,c.current=!1}));const d=(0,i.useRef)(a);return r((()=>{const e=()=>{try{const e=t.getState(),n=s.current(e);l.current(I.current,n)||(g.current=e,I.current=n,o())}catch(e){c.current=!0,o()}},n=t.subscribe(e);return t.getState()!==d.current&&e(),n}),[]),u?C:I.current};return Object.assign(n,t),n[Symbol.iterator]=function*(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4"),yield n,yield t},n}},2414:function(e,t){"use strict";t.Z=function(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(t,n[i])||!Object.is(e[n[i]],t[n[i]]))return!1;return!0}}}]);